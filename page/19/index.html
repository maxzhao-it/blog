<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222">


  <link rel="apple-touch-icon" sizes="180x180" href="/blog/uploads/images/gt.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/blog/uploads/images/gt-32.jpg">
  <link rel="icon" type="image/png" sizes="16x16" href="/blog/uploads/images/gt-16.jpg">
  <link rel="mask-icon" href="/blog/uploads/images/logo.png" color="#222">

<link rel="stylesheet" href="/blog/css/main.css">



<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.1.1/css/all.min.css" integrity="sha256-DfWjNxDkM94fVBWx1H5BMMp0Zq7luBlV8QRcSES7s+0=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/animate.css@3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/pace-js@1.2.4/themes/blue/pace-theme-minimal.css">
  <script src="https://cdn.jsdelivr.net/npm/pace-js@1.2.4/pace.min.js" integrity="sha256-gqd7YTjg/BtfqWSwsJOvndl0Bxc8gFImLEkXQT8+qj0=" crossorigin="anonymous"></script>

<script class="next-config" data-name="main" type="application/json">{"hostname":"github.com","root":"/blog/","images":"/blog/images","scheme":"Gemini","darkmode":false,"version":"8.11.1","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12},"copycode":false,"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"Searching...","empty":"We didn't find any results for the search: ${query}","hits_time":"${hits} results found in ${time} ms","hits":"${hits} results found"},"path":"/blog/search.xml","localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false}}</script><script src="/blog/js/config.js"></script>



<link rel="canonical" href="https://github.com/maxzhao-it/blog/page/19/">



<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":true,"isPost":false,"lang":"en","comments":"","permalink":"","path":"page/19/index.html","title":""}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>maxzhao</title>
  





  <noscript>
    <link rel="stylesheet" href="/blog/css/noscript.css">
  </noscript>
<link rel="alternate" href="/blog/atom.xml" title="maxzhao" type="application/atom+xml">
</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/blog/" class="brand" rel="start">
      <i class="logo-line"></i>
      <h1 class="site-title">maxzhao</h1>
      <i class="logo-line"></i>
    </a>
      <p class="site-subtitle" itemprop="description">不要害怕Exception和Error</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="/blog/" rel="section"><i class="fa fa-home fa-fw"></i>Home</a></li><li class="menu-item menu-item-about"><a href="/blog/about/" rel="section"><i class="fa fa-user fa-fw"></i>About</a></li><li class="menu-item menu-item-tags"><a href="/blog/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>Tags</a></li><li class="menu-item menu-item-categories"><a href="/blog/categories/" rel="section"><i class="fa fa-th fa-fw"></i>Categories</a></li><li class="menu-item menu-item-archives"><a href="/blog/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>Archives</a></li><li class="menu-item menu-item-schedule"><a href="/blog/schedule/" rel="section"><i class="fa fa-calendar fa-fw"></i>Schedule</a></li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>Search
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup"><div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off" maxlength="80"
           placeholder="Searching..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close" role="button">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div class="search-result-container no-result">
  <div class="search-result-icon">
    <i class="fa fa-spinner fa-pulse fa-5x"></i>
  </div>
</div>

    </div>
  </div>

</div>
        
  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>

  <aside class="sidebar">

    <div class="sidebar-inner sidebar-overview-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author site-overview-item animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="赵联胜"
      src="/blog/uploads/images/avatar.jpg">
  <p class="site-author-name" itemprop="name">赵联胜</p>
  <div class="site-description" itemprop="description">小码农赵联胜的博客,从遇到Java到爱上Java，工作之余学习Java生态圈中的各种技术。</div>
</div>
<div class="site-state-wrap site-overview-item animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/blog/archives/">
          <span class="site-state-item-count">407</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
          <a href="/blog/categories/">
        <span class="site-state-item-count">182</span>
        <span class="site-state-item-name">categories</span></a>
      </div>
      <div class="site-state-item site-state-tags">
          <a href="/blog/tags/">
        <span class="site-state-item-count">229</span>
        <span class="site-state-item-name">tags</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author site-overview-item animated">
      <span class="links-of-author-item">
        <a href="https://gitee.com/zhaoliansheng" title="GitHub → https:&#x2F;&#x2F;gitee.com&#x2F;zhaoliansheng" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i></a>
      </span>
      <span class="links-of-author-item">
        <a href="/blog/1441439636@qq.com" title="E-Mail → 1441439636@qq.com"><i class="fa fa-envelope fa-fw"></i></a>
      </span>
  </div>


  <div class="links-of-blogroll site-overview-item animated">
    <div class="links-of-blogroll-title"><i class="fa fa-globe fa-fw"></i>
      友情链接
    </div>
    <ul class="links-of-blogroll-list">
        <li class="links-of-blogroll-item">
          <a href="https://www.jianshu.com/u/e8c426a6007e" title="https:&#x2F;&#x2F;www.jianshu.com&#x2F;u&#x2F;e8c426a6007e" rel="noopener" target="_blank">我的简书</a>
        </li>
    </ul>
  </div>

        </div>
      </div>
    </div>
  </aside>
  <div class="sidebar-dimmer"></div>


    </header>

    
  <div class="back-to-top" role="button" aria-label="Back to top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


    <div class="main-inner index posts-expand">

    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://github.com/maxzhao-it/blog/post/15751/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/blog/uploads/images/avatar.jpg">
      <meta itemprop="name" content="赵联胜">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="maxzhao">
      <meta itemprop="description" content="小码农赵联胜的博客,从遇到Java到爱上Java，工作之余学习Java生态圈中的各种技术。">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | maxzhao">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/blog/post/15751/" class="post-title-link" itemprop="url">MyBatisPlus代码生成器自定义FreemarkerEngine</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2022-07-04 14:50:22" itemprop="dateModified" datetime="2022-07-04T14:50:22+08:00">2022-07-04</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/blog/categories/Java/" itemprop="url" rel="index"><span itemprop="name">Java</span></a>
        </span>
          , 
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/blog/categories/Java/MyBatis/" itemprop="url" rel="index"><span itemprop="name">MyBatis</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h1><p>MyBatisPlus：AutoGenerator 是 MyBatis-Plus 的代码生成器，通过 AutoGenerator 可以快速生成 Entity、Mapper、Mapper XML、Service、Controller<br>等各个模块的代码，极大的提升了开发效率。</p>
<p>很多时候上面生成的代码不能满足开发需求，在自定义模板的同时，我们也会自定义模板引擎，这里使用 <code>Freemarker</code>模板引擎。</p>
<blockquote>
<p><a target="_blank" rel="noopener" href="https://mp.baomidou.com/guide/generator.html">MyBatisPlus代码生成器官方简介</a></p>
</blockquote>
<h1 id="配置"><a href="#配置" class="headerlink" title="配置"></a>配置</h1><h2 id="pom-xml配置"><a href="#pom-xml配置" class="headerlink" title="pom.xml配置"></a><code>pom.xml</code>配置</h2><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.freemarker<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>freemarker<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="自定义模板引擎类"><a href="#自定义模板引擎类" class="headerlink" title="自定义模板引擎类"></a>自定义模板引擎类</h2><p><code>CustomFreemarkerTemplateEngine</code></p>
<h2 id="AutoGenerator配置"><a href="#AutoGenerator配置" class="headerlink" title="AutoGenerator配置"></a><code>AutoGenerator</code>配置</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MpGeneratorDemo</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">generator</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">AutoGenerator</span> <span class="variable">mpg</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">AutoGenerator</span>();</span><br><span class="line">        <span class="comment">/**省略其他配置*/</span></span><br><span class="line">        <span class="type">CustomFreemarkerTemplateEngine</span> <span class="variable">templateEngine</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">CustomFreemarkerTemplateEngine</span>(config);</span><br><span class="line">        <span class="comment">/*配置模板引擎的属性，比如自定义的config，构造时传参*/</span></span><br><span class="line">        mpg.setTemplateEngine(templateEngine);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="FreemarkerEngine"><a href="#FreemarkerEngine" class="headerlink" title="FreemarkerEngine"></a><code>FreemarkerEngine</code></h1><h2 id="继承-AbstractTemplateEngine"><a href="#继承-AbstractTemplateEngine" class="headerlink" title="继承 AbstractTemplateEngine"></a>继承 <code>AbstractTemplateEngine</code></h2><p>这里有三个属性</p>
<ol>
<li><code>configuration</code> ：<code>freemarker</code>配置，可以获取模板并操作模板</li>
<li><code>zipOutputStream</code>：导出<code>ZIP</code>文件的输出流</li>
<li><code>config</code>：自定义配置，可以控制是否输出<code>ZIP</code>文件、控制自定义模板属性等等</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CustomFreemarkerTemplateEngine</span> <span class="keyword">extends</span> <span class="title class_">AbstractTemplateEngine</span> &#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * freemarker 配置</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> Configuration configuration;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * zip 输出流</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Setter</span></span><br><span class="line">    <span class="keyword">private</span> ZipOutputStream zipOutputStream;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 自定义配置</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> CodeGeneratorConfig config;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 初始化</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> config 自定义配置</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">CustomFreemarkerTemplateEngine</span><span class="params">(CodeGeneratorConfig config)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.config = config;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> CustomFreemarkerTemplateEngine <span class="title function_">init</span><span class="params">(ConfigBuilder configBuilder)</span> &#123;</span><br><span class="line">        <span class="built_in">super</span>.init(configBuilder);</span><br><span class="line">        configuration = <span class="keyword">new</span> <span class="title class_">Configuration</span>(Configuration.DEFAULT_INCOMPATIBLE_IMPROVEMENTS);</span><br><span class="line">        configuration.setDefaultEncoding(ConstVal.UTF8);</span><br><span class="line">        configuration.setClassForTemplateLoading(FreemarkerTemplateEngine.class, StringPool.SLASH);</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">this</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">writer</span><span class="params">(Map&lt;String, Object&gt; objectMap, String templatePath, String outputFile)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="type">Template</span> <span class="variable">template</span> <span class="operator">=</span> configuration.getTemplate(templatePath);</span><br><span class="line">        <span class="comment">/**生成模板操作***************************/</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 获取模板路径&lt;br&gt;</span></span><br><span class="line"><span class="comment">     * 在配置时，一般不配置 .ftl 文件，这是 Freemarker 模板的习惯，所以这里要在路径上添加 .ftl</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> filePath 模板路径</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 模板真实路径</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">templateFilePath</span><span class="params">(String filePath)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> filePath + <span class="string">&quot;.ftl&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Map&lt;String, Object&gt; <span class="title function_">getObjectMap</span><span class="params">(TableInfo tableInfo)</span> &#123;</span><br><span class="line">        Map&lt;String, Object&gt; objectMap = <span class="built_in">super</span>.getObjectMap(tableInfo);</span><br><span class="line">        <span class="comment">/*****************************/</span></span><br><span class="line">        <span class="keyword">return</span> objectMap;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="writer模板生成方法"><a href="#writer模板生成方法" class="headerlink" title="writer模板生成方法"></a><code>writer</code>模板生成方法</h2><p>当前方法有三个参数：</p>
<ol>
<li>模板的参数<code>Map</code><ul>
<li>当前属性是 <code>AbstractTemplateEngine</code>中配置了一部分</li>
<li>自定义模板引擎中自定义一部分</li>
</ul>
</li>
<li>模板路径</li>
<li>输出文件路径</li>
</ol>
<p>模板生成方法主要做了3件事：</p>
<ol>
<li>根据模板路径获取模板<ul>
<li>模板路径是由配置路径和<code>templateFilePath</code>方法创建的</li>
<li><code>templateFilePath</code>方法是参入配置路径，返回实际模板路径</li>
</ul>
</li>
<li>生成模板</li>
<li>写入<code>ZIP</code>文件</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CustomFreemarkerTemplateEngine</span> <span class="keyword">extends</span> <span class="title class_">AbstractTemplateEngine</span> &#123;</span><br><span class="line">    <span class="comment">/************************************/</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">writer</span><span class="params">(Map&lt;String, Object&gt; objectMap, String templatePath, String outputFile)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="type">Template</span> <span class="variable">template</span> <span class="operator">=</span> configuration.getTemplate(templatePath);</span><br><span class="line">        <span class="keyword">try</span> (<span class="type">FileOutputStream</span> <span class="variable">fileOutputStream</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">FileOutputStream</span>(outputFile)) &#123;</span><br><span class="line">            template.process(objectMap, <span class="keyword">new</span> <span class="title class_">OutputStreamWriter</span>(fileOutputStream, ConstVal.UTF8));</span><br><span class="line">        &#125;</span><br><span class="line">        log.debug(<span class="string">&quot;模板:&quot;</span> + templatePath + <span class="string">&quot;;  文件:&quot;</span> + outputFile);</span><br><span class="line">        <span class="keyword">if</span> (config.getUseZip()) &#123;</span><br><span class="line">            <span class="type">InputStream</span> <span class="variable">inputStream</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">            <span class="type">BufferedInputStream</span> <span class="variable">bufferedInputStream</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">            zipOutputStream.putNextEntry(<span class="keyword">new</span> <span class="title class_">ZipEntry</span>(outputFile.replace(config.getOutPutDir(), <span class="string">&quot;&quot;</span>)));</span><br><span class="line">            <span class="type">byte</span>[] buff = <span class="keyword">new</span> <span class="title class_">byte</span>[<span class="number">4096</span>];</span><br><span class="line">            <span class="type">int</span> len;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                inputStream = <span class="keyword">new</span> <span class="title class_">FileInputStream</span>(outputFile);</span><br><span class="line">                <span class="comment">/*读取文件*/</span></span><br><span class="line">                bufferedInputStream = <span class="keyword">new</span> <span class="title class_">BufferedInputStream</span>(inputStream);</span><br><span class="line">                <span class="comment">/*判断：当前已经传递的数据大小+当前已有的长度，小于总长度时，*/</span></span><br><span class="line">                <span class="keyword">while</span> ((len = bufferedInputStream.read(buff)) != -<span class="number">1</span>) &#123;</span><br><span class="line">                    zipOutputStream.write(buff, <span class="number">0</span>, len);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">                log.error(<span class="string">&quot;代码生成器：输出ZIP错误：模板 :&#123;&#125;;  文件:&#123;&#125;&quot;</span>, templatePath, outputFile);</span><br><span class="line">                log.error(<span class="string">&quot;代码生成器：输出ZIP错误&quot;</span>, e);</span><br><span class="line">            &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">                IOUtils.closeQuietly(inputStream);</span><br><span class="line">                IOUtils.closeQuietly(bufferedInputStream);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"><span class="comment">/************************************/</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="getObjectMap获取模板参数方法"><a href="#getObjectMap获取模板参数方法" class="headerlink" title="getObjectMap获取模板参数方法"></a><code>getObjectMap</code>获取模板参数方法</h2><ol>
<li>当前方法只有一个参数<code>TableInfo</code>，顾名思义，就是单表的信息。</li>
<li><code>TableInfo</code>主要包括表结构、主要的<code>Class</code>名 <code> Entity、Mapper、Mapper XML、Service、Controller</code>；</li>
<li>如果在  <code>AutoGenerator</code> 中配置了策略，这里就会得到执行策略后的名字。</li>
</ol>
<p>我在这里配置了一个自己的<code>CustomTableInfo</code>(附录)，除了自带的信息外，好包含了 <code>dtoName、voName、convertName</code>等等。</p>
<p>下面是一段配置的作用是，传入模板参数 <code>activeCrud</code>，当前参数可以在模板中判断是否生成 <code>crud</code>代码（需要模板中有相关代码）：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">  <span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CustomFreemarkerTemplateEngine</span> <span class="keyword">extends</span> <span class="title class_">AbstractTemplateEngine</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Map&lt;String, Object&gt; <span class="title function_">getObjectMap</span><span class="params">(TableInfo tableInfo)</span> &#123;</span><br><span class="line">        Map&lt;String, Object&gt; objectMap = <span class="built_in">super</span>.getObjectMap(tableInfo);</span><br><span class="line">        <span class="comment">/*使用增删改查*/</span></span><br><span class="line">        objectMap.put(<span class="string">&quot;activeCrud&quot;</span>, config.getActiveCrud());</span><br><span class="line">        <span class="keyword">return</span> objectMap;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>我在 <code>freemarker</code>自定义模板中，就可以使用</p>
<h1 id="附录"><a href="#附录" class="headerlink" title="附录"></a>附录</h1><h2 id="CodeGeneratorFactory类"><a href="#CodeGeneratorFactory类" class="headerlink" title="CodeGeneratorFactory类"></a><code>CodeGeneratorFactory</code>类</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.gt.code.generator.factory;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.annotation.DbType;</span><br><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.annotation.FieldFill;</span><br><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.core.toolkit.StringPool;</span><br><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.generator.AutoGenerator;</span><br><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.generator.InjectionConfig;</span><br><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.generator.config.*;</span><br><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.generator.config.converts.OracleTypeConvert;</span><br><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.generator.config.po.TableFill;</span><br><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.generator.config.po.TableInfo;</span><br><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.generator.config.rules.IColumnType;</span><br><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.generator.config.rules.NamingStrategy;</span><br><span class="line"><span class="keyword">import</span> com.gt.code.generator.config.CodeGeneratorConfig;</span><br><span class="line"><span class="keyword">import</span> com.gt.code.generator.config.CodeGeneratorDbConfig;</span><br><span class="line"><span class="keyword">import</span> com.gt.code.generator.config.CodeGeneratorEnumVal;</span><br><span class="line"><span class="keyword">import</span> com.gt.code.generator.config.CodeGeneratorVal;</span><br><span class="line"><span class="keyword">import</span> com.gt.code.generator.util.template.CustomFreemarkerTemplateEngine;</span><br><span class="line"><span class="keyword">import</span> org.apache.commons.io.IOUtils;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.ByteArrayOutputStream;</span><br><span class="line"><span class="keyword">import</span> java.io.File;</span><br><span class="line"><span class="keyword">import</span> java.util.*;</span><br><span class="line"><span class="keyword">import</span> java.util.zip.ZipOutputStream;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 生成代码工厂&lt;br&gt;</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> maxzhao</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2021-08-27</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CodeGeneratorFactory</span> &#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 自动填充</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> List&lt;TableFill&gt; TABLE_FILL_LIST = Arrays.asList(</span><br><span class="line">            <span class="keyword">new</span> <span class="title class_">TableFill</span>(<span class="string">&quot;createTime&quot;</span>, FieldFill.INSERT),</span><br><span class="line">            <span class="keyword">new</span> <span class="title class_">TableFill</span>(<span class="string">&quot;updateTime&quot;</span>, FieldFill.UPDATE),</span><br><span class="line">            <span class="keyword">new</span> <span class="title class_">TableFill</span>(<span class="string">&quot;delStatus&quot;</span>, FieldFill.INSERT_UPDATE));</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="title function_">CodeGeneratorFactory</span><span class="params">()</span> &#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="type">byte</span>[] generate(CodeGeneratorConfig config) &#123;</span><br><span class="line">        <span class="type">AutoGenerator</span> <span class="variable">mpg</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">AutoGenerator</span>();</span><br><span class="line">        <span class="type">CodeGeneratorDbConfig</span> <span class="variable">dbConfig</span> <span class="operator">=</span> config.getDbConfig();</span><br><span class="line">        <span class="comment">/*输出路径*/</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">outPutDir</span> <span class="operator">=</span> config.getFullOutPutDir();</span><br><span class="line">        <span class="comment">//region 注入配置</span></span><br><span class="line">        mpg.setCfg(configInjection(config));</span><br><span class="line">        <span class="comment">//endregion</span></span><br><span class="line">        <span class="comment">//region 数据源配置</span></span><br><span class="line">        <span class="type">DataSourceConfig</span> <span class="variable">dataSource</span> <span class="operator">=</span> dbConfig.generatorDataSourceConfig();</span><br><span class="line">        <span class="keyword">if</span> (dataSource.getDbType() == DbType.ORACLE) &#123;</span><br><span class="line">            dataSource.setTypeConvert(<span class="keyword">new</span> <span class="title class_">OracleTypeConvert</span>() &#123;</span><br><span class="line">                <span class="meta">@Override</span></span><br><span class="line">                <span class="keyword">public</span> IColumnType <span class="title function_">processTypeConvert</span><span class="params">(GlobalConfig globalConfig, String fieldType)</span> &#123;</span><br><span class="line">                    <span class="keyword">if</span> (fieldType.toLowerCase(Locale.ROOT).matches(<span class="string">&quot;&quot;</span>)) &#123;</span><br><span class="line"></span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="keyword">return</span> <span class="built_in">super</span>.processTypeConvert(globalConfig, fieldType);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;);</span><br><span class="line">        &#125;</span><br><span class="line">        mpg.setDataSource(dataSource);</span><br><span class="line">        <span class="comment">//endregion</span></span><br><span class="line">        <span class="comment">//region 表策略配置</span></span><br><span class="line">        <span class="type">StrategyConfig</span> <span class="variable">strategy</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StrategyConfig</span>();</span><br><span class="line">        <span class="comment">/*驼峰*/</span></span><br><span class="line">        strategy.setNaming(NamingStrategy.underline_to_camel);</span><br><span class="line">        <span class="comment">/*驼峰*/</span></span><br><span class="line">        strategy.setColumnNaming(NamingStrategy.underline_to_camel);</span><br><span class="line">        <span class="comment">/*使用 lombok*/</span></span><br><span class="line">        strategy.setEntityLombokModel(<span class="literal">true</span>);</span><br><span class="line">        <span class="comment">/*默认使用 restfull风格*/</span></span><br><span class="line">        strategy.setRestControllerStyle(<span class="literal">true</span>);</span><br><span class="line">        <span class="comment">/*标*/</span></span><br><span class="line">        strategy.setInclude(config.getTablesNames());</span><br><span class="line">        <span class="comment">/*驼峰转连字符串*/</span></span><br><span class="line">        strategy.setControllerMappingHyphenStyle(<span class="literal">true</span>);</span><br><span class="line">        strategy.setTablePrefix(config.getTablePrefix());</span><br><span class="line">        <span class="comment">/*字段添加 @TableField*/</span></span><br><span class="line">        strategy.setEntityTableFieldAnnotationEnable(<span class="literal">true</span>);</span><br><span class="line">        strategy.setTableFillList(TABLE_FILL_LIST);</span><br><span class="line">        mpg.setStrategy(strategy);</span><br><span class="line">        <span class="comment">//endregion</span></span><br><span class="line">        <span class="comment">//region 包配置</span></span><br><span class="line">        <span class="type">PackageConfig</span> <span class="variable">pc</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">PackageConfig</span>();</span><br><span class="line">        pc.setModuleName(config.getModuleName());</span><br><span class="line">        pc.setParent(config.getParentPackage());</span><br><span class="line">        <span class="comment">/*设置 controller 文件 包名*/</span></span><br><span class="line">        pc.setController(CodeGeneratorEnumVal.CONTROLLER.getPackageName());</span><br><span class="line">        <span class="comment">/*设置 xml 文件 包名*/</span></span><br><span class="line">        pc.setXml(<span class="string">&quot;mapper&quot;</span>);</span><br><span class="line">        <span class="comment">/*设置 entity 文件 包名*/</span></span><br><span class="line">        pc.setEntity(<span class="string">&quot;model.entity&quot;</span>);</span><br><span class="line">        pc.setXml(<span class="string">&quot;mapper&quot;</span>);</span><br><span class="line">        mpg.setPackageInfo(pc);</span><br><span class="line">        <span class="comment">//endregion</span></span><br><span class="line">        <span class="comment">//region 模板配置</span></span><br><span class="line">        <span class="type">TemplateConfig</span> <span class="variable">templateConfig</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">TemplateConfig</span>()</span><br><span class="line">                .setEntity(CodeGeneratorEnumVal.ENTITY.getTemplate())</span><br><span class="line">                .setController(CodeGeneratorEnumVal.CONTROLLER.getTemplate())</span><br><span class="line">                .setService(CodeGeneratorEnumVal.SERVICE.getTemplate())</span><br><span class="line">                .setServiceImpl(CodeGeneratorEnumVal.SERVICE_IMPL.getTemplate())</span><br><span class="line">                .setMapper(CodeGeneratorEnumVal.MAPPER.getTemplate())</span><br><span class="line">                .setXml(CodeGeneratorEnumVal.TEMPLATE_XML.getTemplate());</span><br><span class="line">        mpg.setTemplate(templateConfig);</span><br><span class="line">        <span class="comment">//endregion</span></span><br><span class="line">        <span class="comment">//region 全局配置</span></span><br><span class="line">        <span class="comment">/*默认使用雪花算法*/</span></span><br><span class="line">        <span class="type">GlobalConfig</span> <span class="variable">gc</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">GlobalConfig</span>();</span><br><span class="line">        gc.setOutputDir(outPutDir);</span><br><span class="line">        gc.setAuthor(config.getAuthor());</span><br><span class="line">        gc.setOpen(<span class="literal">false</span>);</span><br><span class="line">        <span class="comment">/*默认不覆盖，如果文件存在，将不会再生成，配置true就是覆盖*/</span></span><br><span class="line">        gc.setFileOverride(<span class="literal">true</span>);</span><br><span class="line">        <span class="comment">/*配置 swagger2*/</span></span><br><span class="line">        gc.setSwagger2(config.getSwagger2());</span><br><span class="line">        <span class="comment">/*开启 ActiveRecord 模式*/</span></span><br><span class="line">        gc.setActiveRecord(config.getActiveRecord());</span><br><span class="line">        mpg.setGlobalConfig(gc);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//endregion</span></span><br><span class="line">        <span class="comment">//region 模板引擎</span></span><br><span class="line">        <span class="comment">// 选择 freemarker 引擎需要指定如下加，注意 pom 依赖必须有！</span></span><br><span class="line">        <span class="type">CustomFreemarkerTemplateEngine</span> <span class="variable">templateEngine</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">CustomFreemarkerTemplateEngine</span>(config);</span><br><span class="line">        <span class="type">ByteArrayOutputStream</span> <span class="variable">outputStream</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">        <span class="type">ZipOutputStream</span> <span class="variable">zip</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">        <span class="keyword">if</span> (config.getUseZip()) &#123;</span><br><span class="line">            <span class="comment">/*下载zip文件 字节输出流*/</span></span><br><span class="line">            outputStream = <span class="keyword">new</span> <span class="title class_">ByteArrayOutputStream</span>();</span><br><span class="line">            zip = <span class="keyword">new</span> <span class="title class_">ZipOutputStream</span>(outputStream);</span><br><span class="line">            templateEngine.setZipOutputStream(zip);</span><br><span class="line">            <span class="comment">/*下载zip ，会覆盖文件*/</span></span><br><span class="line">            gc.setFileOverride(<span class="literal">true</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        mpg.setTemplateEngine(templateEngine);</span><br><span class="line">        <span class="comment">//endregion</span></span><br><span class="line">        mpg.execute();</span><br><span class="line">        <span class="keyword">if</span> (config.getUseZip()) &#123;</span><br><span class="line">            <span class="comment">/*获取结果*/</span></span><br><span class="line">            <span class="comment">//等同于自己写判断然后关闭</span></span><br><span class="line">            IOUtils.closeQuietly(zip);</span><br><span class="line">            <span class="keyword">return</span> outputStream != <span class="literal">null</span> ? outputStream.toByteArray() : <span class="literal">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 添加自动填充</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> tableFill 新的自动填充</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">addTableFill</span><span class="params">(TableFill tableFill)</span> &#123;</span><br><span class="line">        TABLE_FILL_LIST.add(tableFill);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 配置自定义参数/属性</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> config 配置信息</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> InjectionConfig <span class="title function_">configInjection</span><span class="params">(CodeGeneratorConfig config)</span> &#123;</span><br><span class="line">        <span class="comment">// 自定义配置</span></span><br><span class="line">        <span class="type">InjectionConfig</span> <span class="variable">cfg</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">InjectionConfig</span>() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">initMap</span><span class="params">()</span> &#123;</span><br><span class="line">                <span class="type">String</span> <span class="variable">controllerPackage</span> <span class="operator">=</span> <span class="built_in">this</span>.getConfig().getPackageInfo().get(<span class="string">&quot;Controller&quot;</span>);</span><br><span class="line">                <span class="built_in">this</span>.getConfig().getPackageInfo().put(<span class="string">&quot;Dto&quot;</span>, controllerPackage + <span class="string">&quot;.dto&quot;</span>);</span><br><span class="line">                <span class="built_in">this</span>.getConfig().getPackageInfo().put(<span class="string">&quot;Params&quot;</span>, controllerPackage + <span class="string">&quot;.Params&quot;</span>);</span><br><span class="line">                <span class="built_in">this</span>.getConfig().getPackageInfo().put(<span class="string">&quot;Vo&quot;</span>, controllerPackage + <span class="string">&quot;.vo&quot;</span>);</span><br><span class="line">                <span class="built_in">this</span>.getConfig().getPackageInfo().put(<span class="string">&quot;Convert&quot;</span>, controllerPackage.substring(<span class="number">0</span>, controllerPackage.lastIndexOf(CodeGeneratorEnumVal.CONTROLLER.getPackageName())) + CodeGeneratorEnumVal.CONVERT.getPackageName());</span><br><span class="line">                <span class="type">String</span> <span class="variable">xmlPath</span> <span class="operator">=</span> <span class="built_in">this</span>.getConfig().getPathInfo().get(<span class="string">&quot;xml_path&quot;</span>);</span><br><span class="line">                <span class="comment">/*修改 xml 生成路径*/</span></span><br><span class="line">                <span class="built_in">this</span>.getConfig().getPathInfo().put(<span class="string">&quot;xml_path&quot;</span>, xmlPath.replace(CodeGeneratorVal.JAVA_SOURCE_PATH, CodeGeneratorVal.XML_SOURCE_PATH));</span><br><span class="line">                Map&lt;String, Object&gt; map = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;(<span class="number">4</span>);</span><br><span class="line">                <span class="comment">/*自定义cfg引用*/</span></span><br><span class="line">                <span class="built_in">this</span>.setMap(map);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;;</span><br><span class="line">        List&lt;FileOutConfig&gt; focList = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        <span class="comment">/*dto 模板*/</span></span><br><span class="line">        focList.add(convertFileOutConfig(config, CodeGeneratorEnumVal.DTO));</span><br><span class="line">        <span class="comment">/*params 模板*/</span></span><br><span class="line">        focList.add(convertFileOutConfig(config, CodeGeneratorEnumVal.PARAMS));</span><br><span class="line">        <span class="comment">/*vo 模板*/</span></span><br><span class="line">        focList.add(convertFileOutConfig(config, CodeGeneratorEnumVal.VO));</span><br><span class="line">        <span class="comment">/*判断是否使用 mapstruct convert*/</span></span><br><span class="line">        <span class="keyword">if</span> ((config.getUseConvert() != <span class="literal">null</span> &amp;&amp; config.getUseConvert())</span><br><span class="line">                <span class="comment">/*增删查改时使用*/</span></span><br><span class="line">                || (config.getActiveCrud() != <span class="literal">null</span> &amp;&amp; config.getActiveCrud())) &#123;</span><br><span class="line">            <span class="comment">/*convert 模板*/</span></span><br><span class="line">            focList.add(convertFileOutConfig(config, CodeGeneratorEnumVal.CONVERT));</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">/*使用增删查改*/</span></span><br><span class="line">        <span class="keyword">if</span> (config.getActiveCrud() != <span class="literal">null</span> &amp;&amp; config.getActiveCrud()) &#123;</span><br><span class="line">            <span class="comment">/*exception 模板*/</span></span><br><span class="line">            focList.add(convertFileOutConfig(config, CodeGeneratorEnumVal.EXCEPTION));</span><br><span class="line">            <span class="comment">/*exception enum 模板*/</span></span><br><span class="line">            focList.add(convertFileOutConfig(config, CodeGeneratorEnumVal.EXCEPTION_ENUM));</span><br><span class="line">            <span class="comment">/*exception handler 模板*/</span></span><br><span class="line">            focList.add(convertFileOutConfig(config, CodeGeneratorEnumVal.EXCEPTION_HANDLER));</span><br><span class="line">        &#125;</span><br><span class="line">        cfg.setFileOutConfigList(focList);</span><br><span class="line">        <span class="keyword">return</span> cfg;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 加载文件输出配置</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> config  配置</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> enumVal 模板</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> mybatis plus 文件输出配置</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> FileOutConfig <span class="title function_">convertFileOutConfig</span><span class="params">(CodeGeneratorConfig config, CodeGeneratorEnumVal enumVal)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">FileOutConfig</span>(enumVal.getTemplate()) &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="keyword">public</span> String <span class="title function_">outputFile</span><span class="params">(TableInfo tableInfo)</span> &#123;</span><br><span class="line">                <span class="comment">/*指定模板生，自定义生成文件到哪个地方*/</span></span><br><span class="line">                <span class="keyword">return</span> config.getModuleOutPutDir() + File.separator +</span><br><span class="line">                        enumVal.getPackageName().replace(<span class="string">&quot;.&quot;</span>, File.separator) +</span><br><span class="line">                        File.separator +</span><br><span class="line">                        String.format(enumVal.getClassName(), tableInfo.getEntityName()) + StringPool.DOT_JAVA;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="CustomFreemarkerTemplateEngine类"><a href="#CustomFreemarkerTemplateEngine类" class="headerlink" title="CustomFreemarkerTemplateEngine类"></a><code>CustomFreemarkerTemplateEngine</code>类</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.gt.code.generator.util.template;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.core.toolkit.StringPool;</span><br><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.generator.config.ConstVal;</span><br><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.generator.config.builder.ConfigBuilder;</span><br><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.generator.config.po.TableInfo;</span><br><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.generator.engine.AbstractTemplateEngine;</span><br><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.generator.engine.FreemarkerTemplateEngine;</span><br><span class="line"><span class="keyword">import</span> com.gt.code.generator.config.CodeGeneratorConfig;</span><br><span class="line"><span class="keyword">import</span> com.gt.code.generator.config.CodeGeneratorEnumVal;</span><br><span class="line"><span class="keyword">import</span> com.gt.code.generator.util.CustomTableInfo;</span><br><span class="line"><span class="keyword">import</span> freemarker.template.Configuration;</span><br><span class="line"><span class="keyword">import</span> freemarker.template.Template;</span><br><span class="line"><span class="keyword">import</span> lombok.Setter;</span><br><span class="line"><span class="keyword">import</span> lombok.extern.slf4j.Slf4j;</span><br><span class="line"><span class="keyword">import</span> org.apache.commons.io.IOUtils;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.*;</span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"><span class="keyword">import</span> java.util.zip.ZipEntry;</span><br><span class="line"><span class="keyword">import</span> java.util.zip.ZipOutputStream;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 自定义 Freemarker 模板引擎</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> maxzhao</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2021-08-28 08:36</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CustomFreemarkerTemplateEngine</span> <span class="keyword">extends</span> <span class="title class_">AbstractTemplateEngine</span> &#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * freemarker 配置</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> Configuration configuration;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * zip 输出流</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Setter</span></span><br><span class="line">    <span class="keyword">private</span> ZipOutputStream zipOutputStream;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 自定义配置</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> CodeGeneratorConfig config;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 初始化</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> config 自定义配置</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">CustomFreemarkerTemplateEngine</span><span class="params">(CodeGeneratorConfig config)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.config = config;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> CustomFreemarkerTemplateEngine <span class="title function_">init</span><span class="params">(ConfigBuilder configBuilder)</span> &#123;</span><br><span class="line">        <span class="built_in">super</span>.init(configBuilder);</span><br><span class="line">        configuration = <span class="keyword">new</span> <span class="title class_">Configuration</span>(Configuration.DEFAULT_INCOMPATIBLE_IMPROVEMENTS);</span><br><span class="line">        configuration.setDefaultEncoding(ConstVal.UTF8);</span><br><span class="line">        configuration.setClassForTemplateLoading(FreemarkerTemplateEngine.class, StringPool.SLASH);</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">this</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">writer</span><span class="params">(Map&lt;String, Object&gt; objectMap, String templatePath, String outputFile)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="type">Template</span> <span class="variable">template</span> <span class="operator">=</span> configuration.getTemplate(templatePath);</span><br><span class="line">        <span class="keyword">try</span> (<span class="type">FileOutputStream</span> <span class="variable">fileOutputStream</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">FileOutputStream</span>(outputFile)) &#123;</span><br><span class="line">            template.process(objectMap, <span class="keyword">new</span> <span class="title class_">OutputStreamWriter</span>(fileOutputStream, ConstVal.UTF8));</span><br><span class="line">        &#125;</span><br><span class="line">        log.debug(<span class="string">&quot;模板:&quot;</span> + templatePath + <span class="string">&quot;;  文件:&quot;</span> + outputFile);</span><br><span class="line">        <span class="keyword">if</span> (config.getUseZip()) &#123;</span><br><span class="line">            <span class="type">InputStream</span> <span class="variable">inputStream</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">            <span class="type">BufferedInputStream</span> <span class="variable">bufferedInputStream</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">            zipOutputStream.putNextEntry(<span class="keyword">new</span> <span class="title class_">ZipEntry</span>(outputFile.replace(config.getOutPutDir(), <span class="string">&quot;&quot;</span>)));</span><br><span class="line">            <span class="type">byte</span>[] buff = <span class="keyword">new</span> <span class="title class_">byte</span>[<span class="number">4096</span>];</span><br><span class="line">            <span class="type">int</span> len;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                inputStream = <span class="keyword">new</span> <span class="title class_">FileInputStream</span>(outputFile);</span><br><span class="line">                <span class="comment">/*读取文件*/</span></span><br><span class="line">                bufferedInputStream = <span class="keyword">new</span> <span class="title class_">BufferedInputStream</span>(inputStream);</span><br><span class="line">                <span class="comment">/*判断：当前已经传递的数据大小+当前已有的长度，小于总长度时，*/</span></span><br><span class="line">                <span class="keyword">while</span> ((len = bufferedInputStream.read(buff)) != -<span class="number">1</span>) &#123;</span><br><span class="line">                    zipOutputStream.write(buff, <span class="number">0</span>, len);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">                log.error(<span class="string">&quot;代码生成器：输出ZIP错误：模板 :&#123;&#125;;  文件:&#123;&#125;&quot;</span>, templatePath, outputFile);</span><br><span class="line">                log.error(<span class="string">&quot;代码生成器：输出ZIP错误&quot;</span>, e);</span><br><span class="line">            &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">                IOUtils.closeQuietly(inputStream);</span><br><span class="line">                IOUtils.closeQuietly(bufferedInputStream);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 获取模板路径&lt;br&gt;</span></span><br><span class="line"><span class="comment">     * 在配置时，一般不配置 .ftl 文件，这是 Freemarker 模板的习惯，所以这里要在路径上添加 .ftl</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> filePath 模板路径</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 模板真实路径</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">templateFilePath</span><span class="params">(String filePath)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> filePath + <span class="string">&quot;.ftl&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Map&lt;String, Object&gt; <span class="title function_">getObjectMap</span><span class="params">(TableInfo tableInfo)</span> &#123;</span><br><span class="line">        Map&lt;String, Object&gt; objectMap = <span class="built_in">super</span>.getObjectMap(tableInfo);</span><br><span class="line">        <span class="comment">/*获取类 Package*/</span></span><br><span class="line">        Map&lt;String, String&gt; packageInfo = <span class="built_in">super</span>.getConfigBuilder().getPackageInfo();</span><br><span class="line">        <span class="type">String</span> <span class="variable">controllerPackage</span> <span class="operator">=</span> packageInfo.get(<span class="string">&quot;Controller&quot;</span>);</span><br><span class="line">        <span class="comment">/*基础 package*/</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">basePackage</span> <span class="operator">=</span> controllerPackage.substring(<span class="number">0</span>, controllerPackage.lastIndexOf(CodeGeneratorEnumVal.CONTROLLER.getPackageName()));</span><br><span class="line">        packageInfo.put(<span class="string">&quot;basePackage&quot;</span>, basePackage);</span><br><span class="line">        <span class="comment">/*自定义表数据*/</span></span><br><span class="line">        <span class="type">CustomTableInfo</span> <span class="variable">customTableInfo</span> <span class="operator">=</span> CustomTableInfo.getInstance(tableInfo);</span><br><span class="line">        <span class="comment">/*使用增删改查*/</span></span><br><span class="line">        objectMap.put(<span class="string">&quot;activeCrud&quot;</span>, config.getActiveCrud());</span><br><span class="line">        <span class="keyword">if</span> (config.getActiveCrud() != <span class="literal">null</span> &amp;&amp; config.getActiveCrud()) &#123;</span><br><span class="line">            <span class="comment">/*使用增删改查时，添加代码引入*/</span></span><br><span class="line">            packageInfo.put(<span class="string">&quot;ExceptionHandler&quot;</span>, basePackage + <span class="string">&quot;exception.handler&quot;</span>);</span><br><span class="line">            packageInfo.put(<span class="string">&quot;Exception&quot;</span>, basePackage + <span class="string">&quot;exception&quot;</span>);</span><br><span class="line">            packageInfo.put(<span class="string">&quot;ExceptionEnum&quot;</span>, basePackage + <span class="string">&quot;exception&quot;</span>);</span><br><span class="line">            customTableInfo.initImportPackage(packageInfo);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">/*每个类的 package*/</span></span><br><span class="line">        objectMap.put(<span class="string">&quot;packageInfo&quot;</span>, packageInfo);</span><br><span class="line">        <span class="comment">/*自定义表数据*/</span></span><br><span class="line">        objectMap.put(<span class="string">&quot;table&quot;</span>, customTableInfo);</span><br><span class="line">        <span class="keyword">return</span> objectMap;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="CustomTableInfo类"><a href="#CustomTableInfo类" class="headerlink" title="CustomTableInfo类"></a><code>CustomTableInfo</code>类</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.gt.code.generator.util;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.core.toolkit.StringPool;</span><br><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.generator.config.po.TableField;</span><br><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.generator.config.po.TableInfo;</span><br><span class="line"><span class="keyword">import</span> com.gt.code.generator.config.CodeGeneratorEnumVal;</span><br><span class="line"><span class="keyword">import</span> lombok.Data;</span><br><span class="line"><span class="keyword">import</span> lombok.EqualsAndHashCode;</span><br><span class="line"><span class="keyword">import</span> lombok.experimental.Accessors;</span><br><span class="line"><span class="keyword">import</span> org.springframework.util.StringUtils;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.*;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 自定义表配置</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> maxzhao</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2021-08-29 10:47</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@EqualsAndHashCode(callSuper = true)</span></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@Accessors(chain = true)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CustomTableInfo</span> <span class="keyword">extends</span> <span class="title class_">TableInfo</span> &#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 主键类型，默认为 String</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> String idTypeClassName;</span><br><span class="line">    <span class="keyword">private</span> String dtoName;</span><br><span class="line">    <span class="keyword">private</span> String paramsName;</span><br><span class="line">    <span class="keyword">private</span> String voName;</span><br><span class="line">    <span class="keyword">private</span> String convertName;</span><br><span class="line">    <span class="keyword">private</span> String serviceBeanName;</span><br><span class="line">    <span class="keyword">private</span> String mapperBeanName;</span><br><span class="line">    <span class="keyword">private</span> String convertBeanName;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 异常类名</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> String exceptionName;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 异常枚举</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> String exceptionEnumName;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 异常处理类名</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> String exceptionHandlerName;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 使用 crud 时的 CONTROLLER 引入</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Set&lt;String&gt; apiImportPackages = <span class="keyword">new</span> <span class="title class_">HashSet</span>&lt;&gt;();</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 使用 crud 时的 SERVICE 接口引入</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Set&lt;String&gt; serviceImportPackages = <span class="keyword">new</span> <span class="title class_">HashSet</span>&lt;&gt;();</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 使用 crud 时的 SERVICE 实现引入</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Set&lt;String&gt; serviceImplImportPackages = <span class="keyword">new</span> <span class="title class_">HashSet</span>&lt;&gt;();</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 使用 crud 时的 通用 实现引入</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Set&lt;String&gt; crudImplImportPackages = <span class="keyword">new</span> <span class="title class_">HashSet</span>&lt;&gt;();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">CustomTableInfo</span><span class="params">(TableInfo tableInfo)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.setConvert(tableInfo.isConvert());</span><br><span class="line">        <span class="built_in">this</span>.setEntityName(tableInfo.getEntityName());</span><br><span class="line">        List&lt;TableField&gt; fields = tableInfo.getFields();</span><br><span class="line">        <span class="built_in">this</span>.setFields(fields);</span><br><span class="line">        <span class="keyword">for</span> (TableField field : fields) &#123;</span><br><span class="line">            <span class="keyword">if</span> (field.isKeyFlag()) &#123;</span><br><span class="line">                <span class="built_in">this</span>.idTypeClassName = field.getColumnType().getType();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (!StringUtils.hasText(<span class="built_in">this</span>.idTypeClassName)) &#123;</span><br><span class="line">            <span class="built_in">this</span>.idTypeClassName = <span class="string">&quot;String&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">this</span>.getImportPackages().addAll(tableInfo.getImportPackages());</span><br><span class="line">        <span class="built_in">this</span>.setName(tableInfo.getName());</span><br><span class="line">        <span class="built_in">this</span>.setComment(tableInfo.getComment());</span><br><span class="line">        <span class="built_in">this</span>.setEntityName(tableInfo.getEntityName());</span><br><span class="line">        <span class="built_in">this</span>.setMapperName(tableInfo.getMapperName());</span><br><span class="line">        <span class="built_in">this</span>.setXmlName(tableInfo.getXmlName());</span><br><span class="line">        <span class="built_in">this</span>.setServiceName(tableInfo.getServiceName());</span><br><span class="line">        <span class="built_in">this</span>.setServiceImplName(tableInfo.getServiceImplName());</span><br><span class="line">        <span class="built_in">this</span>.setControllerName(tableInfo.getControllerName());</span><br><span class="line">        <span class="built_in">this</span>.setCommonFields(tableInfo.getCommonFields());</span><br><span class="line">        <span class="built_in">this</span>.setFieldNames(tableInfo.getFieldNames());</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> CustomTableInfo <span class="title function_">getInstance</span><span class="params">(TableInfo tableInfo)</span> &#123;</span><br><span class="line">        <span class="type">CustomTableInfo</span> <span class="variable">customTableInfo</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">CustomTableInfo</span>(tableInfo);</span><br><span class="line"></span><br><span class="line">        customTableInfo.setDtoName(String.format(CodeGeneratorEnumVal.DTO.getClassName(), tableInfo.getEntityName()));</span><br><span class="line">        customTableInfo.setParamsName(String.format(CodeGeneratorEnumVal.PARAMS.getClassName(), tableInfo.getEntityName()));</span><br><span class="line">        customTableInfo.setVoName(String.format(CodeGeneratorEnumVal.VO.getClassName(), tableInfo.getEntityName()));</span><br><span class="line">        customTableInfo.setConvertName(String.format(CodeGeneratorEnumVal.CONVERT.getClassName(), tableInfo.getEntityName()));</span><br><span class="line"></span><br><span class="line">        <span class="type">String</span> <span class="variable">serviceBeanName</span> <span class="operator">=</span> customTableInfo.getServiceName().substring(<span class="number">1</span>);</span><br><span class="line">        serviceBeanName = serviceBeanName.substring(<span class="number">0</span>, <span class="number">1</span>).toLowerCase() + serviceBeanName.substring(<span class="number">1</span>);</span><br><span class="line">        customTableInfo.setServiceBeanName(serviceBeanName);</span><br><span class="line">        <span class="type">String</span> <span class="variable">mapperBeanName</span> <span class="operator">=</span> customTableInfo.getMapperName();</span><br><span class="line">        mapperBeanName = mapperBeanName.substring(<span class="number">0</span>, <span class="number">1</span>).toLowerCase() + mapperBeanName.substring(<span class="number">1</span>);</span><br><span class="line">        customTableInfo.setMapperBeanName(mapperBeanName);</span><br><span class="line">        customTableInfo.setConvertBeanName(customTableInfo.getConvertName().substring(<span class="number">0</span>, <span class="number">1</span>).toLowerCase(Locale.ROOT) +</span><br><span class="line">                customTableInfo.getConvertName().substring(<span class="number">1</span>));</span><br><span class="line"></span><br><span class="line">        <span class="comment">/*异常类名 */</span></span><br><span class="line">        customTableInfo.setExceptionName(String.format(CodeGeneratorEnumVal.EXCEPTION.getClassName(), tableInfo.getEntityName()));</span><br><span class="line">        customTableInfo.setExceptionEnumName(String.format(CodeGeneratorEnumVal.EXCEPTION_ENUM.getClassName(), tableInfo.getEntityName()));</span><br><span class="line">        customTableInfo.setExceptionHandlerName(String.format(CodeGeneratorEnumVal.EXCEPTION_HANDLER.getClassName(), tableInfo.getEntityName()));</span><br><span class="line">        <span class="keyword">return</span> customTableInfo;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 初始化导入依赖</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> packageInfo 所有的 package</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">initImportPackage</span><span class="params">(Map&lt;String, String&gt; packageInfo)</span> &#123;</span><br><span class="line">        apiImportPackages.add(java.util.List.class.getCanonicalName());</span><br><span class="line">        apiImportPackages.add(org.springframework.http.ResponseEntity.class.getCanonicalName());</span><br><span class="line"></span><br><span class="line">        serviceImportPackages.add(java.util.List.class.getCanonicalName());</span><br><span class="line">        serviceImplImportPackages.add(java.util.List.class.getCanonicalName());</span><br><span class="line">        serviceImplImportPackages.add(packageInfo.get(<span class="string">&quot;Convert&quot;</span>) + StringPool.DOT + <span class="built_in">this</span>.getConvertName());</span><br><span class="line">        serviceImplImportPackages.add(packageInfo.get(<span class="string">&quot;Exception&quot;</span>) + StringPool.DOT + <span class="built_in">this</span>.getExceptionName());</span><br><span class="line">        serviceImplImportPackages.add(packageInfo.get(<span class="string">&quot;ExceptionEnum&quot;</span>) + StringPool.DOT + <span class="built_in">this</span>.getExceptionEnumName());</span><br><span class="line">        serviceImplImportPackages.add(packageInfo.get(<span class="string">&quot;ExceptionHandler&quot;</span>) + StringPool.DOT + <span class="built_in">this</span>.getExceptionHandlerName());</span><br><span class="line">        serviceImplImportPackages.add(com.baomidou.mybatisplus.core.conditions.query.LambdaQueryWrapper.class.getCanonicalName());</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        crudImplImportPackages.add(com.baomidou.mybatisplus.core.metadata.IPage.class.getCanonicalName());</span><br><span class="line">        crudImplImportPackages.add(com.baomidou.mybatisplus.extension.plugins.pagination.Page.class.getCanonicalName());</span><br><span class="line">        crudImplImportPackages.add(packageInfo.get(<span class="string">&quot;Dto&quot;</span>) + StringPool.DOT + <span class="built_in">this</span>.dtoName);</span><br><span class="line">        crudImplImportPackages.add(packageInfo.get(<span class="string">&quot;Params&quot;</span>) + StringPool.DOT + <span class="built_in">this</span>.paramsName);</span><br><span class="line">        crudImplImportPackages.add(packageInfo.get(<span class="string">&quot;Vo&quot;</span>) + StringPool.DOT + <span class="built_in">this</span>.voName);</span><br><span class="line">        crudImplImportPackages.add(packageInfo.get(<span class="string">&quot;Entity&quot;</span>) + StringPool.DOT + <span class="built_in">this</span>.getEntityName());</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p>本文地址： <a href="https://github.com/maxzhao-it/blog/post/15751/">https://github.com/maxzhao-it/blog/post/15751/</a> </p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://github.com/maxzhao-it/blog/post/8bda86f41/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/blog/uploads/images/avatar.jpg">
      <meta itemprop="name" content="赵联胜">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="maxzhao">
      <meta itemprop="description" content="小码农赵联胜的博客,从遇到Java到爱上Java，工作之余学习Java生态圈中的各种技术。">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | maxzhao">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/blog/post/8bda86f41/" class="post-title-link" itemprop="url">Idea配置Java版权信息</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2022-12-23 17:16:30" itemprop="dateModified" datetime="2022-12-23T17:16:30+08:00">2022-12-23</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/blog/categories/Java/" itemprop="url" rel="index"><span itemprop="name">Java</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h2 id="配置版权信息"><a href="#配置版权信息" class="headerlink" title="配置版权信息"></a>配置版权信息</h2><p>打开<code>setting-Editor-Copyright-CopyrightProfiles</code></p>
<p>变量配置</p>
<table>
<thead>
<tr>
<th>名称</th>
<th>类型</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td><code>$today</code></td>
<td><code>DateInfo</code></td>
<td><code>当前日期时间对象</code></td>
</tr>
<tr>
<td><code>$file.fileName</code></td>
<td><code>String</code></td>
<td><code>当前文件的名称</code></td>
</tr>
<tr>
<td><code>$file.pathName</code></td>
<td><code>String</code></td>
<td><code>当前文件的完整路径</code></td>
</tr>
<tr>
<td><code>$file.className</code></td>
<td><code>String</code></td>
<td><code>当前文件的类名</code></td>
</tr>
<tr>
<td><code>$file.qualifiedClassName</code></td>
<td><code>String</code></td>
<td><code>当前文件的权限定名</code></td>
</tr>
<tr>
<td><code>$file.lastModified</code></td>
<td><code>DateInfo</code></td>
<td><code>上一次修改的日期时间对象</code></td>
</tr>
<tr>
<td><code>$project.name</code></td>
<td><code>String</code></td>
<td><code>当前项目名</code></td>
</tr>
<tr>
<td><code>$module.name</code></td>
<td><code>String</code></td>
<td><code>当前 Module 名</code></td>
</tr>
<tr>
<td><code>$username</code></td>
<td><code>String</code></td>
<td><code>当前用户名（系统用户名）</code></td>
</tr>
</tbody></table>
<p><code>DateInfo</code>配置信息</p>
<table>
<thead>
<tr>
<th>名称</th>
<th>类型</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td><code>year</code></td>
<td><code>int</code></td>
<td><code>当前年份</code></td>
</tr>
<tr>
<td><code>month</code></td>
<td><code>int</code></td>
<td><code>当前月份</code></td>
</tr>
<tr>
<td><code>day</code></td>
<td><code>int</code></td>
<td><code>当前日期（1-31）</code></td>
</tr>
<tr>
<td><code>hour</code></td>
<td><code>int</code></td>
<td><code>当前小时（0-11）</code></td>
</tr>
<tr>
<td><code>hour24</code></td>
<td><code>int</code></td>
<td><code>当前小时（0-23）</code></td>
</tr>
<tr>
<td><code>minute</code></td>
<td><code>int</code></td>
<td><code>当前分钟（0-59）</code></td>
</tr>
<tr>
<td><code>second</code></td>
<td><code>int</code></td>
<td><code>当前秒数（0-59）</code></td>
</tr>
<tr>
<td><code>format(String format)</code></td>
<td><code>String</code></td>
<td><code>时间日期格式化</code></td>
</tr>
</tbody></table>
<h2 id="配置-Scope"><a href="#配置-Scope" class="headerlink" title="配置 Scope"></a>配置 <code>Scope</code></h2><p>打开<code>setting-Editor-Copyright</code></p>
<p><img src="/blog/uploads/images/JAVA/image-20220615110322148.png" alt="image-20220615110322148"></p>
<h2 id="快速引入"><a href="#快速引入" class="headerlink" title="快速引入"></a>快速引入</h2><p>在<code>java</code>文件的类上方按<code>Alt + Ins</code></p>
<p>本文地址： <a href="https://github.com/maxzhao-it/blog/post/8bda86f41/">https://github.com/maxzhao-it/blog/post/8bda86f41/</a> </p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://github.com/maxzhao-it/blog/post/8bda86f4/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/blog/uploads/images/avatar.jpg">
      <meta itemprop="name" content="赵联胜">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="maxzhao">
      <meta itemprop="description" content="小码农赵联胜的博客,从遇到Java到爱上Java，工作之余学习Java生态圈中的各种技术。">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | maxzhao">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/blog/post/8bda86f4/" class="post-title-link" itemprop="url">Java操作图片裁剪</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2022-07-28 17:37:15" itemprop="dateModified" datetime="2022-07-28T17:37:15+08:00">2022-07-28</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/blog/categories/Java/" itemprop="url" rel="index"><span itemprop="name">Java</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h1><p><code>Java</code> 操作图片，实现图片的裁剪</p>
<h1 id="裁剪图片"><a href="#裁剪图片" class="headerlink" title="裁剪图片"></a>裁剪图片</h1><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ImageUtil</span> &#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 获取人脸图片数据</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> pictureBytes 照片数据</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> contentType  请求内容类型</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> faceName     人脸模型名称</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 人脸图片数据</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="type">byte</span>[] getFaceHead(String faceName, <span class="type">byte</span>[] pictureBytes, MediaType contentType) &#123;</span><br><span class="line">        <span class="comment">/*获取人脸位置与大小*/</span></span><br><span class="line">        <span class="type">double</span>[] faceDetectResult = <span class="built_in">this</span>.getFaceDetectResult(faceName, pictureBytes, contentType);</span><br><span class="line">        <span class="keyword">if</span> (faceDetectResult[<span class="number">0</span>] == <span class="number">0</span></span><br><span class="line">                &amp;&amp; faceDetectResult[<span class="number">1</span>] == <span class="number">0</span></span><br><span class="line">                &amp;&amp; (faceDetectResult[<span class="number">2</span>] == <span class="number">0</span></span><br><span class="line">                || faceDetectResult[<span class="number">3</span>] == <span class="number">0</span>)) &#123;</span><br><span class="line">            log.warn(<span class="string">&quot;图片无法裁剪，使用原图片&quot;</span>);</span><br><span class="line">            <span class="keyword">return</span> pictureBytes;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">/*裁剪图片*/</span></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">/*获取图片 buffer*/</span></span><br><span class="line">            <span class="type">BufferedImage</span> <span class="variable">pictureImage</span> <span class="operator">=</span> ImageIO.read(<span class="keyword">new</span> <span class="title class_">ByteArrayInputStream</span>(pictureBytes));</span><br><span class="line">            <span class="keyword">final</span> <span class="type">int</span> <span class="variable">width</span> <span class="operator">=</span> pictureImage.getWidth();</span><br><span class="line">            <span class="keyword">final</span> <span class="type">int</span> <span class="variable">height</span> <span class="operator">=</span> pictureImage.getHeight();</span><br><span class="line">            <span class="comment">/*图片裁剪*/</span></span><br><span class="line">            <span class="type">int</span> <span class="variable">x</span> <span class="operator">=</span> (<span class="type">int</span>) (faceDetectResult[<span class="number">0</span>] * width);</span><br><span class="line">            <span class="comment">/*坐标 - 10*/</span></span><br><span class="line">            x = Math.max((x - <span class="number">10</span>), <span class="number">0</span>);</span><br><span class="line">            <span class="type">int</span> <span class="variable">y</span> <span class="operator">=</span> (<span class="type">int</span>) (faceDetectResult[<span class="number">1</span>] * height);</span><br><span class="line">            <span class="comment">/*坐标 - 10*/</span></span><br><span class="line">            y = Math.max((y - <span class="number">10</span>), <span class="number">0</span>);</span><br><span class="line">            <span class="type">int</span> <span class="variable">w</span> <span class="operator">=</span> (<span class="type">int</span>) (faceDetectResult[<span class="number">2</span>] * width);</span><br><span class="line">            <span class="comment">/*宽度 + 10*/</span></span><br><span class="line">            w = Math.min((w + <span class="number">10</span>), width - x);</span><br><span class="line">            <span class="type">int</span> <span class="variable">h</span> <span class="operator">=</span> (<span class="type">int</span>) (faceDetectResult[<span class="number">3</span>] * height);</span><br><span class="line">            <span class="comment">/*高度 + 10*/</span></span><br><span class="line">            h = Math.min((h + <span class="number">10</span>), height - y);</span><br><span class="line">            <span class="type">BufferedImage</span> <span class="variable">headImage</span> <span class="operator">=</span> pictureImage.getSubimage(x, y, w, h);</span><br><span class="line">            <span class="type">ByteArrayOutputStream</span> <span class="variable">out</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ByteArrayOutputStream</span>();</span><br><span class="line">            ImageIO.write(headImage, <span class="string">&quot;jpg&quot;</span>, out);</span><br><span class="line">            <span class="keyword">return</span> out.toByteArray();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">            log.warn(<span class="string">&quot;裁剪图片失败使用原照片 &#123;&#125;&quot;</span>, e.getMessage());</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(<span class="string">&quot;裁剪图片失败&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="附录"><a href="#附录" class="headerlink" title="附录"></a>附录</h1><h1 id="1-图片操作类"><a href="#1-图片操作类" class="headerlink" title="1 图片操作类"></a>1 图片操作类</h1><ol>
<li><code>Image</code></li>
<li><code>BufferedImage</code><ol>
<li><code>getSubimage</code>  图片裁剪</li>
</ol>
</li>
<li><code>ImageIO</code><ol>
<li><code>read</code> 读取图片</li>
<li><code>wirte</code> 写出图片</li>
</ol>
</li>
</ol>
<p>本文地址： <a href="https://github.com/maxzhao-it/blog/post/8bda86f4/">https://github.com/maxzhao-it/blog/post/8bda86f4/</a> </p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://github.com/maxzhao-it/blog/post/1a9b93f6/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/blog/uploads/images/avatar.jpg">
      <meta itemprop="name" content="赵联胜">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="maxzhao">
      <meta itemprop="description" content="小码农赵联胜的博客,从遇到Java到爱上Java，工作之余学习Java生态圈中的各种技术。">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | maxzhao">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/blog/post/1a9b93f6/" class="post-title-link" itemprop="url">Java操作图片翻转</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2022-07-28 17:37:16" itemprop="dateModified" datetime="2022-07-28T17:37:16+08:00">2022-07-28</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/blog/categories/Java/" itemprop="url" rel="index"><span itemprop="name">Java</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h1><p><code>Java</code> 操作图片，实现图片的翻转</p>
<h1 id="裁剪图片"><a href="#裁剪图片" class="headerlink" title="裁剪图片"></a>裁剪图片</h1><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ImageUtil</span> &#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 测试</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">test</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="type">FileInputStream</span> <span class="variable">in</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">FileInputStream</span>(<span class="string">&quot;D:\\Pictures\\temp\\1.jpg&quot;</span>);</span><br><span class="line">            <span class="type">byte</span>[] bytes = <span class="keyword">new</span> <span class="title class_">byte</span>[in.available()];</span><br><span class="line">            <span class="type">int</span> <span class="variable">read</span> <span class="operator">=</span> in.read(bytes);</span><br><span class="line">            in.close();</span><br><span class="line">            bytes = getFaceHead(getFaceHead);</span><br><span class="line">            <span class="type">OutputStream</span> <span class="variable">outputStream</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">FileOutputStream</span>(<span class="string">&quot;D:\\Pictures\\temp\\&quot;</span> + System.currentTimeMillis() + <span class="string">&quot;.jpg&quot;</span>);</span><br><span class="line">            outputStream.write(bytes);</span><br><span class="line">            outputStream.close();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(<span class="string">&quot;翻转图片失败&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 水平翻转图片</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> pictureBytes 照片数据</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 人脸图片数据</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="type">byte</span>[] getFaceHead(<span class="type">byte</span>[] pictureBytes) &#123;</span><br><span class="line">        <span class="comment">/*翻转图片*/</span></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">/*获取图片 buffer*/</span></span><br><span class="line">            <span class="type">BufferedImage</span> <span class="variable">pictureImage</span> <span class="operator">=</span> ImageIO.read(<span class="keyword">new</span> <span class="title class_">ByteArrayInputStream</span>(pictureBytes));</span><br><span class="line">            <span class="keyword">final</span> <span class="type">int</span> <span class="variable">width</span> <span class="operator">=</span> pictureImage.getWidth();</span><br><span class="line">            <span class="keyword">final</span> <span class="type">int</span> <span class="variable">height</span> <span class="operator">=</span> pictureImage.getHeight();</span><br><span class="line">            <span class="comment">/*读取所有的像素*/</span></span><br><span class="line">            <span class="type">int</span>[] rgbs = pictureImage.getRGB(<span class="number">0</span>, <span class="number">0</span>, width, height, <span class="literal">null</span>, <span class="number">0</span>, width);</span><br><span class="line">            <span class="comment">/*水平切换像素*/</span></span><br><span class="line">            <span class="type">int</span> temp;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">row</span> <span class="operator">=</span> <span class="number">0</span>; row &lt; height; row++) &#123;</span><br><span class="line">                <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">col</span> <span class="operator">=</span> <span class="number">0</span>; col &lt; width / <span class="number">2</span>; col++) &#123;</span><br><span class="line">                    temp = rgbs[row * width + col];</span><br><span class="line">                    rgbs[row * width + col] = rgbs[row * width + (width - <span class="number">1</span> - col)];</span><br><span class="line">                    rgbs[row * width + (width - <span class="number">1</span> - col)] = temp;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">/*写入像素*/</span></span><br><span class="line">            pictureImage.setRGB(<span class="number">0</span>, <span class="number">0</span>, width, height, rgbs, <span class="number">0</span>, width);</span><br><span class="line">            <span class="type">ByteArrayOutputStream</span> <span class="variable">out</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ByteArrayOutputStream</span>();</span><br><span class="line">            ImageIO.write(pictureImage, <span class="string">&quot;jpg&quot;</span>, out);</span><br><span class="line">            <span class="keyword">return</span> out.toByteArray();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(<span class="string">&quot;翻转图片失败&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="附录"><a href="#附录" class="headerlink" title="附录"></a>附录</h1><h1 id="1-图片操作类"><a href="#1-图片操作类" class="headerlink" title="1 图片操作类"></a>1 图片操作类</h1><ol>
<li><code>Image</code></li>
<li><code>BufferedImage</code><ol>
<li><code>getSubimage</code>  图片裁剪</li>
<li><code>getRGB</code> 获取像素</li>
</ol>
</li>
<li><code>ImageIO</code><ol>
<li><code>read</code> 读取图片</li>
<li><code>wirte</code> 写出图片</li>
</ol>
</li>
</ol>
<p>本文地址： <a href="https://github.com/maxzhao-it/blog/post/1a9b93f6/">https://github.com/maxzhao-it/blog/post/1a9b93f6/</a> </p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://github.com/maxzhao-it/blog/post/5949bf48/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/blog/uploads/images/avatar.jpg">
      <meta itemprop="name" content="赵联胜">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="maxzhao">
      <meta itemprop="description" content="小码农赵联胜的博客,从遇到Java到爱上Java，工作之余学习Java生态圈中的各种技术。">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | maxzhao">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/blog/post/5949bf48/" class="post-title-link" itemprop="url">JS实现图片裁剪功能</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2022-07-04 14:50:22" itemprop="dateModified" datetime="2022-07-04T14:50:22+08:00">2022-07-04</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/blog/categories/JS/" itemprop="url" rel="index"><span itemprop="name">JS</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h1><p><code>JS</code> 实现图片的裁剪</p>
<h1 id="JS-代码"><a href="#JS-代码" class="headerlink" title="JS 代码"></a><code>JS</code> 代码</h1><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br></pre></td><td class="code"><pre><span class="line">&lt;html&gt;</span><br><span class="line"></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;images&quot;</span> <span class="attr">style</span>=<span class="string">&quot;width:100px;height:200px;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">&quot;3.jpg&quot;</span>/&gt;</span></span></span><br><span class="line"><span class="language-xml"></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="keyword">var</span> loadTimer;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="keyword">var</span> imgObject = <span class="keyword">new</span> <span class="title class_">Image</span>();</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    imgObject.<span class="property">src</span> = <span class="string">&#x27;3.jpg&#x27;</span>;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    imgObject.<span class="property">onLoad</span> = <span class="title function_">onImgLoaded</span>();</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;imgObject.naturalHeight==============&gt;&#x27;</span>, imgObject.<span class="property">naturalHeight</span>);</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;imgObject.naturalWidth==============&gt;&#x27;</span>, imgObject.<span class="property">naturalWidth</span>);</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="keyword">function</span> <span class="title function_">onImgLoaded</span>(<span class="params"></span>) &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        <span class="keyword">if</span> (loadTimer != <span class="literal">null</span>) <span class="built_in">clearTimeout</span>(loadTimer);</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        <span class="keyword">if</span> (!imgObject.<span class="property">complete</span>) &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">            loadTimer = <span class="built_in">setTimeout</span>(<span class="keyword">function</span> (<span class="params"></span>) &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">                <span class="title function_">onImgLoaded</span>();</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">            &#125;, <span class="number">3</span>);</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        &#125; <span class="keyword">else</span> &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">            <span class="title function_">onPreloadComplete</span>();</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        &#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    &#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="keyword">function</span> <span class="title function_">onPreloadComplete</span>(<span class="params"></span>) &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        <span class="comment">//call the methods that will create a 64-bit version of thumbnail here.</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        <span class="keyword">var</span> newImg = <span class="title function_">getImagePortion</span>(imgObject,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">            <span class="number">0.17443209886550903</span>* imgObject.<span class="property">naturalWidth</span>,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">            <span class="number">0.1213589534163475</span> * imgObject.<span class="property">naturalHeight</span>,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">                <span class="number">0.44079777598381042</span> * imgObject.<span class="property">naturalWidth</span>,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">                <span class="number">0.44744855165481567</span> * imgObject.<span class="property">naturalHeight</span>,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">            <span class="number">2</span>);</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;newImg&quot;</span>, newImg);</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        <span class="comment">//place image in appropriate div</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&quot;images&quot;</span>).<span class="property">innerHTML</span> = <span class="string">&quot;&lt;img alt=\&quot;\&quot; src=\&quot;&quot;</span> + newImg + <span class="string">&quot;\&quot; /&gt;&quot;</span>;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    &#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="keyword">function</span> <span class="title function_">getImagePortion</span>(<span class="params">imgObj, newWidth, newHeight, startX, startY, ratio</span>) &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;newWidth&#x27;</span>, newWidth);</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;newHeight&#x27;</span>, newHeight);</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;startX&#x27;</span>, startX);</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;startY&#x27;</span>, startY);</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        <span class="comment">// newWidth = Math.floor(newWidth);</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        <span class="comment">// newHeight = Math.floor(newHeight);</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        <span class="comment">// startX = Math.floor(startX);</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        <span class="comment">// startY = Math.floor(startY);</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        <span class="comment">/* the parameters: - the image element - the new width - the new height - the x point we start taking pixels - the y point we start taking pixels - the ratio */</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        <span class="comment">//set up canvas for thumbnail</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        <span class="keyword">var</span> tnCanvas = <span class="variable language_">document</span>.<span class="title function_">createElement</span>(<span class="string">&#x27;canvas&#x27;</span>);</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        <span class="keyword">var</span> tnCanvasContext = tnCanvas.<span class="title function_">getContext</span>(<span class="string">&#x27;2d&#x27;</span>);</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        tnCanvas.<span class="property">width</span> = newWidth;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        tnCanvas.<span class="property">height</span> = newHeight;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        <span class="comment">/* use the sourceCanvas to duplicate the entire image. This step was crucial for iOS4 and under devices. Follow the link at the end of this post to see what happens when you don’t do this */</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        <span class="keyword">var</span> bufferCanvas = <span class="variable language_">document</span>.<span class="title function_">createElement</span>(<span class="string">&#x27;canvas&#x27;</span>);</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        <span class="keyword">var</span> bufferContext = bufferCanvas.<span class="title function_">getContext</span>(<span class="string">&#x27;2d&#x27;</span>);</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        bufferCanvas.<span class="property">width</span> = imgObj.<span class="property">width</span>;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        bufferCanvas.<span class="property">height</span> = imgObj.<span class="property">height</span>;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        bufferContext.<span class="title function_">drawImage</span>(imgObj, <span class="number">0</span>, <span class="number">0</span>);</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        <span class="comment">/* now we use the drawImage method to take the pixels from our bufferCanvas and draw them into our thumbnail canvas */</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        tnCanvasContext.<span class="title function_">drawImage</span>(bufferCanvas, startX, startY, newWidth * ratio, newHeight * ratio, <span class="number">0</span>, <span class="number">0</span>, newWidth, newHeight);</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        <span class="keyword">return</span> tnCanvas.<span class="title function_">toDataURL</span>();</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    &#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="built_in">setTimeout</span>(<span class="keyword">function</span> (<span class="params"></span>) &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    &#125;, <span class="number">1000</span>);</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span></span><br><span class="line"></span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>


<p>本文地址： <a href="https://github.com/maxzhao-it/blog/post/5949bf48/">https://github.com/maxzhao-it/blog/post/5949bf48/</a> </p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://github.com/maxzhao-it/blog/post/8e2fc2ac/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/blog/uploads/images/avatar.jpg">
      <meta itemprop="name" content="赵联胜">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="maxzhao">
      <meta itemprop="description" content="小码农赵联胜的博客,从遇到Java到爱上Java，工作之余学习Java生态圈中的各种技术。">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | maxzhao">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/blog/post/8e2fc2ac/" class="post-title-link" itemprop="url">PostgreSQL基于Citus的分布式搭建</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2022-07-04 14:50:22" itemprop="dateModified" datetime="2022-07-04T14:50:22+08:00">2022-07-04</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/blog/categories/DB/" itemprop="url" rel="index"><span itemprop="name">DB</span></a>
        </span>
          , 
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/blog/categories/DB/PostgreSql/" itemprop="url" rel="index"><span itemprop="name">PostgreSql</span></a>
        </span>
          , 
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/blog/categories/DB/PostgreSql/%E5%88%86%E5%B8%83%E5%BC%8F/" itemprop="url" rel="index"><span itemprop="name">分布式</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h1><blockquote>
<p><a href="../439bd436"><code>yum</code>快速安装</a></p>
<p><a target="_blank" rel="noopener" href="https://www.citusdata.com/getting-started/">官方介绍</a></p>
</blockquote>
<h2 id="Citus简介"><a href="#Citus简介" class="headerlink" title="Citus简介"></a><strong>Citus</strong>简介</h2><p>Citus以插件的方式扩展到postgresql中，独立于postgresql内核，所以能很快的跟上pg主版本的更新，部署也比较简单，是现在非常流行的分布式方案。Citus在苏宁有大规模应用，微软也提供citus的商业支持。下面是citus的架构：</p>
<p><img src="/blog/uploads/images/2018042723003371.png" alt="2018042723003371"></p>
<p><code>Citus</code><br>节点主要分为协调节点和工作节点，协调节点不存储真实数据，只存储数据分布的元信息，实际的数据被分成若干分片，打散到不同worker节点中，应用连接协调节点，协调节点进行sql解析，生成分布式执行计划，下发到worker节点执行，cn将结果汇总返回客户端。</p>
<blockquote>
<p>来自 <a target="_blank" rel="noopener" href="https://cloud.tencent.com/developer/article/1563023">PostgreSQL的几种分布式架构对比</a></p>
</blockquote>
<p>其它特性：</p>
<p>● PostgreSQL兼容</p>
<p>● 水平扩展</p>
<p>● 实时并发查</p>
<p>● 快速数据加载</p>
<p>● 实时增删改查</p>
<p>● 持分布式事务</p>
<p>● 支持常用DDL</p>
<h3 id="交互"><a href="#交互" class="headerlink" title="交互"></a>交互</h3><ol>
<li>客户端应用访问数据时只和CN节点交互。</li>
<li>CN收到SQL请求后，生成分布式执行计划，并将各个子任务下发到相应的Worker节点，之后收集Worker的结果，经过处理后返回最终结果给客户端。</li>
</ol>
<h2 id="服务器"><a href="#服务器" class="headerlink" title="服务器"></a>服务器</h2><ul>
<li><code>192.168.2.100:5432 master</code></li>
<li><code>192.168.2.101:5432 worker101</code></li>
<li><code>192.168.2.102:5432 worker102</code></li>
<li><code>192.168.2.103:5432 worker103</code></li>
<li><code>192.168.2.104:5432 worker104</code></li>
</ul>
<h1 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h1><h2 id="全部节点上的操作"><a href="#全部节点上的操作" class="headerlink" title="全部节点上的操作"></a>全部节点上的操作</h2><h3 id="安装-citus"><a href="#安装-citus" class="headerlink" title="安装 citus"></a>安装 <code>citus</code></h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">curl https://install.citusdata.com/community/rpm.sh | sudo bash</span><br><span class="line"><span class="comment"># 查看所有版本</span></span><br><span class="line">yum list|grep citus</span><br><span class="line"><span class="comment"># 安装与自己PG对应的版本</span></span><br><span class="line">yum install -y citus83_10</span><br></pre></td></tr></table></figure>

<p>查看 <code>PG</code> 配置文件路径</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">psql -U postgres -c <span class="string">&#x27;SHOW config_file&#x27;</span></span><br></pre></td></tr></table></figure>

<p>预加载 <code>citus</code> 扩展</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># preload citus extension</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;shared_preload_libraries = &#x27;citus&#x27;&quot;</span> | sudo <span class="built_in">tee</span> -a /var/lib/pgsql/10/data/postgresql.conf</span><br><span class="line"><span class="comment"># 重启</span></span><br><span class="line">systemctl restart postgresql-10</span><br></pre></td></tr></table></figure>

<h3 id="加载待所有的数据库中"><a href="#加载待所有的数据库中" class="headerlink" title="加载待所有的数据库中"></a>加载待所有的数据库中</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo -i -u postgres psql -c <span class="string">&quot;CREATE EXTENSION citus;&quot;</span></span><br></pre></td></tr></table></figure>

<p>成功输出</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">CREATE EXTENSION</span><br></pre></td></tr></table></figure>

<h2 id="在Worker节点上执行"><a href="#在Worker节点上执行" class="headerlink" title="在Worker节点上执行"></a>在<code>Worker</code>节点上执行</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> <span class="string">&quot;host    all             all             192.168.2.100/32            trust&quot;</span> &gt;&gt; /var/lib/pgsql/10/data/pg_hba.conf</span><br><span class="line"><span class="comment"># 重启</span></span><br><span class="line">systemctl restart postgresql-10</span><br></pre></td></tr></table></figure>

<h2 id="在主节点上执行"><a href="#在主节点上执行" class="headerlink" title="在主节点上执行"></a>在主节点上执行</h2><h3 id="添加-worker-节点"><a href="#添加-worker-节点" class="headerlink" title="添加 worker 节点"></a>添加 <code>worker</code> 节点</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 新版：citus_add_node  旧版：master_add_node</span></span><br><span class="line">sudo -i -u postgres psql -c <span class="string">&quot;SELECT * from master_add_node(&#x27;192.168.2.102&#x27;, 5432);&quot;</span></span><br><span class="line">sudo -i -u postgres psql -c <span class="string">&quot;SELECT * from master_add_node(&#x27;192.168.2.102&#x27;, 5432);&quot;</span></span><br><span class="line">sudo -i -u postgres psql -c <span class="string">&quot;SELECT * from master_add_node(&#x27;192.168.2.103&#x27;, 5432);&quot;</span></span><br><span class="line">sudo -i -u postgres psql -c <span class="string">&quot;SELECT * from master_add_node(&#x27;192.168.2.104&#x27;, 5432);&quot;</span></span><br></pre></td></tr></table></figure>

<h3 id="查看节点"><a href="#查看节点" class="headerlink" title="查看节点"></a>查看节点</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 新版：citus_get_active_worker_nodes  旧版：master_get_active_worker_nodes</span></span><br><span class="line">sudo -i -u postgres psql -c <span class="string">&quot;SELECT * FROM master_get_active_worker_nodes();&quot;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">   node_name   | node_port</span><br><span class="line">---------------+-----------</span><br><span class="line"> 192.168.2.101 |      5432</span><br><span class="line"> 192.168.2.103 |      5432</span><br><span class="line"> 192.168.2.102 |      5432</span><br><span class="line"> 192.168.2.104 |      5432</span><br></pre></td></tr></table></figure>

<h1 id="使用"><a href="#使用" class="headerlink" title="使用"></a>使用</h1><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo -i -u postgres psql</span><br></pre></td></tr></table></figure>

<p>这个，有点复杂。</p>
<p>本文地址： <a href="https://github.com/maxzhao-it/blog/post/8e2fc2ac/">https://github.com/maxzhao-it/blog/post/8e2fc2ac/</a> </p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://github.com/maxzhao-it/blog/post/49280/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/blog/uploads/images/avatar.jpg">
      <meta itemprop="name" content="赵联胜">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="maxzhao">
      <meta itemprop="description" content="小码农赵联胜的博客,从遇到Java到爱上Java，工作之余学习Java生态圈中的各种技术。">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | maxzhao">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/blog/post/49280/" class="post-title-link" itemprop="url">MyBatisPlus代码生成器添加自定义模板</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2022-07-04 14:50:22" itemprop="dateModified" datetime="2022-07-04T14:50:22+08:00">2022-07-04</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/blog/categories/SpringBoot/" itemprop="url" rel="index"><span itemprop="name">SpringBoot</span></a>
        </span>
          , 
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/blog/categories/SpringBoot/MyBatisPlus/" itemprop="url" rel="index"><span itemprop="name">MyBatisPlus</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h1><p>MyBatisPlus：AutoGenerator 是 MyBatis-Plus 的代码生成器，通过 AutoGenerator 可以快速生成 Entity、Mapper、Mapper XML、Service、Controller<br>等各个模块的代码，极大的提升了开发效率。</p>
<p><strong>但是</strong>，自带的模板还是有点差强人意，这里就需要自定义模板来实现。</p>
<blockquote>
<p>需要了解自定义代码生成器</p>
<p>参考：<a href="../15751">MyBatisPlus代码生成器自定义FreemarkerEngine</a></p>
</blockquote>
<p>这里以新建一个 <code>Dto</code> 举例。</p>
<h1 id="配置"><a href="#配置" class="headerlink" title="配置"></a>配置</h1><h2 id="配置模板信息"><a href="#配置模板信息" class="headerlink" title="配置模板信息"></a>配置模板信息</h2><p>创建枚举类<code>CodeGeneratorEnumVal</code>(详见附录)</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 常用配置信息&lt;br&gt;</span></span><br><span class="line"><span class="comment"> * 自定义模板需要添加 .ftl&lt;br&gt;</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> maxzhao</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2021-08-26 23:01</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Getter</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">enum</span> <span class="title class_">CodeGeneratorEnumVal</span> &#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * controller&lt;br&gt;</span></span><br><span class="line"><span class="comment">     * * 非自定义，模板路径不需要 .ftl</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    CONTROLLER(<span class="string">&quot;templates/api/z.controller.java&quot;</span>, <span class="string">&quot;api&quot;</span>, <span class="string">&quot;%sController&quot;</span>),</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * dto</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    DTO(<span class="string">&quot;templates/api/dto/z.dto.java.ftl&quot;</span>, <span class="string">&quot;api.dto&quot;</span>, <span class="string">&quot;%sDto&quot;</span>),</span><br><span class="line">    <span class="comment">/*********/</span></span><br><span class="line">        <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 模板</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> String template;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 模板</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> String packageName;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 模板</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> String className;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="配置-AutoGenerator"><a href="#配置-AutoGenerator" class="headerlink" title="配置 AutoGenerator"></a>配置 <code>AutoGenerator</code></h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CodeGeneratorFactory</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="type">byte</span>[] generate(CodeGeneratorConfig config) &#123;</span><br><span class="line">    <span class="type">CodeGeneratorDbConfig</span> <span class="variable">dbConfig</span> <span class="operator">=</span> config.getDbConfig();</span><br><span class="line"><span class="comment">//region 注入配置</span></span><br><span class="line">mpg.setCfg(configInjection(config));</span><br><span class="line">    <span class="comment">/*************/</span></span><br><span class="line">    <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="configInjection方法"><a href="#configInjection方法" class="headerlink" title="configInjection方法"></a><code>configInjection</code>方法</h2><p>这里配置的是</p>
<ol>
<li>自定义模板的路径( <code>map cfg</code>)</li>
<li>输出文件的路径 (<code>PathInfo</code>)</li>
<li>通用模板参数<ul>
<li>包路径 (<code>packageInfo</code>)</li>
<li>基础的 <code> Entity、Mapper、Mapper XML、Service、Controller</code>生成路径</li>
</ul>
</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CodeGeneratorFactory</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> InjectionConfig <span class="title function_">configInjection</span><span class="params">(CodeGeneratorConfig config)</span> &#123;</span><br><span class="line">        <span class="comment">// 自定义配置</span></span><br><span class="line">        <span class="type">InjectionConfig</span> <span class="variable">cfg</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">InjectionConfig</span>() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">initMap</span><span class="params">()</span> &#123;</span><br><span class="line">                <span class="type">String</span> <span class="variable">controllerPackage</span> <span class="operator">=</span> <span class="built_in">this</span>.getConfig().getPackageInfo().get(<span class="string">&quot;Controller&quot;</span>);</span><br><span class="line">                <span class="built_in">this</span>.getConfig().getPackageInfo().put(<span class="string">&quot;Dto&quot;</span>, controllerPackage + <span class="string">&quot;.dto&quot;</span>);</span><br><span class="line">            </span><br><span class="line">        <span class="comment">/**************************/</span></span><br><span class="line">                <span class="type">String</span> <span class="variable">xmlPath</span> <span class="operator">=</span> <span class="built_in">this</span>.getConfig().getPathInfo().get(<span class="string">&quot;xml_path&quot;</span>);</span><br><span class="line">                <span class="comment">/*修改 xml 生成路径*/</span></span><br><span class="line">                <span class="built_in">this</span>.getConfig().getPathInfo().put(<span class="string">&quot;xml_path&quot;</span>, xmlPath.replace(CodeGeneratorVal.JAVA_SOURCE_PATH, CodeGeneratorVal.XML_SOURCE_PATH));</span><br><span class="line">                Map&lt;String, Object&gt; map = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;(<span class="number">4</span>);</span><br><span class="line">                <span class="comment">/*自定义cfg引用*/</span></span><br><span class="line">                <span class="built_in">this</span>.setMap(map);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;;</span><br><span class="line">        List&lt;FileOutConfig&gt; focList = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        <span class="comment">/*dto 模板*/</span></span><br><span class="line">        focList.add(convertFileOutConfig(config, CodeGeneratorEnumVal.DTO));</span><br><span class="line">        <span class="comment">/**************************/</span></span><br><span class="line">        cfg.setFileOutConfigList(focList);</span><br><span class="line">        <span class="keyword">return</span> cfg;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 加载文件输出配置</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> config  配置</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> enumVal 模板</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> mybatis plus 文件输出配置</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> FileOutConfig <span class="title function_">convertFileOutConfig</span><span class="params">(CodeGeneratorConfig config, CodeGeneratorEnumVal enumVal)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">FileOutConfig</span>(enumVal.getTemplate()) &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="keyword">public</span> String <span class="title function_">outputFile</span><span class="params">(TableInfo tableInfo)</span> &#123;</span><br><span class="line">                <span class="comment">/*指定模板生，自定义生成文件到哪个地方*/</span></span><br><span class="line">                <span class="keyword">return</span> config.getModuleOutPutDir() + File.separator +</span><br><span class="line">                        enumVal.getPackageName().replace(<span class="string">&quot;.&quot;</span>, File.separator) +</span><br><span class="line">                        File.separator +</span><br><span class="line">                        String.format(enumVal.getClassName(), tableInfo.getEntityName()) + StringPool.DOT_JAVA;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="模板文件z-dto-java-ftl"><a href="#模板文件z-dto-java-ftl" class="headerlink" title="模板文件z.dto.java.ftl"></a>模板文件<code>z.dto.java.ftl</code></h2><p>在 <code>resources/templates/api/dto/z.dto.java.ftl</code> 下创建文件，<code>dto</code>模板文件与 <code>entity</code>文件是比较相似的，所以直接从 <code>entity.java.ftl</code>拷贝一下，然后修改自己的自定义模板逻辑。</p>
<p>主要修改点</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">package $&#123;package.Dto&#125;;</span><br><span class="line">/**去掉 @Table @TableId @TableField 等Mybatis 标签***/</span><br><span class="line">public class $&#123;table.dtoName&#125; implements Serializable &#123;</span><br><span class="line">/*****/</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h1 id="附录"><a href="#附录" class="headerlink" title="附录"></a>附录</h1><h2 id="CodeGeneratorEnumVal"><a href="#CodeGeneratorEnumVal" class="headerlink" title="CodeGeneratorEnumVal"></a><code>CodeGeneratorEnumVal</code></h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.gt.code.generator.config;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> lombok.Getter;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 常用配置信息&lt;br&gt;</span></span><br><span class="line"><span class="comment"> * 自定义模板需要添加 .ftl&lt;br&gt;</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> maxzhao</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2021-08-26 23:01</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Getter</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">enum</span> <span class="title class_">CodeGeneratorEnumVal</span> &#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * controller&lt;br&gt;</span></span><br><span class="line"><span class="comment">     * * 非自定义，模板路径不需要 .ftl</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    CONTROLLER(<span class="string">&quot;templates/api/z.controller.java&quot;</span>, <span class="string">&quot;api&quot;</span>, <span class="string">&quot;%sDto&quot;</span>),</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * dto</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    DTO(<span class="string">&quot;templates/api/dto/z.dto.java.ftl&quot;</span>, <span class="string">&quot;api.dto&quot;</span>, <span class="string">&quot;%sDto&quot;</span>),</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * params</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    PARAMS(<span class="string">&quot;templates/api/params/z.params.java.ftl&quot;</span>, <span class="string">&quot;api.params&quot;</span>, <span class="string">&quot;%sParams&quot;</span>),</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * vo</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    VO(<span class="string">&quot;templates/api/vo/z.vo.java.ftl&quot;</span>, <span class="string">&quot;api.vo&quot;</span>, <span class="string">&quot;%sVo&quot;</span>),</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * entity&lt;br&gt;</span></span><br><span class="line"><span class="comment">     * * 非自定义，模板路径不需要 .ftl</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    ENTITY(<span class="string">&quot;templates/model/entity/z.entity.java&quot;</span>, <span class="string">&quot;model.entity&quot;</span>, <span class="string">&quot;%&quot;</span>),</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * service&lt;br&gt;</span></span><br><span class="line"><span class="comment">     * 非自定义，模板路径不需要 .ftl</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    SERVICE(<span class="string">&quot;templates/service/z.service.java&quot;</span>, <span class="string">&quot;service&quot;</span>, <span class="string">&quot;%&quot;</span>),</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * service impl&lt;br&gt;</span></span><br><span class="line"><span class="comment">     * * 非自定义，模板路径不需要 .ftl</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    SERVICE_IMPL(<span class="string">&quot;templates/service/impl/z.serviceImpl.java&quot;</span>, <span class="string">&quot;service.impl&quot;</span>, <span class="string">&quot;%&quot;</span>),</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * mapper&lt;br&gt;</span></span><br><span class="line"><span class="comment">     * * 非自定义，模板路径不需要 .ftl</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    MAPPER(<span class="string">&quot;templates/mapper/z.mapper.java&quot;</span>, <span class="string">&quot;mapper&quot;</span>, <span class="string">&quot;%Mapper&quot;</span>),</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * mapper xml&lt;br&gt;</span></span><br><span class="line"><span class="comment">     * * 非自定义，模板路径不需要 .ftl</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    TEMPLATE_XML(<span class="string">&quot;templates/mapper/z.mapper.xml&quot;</span>, <span class="string">&quot;mapper&quot;</span>, <span class="string">&quot;%Mapper&quot;</span>),</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * convert</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    CONVERT(<span class="string">&quot;templates/util/convert/z.convert.java.ftl&quot;</span>, <span class="string">&quot;util.convert&quot;</span>, <span class="string">&quot;%sConvert&quot;</span>),</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 异常</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    EXCEPTION(<span class="string">&quot;templates/exception/z.exception.java.ftl&quot;</span>, <span class="string">&quot;exception&quot;</span>, <span class="string">&quot;%sException&quot;</span>),</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 异常类型</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    EXCEPTION_ENUM(<span class="string">&quot;templates/exception/z.exceptionEnum.java.ftl&quot;</span>, <span class="string">&quot;exception&quot;</span>, <span class="string">&quot;%sExceptionEnum&quot;</span>),</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 异常类型</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    EXCEPTION_HANDLER(<span class="string">&quot;templates/exception/handler/z.exceptionHandler.java.ftl&quot;</span>, <span class="string">&quot;exception.handler&quot;</span>, <span class="string">&quot;%sExceptionHandler&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 模板</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> String template;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 模板</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> String packageName;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 模板</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> String className;</span><br><span class="line"></span><br><span class="line">    CodeGeneratorEnumVal(String template, String packageName, String className) &#123;</span><br><span class="line">        <span class="built_in">this</span>.template = template;</span><br><span class="line">        <span class="built_in">this</span>.packageName = packageName;</span><br><span class="line">        <span class="built_in">this</span>.className = className;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">toString</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">super</span>.toString();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="CodeGeneratorFactory"><a href="#CodeGeneratorFactory" class="headerlink" title="CodeGeneratorFactory"></a><code>CodeGeneratorFactory</code></h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.gt.code.generator.factory;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.annotation.DbType;</span><br><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.annotation.FieldFill;</span><br><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.core.toolkit.StringPool;</span><br><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.generator.AutoGenerator;</span><br><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.generator.InjectionConfig;</span><br><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.generator.config.*;</span><br><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.generator.config.converts.OracleTypeConvert;</span><br><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.generator.config.po.TableFill;</span><br><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.generator.config.po.TableInfo;</span><br><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.generator.config.rules.IColumnType;</span><br><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.generator.config.rules.NamingStrategy;</span><br><span class="line"><span class="keyword">import</span> com.gt.code.generator.config.CodeGeneratorConfig;</span><br><span class="line"><span class="keyword">import</span> com.gt.code.generator.config.CodeGeneratorDbConfig;</span><br><span class="line"><span class="keyword">import</span> com.gt.code.generator.config.CodeGeneratorEnumVal;</span><br><span class="line"><span class="keyword">import</span> com.gt.code.generator.config.CodeGeneratorVal;</span><br><span class="line"><span class="keyword">import</span> com.gt.code.generator.util.template.CustomFreemarkerTemplateEngine;</span><br><span class="line"><span class="keyword">import</span> org.apache.commons.io.IOUtils;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.ByteArrayOutputStream;</span><br><span class="line"><span class="keyword">import</span> java.io.File;</span><br><span class="line"><span class="keyword">import</span> java.util.*;</span><br><span class="line"><span class="keyword">import</span> java.util.zip.ZipOutputStream;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 生成代码工厂&lt;br&gt;</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> maxzhao</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2021-08-27</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CodeGeneratorFactory</span> &#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 自动填充</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> List&lt;TableFill&gt; TABLE_FILL_LIST = Arrays.asList(</span><br><span class="line">            <span class="keyword">new</span> <span class="title class_">TableFill</span>(<span class="string">&quot;createTime&quot;</span>, FieldFill.INSERT),</span><br><span class="line">            <span class="keyword">new</span> <span class="title class_">TableFill</span>(<span class="string">&quot;updateTime&quot;</span>, FieldFill.UPDATE),</span><br><span class="line">            <span class="keyword">new</span> <span class="title class_">TableFill</span>(<span class="string">&quot;delStatus&quot;</span>, FieldFill.INSERT_UPDATE));</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="title function_">CodeGeneratorFactory</span><span class="params">()</span> &#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="type">byte</span>[] generate(CodeGeneratorConfig config) &#123;</span><br><span class="line">        <span class="type">AutoGenerator</span> <span class="variable">mpg</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">AutoGenerator</span>();</span><br><span class="line">        <span class="type">CodeGeneratorDbConfig</span> <span class="variable">dbConfig</span> <span class="operator">=</span> config.getDbConfig();</span><br><span class="line">        <span class="comment">/*输出路径*/</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">outPutDir</span> <span class="operator">=</span> config.getFullOutPutDir();</span><br><span class="line">        <span class="comment">//region 注入配置</span></span><br><span class="line">        mpg.setCfg(configInjection(config));</span><br><span class="line">        <span class="comment">//endregion</span></span><br><span class="line">        <span class="comment">//region 数据源配置</span></span><br><span class="line">        <span class="type">DataSourceConfig</span> <span class="variable">dataSource</span> <span class="operator">=</span> dbConfig.generatorDataSourceConfig();</span><br><span class="line">        <span class="keyword">if</span> (dataSource.getDbType() == DbType.ORACLE) &#123;</span><br><span class="line">            dataSource.setTypeConvert(<span class="keyword">new</span> <span class="title class_">OracleTypeConvert</span>() &#123;</span><br><span class="line">                <span class="meta">@Override</span></span><br><span class="line">                <span class="keyword">public</span> IColumnType <span class="title function_">processTypeConvert</span><span class="params">(GlobalConfig globalConfig, String fieldType)</span> &#123;</span><br><span class="line">                    <span class="keyword">if</span> (fieldType.toLowerCase(Locale.ROOT).matches(<span class="string">&quot;&quot;</span>)) &#123;</span><br><span class="line"></span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="keyword">return</span> <span class="built_in">super</span>.processTypeConvert(globalConfig, fieldType);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;);</span><br><span class="line">        &#125;</span><br><span class="line">        mpg.setDataSource(dataSource);</span><br><span class="line">        <span class="comment">//endregion</span></span><br><span class="line">        <span class="comment">//region 表策略配置</span></span><br><span class="line">        <span class="type">StrategyConfig</span> <span class="variable">strategy</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StrategyConfig</span>();</span><br><span class="line">        <span class="comment">/*驼峰*/</span></span><br><span class="line">        strategy.setNaming(NamingStrategy.underline_to_camel);</span><br><span class="line">        <span class="comment">/*驼峰*/</span></span><br><span class="line">        strategy.setColumnNaming(NamingStrategy.underline_to_camel);</span><br><span class="line">        <span class="comment">/*使用 lombok*/</span></span><br><span class="line">        strategy.setEntityLombokModel(<span class="literal">true</span>);</span><br><span class="line">        <span class="comment">/*默认使用 restfull风格*/</span></span><br><span class="line">        strategy.setRestControllerStyle(<span class="literal">true</span>);</span><br><span class="line">        <span class="comment">/*标*/</span></span><br><span class="line">        strategy.setInclude(config.getTablesNames());</span><br><span class="line">        <span class="comment">/*驼峰转连字符串*/</span></span><br><span class="line">        strategy.setControllerMappingHyphenStyle(<span class="literal">true</span>);</span><br><span class="line">        strategy.setTablePrefix(config.getTablePrefix());</span><br><span class="line">        <span class="comment">/*字段添加 @TableField*/</span></span><br><span class="line">        strategy.setEntityTableFieldAnnotationEnable(<span class="literal">true</span>);</span><br><span class="line">        strategy.setTableFillList(TABLE_FILL_LIST);</span><br><span class="line">        mpg.setStrategy(strategy);</span><br><span class="line">        <span class="comment">//endregion</span></span><br><span class="line">        <span class="comment">//region 包配置</span></span><br><span class="line">        <span class="type">PackageConfig</span> <span class="variable">pc</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">PackageConfig</span>();</span><br><span class="line">        pc.setModuleName(config.getModuleName());</span><br><span class="line">        pc.setParent(config.getParentPackage());</span><br><span class="line">        <span class="comment">/*设置 controller 文件 包名*/</span></span><br><span class="line">        pc.setController(CodeGeneratorEnumVal.CONTROLLER.getPackageName());</span><br><span class="line">        <span class="comment">/*设置 xml 文件 包名*/</span></span><br><span class="line">        pc.setXml(<span class="string">&quot;mapper&quot;</span>);</span><br><span class="line">        <span class="comment">/*设置 entity 文件 包名*/</span></span><br><span class="line">        pc.setEntity(<span class="string">&quot;model.entity&quot;</span>);</span><br><span class="line">        pc.setXml(<span class="string">&quot;mapper&quot;</span>);</span><br><span class="line">        mpg.setPackageInfo(pc);</span><br><span class="line">        <span class="comment">//endregion</span></span><br><span class="line">        <span class="comment">//region 模板配置</span></span><br><span class="line">        <span class="type">TemplateConfig</span> <span class="variable">templateConfig</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">TemplateConfig</span>()</span><br><span class="line">                .setEntity(CodeGeneratorEnumVal.ENTITY.getTemplate())</span><br><span class="line">                .setController(CodeGeneratorEnumVal.CONTROLLER.getTemplate())</span><br><span class="line">                .setService(CodeGeneratorEnumVal.SERVICE.getTemplate())</span><br><span class="line">                .setServiceImpl(CodeGeneratorEnumVal.SERVICE_IMPL.getTemplate())</span><br><span class="line">                .setMapper(CodeGeneratorEnumVal.MAPPER.getTemplate())</span><br><span class="line">                .setXml(CodeGeneratorEnumVal.TEMPLATE_XML.getTemplate());</span><br><span class="line">        mpg.setTemplate(templateConfig);</span><br><span class="line">        <span class="comment">//endregion</span></span><br><span class="line">        <span class="comment">//region 全局配置</span></span><br><span class="line">        <span class="comment">/*默认使用雪花算法*/</span></span><br><span class="line">        <span class="type">GlobalConfig</span> <span class="variable">gc</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">GlobalConfig</span>();</span><br><span class="line">        gc.setOutputDir(outPutDir);</span><br><span class="line">        gc.setAuthor(config.getAuthor());</span><br><span class="line">        gc.setOpen(<span class="literal">false</span>);</span><br><span class="line">        <span class="comment">/*默认不覆盖，如果文件存在，将不会再生成，配置true就是覆盖*/</span></span><br><span class="line">        gc.setFileOverride(<span class="literal">true</span>);</span><br><span class="line">        <span class="comment">/*配置 swagger2*/</span></span><br><span class="line">        gc.setSwagger2(config.getSwagger2());</span><br><span class="line">        <span class="comment">/*开启 ActiveRecord 模式*/</span></span><br><span class="line">        gc.setActiveRecord(config.getActiveRecord());</span><br><span class="line">        mpg.setGlobalConfig(gc);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//endregion</span></span><br><span class="line">        <span class="comment">//region 模板引擎</span></span><br><span class="line">        <span class="comment">// 选择 freemarker 引擎需要指定如下加，注意 pom 依赖必须有！</span></span><br><span class="line">        <span class="type">CustomFreemarkerTemplateEngine</span> <span class="variable">templateEngine</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">CustomFreemarkerTemplateEngine</span>(config);</span><br><span class="line">        <span class="type">ByteArrayOutputStream</span> <span class="variable">outputStream</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">        <span class="type">ZipOutputStream</span> <span class="variable">zip</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">        <span class="keyword">if</span> (config.getUseZip()) &#123;</span><br><span class="line">            <span class="comment">/*下载zip文件 字节输出流*/</span></span><br><span class="line">            outputStream = <span class="keyword">new</span> <span class="title class_">ByteArrayOutputStream</span>();</span><br><span class="line">            zip = <span class="keyword">new</span> <span class="title class_">ZipOutputStream</span>(outputStream);</span><br><span class="line">            templateEngine.setZipOutputStream(zip);</span><br><span class="line">            <span class="comment">/*下载zip ，会覆盖文件*/</span></span><br><span class="line">            gc.setFileOverride(<span class="literal">true</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        mpg.setTemplateEngine(templateEngine);</span><br><span class="line">        <span class="comment">//endregion</span></span><br><span class="line">        mpg.execute();</span><br><span class="line">        <span class="keyword">if</span> (config.getUseZip()) &#123;</span><br><span class="line">            <span class="comment">/*获取结果*/</span></span><br><span class="line">            <span class="comment">//等同于自己写判断然后关闭</span></span><br><span class="line">            IOUtils.closeQuietly(zip);</span><br><span class="line">            <span class="keyword">return</span> outputStream != <span class="literal">null</span> ? outputStream.toByteArray() : <span class="literal">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 添加自动填充</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> tableFill 新的自动填充</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">addTableFill</span><span class="params">(TableFill tableFill)</span> &#123;</span><br><span class="line">        TABLE_FILL_LIST.add(tableFill);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 配置自定义参数/属性</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> config 配置信息</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> InjectionConfig <span class="title function_">configInjection</span><span class="params">(CodeGeneratorConfig config)</span> &#123;</span><br><span class="line">        <span class="comment">// 自定义配置</span></span><br><span class="line">        <span class="type">InjectionConfig</span> <span class="variable">cfg</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">InjectionConfig</span>() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">initMap</span><span class="params">()</span> &#123;</span><br><span class="line">                <span class="type">String</span> <span class="variable">controllerPackage</span> <span class="operator">=</span> <span class="built_in">this</span>.getConfig().getPackageInfo().get(<span class="string">&quot;Controller&quot;</span>);</span><br><span class="line">                <span class="built_in">this</span>.getConfig().getPackageInfo().put(<span class="string">&quot;Dto&quot;</span>, controllerPackage + <span class="string">&quot;.dto&quot;</span>);</span><br><span class="line">                <span class="built_in">this</span>.getConfig().getPackageInfo().put(<span class="string">&quot;Params&quot;</span>, controllerPackage + <span class="string">&quot;.params&quot;</span>);</span><br><span class="line">                <span class="built_in">this</span>.getConfig().getPackageInfo().put(<span class="string">&quot;Vo&quot;</span>, controllerPackage + <span class="string">&quot;.vo&quot;</span>);</span><br><span class="line">                <span class="built_in">this</span>.getConfig().getPackageInfo().put(<span class="string">&quot;Convert&quot;</span>, controllerPackage.substring(<span class="number">0</span>, controllerPackage.lastIndexOf(CodeGeneratorEnumVal.CONTROLLER.getPackageName())) + CodeGeneratorEnumVal.CONVERT.getPackageName());</span><br><span class="line">                <span class="type">String</span> <span class="variable">xmlPath</span> <span class="operator">=</span> <span class="built_in">this</span>.getConfig().getPathInfo().get(<span class="string">&quot;xml_path&quot;</span>);</span><br><span class="line">                <span class="comment">/*修改 xml 生成路径*/</span></span><br><span class="line">                <span class="built_in">this</span>.getConfig().getPathInfo().put(<span class="string">&quot;xml_path&quot;</span>, xmlPath.replace(CodeGeneratorVal.JAVA_SOURCE_PATH, CodeGeneratorVal.XML_SOURCE_PATH));</span><br><span class="line">                Map&lt;String, Object&gt; map = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;(<span class="number">4</span>);</span><br><span class="line">                <span class="comment">/*自定义cfg引用*/</span></span><br><span class="line">                <span class="built_in">this</span>.setMap(map);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;;</span><br><span class="line">        List&lt;FileOutConfig&gt; focList = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        <span class="comment">/*dto 模板*/</span></span><br><span class="line">        focList.add(convertFileOutConfig(config, CodeGeneratorEnumVal.DTO));</span><br><span class="line">        <span class="comment">/*params 模板*/</span></span><br><span class="line">        focList.add(convertFileOutConfig(config, CodeGeneratorEnumVal.PARAMS));</span><br><span class="line">        <span class="comment">/*vo 模板*/</span></span><br><span class="line">        focList.add(convertFileOutConfig(config, CodeGeneratorEnumVal.VO));</span><br><span class="line">        <span class="comment">/*判断是否使用 mapstruct convert*/</span></span><br><span class="line">        <span class="keyword">if</span> ((config.getUseConvert() != <span class="literal">null</span> &amp;&amp; config.getUseConvert())</span><br><span class="line">                <span class="comment">/*增删查改时使用*/</span></span><br><span class="line">                || (config.getActiveCrud() != <span class="literal">null</span> &amp;&amp; config.getActiveCrud())) &#123;</span><br><span class="line">            <span class="comment">/*convert 模板*/</span></span><br><span class="line">            focList.add(convertFileOutConfig(config, CodeGeneratorEnumVal.CONVERT));</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">/*使用增删查改*/</span></span><br><span class="line">        <span class="keyword">if</span> (config.getActiveCrud() != <span class="literal">null</span> &amp;&amp; config.getActiveCrud()) &#123;</span><br><span class="line">            <span class="comment">/*exception 模板*/</span></span><br><span class="line">            focList.add(convertFileOutConfig(config, CodeGeneratorEnumVal.EXCEPTION));</span><br><span class="line">            <span class="comment">/*exception enum 模板*/</span></span><br><span class="line">            focList.add(convertFileOutConfig(config, CodeGeneratorEnumVal.EXCEPTION_ENUM));</span><br><span class="line">            <span class="comment">/*exception handler 模板*/</span></span><br><span class="line">            focList.add(convertFileOutConfig(config, CodeGeneratorEnumVal.EXCEPTION_HANDLER));</span><br><span class="line">        &#125;</span><br><span class="line">        cfg.setFileOutConfigList(focList);</span><br><span class="line">        <span class="keyword">return</span> cfg;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 加载文件输出配置</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> config  配置</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> enumVal 模板</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> mybatis plus 文件输出配置</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> FileOutConfig <span class="title function_">convertFileOutConfig</span><span class="params">(CodeGeneratorConfig config, CodeGeneratorEnumVal enumVal)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">FileOutConfig</span>(enumVal.getTemplate()) &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="keyword">public</span> String <span class="title function_">outputFile</span><span class="params">(TableInfo tableInfo)</span> &#123;</span><br><span class="line">                <span class="comment">/*指定模板生，自定义生成文件到哪个地方*/</span></span><br><span class="line">                <span class="keyword">return</span> config.getModuleOutPutDir() + File.separator +</span><br><span class="line">                        enumVal.getPackageName().replace(<span class="string">&quot;.&quot;</span>, File.separator) +</span><br><span class="line">                        File.separator +</span><br><span class="line">                        String.format(enumVal.getClassName(), tableInfo.getEntityName()) + StringPool.DOT_JAVA;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="CodeGeneratorConfig"><a href="#CodeGeneratorConfig" class="headerlink" title="CodeGeneratorConfig"></a><code>CodeGeneratorConfig</code></h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.gt.code.generator.config;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> io.swagger.annotations.ApiModelProperty;</span><br><span class="line"><span class="keyword">import</span> lombok.AccessLevel;</span><br><span class="line"><span class="keyword">import</span> lombok.Data;</span><br><span class="line"><span class="keyword">import</span> lombok.Setter;</span><br><span class="line"><span class="keyword">import</span> lombok.experimental.Accessors;</span><br><span class="line"><span class="keyword">import</span> org.springframework.util.StringUtils;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.File;</span><br><span class="line"><span class="keyword">import</span> java.util.Optional;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 代码生成器基础配置&lt;br&gt;</span></span><br><span class="line"><span class="comment"> * Bean 注入 &lt;br&gt;</span></span><br><span class="line"><span class="comment"> * 静态注入 &lt;br&gt;</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> maxzhao</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2021-08-26 22:16</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@Accessors</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CodeGeneratorConfig</span> &#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 输出路径，默认当前项目路径</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> String outPutDir;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 输出 Java 文件的起始路径&lt;br&gt;</span></span><br><span class="line"><span class="comment">     * 只读</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Setter(AccessLevel.NONE)</span></span><br><span class="line">    <span class="keyword">private</span> String fullOutPutDir;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 输出具体模块代码的文件的起始路径&lt;br&gt;</span></span><br><span class="line"><span class="comment">     * &#123;<span class="doctag">@link</span> #fullOutPutDir&#125; + &#123;<span class="doctag">@link</span> #parentPackage&#125; + &#123;<span class="doctag">@link</span> #moduleName&#125; &lt;br&gt;</span></span><br><span class="line"><span class="comment">     * 只读</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Setter(AccessLevel.NONE)</span></span><br><span class="line">    <span class="keyword">private</span> String moduleOutPutDir;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 输出路径，默认当前项目路径</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> outPutDir 输出路径</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setOutPutDir</span><span class="params">(String outPutDir)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.outPutDir = StringUtils.hasText(outPutDir)</span><br><span class="line">                ? outPutDir</span><br><span class="line">                : System.getProperty(<span class="string">&quot;user.dir&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 输出 Java 文件的起始路径</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 输出全路径 包含 src.main.java</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getFullOutPutDir</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="built_in">this</span>.fullOutPutDir != <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="built_in">this</span>.fullOutPutDir;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">/*获取当前的项目路径*/</span></span><br><span class="line">        <span class="built_in">this</span>.fullOutPutDir = <span class="built_in">this</span>.outPutDir;</span><br><span class="line">        fullOutPutDir += File.separator + CodeGeneratorVal.JAVA_SOURCE_PATH;</span><br><span class="line">        fullOutPutDir = fullOutPutDir.replace(<span class="string">&quot;\\&quot;</span>, File.separator)</span><br><span class="line">                .replace(<span class="string">&quot;/&quot;</span>, File.separator)</span><br><span class="line">                .replace(File.separator + File.separator, File.separator);</span><br><span class="line">        <span class="keyword">return</span> fullOutPutDir;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 获取输出模块的路径</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 输出全路径 包含 src.main.java</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getModuleOutPutDir</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="built_in">this</span>.moduleOutPutDir != <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="built_in">this</span>.moduleOutPutDir;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">/*获取java 文件的输出路径*/</span></span><br><span class="line">        <span class="built_in">this</span>.moduleOutPutDir = getFullOutPutDir();</span><br><span class="line">        <span class="built_in">this</span>.moduleOutPutDir = (<span class="built_in">this</span>.moduleOutPutDir + File.separator +</span><br><span class="line">                <span class="built_in">this</span>.parentPackage + File.separator + <span class="built_in">this</span>.moduleName)</span><br><span class="line">                .replace(<span class="string">&quot;.&quot;</span>, File.separator)</span><br><span class="line">                .replace(File.separator + File.separator, File.separator);</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">this</span>.moduleOutPutDir;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 基础包名(默认 gt.maxzhao.boot)&lt;br&gt;</span></span><br><span class="line"><span class="comment">     * default &#123;<span class="doctag">@link</span> CodeGeneratorVal#DEFAULT_PARENT_PACKAGE&#125;</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> String parentPackage;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 基础包名(默认 gt.maxzhao.boot)</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> parentPackage 基础包名</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setParentPackage</span><span class="params">(String parentPackage)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.parentPackage = StringUtils.hasText(parentPackage)</span><br><span class="line">                ? parentPackage</span><br><span class="line">                : CodeGeneratorVal.DEFAULT_PARENT_PACKAGE;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 模块名(默认为null，格式为 xx.xxx)</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> String moduleName;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 作者</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> String author;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 表前缀</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> String[] tablePrefix;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 表名数组</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> String[] tablesNames;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 使用 mapstruct 的 convert，true 使用 ；false 不使用&lt;br&gt;</span></span><br><span class="line"><span class="comment">     * default false</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="type">Boolean</span> <span class="variable">useConvert</span> <span class="operator">=</span> <span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 使用 mapstruct 的 convert，true 使用 ；false 不使用</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> useConvert true 使用 ；false 不使用</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setUseConvert</span><span class="params">(Boolean useConvert)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.useConvert = Optional.ofNullable(useConvert).orElse(<span class="literal">false</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 开启 ActiveRecord 模式&lt;br&gt;</span></span><br><span class="line"><span class="comment">     * default false</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="type">Boolean</span> <span class="variable">activeRecord</span> <span class="operator">=</span> <span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 开启 ActiveRecord 模式&lt;br&gt;</span></span><br><span class="line"><span class="comment">     * default false</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> activeRecord true 使用 ；false 不使用</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setActiveRecord</span><span class="params">(Boolean activeRecord)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.activeRecord = Optional.ofNullable(activeRecord).orElse(<span class="literal">false</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 使用 swagger2，true 使用 ；false 不使用&lt;br&gt;</span></span><br><span class="line"><span class="comment">     * default true</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="type">Boolean</span> <span class="variable">swagger2</span> <span class="operator">=</span> <span class="literal">true</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 使用 swagger2，true 使用 ；false 不使用&lt;br&gt;</span></span><br><span class="line"><span class="comment">     * default true</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> swagger2 true 使用 ；false 不使用</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setSwagger2</span><span class="params">(Boolean swagger2)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.swagger2 = Optional.ofNullable(swagger2).orElse(<span class="literal">true</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 数据库配置</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="type">CodeGeneratorDbConfig</span> <span class="variable">dbConfig</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 使用zip文件下载&lt;br&gt;</span></span><br><span class="line"><span class="comment">     * http 可以直接下载 zip 文件</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="type">Boolean</span> <span class="variable">useZip</span> <span class="operator">=</span> <span class="literal">false</span>;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 自动生成crud&lt;br&gt;</span></span><br><span class="line"><span class="comment">     * 默认使用</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="type">Boolean</span> <span class="variable">activeCrud</span> <span class="operator">=</span> <span class="literal">true</span>;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 自动生成 exception&lt;br&gt;</span></span><br><span class="line"><span class="comment">     * 默认不使用</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="type">Boolean</span> <span class="variable">activeException</span> <span class="operator">=</span> <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="z-dto-java-ftl"><a href="#z-dto-java-ftl" class="headerlink" title="z.dto.java.ftl"></a><code>z.dto.java.ftl</code></h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br></pre></td><td class="code"><pre><span class="line">package $&#123;package.Dto&#125;;</span><br><span class="line"></span><br><span class="line">&lt;#list table.importPackages as pkg&gt;</span><br><span class="line">    &lt;#if pkg?contains(&quot;com.baomidou.mybatisplus.annotation&quot;)&gt;</span><br><span class="line">    &lt;#else&gt;</span><br><span class="line">import $&#123;pkg&#125;;</span><br><span class="line">    &lt;/#if&gt;</span><br><span class="line">&lt;/#list&gt;</span><br><span class="line">&lt;#if swagger2&gt;</span><br><span class="line">import io.swagger.annotations.ApiModel;</span><br><span class="line">import io.swagger.annotations.ApiModelProperty;</span><br><span class="line">&lt;/#if&gt;</span><br><span class="line">&lt;#if entityLombokModel&gt;</span><br><span class="line">import lombok.Data;</span><br><span class="line">import lombok.EqualsAndHashCode;</span><br><span class="line">import lombok.experimental.Accessors;</span><br><span class="line">&lt;/#if&gt;</span><br><span class="line">import org.springframework.format.annotation.DateTimeFormat;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * &lt;p&gt;$&#123;table.comment!&#x27;TODO 待补充注解&#x27;&#125;&lt;/p&gt;</span><br><span class="line"> * &lt;p&gt;接口、服务等接收参数&lt;/p&gt;</span><br><span class="line"> *</span><br><span class="line"> * @author $&#123;author&#125;</span><br><span class="line"> * @date $&#123;date&#125;</span><br><span class="line"> */</span><br><span class="line">&lt;#if entityLombokModel&gt;</span><br><span class="line">@Data</span><br><span class="line">    &lt;#if superEntityClass??&gt;</span><br><span class="line">@EqualsAndHashCode(callSuper = true)</span><br><span class="line">    &lt;#else&gt;</span><br><span class="line">@EqualsAndHashCode(callSuper = false)</span><br><span class="line">    &lt;/#if&gt;</span><br><span class="line">@Accessors(chain = true)</span><br><span class="line">&lt;/#if&gt;</span><br><span class="line">&lt;#if swagger2&gt;</span><br><span class="line">@ApiModel(value=&quot;$&#123;table.dtoName&#125;对象&quot;, description=&quot;$&#123;table.comment!&#x27;TODO 待补充注解&#x27;&#125;&quot;)</span><br><span class="line">&lt;/#if&gt;</span><br><span class="line">public class $&#123;table.dtoName&#125; implements Serializable &#123;</span><br><span class="line"></span><br><span class="line">&lt;#if entitySerialVersionUID&gt;</span><br><span class="line">    private static final long serialVersionUID = 1L;</span><br><span class="line">&lt;/#if&gt;</span><br><span class="line">&lt;#-- ----------  BEGIN 字段循环遍历  ----------&gt;</span><br><span class="line">&lt;#list table.fields as field&gt;</span><br><span class="line">    &lt;#if field.keyFlag&gt;</span><br><span class="line">        &lt;#assign keyPropertyName=&quot;$&#123;field.propertyName&#125;&quot;/&gt;</span><br><span class="line">    &lt;/#if&gt;</span><br><span class="line">    /**</span><br><span class="line">     * $&#123;field.comment!&#x27;TODO 待补充注解&#x27;&#125;</span><br><span class="line">     */</span><br><span class="line">    &lt;#if field.comment!?length gt 0&gt;</span><br><span class="line">        &lt;#if swagger2&gt;</span><br><span class="line">    @ApiModelProperty(value = &quot;$&#123;field.comment!&#x27;TODO 待补充注解&#x27;&#125;&quot;)</span><br><span class="line">        &lt;/#if&gt;</span><br><span class="line">    &lt;/#if&gt;</span><br><span class="line">    &lt;#-- DateTimeFormat --&gt;</span><br><span class="line">    &lt;#if &quot;LocalDateTime&quot; == field.propertyType&gt;</span><br><span class="line">    @DateTimeFormat(pattern = &quot;yyyy-MM-dd HH:mm:ss&quot;)</span><br><span class="line">    &lt;#elseif &quot;LocalDate&quot; == field.propertyType&gt;</span><br><span class="line">    @DateTimeFormat(pattern = &quot;yyyy-MM-dd&quot;)</span><br><span class="line">    &lt;/#if&gt;</span><br><span class="line">    private $&#123;field.propertyType&#125; $&#123;field.propertyName&#125;;</span><br><span class="line">&lt;/#list&gt;</span><br><span class="line">&lt;#------------  END 字段循环遍历  ----------&gt;</span><br><span class="line"></span><br><span class="line">&lt;#if !entityLombokModel&gt;</span><br><span class="line">    &lt;#list table.fields as field&gt;</span><br><span class="line">        &lt;#if field.propertyType == &quot;boolean&quot;&gt;</span><br><span class="line">            &lt;#assign getprefix=&quot;is&quot;/&gt;</span><br><span class="line">        &lt;#else&gt;</span><br><span class="line">            &lt;#assign getprefix=&quot;get&quot;/&gt;</span><br><span class="line">        &lt;/#if&gt;</span><br><span class="line">    public $&#123;field.propertyType&#125; $&#123;getprefix&#125;$&#123;field.capitalName&#125;() &#123;</span><br><span class="line">        return $&#123;field.propertyName&#125;;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    &lt;#if entityBuilderModel&gt;</span><br><span class="line">    public $&#123;entity&#125; set$&#123;field.capitalName&#125;($&#123;field.propertyType&#125; $&#123;field.propertyName&#125;) &#123;</span><br><span class="line">    &lt;#else&gt;</span><br><span class="line">    public void set$&#123;field.capitalName&#125;($&#123;field.propertyType&#125; $&#123;field.propertyName&#125;) &#123;</span><br><span class="line">    &lt;/#if&gt;</span><br><span class="line">        this.$&#123;field.propertyName&#125; = $&#123;field.propertyName&#125;;</span><br><span class="line">        &lt;#if entityBuilderModel&gt;</span><br><span class="line">        return this;</span><br><span class="line">        &lt;/#if&gt;</span><br><span class="line">    &#125;</span><br><span class="line">    &lt;/#list&gt;</span><br><span class="line">&lt;/#if&gt;</span><br><span class="line"></span><br><span class="line">&lt;#if entityColumnConstant&gt;</span><br><span class="line">    &lt;#list table.fields as field&gt;</span><br><span class="line">    public static final String $&#123;field.name?upper_case&#125; = &quot;$&#123;field.name&#125;&quot;;</span><br><span class="line"></span><br><span class="line">    &lt;/#list&gt;</span><br><span class="line">&lt;/#if&gt;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p>本文地址： <a href="https://github.com/maxzhao-it/blog/post/49280/">https://github.com/maxzhao-it/blog/post/49280/</a> </p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://github.com/maxzhao-it/blog/post/88ab1115/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/blog/uploads/images/avatar.jpg">
      <meta itemprop="name" content="赵联胜">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="maxzhao">
      <meta itemprop="description" content="小码农赵联胜的博客,从遇到Java到爱上Java，工作之余学习Java生态圈中的各种技术。">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | maxzhao">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/blog/post/88ab1115/" class="post-title-link" itemprop="url">PostgreSQL备份与恢复</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2023-04-24 10:27:51" itemprop="dateModified" datetime="2023-04-24T10:27:51+08:00">2023-04-24</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/blog/categories/DB/" itemprop="url" rel="index"><span itemprop="name">DB</span></a>
        </span>
          , 
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/blog/categories/DB/PostgreSql/" itemprop="url" rel="index"><span itemprop="name">PostgreSql</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h2 id="备份数据"><a href="#备份数据" class="headerlink" title="备份数据"></a>备份数据</h2><ul>
<li>输出目录格式的归档</li>
</ul>
<p>这个方式备份可以避免操作系统对单个文件的大小的限制</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pg_dump  -U postgres -F -O d -f  /home/back mydb</span><br></pre></td></tr></table></figure>

<p>备份完成后，会生成一个备份文件夹</p>
<ul>
<li><code>tar</code>格式的归档(在用<code>pg_resotre</code>恢复时不支持并行恢复)</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pg_dump -U postgres -F t postgres &gt; mydb.tar</span><br></pre></td></tr></table></figure>

<ul>
<li>生成<code>sql</code>脚本(不支持<code>pg_restore</code> 恢复)</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pg_dump -U postgres -F p postgres &gt; mydb.sql</span><br></pre></td></tr></table></figure>

<ul>
<li>生成自定格式的归档</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pg_dump -U postgres -F c postgres &gt; mydb.bin</span><br></pre></td></tr></table></figure>

<h2 id="恢复数据"><a href="#恢复数据" class="headerlink" title="恢复数据"></a>恢复数据</h2><ul>
<li>恢复前，创建目标数据库</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">　create database mydb;</span><br></pre></td></tr></table></figure>

<ul>
<li>恢复数据</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pg_restore -U postgres -d mydb -j 4 /home/back.dump</span><br></pre></td></tr></table></figure>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pg_restore -U postgres -d mydb -n schema  -t table_name -a -O -j 4 /home/back.dump</span><br></pre></td></tr></table></figure>

<ul>
<li>恢复结构</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pg_restore -U postgres -d mydb --section=pre-data -j 4 /home/back.dump</span><br></pre></td></tr></table></figure>

<blockquote>
<p><code>-j 4</code> 是并行执行线程 其中tar格式备份不支持并行恢复</p>
</blockquote>
<h1 id="附录"><a href="#附录" class="headerlink" title="附录"></a>附录</h1><h2 id="pg-restore"><a href="#pg-restore" class="headerlink" title="pg_restore"></a><code>pg_restore</code></h2><p>用法:<br>pg_restore [选项]… [文件名]</p>
<p>一般选项:</p>
<ul>
<li><code>-d, --dbname=名字</code>         连接数据库名字</li>
<li><code>-f, --file=文件名</code>        输出文件名(- 对于stdout)</li>
<li><code>-F, --format=c|d|t</code>        备份文件格式(应该自动进行)</li>
<li><code>-l, --list</code>                打印归档文件的 TOC 概述</li>
<li><code>-v, --verbose</code>             详细模式</li>
<li><code>-V, --version</code>             输出版本信息, 然后退出</li>
<li><code>-?, --help</code>                显示此帮助, 然后退出</li>
</ul>
<p>恢复控制选项:</p>
<ul>
<li><code>-a, --data-only</code>               只恢复数据, 不包括模式</li>
<li><code>-c, --clean</code>                   在重新创建之前，先清除（删除）数据库对象</li>
<li><code>-C, --create</code>                  创建目标数据库</li>
<li><code>-e, --exit-on-error</code>           发生错误退出, 默认为继续</li>
<li><code>-I, --index=NAME</code>              恢复指定名称的索引</li>
<li><code>-j, --jobs=NUM</code>                执行多个并行任务进行恢复工作</li>
<li><code>-L, --use-list=FILENAME</code>       从这个文件中使用指定的内容表排序输出</li>
<li><code>-n, --schema=NAME</code>             在这个模式中只恢复对象</li>
<li><code>-N, --exclude-schema=NAME</code>     不恢复此模式中的对象</li>
<li><code>-O, --no-owner</code>                不恢复对象所属者</li>
<li><code>-P, --function=NAME(args)</code>     恢复指定名字的函数</li>
<li><code>-s, --schema-only</code>             只恢复模式, 不包括数据</li>
<li><code>-S, --superuser=NAME</code>          使用指定的超级用户来禁用触发器</li>
<li><code>-t, --table=NAME</code>              恢复命名关系（表、视图等）</li>
<li><code>-T, --trigger=NAME</code>            恢复指定名字的触发器</li>
<li><code>-x, --no-privileges</code>           跳过处理权限的恢复 (grant&#x2F;revoke)</li>
<li><code>-1, --single-transaction</code>      作为单个事务恢复</li>
<li><code>--disable-triggers</code>            在只恢复数据的过程中禁用触发器</li>
<li><code>--enable-row-security</code>         启用行安全性</li>
<li><code>--if-exists</code>                   当删除对象时使用IF EXISTS</li>
<li><code>--no-comments</code>                 不恢复注释</li>
<li><code>--no-data-for-failed-tables</code>   对那些无法创建的表不进行 数据恢复</li>
<li><code>--no-publications</code>             不恢复发行</li>
<li><code>--no-security-labels</code>          不恢复安全标签信息</li>
<li><code>--no-subscriptions</code>            不恢复订阅</li>
<li><code>--no-tablespaces</code>              不恢复表空间的分配信息</li>
<li><code>--section=SECTION</code>             恢复命名节 (数据前、数据及数据后)</li>
<li><code>--strict-names</code>                要求每个表和(或)schema包括模式以匹配至少一个实体</li>
<li><code>--use-set-session-authorization</code> 使用 SESSION AUTHORIZATION 命令代替 ALTER OWNER 命令来设置所有权</li>
</ul>
<p>联接选项:</p>
<ul>
<li><code>-h, --host=主机名</code>         数据库服务器的主机名或套接字目录</li>
<li><code>-p, --port=端口号</code>         数据库服务器的端口号</li>
<li><code>-U, --username=名字</code>       以指定的数据库用户联接</li>
<li><code>-w, --no-password</code>         永远不提示输入口令</li>
<li><code>-W, --password</code>            强制口令提示 (自动)</li>
<li><code>--role=ROLENAME</code>           在恢复前执行SET ROLE操作</li>
</ul>
<p>选项 -I, -n, -N, -P, -t, -T, 以及 –section 可以组合使用和指定多次用于选择多个对象.</p>
<h2 id="pg-dump"><a href="#pg-dump" class="headerlink" title="pg_dump"></a><code>pg_dump</code></h2><p>用法:<br>pg_dump [选项]… [数据库名字]</p>
<p>一般选项:</p>
<ul>
<li><code>-f, --file=FILENAME</code>           输出文件或目录名</li>
<li><code>-F, --format=c|d|t|p</code>          输出文件格式 (定制, 目录, tar) 明文 (默认值))</li>
<li><code>-j, --jobs=NUM</code>                执行多个并行任务进行备份转储工作</li>
<li><code>-v, --verbose</code>                 详细模式</li>
<li><code>-V, --version</code>                 输出版本信息，然后退出</li>
<li><code>-Z, --compress=0-9</code>            被压缩格式的压缩级别</li>
<li><code>--lock-wait-timeout=TIMEOUT</code>   在等待表锁超时后操作失败</li>
<li><code>--no-sync</code>                     do not wait for changes to be written safely to disk</li>
<li><code>-?, --help</code>                    显示此帮助, 然后退出</li>
</ul>
<p>控制输出内容选项:</p>
<ul>
<li><code>-a, --data-only</code>               只转储数据,不包括模式</li>
<li><code>-b, --blobs</code>                   在转储中包括大对象</li>
<li><code>-B, --no-blobs</code>                exclude large objects in dump</li>
<li><code>-c, --clean</code>                   在重新创建之前，先清除（删除）数据库对象</li>
<li><code>-C, --create</code>                  在转储中包括命令,以便创建数据库</li>
<li><code>-E, --encoding=ENCODING</code>       转储以ENCODING形式编码的数据</li>
<li><code>-n, --schema=SCHEMA</code>           只转储指定名称的模式</li>
<li><code>-N, --exclude-schema=SCHEMA</code>   不转储已命名的模式</li>
<li><code>-o, --oids</code>                    在转储中包括 OID</li>
<li><code>-O, --no-owner</code>                在明文格式中, 忽略恢复对象所属者</li>
<li><code>-s, --schema-only</code>             只转储模式, 不包括数据</li>
<li><code>-S, --superuser=NAME</code>          在明文格式中使用指定的超级用户名</li>
<li><code>-t, --table=TABLE</code>             只转储指定名称的表</li>
<li><code>-T, --exclude-table=TABLE</code>     不转储指定名称的表</li>
<li><code>-x, --no-privileges</code>           不要转储权限 (grant&#x2F;revoke)</li>
<li><code>--binary-upgrade</code>              只能由升级工具使用</li>
<li><code>--column-inserts</code>              以带有列名的INSERT命令形式转储数据</li>
<li><code>--disable-dollar-quoting</code>      取消美元 (符号) 引号, 使用 SQL 标准引号</li>
<li><code>--disable-triggers</code>            在只恢复数据的过程中禁用触发器</li>
<li><code>--enable-row-security</code>         启用行安全性（只转储用户能够访问的内容）</li>
<li><code>--exclude-table-data=TABLE</code>    不转储指定名称的表中的数据</li>
<li><code>--if-exists</code>                   当删除对象时使用IF EXISTS</li>
<li><code>--inserts</code>                     以INSERT命令，而不是COPY命令的形式转储数据</li>
<li><code>--no-publications</code>             do not dump publications</li>
<li><code>--no-security-labels</code>          不转储安全标签的分配</li>
<li><code>--no-subscriptions</code>            do not dump subscriptions</li>
<li><code>--no-synchronized-snapshots</code>   在并行工作集中不使用同步快照</li>
<li><code>--no-tablespaces</code>              不转储表空间分配信息</li>
<li><code>--no-unlogged-table-data</code>      不转储没有日志的表数据</li>
<li><code>--quote-all-identifiers</code>       所有标识符加引号，即使不是关键字</li>
<li><code>--section=SECTION</code>             备份命名的节 (数据前, 数据, 及 数据后)</li>
<li><code>--serializable-deferrable</code>     等到备份可以无异常运行</li>
<li><code>--snapshot=SNAPSHOT</code>           为转储使用给定的快照</li>
<li><code>--strict-names</code>                要求每个表和&#x2F;或schema包括模式以匹配至少一个实体</li>
<li><code>--use-set-session-authorization</code>  使用 SESSION AUTHORIZATION 命令代替 ALTER OWNER 命令来设置所有权</li>
</ul>
<p>联接选项:</p>
<ul>
<li><code>-d, --dbname=DBNAME</code>       对数据库 DBNAME备份</li>
<li><code>-h, --host=主机名</code>        数据库服务器的主机名或套接字目录</li>
<li><code>-p, --port=端口号</code>        数据库服务器的端口号</li>
<li><code>-U, --username=名字</code>      以指定的数据库用户联接</li>
<li><code>-w, --no-password</code>        永远不提示输入口令</li>
<li><code>-W, --password</code>           强制口令提示 (自动)</li>
<li><code>--role=ROLENAME</code>          在转储前运行SET ROLE</li>
</ul>
<p>如果没有提供数据库名字,</p>
<p>本文地址： <a href="https://github.com/maxzhao-it/blog/post/88ab1115/">https://github.com/maxzhao-it/blog/post/88ab1115/</a> </p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://github.com/maxzhao-it/blog/post/e2a00d68/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/blog/uploads/images/avatar.jpg">
      <meta itemprop="name" content="赵联胜">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="maxzhao">
      <meta itemprop="description" content="小码农赵联胜的博客,从遇到Java到爱上Java，工作之余学习Java生态圈中的各种技术。">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | maxzhao">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/blog/post/e2a00d68/" class="post-title-link" itemprop="url">Linux无法开启网卡的问题</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2022-07-04 14:50:22" itemprop="dateModified" datetime="2022-07-04T14:50:22+08:00">2022-07-04</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/blog/categories/Linux/" itemprop="url" rel="index"><span itemprop="name">Linux</span></a>
        </span>
          , 
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/blog/categories/Linux/SSH/" itemprop="url" rel="index"><span itemprop="name">SSH</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>查看网卡</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">ip -a</span><br><span class="line">ifconfig </span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>找到网卡后激活网卡</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nmcli c up ens33</span><br></pre></td></tr></table></figure>

<p>激活出现错误</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Connection <span class="string">&#x27;ens33&#x27;</span> is not available on device ens33 because device is strictly unmanaged</span><br></pre></td></tr></table></figure>

<p>这是因为NM托管未开启导致的。</p>
<p>查看网络托管状态</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nmcli n</span><br></pre></td></tr></table></figure>

<p>如果为 disable 则开启</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nmcli n on</span><br></pre></td></tr></table></figure>
<p>本文地址： <a href="https://github.com/maxzhao-it/blog/post/e2a00d68/">https://github.com/maxzhao-it/blog/post/e2a00d68/</a> </p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://github.com/maxzhao-it/blog/post/45ed5038/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/blog/uploads/images/avatar.jpg">
      <meta itemprop="name" content="赵联胜">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="maxzhao">
      <meta itemprop="description" content="小码农赵联胜的博客,从遇到Java到爱上Java，工作之余学习Java生态圈中的各种技术。">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | maxzhao">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/blog/post/45ed5038/" class="post-title-link" itemprop="url">SpringBoot实体Long传递到前端丢失精度</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2022-07-04 14:50:22" itemprop="dateModified" datetime="2022-07-04T14:50:22+08:00">2022-07-04</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/blog/categories/Java/" itemprop="url" rel="index"><span itemprop="name">Java</span></a>
        </span>
          , 
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/blog/categories/Java/SpringBoot/" itemprop="url" rel="index"><span itemprop="name">SpringBoot</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h2 id="问题"><a href="#问题" class="headerlink" title="问题"></a>问题</h2><h3 id="主键-Long-型返回到前端丢失精度问题"><a href="#主键-Long-型返回到前端丢失精度问题" class="headerlink" title="主键 Long 型返回到前端丢失精度问题"></a>主键 Long 型返回到前端丢失精度问题</h3><h4 id="两种简单的解决方式："><a href="#两种简单的解决方式：" class="headerlink" title="两种简单的解决方式："></a>两种简单的解决方式：</h4><ol>
<li>@JSONField(serializeUsing &#x3D; ToStringSerializer.class)</li>
</ol>
<p>2.@JsonSerialize(using &#x3D; LongToStringSerializer.class)</p>
<h5 id="fastjson中的ToStringSerializer"><a href="#fastjson中的ToStringSerializer" class="headerlink" title="fastjson中的ToStringSerializer"></a><code>fastjson</code>中的<code>ToStringSerializer</code></h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ToStringSerializer</span> <span class="keyword">implements</span> <span class="title class_">ObjectSerializer</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">ToStringSerializer</span> <span class="variable">instance</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ToStringSerializer</span>();</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">write</span><span class="params">(JSONSerializer serializer, Object object, Object fieldName, Type fieldType,</span></span><br><span class="line"><span class="params">                      <span class="type">int</span> features)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        <span class="type">SerializeWriter</span> <span class="variable">out</span> <span class="operator">=</span> serializer.out;</span><br><span class="line">        <span class="keyword">if</span> (object == <span class="literal">null</span>) &#123;</span><br><span class="line">            out.writeNull();</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="type">String</span> <span class="variable">strVal</span> <span class="operator">=</span> object.toString();</span><br><span class="line">        out.writeString(strVal);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="自定义类-LongToStringSerializer"><a href="#自定义类-LongToStringSerializer" class="headerlink" title="自定义类 LongToStringSerializer"></a>自定义类 <code>LongToStringSerializer</code></h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">LongToStringSerializer</span> <span class="keyword">extends</span> <span class="title class_">JsonSerializer</span>&lt;Long&gt; &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">serialize</span><span class="params">(Long value, JsonGenerator gen, SerializerProvider serializers)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        <span class="keyword">if</span> (value == <span class="literal">null</span>) &#123;</span><br><span class="line">            gen.writeNull();</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        gen.writeString(value.toString());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="一劳永逸的解决方式-序列化、反序列化"><a href="#一劳永逸的解决方式-序列化、反序列化" class="headerlink" title="一劳永逸的解决方式(序列化、反序列化)"></a>一劳永逸的解决方式(序列化、反序列化)</h4><p>此解决方案是 <code>springboot</code> 中使用<code>jackson</code></p>
<h5 id="在-WebMvcConfigurer中，配置-objectMapper-的-bean"><a href="#在-WebMvcConfigurer中，配置-objectMapper-的-bean" class="headerlink" title="在 WebMvcConfigurer中，配置 objectMapper 的 bean"></a>在 <code>WebMvcConfigurer</code>中，配置 <code>objectMapper</code> 的 <code>bean</code></h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * WebMvcConfigurer</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> maxzhao</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2020-03-05 14:23</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">BootWebMvcConfigurer</span> <span class="keyword">implements</span> <span class="title class_">WebMvcConfigurer</span> &#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Json序列化和反序列化转换器，用于转换Post请求体中的json以及将我们的对象序列化为返回响应的json</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> ObjectMapper <span class="title function_">objectMapper</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">ObjectMapper</span> <span class="variable">objectMapper</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ObjectMapper</span>();</span><br><span class="line">        objectMapper.disable(SerializationFeature.WRITE_DATES_AS_TIMESTAMPS);</span><br><span class="line">        objectMapper.disable(DeserializationFeature.ADJUST_DATES_TO_CONTEXT_TIME_ZONE);</span><br><span class="line"></span><br><span class="line">        <span class="comment">/*LocalDateTime系列序列化和反序列化模块，继承自jsr310，我们在这里修改了日期格式</span></span><br><span class="line"><span class="comment">         * 在这里修改之后，就不用再去全局序列化了*/</span></span><br><span class="line">        <span class="type">JavaTimeModule</span> <span class="variable">javaTimeModule</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">JavaTimeModule</span>();</span><br><span class="line">        javaTimeModule.addSerializer(LocalDateTime.class</span><br><span class="line">                , <span class="keyword">new</span> <span class="title class_">LocalDateTimeSerializer</span>(DateTimeFormatter.ofPattern(DateBootUtil.DEFAULT_DATETIME_FORMAT)));</span><br><span class="line">        javaTimeModule.addSerializer(LocalDate.class</span><br><span class="line">                , <span class="keyword">new</span> <span class="title class_">LocalDateSerializer</span>(DateTimeFormatter.ofPattern(DateBootUtil.DEFAULT_DATE_FORMAT)));</span><br><span class="line">        javaTimeModule.addSerializer(LocalTime.class</span><br><span class="line">                , <span class="keyword">new</span> <span class="title class_">LocalTimeSerializer</span>(DateTimeFormatter.ofPattern(DateBootUtil.DEFAULT_TIME_FORMAT)));</span><br><span class="line">        javaTimeModule.addDeserializer(LocalDateTime.class</span><br><span class="line">                , <span class="keyword">new</span> <span class="title class_">LocalDateTimeDeserializer</span>(DateTimeFormatter.ofPattern(DateBootUtil.DEFAULT_DATETIME_FORMAT)));</span><br><span class="line">        javaTimeModule.addDeserializer(LocalDate.class</span><br><span class="line">                , <span class="keyword">new</span> <span class="title class_">LocalDateDeserializer</span>(DateTimeFormatter.ofPattern(DateBootUtil.DEFAULT_DATE_FORMAT)));</span><br><span class="line">        javaTimeModule.addDeserializer(LocalTime.class</span><br><span class="line">                , <span class="keyword">new</span> <span class="title class_">LocalTimeDeserializer</span>(DateTimeFormatter.ofPattern(DateBootUtil.DEFAULT_TIME_FORMAT)));</span><br><span class="line">        javaTimeModule.addSerializer(Long.class</span><br><span class="line">                , <span class="keyword">new</span> <span class="title class_">LongToStringSerializer</span>());</span><br><span class="line">        <span class="comment">/*Date序列化和反序列化  jackson-datatype-jsr310 包中已经存在 这里就不用再次写了*/</span></span><br><span class="line">        objectMapper.registerModule(javaTimeModule);</span><br><span class="line">        <span class="keyword">return</span> objectMapper;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<p>本文地址： <a href="https://github.com/maxzhao-it/blog/post/45ed5038/">https://github.com/maxzhao-it/blog/post/45ed5038/</a> </p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/blog/page/18/"><i class="fa fa-angle-left" aria-label="Previous page"></i></a><a class="page-number" href="/blog/">1</a><span class="space">&hellip;</span><a class="page-number" href="/blog/page/18/">18</a><span class="page-number current">19</span><a class="page-number" href="/blog/page/20/">20</a><span class="space">&hellip;</span><a class="page-number" href="/blog/page/41/">41</a><a class="extend next" rel="next" href="/blog/page/20/"><i class="fa fa-angle-right" aria-label="Next page"></i></a>
  </nav>

</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">


<div class="copyright">
  &copy; 
  <span itemprop="copyrightYear">2023</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">赵联胜</span>
</div>

    </div>
  </footer>

  
  <script src="https://cdn.jsdelivr.net/npm/animejs@3.2.1/lib/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
<script src="/blog/js/comments.js"></script><script src="/blog/js/utils.js"></script><script src="/blog/js/motion.js"></script><script src="/blog/js/next-boot.js"></script>

  
<script src="https://cdn.jsdelivr.net/npm/hexo-generator-searchdb@1.4.0/dist/search.js" integrity="sha256-vXZMYLEqsROAXkEw93GGIvaB2ab+QW6w3+1ahD9nXXA=" crossorigin="anonymous"></script>
<script src="/blog/js/third-party/search/local-search.js"></script>




  <script src="/blog/js/third-party/pace.js"></script>

  





</body>
</html>
