<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222">


  <link rel="apple-touch-icon" sizes="180x180" href="/blog/uploads/images/gt.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/blog/uploads/images/gt-32.jpg">
  <link rel="icon" type="image/png" sizes="16x16" href="/blog/uploads/images/gt-16.jpg">
  <link rel="mask-icon" href="/blog/uploads/images/logo.png" color="#222">

<link rel="stylesheet" href="/blog/css/main.css">



<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.1.1/css/all.min.css" integrity="sha256-DfWjNxDkM94fVBWx1H5BMMp0Zq7luBlV8QRcSES7s+0=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/animate.css@3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/pace-js@1.2.4/themes/blue/pace-theme-minimal.css">
  <script src="https://cdn.jsdelivr.net/npm/pace-js@1.2.4/pace.min.js" integrity="sha256-gqd7YTjg/BtfqWSwsJOvndl0Bxc8gFImLEkXQT8+qj0=" crossorigin="anonymous"></script>

<script class="next-config" data-name="main" type="application/json">{"hostname":"github.com","root":"/blog/","images":"/blog/images","scheme":"Gemini","darkmode":false,"version":"8.11.1","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12},"copycode":false,"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"Searching...","empty":"We didn't find any results for the search: ${query}","hits_time":"${hits} results found in ${time} ms","hits":"${hits} results found"},"path":"/blog/search.xml","localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false}}</script><script src="/blog/js/config.js"></script>



<link rel="canonical" href="https://github.com/maxzhao-it/blog/page/37/">



<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":true,"isPost":false,"lang":"en","comments":"","permalink":"","path":"page/37/index.html","title":""}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>maxzhao</title>
  





  <noscript>
    <link rel="stylesheet" href="/blog/css/noscript.css">
  </noscript>
<link rel="alternate" href="/blog/atom.xml" title="maxzhao" type="application/atom+xml">
</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/blog/" class="brand" rel="start">
      <i class="logo-line"></i>
      <h1 class="site-title">maxzhao</h1>
      <i class="logo-line"></i>
    </a>
      <p class="site-subtitle" itemprop="description">不要害怕Exception和Error</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="/blog/" rel="section"><i class="fa fa-home fa-fw"></i>Home</a></li><li class="menu-item menu-item-about"><a href="/blog/about/" rel="section"><i class="fa fa-user fa-fw"></i>About</a></li><li class="menu-item menu-item-tags"><a href="/blog/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>Tags</a></li><li class="menu-item menu-item-categories"><a href="/blog/categories/" rel="section"><i class="fa fa-th fa-fw"></i>Categories</a></li><li class="menu-item menu-item-archives"><a href="/blog/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>Archives</a></li><li class="menu-item menu-item-schedule"><a href="/blog/schedule/" rel="section"><i class="fa fa-calendar fa-fw"></i>Schedule</a></li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>Search
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup"><div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off" maxlength="80"
           placeholder="Searching..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close" role="button">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div class="search-result-container no-result">
  <div class="search-result-icon">
    <i class="fa fa-spinner fa-pulse fa-5x"></i>
  </div>
</div>

    </div>
  </div>

</div>
        
  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>

  <aside class="sidebar">

    <div class="sidebar-inner sidebar-overview-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author site-overview-item animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="赵联胜"
      src="/blog/uploads/images/avatar.jpg">
  <p class="site-author-name" itemprop="name">赵联胜</p>
  <div class="site-description" itemprop="description">小码农赵联胜的博客,从遇到Java到爱上Java，工作之余学习Java生态圈中的各种技术。</div>
</div>
<div class="site-state-wrap site-overview-item animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/blog/archives/">
          <span class="site-state-item-count">400</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
          <a href="/blog/categories/">
        <span class="site-state-item-count">160</span>
        <span class="site-state-item-name">categories</span></a>
      </div>
      <div class="site-state-item site-state-tags">
          <a href="/blog/tags/">
        <span class="site-state-item-count">201</span>
        <span class="site-state-item-name">tags</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author site-overview-item animated">
      <span class="links-of-author-item">
        <a href="https://gitee.com/zhaoliansheng" title="GitHub → https:&#x2F;&#x2F;gitee.com&#x2F;zhaoliansheng" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i></a>
      </span>
      <span class="links-of-author-item">
        <a href="/blog/1441439636@qq.com" title="E-Mail → 1441439636@qq.com"><i class="fa fa-envelope fa-fw"></i></a>
      </span>
  </div>


  <div class="links-of-blogroll site-overview-item animated">
    <div class="links-of-blogroll-title"><i class="fa fa-globe fa-fw"></i>
      友情链接
    </div>
    <ul class="links-of-blogroll-list">
        <li class="links-of-blogroll-item">
          <a href="https://www.jianshu.com/u/e8c426a6007e" title="https:&#x2F;&#x2F;www.jianshu.com&#x2F;u&#x2F;e8c426a6007e" rel="noopener" target="_blank">我的简书</a>
        </li>
    </ul>
  </div>

        </div>
      </div>
    </div>
  </aside>
  <div class="sidebar-dimmer"></div>


    </header>

    
  <div class="back-to-top" role="button" aria-label="Back to top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


    <div class="main-inner index posts-expand">

    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://github.com/maxzhao-it/blog/post/55853/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/blog/uploads/images/avatar.jpg">
      <meta itemprop="name" content="赵联胜">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="maxzhao">
      <meta itemprop="description" content="小码农赵联胜的博客,从遇到Java到爱上Java，工作之余学习Java生态圈中的各种技术。">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | maxzhao">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/blog/post/55853/" class="post-title-link" itemprop="url">JAVA自定义注解</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2022-07-28 17:39:49" itemprop="dateModified" datetime="2022-07-28T17:39:49+08:00">2022-07-28</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/blog/categories/Java/" itemprop="url" rel="index"><span itemprop="name">Java</span></a>
        </span>
          , 
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/blog/categories/Java/AOP/" itemprop="url" rel="index"><span itemprop="name">AOP</span></a>
        </span>
          , 
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/blog/categories/Java/AOP/%E8%87%AA%E5%AE%9A%E4%B9%89%E6%B3%A8%E8%A7%A3/" itemprop="url" rel="index"><span itemprop="name">自定义注解</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h2 id="自定义注解"><a href="#自定义注解" class="headerlink" title="自定义注解"></a>自定义注解</h2><h3 id="1、元注解（meta-annotation）"><a href="#1、元注解（meta-annotation）" class="headerlink" title="1、元注解（meta-annotation）"></a>1、元注解（meta-annotation）</h3><p>元注解的作用就是负责注解其他注解。<code>Java5.0</code>定义了4个标准的 <code>meta-annotation</code>类型，它们被用来提供对其它<code>annotation</code>类型作说明。<code>Java5.0</code>定义的元注解：<br>1.@Target,<br>2.@Retention,<br>3.@Documented,<br>4.@Inherited<br>这些类型和它们所支持的类在java.lang.annotation包中可以找到。下面我们看一下每个元注解的作用和相应分参数的使用说明。</p>
<h4 id="Target："><a href="#Target：" class="headerlink" title="@Target："></a><strong>@Target：</strong></h4><p>@Target说明了Annotation所修饰的对象范围：Annotation可被用于<br>packages、types（类、接口、枚举、Annotation类型）、类型成员（方法、构造方法、成员变量、枚举值）、方法参数和本地变量（如循环变量、catch参数）。在Annotation类型的声明中使用了target可更加明晰其修饰的目标。</p>
<p><strong>作用：用于描述注解的使用范围（即：被描述的注解可以用在什么地方）</strong></p>
<p><strong>取值(ElementType)有：</strong></p>
<p>1.CONSTRUCTOR:用于描述构造器<br>2.FIELD:用于描述域<br>3.LOCAL_VARIABLE:用于描述局部变量<br>4.METHOD:用于描述方法<br>5.PACKAGE:用于描述包<br>6.PARAMETER:用于描述参数<br>7.TYPE:用于描述类、接口(包括注解类型) 或enum声明</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">@Target(ElementType.TYPE)</span><br><span class="line">public @interface Table &#123;</span><br><span class="line">    /**</span><br><span class="line">     * 数据表名称注解，默认值为类名称</span><br><span class="line">     * @return</span><br><span class="line">     */</span><br><span class="line">    public String tableName() default &quot;className&quot;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">@Target(ElementType.FIELD)</span><br><span class="line">public @interface NoDBColumn &#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>注解Table 可以用于注解类、接口(包括注解类型) 或enum声明,而注解NoDBColumn仅可用于注解类的成员变量。</p>
<h4 id="Retention："><a href="#Retention：" class="headerlink" title="@Retention："></a><strong>@Retention：</strong></h4><p><strong>@Retention</strong><br>定义了该Annotation被保留的时间长短：某些Annotation仅出现在源代码中，而被编译器丢弃；而另一些却被编译在class文件中；编译在class文件中的Annotation可能会被虚拟机忽略，而另一些在class被装载时将被读取（请注意并不影响class的执行，因为Annotation与class在使用上是被分离的）。使用这个meta-Annotation可以对<br>Annotation的“生命周期”限制。</p>
<p><strong>作用：表示需要在什么级别保存该注释信息，用于描述注解的生命周期（即：被描述的注解在什么范围内有效）</strong></p>
<p><strong>取值（RetentionPoicy）有：</strong></p>
<p>1.SOURCE:在源文件中有效（即源文件保留）<br>2.CLASS:在class文件中有效（即class保留）<br>3.RUNTIME:在运行时有效（即运行时保留）</p>
<p>Retention meta-annotation类型有唯一的value作为成员，它的取值来自java.lang.annotation.RetentionPolicy的枚举类型值。具体实例如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">@Target(ElementType.FIELD)</span><br><span class="line">@Retention(RetentionPolicy.RUNTIME)</span><br><span class="line">public @interface Column &#123;</span><br><span class="line">    public String name() default &quot;fieldName&quot;;</span><br><span class="line">    public String setFuncName() default &quot;setField&quot;;</span><br><span class="line">    public String getFuncName() default &quot;getField&quot;; </span><br><span class="line">    public boolean defaultDBValue() default false;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Column注解的的RetentionPolicy的属性值是RUTIME,这样注解处理器可以通过反射，获取到该注解的属性值，从而去做一些运行时的逻辑处理</p>
<hr>
<h4 id="Documented"><a href="#Documented" class="headerlink" title="@Documented:"></a><strong>@Documented:</strong></h4><p>**@**Documented用于描述其它类型的annotation应该被作为被标注的程序成员的公共API，因此可以被例如javadoc此类的工具文档化。Documented是一个标记注解，没有成员。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">@Target(ElementType.FIELD)</span><br><span class="line">@Retention(RetentionPolicy.RUNTIME)</span><br><span class="line">@Documented</span><br><span class="line">public @interface Column &#123;</span><br><span class="line">    public String name() default &quot;fieldName&quot;;</span><br><span class="line">    public String setFuncName() default &quot;setField&quot;;</span><br><span class="line">    public String getFuncName() default &quot;getField&quot;; </span><br><span class="line">    public boolean defaultDBValue() default false;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="Inherited："><a href="#Inherited：" class="headerlink" title="@Inherited："></a><strong>@Inherited：</strong></h4><p>@Inherited 元注解是一个标记注解，@Inherited阐述了某个被标注的类型是被继承的。如果一个使用了@Inherited修饰的annotation类型被用于一个class，则这个annotation将被用于该class的子类。</p>
<p>注意：@Inherited annotation类型是被标注过的class的子类所继承。类并不从它所实现的接口继承annotation，方法并不从它所重载的方法继承annotation。</p>
<p>当@Inherited<br>annotation类型标注的annotation的Retention是RetentionPolicy.RUNTIME，则反射API增强了这种继承性。如果我们使用java.lang.reflect去查询一个@Inherited<br>annotation类型的annotation时，反射代码检查将展开工作：检查class和其父类，直到发现指定的annotation类型被发现，或者到达类继承结构的顶层。</p>
<p>实例代码：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">/**</span><br><span class="line"> * </span><br><span class="line"> * @author peida</span><br><span class="line"> *</span><br><span class="line"> */</span><br><span class="line">@Inherited</span><br><span class="line">public @interface Greeting &#123;</span><br><span class="line">    public enum FontColor&#123; BULE,RED,GREEN&#125;;</span><br><span class="line">    String name();</span><br><span class="line">    FontColor fontColor() default FontColor.GREEN;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="2、自定义注解："><a href="#2、自定义注解：" class="headerlink" title="2、自定义注解："></a>2、自定义注解：</h3><h4 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h4><p>使用@interface自定义注解时，自动继承了<code>java.lang.annotation.Annotation</code><br>接口，由编译程序自动完成其他细节。在定义注解时，不能继承其他的注解或接口。@interface用来声明一个注解，其中的每一个方法实际上是声明了一个配置参数。方法的名称就是参数的名称，返回值类型就是参数的类型（返回值类型只能是基本类型、Class、String、enum）。可以通过default来声明参数的默认值。</p>
<p>注解的的<code>RetentionPolicy</code>的属性值是<code>RUTIME</code>, 这样注解处理器可以通过反射，获取到该注解的属性值，从而去做一些运行时的逻辑处理.</p>
<h4 id="定义注解格式："><a href="#定义注解格式：" class="headerlink" title="定义注解格式："></a><strong>定义注解格式：</strong></h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="meta">@interface</span> 注解名 &#123;</span><br><span class="line">    定义体</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="注解参数的可支持数据类型："><a href="#注解参数的可支持数据类型：" class="headerlink" title="注解参数的可支持数据类型："></a><strong>注解参数的可支持数据类型：</strong></h4><p>1.所有基本数据类型（int,float,boolean,byte,double,char,long,short)<br>2.String类型<br>3.Class类型<br>4.enum类型<br>5.Annotation类型<br>6.以上所有类型的数组</p>
<h4 id="Annotation类型的参数设定"><a href="#Annotation类型的参数设定" class="headerlink" title="Annotation类型的参数设定:"></a><code>Annotation</code>类型的参数设定:</h4><ol>
<li>只能用public或默认(default)这两个访问权修饰.例如,String value();这里把方法设为defaul默认类型；</li>
<li>参数成员只能用基本类型byte,short,char,int,long,float,double,boolean八种基本数据类型和<br>String,Enum,Class,annotations等数据类型,以及这一些类型的数组.例如,String value();这里的参数成员就为String;</li>
<li></li>
</ol>
<p>如果只有一个参数成员,最好把参数名称设为”value”,后加小括号.例:下面的例子FruitName注解就只有一个参数成员。</p>
<h4 id="定义和使用实例："><a href="#定义和使用实例：" class="headerlink" title="定义和使用实例："></a>定义和使用实例：</h4><h5 id="定义："><a href="#定义：" class="headerlink" title="定义："></a>定义：</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">/**</span><br><span class="line"> * &lt;p&gt;多数据源标识&lt;/p&gt;</span><br><span class="line"> * &lt;p&gt;使用方式：必须用在方法上&lt;/p&gt;</span><br><span class="line"> *</span><br><span class="line"> * @author maxzhao</span><br><span class="line"> * @date 2019-06-26 16:13</span><br><span class="line"> */</span><br><span class="line">@Inherited</span><br><span class="line">@Retention(RetentionPolicy.RUNTIME)</span><br><span class="line">@Target(&#123;ElementType.METHOD&#125;)</span><br><span class="line">public @interface MultiDatabase &#123;</span><br><span class="line">    String name() default &quot;main&quot;;</span><br><span class="line">     /**</span><br><span class="line">     * 枚举</span><br><span class="line">     * @author peida</span><br><span class="line">     *</span><br><span class="line">     */</span><br><span class="line">    public enum SourceType&#123; MYSQL,POSTGRESQL,ORACLE&#125;;</span><br><span class="line">    /**</span><br><span class="line">     * 属性</span><br><span class="line">     * @return</span><br><span class="line">     */</span><br><span class="line">    Type sourceType() default Type.MYSQL;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="使用："><a href="#使用：" class="headerlink" title="使用："></a>使用：</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TempServiceDemo</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> TempRepository tempRepository;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">findAll</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;default&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@MultiDatabase(name = &quot;second&quot;, sourceType = MultiDataSource.SourceType.ORACLE)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">findAllSecond</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;second&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@MultiDatabase(name = &quot;third&quot;, sourceType = MultiDataSource.SourceType.MYSQL)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">findAllThird</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;third&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="用反射机制来调用注解中的内容"><a href="#用反射机制来调用注解中的内容" class="headerlink" title="用反射机制来调用注解中的内容"></a>用反射机制来调用注解中的内容</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">        <span class="comment">//获得要调用的类，一般不会这么获取</span></span><br><span class="line">Class&lt;TempServiceDemo&gt; tempServiceDemoClass=TempServiceDemo.class;</span><br><span class="line"><span class="comment">// 获得要调用的方法，output是要调用的方法名字，new Class[]&#123;&#125;为所需要的参数。空则不是这种</span></span><br><span class="line">Method currentMethod=<span class="literal">null</span>;</span><br><span class="line">        <span class="keyword">try</span>&#123;</span><br><span class="line">        currentMethod=tempServiceDemoClass.getMethod(<span class="string">&quot;findAllSecond&quot;</span>,<span class="keyword">new</span> <span class="title class_">Class</span>[]&#123;&#125;);</span><br><span class="line">        <span class="comment">// 是否有类型为MyAnnotation的注解</span></span><br><span class="line">        <span class="keyword">if</span>(currentMethod.isAnnotationPresent(MultiDatabase.class))&#123;</span><br><span class="line">        <span class="comment">// 获得注解</span></span><br><span class="line">        MultiDatabase datasource=currentMethod.getAnnotation(MultiDatabase.class);</span><br><span class="line">        <span class="comment">// 调用注解的内容</span></span><br><span class="line">        System.out.println(datasource.name());</span><br><span class="line">        &#125;</span><br><span class="line">        System.out.println(<span class="string">&quot;----------------------------------&quot;</span>);</span><br><span class="line">        <span class="comment">// 获得所有注解。必须是runtime类型的  @Retention(RetentionPolicy.RUNTIME)</span></span><br><span class="line">        Annotation[]annotations=currentMethod.getAnnotations();</span><br><span class="line">        <span class="keyword">for</span>(Annotation annotation:annotations)&#123;</span><br><span class="line">        <span class="comment">// 遍历所有注解的名字</span></span><br><span class="line">        System.out.println(annotation.annotationType().getName());</span><br><span class="line">        &#125;</span><br><span class="line">        &#125;<span class="keyword">catch</span>(NoSuchMethodException e)&#123;</span><br><span class="line">        <span class="comment">//错误处理</span></span><br><span class="line">        &#125;</span><br></pre></td></tr></table></figure>

<h2 id="AOP-使用自定义注解"><a href="#AOP-使用自定义注解" class="headerlink" title="AOP 使用自定义注解"></a>AOP 使用自定义注解</h2><h3 id="注解-UserAccess"><a href="#注解-UserAccess" class="headerlink" title="注解 @UserAccess"></a>注解 @UserAccess</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="meta">@Target(&#123;ElementType.METHOD, ElementType.TYPE&#125;)</span></span><br><span class="line"><span class="meta">@Retention(RetentionPolicy.RUNTIME)</span></span><br><span class="line"><span class="keyword">public</span> <span class="meta">@interface</span> UserAccess &#123;</span><br><span class="line">    String <span class="title function_">desc</span><span class="params">()</span> <span class="keyword">default</span> <span class="string">&quot;无信息&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="AOP-中的使用"><a href="#AOP-中的使用" class="headerlink" title="AOP 中的使用"></a>AOP 中的使用</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@After(&quot;@annotation(userAccess)&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">after</span><span class="params">(JoinPoint jp,UserAccess userAccess)</span>&#123;</span><br><span class="line">        log.debug(<span class="string">&quot;second after:&quot;</span>+userAccess.desc());</span><br><span class="line">        &#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserController</span> &#123;</span><br><span class="line">    <span class="meta">@RequestMapping(&quot;/second&quot;)</span></span><br><span class="line">    <span class="meta">@UserAccess(desc = &quot;second&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> Object <span class="title function_">second</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;second controller&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="其它注解"><a href="#其它注解" class="headerlink" title="其它注解"></a>其它注解</h2><h4 id="Deprecated-表明不建议使用"><a href="#Deprecated-表明不建议使用" class="headerlink" title="@Deprecated 表明不建议使用"></a>@Deprecated 表明不建议使用</h4><h4 id="JsonValue-序列化之后只返回这一个值"><a href="#JsonValue-序列化之后只返回这一个值" class="headerlink" title="@JsonValue 序列化之后只返回这一个值"></a>@JsonValue 序列化之后只返回这一个值</h4><p>用在属性或者get方法上。</p>
<h4 id="JsonProperty-把当前属性名称序列化为另一个名称"><a href="#JsonProperty-把当前属性名称序列化为另一个名称" class="headerlink" title="@JsonProperty 把当前属性名称序列化为另一个名称"></a>@JsonProperty 把当前属性名称序列化为另一个名称</h4><p>当接受application&#x2F;json编码格式的参数时,同样需要接收参数为this_name的参数.</p>
<p>但是当用表单提交时,则必须传thisName或ThisName才能接收</p>
<blockquote>
<p>本文地址： <a target="_blank" rel="noopener" href="https://www.jianshu.com/p/fdd9a7546aee">SpringBoot+JPA多数据源（注解方式）</a></p>
<p>推荐<br><a target="_blank" rel="noopener" href="https://www.jianshu.com/p/c1f87b0dd597">IDEA好用的插件</a><br><a target="_blank" rel="noopener" href="https://www.jianshu.com/p/c60d3b36142e">JAVA自定义注解</a></p>
</blockquote>
<p>本文地址： <a href="https://github.com/maxzhao-it/blog/post/55853/">https://github.com/maxzhao-it/blog/post/55853/</a> </p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://github.com/maxzhao-it/blog/post/56235/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/blog/uploads/images/avatar.jpg">
      <meta itemprop="name" content="赵联胜">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="maxzhao">
      <meta itemprop="description" content="小码农赵联胜的博客,从遇到Java到爱上Java，工作之余学习Java生态圈中的各种技术。">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | maxzhao">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/blog/post/56235/" class="post-title-link" itemprop="url">JAVA获取类的泛型信息</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2022-07-28 17:37:15" itemprop="dateModified" datetime="2022-07-28T17:37:15+08:00">2022-07-28</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/blog/categories/Java/" itemprop="url" rel="index"><span itemprop="name">Java</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h2 id="一、前言"><a href="#一、前言" class="headerlink" title="一、前言"></a>一、前言</h2><p>在我写 <code>SpringBoot JPA</code> 通用<code>controller</code> 的过程中，发现可以直接使用 <code>Entitymanager</code>进行实体类的操作，<code>EntityManager</code>需要实体信息，因为第一次不熟悉<code>EntityManager</code><br>的操作，所以要获取当前类的泛型信息，然后传入<code>EntityManager</code>完成通用的接口操作。</p>
<h2 id="二、以Dao为例"><a href="#二、以Dao为例" class="headerlink" title="二、以Dao为例"></a>二、以<code>Dao</code>为例</h2><h3 id="实体接口"><a href="#实体接口" class="headerlink" title="实体接口"></a>实体接口</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@Accessors(chain = true)</span></span><br><span class="line"><span class="meta">@MappedSuperclass</span><span class="comment">//实体集成映射</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">BaseEntity</span> <span class="keyword">implements</span> <span class="title class_">Serializable</span> &#123;</span><br><span class="line">    <span class="meta">@Id</span></span><br><span class="line">    <span class="meta">@Column(name = &quot;ID&quot;)</span></span><br><span class="line">    <span class="meta">@ApiModelProperty(value = &quot;主键&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> Long id;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Basic</span></span><br><span class="line">    <span class="meta">@Column(name = &quot;DEL_STATUS&quot;)</span></span><br><span class="line">    <span class="meta">@ApiModelProperty(value = &quot;状态 1启用 0 停用&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> Integer delStatus;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="实体"><a href="#实体" class="headerlink" title="实体"></a>实体</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 应用接口日志</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> author</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2019-7-23 15:38:57</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Accessors(chain = true)</span></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@Entity</span></span><br><span class="line"><span class="meta">@Table(name = &quot;app_log_api&quot;, schema = &quot;&quot;, catalog = &quot;&quot;)</span></span><br><span class="line"><span class="meta">@ApiModel(value = &quot;应用接口日志&quot;, description = &quot;应用接口日志&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AppLogApi</span> <span class="keyword">extends</span> <span class="title class_">BaseEntity</span> <span class="keyword">implements</span> <span class="title class_">Serializable</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">long</span> <span class="variable">serialVersionUID</span> <span class="operator">=</span> -<span class="number">1L</span>;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Basic</span></span><br><span class="line">    <span class="meta">@Column(name = &quot;API&quot;)</span></span><br><span class="line">    <span class="meta">@ApiModelProperty(value = &quot;请求地址&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String api;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Basic</span></span><br><span class="line">    <span class="meta">@Column(name = &quot;API_CLASS&quot;)</span></span><br><span class="line">    <span class="meta">@ApiModelProperty(value = &quot;请求的类.方法&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String apiClass;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/*****/</span></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">AppLogApi</span><span class="params">()</span> &#123;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="Dao接口"><a href="#Dao接口" class="headerlink" title="Dao接口"></a><code>Dao</code>接口</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * BaseService</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> maxzhao</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2019-08-15 11:46</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">BaseService</span>&lt;T <span class="keyword">extends</span> <span class="title class_">BaseEntity</span>, ID&gt; &#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 逻辑删除</span></span><br><span class="line"><span class="comment">     **********</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    ResultObj&lt;String&gt; <span class="title function_">del</span><span class="params">(ID id)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="Dao实现"><a href="#Dao实现" class="headerlink" title="Dao实现"></a><code>Dao</code>实现</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="meta">@Service(value = &quot;baseService&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">BaseServiceImpl</span>&lt;T <span class="keyword">extends</span> <span class="title class_">BaseEntity</span>, ID&gt; <span class="keyword">implements</span> <span class="title class_">BaseService</span>&lt;T, ID&gt; &#123;</span><br><span class="line">    <span class="keyword">private</span> Class&lt;T&gt; clazz = <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">Type</span> <span class="variable">type</span> <span class="operator">=</span> <span class="built_in">this</span>.getClass().getGenericInterfaces()[<span class="number">0</span>];</span><br><span class="line">        <span class="keyword">if</span> (type <span class="keyword">instanceof</span> ParameterizedType) &#123;</span><br><span class="line">            <span class="type">ParameterizedType</span> <span class="variable">pType</span> <span class="operator">=</span> (ParameterizedType) type;</span><br><span class="line">            <span class="type">Type</span> <span class="variable">claz</span> <span class="operator">=</span> pType.getActualTypeArguments()[<span class="number">0</span>];</span><br><span class="line">            <span class="keyword">if</span> (claz <span class="keyword">instanceof</span> Class) &#123;</span><br><span class="line">                <span class="built_in">this</span>.clazz = (Class&lt;T&gt;) claz;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    ResultObj&lt;String&gt; <span class="title function_">del</span><span class="params">(ID id)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    Type type=getClass().getGenericSuperclass();</span><br><span class="line">    <span class="keyword">if</span>(type <span class="keyword">instanceof</span> ParameterizedType)&#123;</span><br><span class="line">    ParameterizedType pType=(ParameterizedType)type;</span><br><span class="line">    Type claz=pType.getActualTypeArguments()[<span class="number">0</span>];</span><br><span class="line">    <span class="keyword">if</span>(claz <span class="keyword">instanceof</span> Class)&#123;</span><br><span class="line">    <span class="built_in">this</span>.clazz=(Class&lt;T&gt;)claz;</span><br><span class="line">    &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<h2 id="其它解读"><a href="#其它解读" class="headerlink" title="其它解读"></a>其它解读</h2><p>一、Type接口<br>Type是所有类型的父接口，他有4个子接口和一个实现类。</p>
<p>Class比较常见，它表示的是原始类型。Class类的对象表示JVM中的一个类或接口。每个Java类在JVM里都表现为一个Class对象，可以通过“类名.class”、“对象.getClass()”、“Class.forName(“类名”)<br>”等方式获取Class对象。数组也被映射为Class对象，所有元素类型相同且维数相同的数组都共享同一个Class对象。<br>ParameterizedType表示的是参数化类型，例如List<String>、Map&lt;Integer,String&gt;、Service<User>这种带有泛型的类型。<br>ParameterizedType接口中常用的方法有3个，分别是：<br>(1) Type getRawType()——返回参数化类型中的原始类型，例如List<String>的原始类型为List。<br>(2) Type[] getActualTypeArguments()——获取参数化类型的类型变量或是实际类型列表，例如Map&lt;Integer,String&gt;<br>的实际泛型列表是Integer和String。需要注意的是，该列表的元素类型是Type，也就是说，可能存在多重嵌套的情况。<br>(3) Type getOwerType()——返回的是类型所属的类型，例如存在A<T>，其中定义了内部类InnerA<T>，则InnerA<T>所属的类型是A<T>，如果是顶层类型则返回null。这种关系常见与Map&lt;K,V&gt;<br>接口与Map.Entry&lt;K,V&gt;接口，Map&lt;K,V&gt;是Map.Entry&lt;K,V&gt;接口的所有者。<br>TypeVariable表示的是类型变量，它用来反映的是JVM编译该泛型前的信息，例如List<T>中的T就是类型变量，它在编译时需要被转换为一个具体的类型后才能正常使用。<br>该接口常用的方法有3个，分别是：<br>(1) Type[] getBounds()——获取类型变量的上边界，如果未明确声明上边界则默认为Object。例如Class<K extents Person>中K的上边界就是Person。<br>(2) D getGenericDeclaration()——获取声明该类型变量的原始类型，例如Test<K extents Person>中原始类型是Test。<br>(3) String getName()——获取在源码中定义的名字，上例中为K。<br>GenericArrayType表示的是数组类型且组成元素时ParameterizedType或TypeVariable，例如List<T>或T[]，该接口只有Type getGenericComponentType()<br>一个方法，它返回数组的组成元素类型。<br>WildcardType表示的通配符类型，例如? extends Number 和 ? super Integer。<br>Wildcard接口有两个方法，分别是：<br>(1) Type[] getUpperBounds()——返回类型变量的上边界。<br>(2) Type[] getLowerBounds()——返回类型变量的下边界。<br>二、ParameterizedType与TypeVariable的使用<br>1.未指定泛型参数的泛型类（例如：ArrayList<T>）<br>public class TypeTest {<br>public static void main(String[] args) {<br>System.out.println(“接口是否是泛型类：”+ (ArrayList.class.getGenericInterfaces()[0] instanceof ParameterizedType));<br>System.out.println(“泛型类的名称：”+ ArrayList.class.getGenericInterfaces()[0].getTypeName());<br>System.out.println(“泛型类的实现：”+ ArrayList.class.getGenericInterfaces()[0].getClass());<br>System.out.println(“是否是泛型参数:”+(((ParameterizedType)ArrayList.class.getGenericInterfaces()[0])<br>.getActualTypeArguments()[0] instanceof TypeVariable));<br>System.out.println(“泛型参数名称:”+((ParameterizedType)ArrayList.class.getGenericInterfaces()[0]).getActualTypeArguments()[0]<br>.getTypeName());<br>System.out.println(“泛型参数的实现：”+((ParameterizedType)ArrayList.class.getGenericInterfaces()[0]).getActualTypeArguments()[0]<br>.getClass());<br>}<br>}</p>
<p>&#x2F;&#x2F;输出结果：<br>接口是否是泛型类：true<br>泛型类的名称：java.util.List<E><br>泛型类的实现：class sun.reflect.generics.reflectiveObjects.ParameterizedTypeImpl<br>是否是泛型参数:true<br>泛型参数名称:E<br>泛型参数的实现：class sun.reflect.generics.reflectiveObjects.TypeVariableImpl<br>1<br>2<br>3<br>4<br>5<br>6<br>7<br>8<br>9<br>10<br>11<br>12<br>13<br>14<br>15<br>16<br>17<br>18<br>在这里，我们使用的是ArrayList.class，如果使用new ArrayList<String>().getClass()，是否得到的泛型参数就是String呢？答案是否定的，因为this.getClass()<br>对象是被所有的不同具体类型的ArrayList实例 共享的（例如：new ArrayList<String>(), new ArrayList<Integer>() 等)，所以在字节码中类型会被擦除到上限。</p>
<p>2.指定泛型参数的泛型类（例如：GenericSubClass<String>）<br>public class GenericClass<T> {<br>}</p>
<p>public class GenericSubClass1<String> extends GenericClass<String> {<br>}</p>
<p>public class GenericSubClass2 extends GenericClass<String> {<br>}</p>
<p>public class TypeTest {<br>public static void main(String[] args) {<br>Class clazz &#x3D; GenericSubClass1.class;<br>&#x2F;&#x2F;Class clazz &#x3D; GenericSubClass2 .class;<br>&#x2F;&#x2F;Class clazz &#x3D; new GenericSubClass1().getClass();<br>&#x2F;&#x2F;Class clazz &#x3D; new GenericSubClass2().getClass();<br>System.out.println(“父类是否是泛型类：”+ (clazz.getGenericSuperclass() instanceof ParameterizedType));<br>System.out.println(“泛型类的名称：”+ clazz.getGenericSuperclass().getTypeName());<br>System.out.println(“泛型类的实现：”+ clazz.getGenericSuperclass().getClass());<br>System.out.println(“是否是泛型参数:”+(((ParameterizedType)clazz.getGenericSuperclass()).getActualTypeArguments()[0] instanceof<br>TypeVariable));<br>System.out.println(“泛型参数名称:”+((ParameterizedType)clazz.getGenericSuperclass()).getActualTypeArguments()[0]<br>.getTypeName());<br>System.out.println(“泛型参数的实现：”+((ParameterizedType)clazz.getGenericSuperclass()).getActualTypeArguments()[0].getClass());<br>}<br>}</p>
<p>&#x2F;&#x2F;输出结果：<br>父类是否是泛型类：true<br>泛型类的名称：com.arch.test.reflect.GenericClass<String><br>泛型类的实现：class sun.reflect.generics.reflectiveObjects.ParameterizedTypeImpl<br>是否是泛型参数:true<br>泛型参数名称:String<br>泛型参数的实现：class sun.reflect.generics.reflectiveObjects.TypeVariableImpl</p>
<p>不管是使用”类.class”，还是使用”对象.getClass()”，得到的父类的泛型参数始终是String。</p>
<p>本文地址： <a href="https://github.com/maxzhao-it/blog/post/56235/">https://github.com/maxzhao-it/blog/post/56235/</a> </p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://github.com/maxzhao-it/blog/post/18026/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/blog/uploads/images/avatar.jpg">
      <meta itemprop="name" content="赵联胜">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="maxzhao">
      <meta itemprop="description" content="小码农赵联胜的博客,从遇到Java到爱上Java，工作之余学习Java生态圈中的各种技术。">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | maxzhao">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/blog/post/18026/" class="post-title-link" itemprop="url">SpringBoot启动自定义控制台图标</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2022-07-04 14:50:22" itemprop="dateModified" datetime="2022-07-04T14:50:22+08:00">2022-07-04</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/blog/categories/SpringBoot/" itemprop="url" rel="index"><span itemprop="name">SpringBoot</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>对于使用过Spring Boot的开发者来说，程序启动的时候输出的由字符组成的Spring符号并不陌生。这个是Spring Boot为自己设计的Banner：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">  .   ____          _            __ _ _  </span><br><span class="line"> /\\ / ___&#x27;_ __ _ _(_)_ __  __ _ \ \ \ \  </span><br><span class="line">( ( )\___ | &#x27;_ | &#x27;_| | &#x27;_ \/ _` | \ \ \ \  </span><br><span class="line"> \\/  ___)| |_)| | | | | || (_| |  ) ) ) )  </span><br><span class="line">  &#x27;  |____| .__|_| |_|_| |_\__, | / / / /  </span><br><span class="line"> =========|_|==============|___/=/_/_/_/  </span><br><span class="line"> :: Spring Boot ::        (v1.3.3.RELEASE)  </span><br></pre></td></tr></table></figure>

<p>如果有人不喜欢这个输出，本文说一下怎么修改。</p>
<h3 id="1-第一种方式：修改的时候，进行设置-在Application的main方法中："><a href="#1-第一种方式：修改的时候，进行设置-在Application的main方法中：" class="headerlink" title="1. 第一种方式：修改的时候，进行设置,在Application的main方法中："></a>1. 第一种方式：修改的时候，进行设置,在Application的main方法中：</h3><p>SpringApplication application &#x3D; <strong>new</strong> SpringApplication(App.<strong>class</strong>);<br> &#x2F;*<br> * Banner.Mode.OFF:关闭;<br> * Banner.Mode.CONSOLE:控制台输出，默认方式;<br> * Banner.Mode.LOG:日志输出方式;<br> *&#x2F; application.setBannerMode(Banner.Mode.<em><strong>OFF</strong></em>);<br> application.run(args);</p>
<h3 id="2-第二种方式：修改banner-txt配置文件"><a href="#2-第二种方式：修改banner-txt配置文件" class="headerlink" title="2. 第二种方式：修改banner.txt配置文件"></a>2. 第二种方式：修改banner.txt配置文件</h3><p>在src&#x2F;main&#x2F;resouces下新建banner.txt，在文件中加入：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">#这个是MANIFEST.MF文件中的版本号</span><br><span class="line">$&#123;application.version&#125;              </span><br><span class="line"></span><br><span class="line">#这个是上面的的版本号前面加v后上括号</span><br><span class="line">$&#123;application.formatted-version&#125;</span><br><span class="line"></span><br><span class="line">#这个是springboot的版本号</span><br><span class="line">$&#123;spring-boot.version&#125;             </span><br><span class="line"></span><br><span class="line">#这个是springboot的版本号</span><br><span class="line">$&#123;spring-boot.formatted-version&#125;</span><br></pre></td></tr></table></figure>

<h3 id="3-第三种方式：重写接口Banner实现"><a href="#3-第三种方式：重写接口Banner实现" class="headerlink" title="3. 第三种方式：重写接口Banner实现"></a>3. 第三种方式：重写接口Banner实现</h3><p>SpringBoot提供了一个接口org.springframework.boot.Banner，他的实例可以被传给SpringApplication的setBanner(banner)方法。如果你闲得不行非要着重美化这个命令行输出的话，可以重写Banner接口的printBanner方法。</p>
<h3 id="4-第四种方式：在application-properties进行配置"><a href="#4-第四种方式：在application-properties进行配置" class="headerlink" title="4. 第四种方式：在application.properties进行配置"></a>4. 第四种方式：在application.properties进行配置</h3><p>在application.proerpties进行banner的显示和关闭：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">### 是否显示banner，可选值[true|false]</span><br><span class="line">spring.main.show-banner=false</span><br></pre></td></tr></table></figure>

<hr>
<p>使用Spring Boot启动的jar包总是会显示一个Spring的图标：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">.   ____          _            __ _ _</span><br><span class="line">/\\ / ___&#x27;_ __ _ _(_)_ __  __ _ \ \ \ \</span><br><span class="line">( ( )\___ | &#x27;_ | &#x27;_| | &#x27;_ \/ _` | \ \ \ \</span><br><span class="line">\\/  ___)| |_)| | | | | || (_| |  ) ) ) )</span><br><span class="line">&#x27;  |____| .__|_| |_|_| |_\__, | / / / /</span><br><span class="line">=========|_|==============|___/=/_/_/_/</span><br><span class="line">:: Spring Boot ::        (v1.3.3.RELEASE)</span><br></pre></td></tr></table></figure>

<p>实际上Spring Boot在这个位置，放了一个彩蛋，我们是可以自定义这个图标的。<br> 我们可以在<code>resource</code>目录下面放入一个<code>banner.txt</code><br> 文件，Spring Boot启动项目的时候就会优先启动这个文件中的内容。<br> 这里给大家推荐两个个字符画生成的网站，我们可以利用生成的字符串放入这个<code>banner.txt</code><br> 文件：</p>
<blockquote>
<p><a target="_blank" rel="noopener" href="https://link.jianshu.com/?t=http://www.network-science.de/ascii/">http://www.network-science.de/ascii/</a><br> <a target="_blank" rel="noopener" href="https://link.jianshu.com/?t=http://patorjk.com/software/taag/">http://patorjk.com/software/taag/</a></p>
</blockquote>
<p>比如我生成一个<code>star wars</code>的图标：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">     _______.___________.    ___      .______         </span><br><span class="line">    /       |           |   /   \     |   _  \        </span><br><span class="line">   |   (----`---|  |----`  /  ^  \    |  |_)  |       </span><br><span class="line">    \   \       |  |      /  /_\  \   |      /        </span><br><span class="line">.----)   |      |  |     /  _____  \  |  |\  \----.   </span><br><span class="line">|_______/       |__|    /__/     \__\ | _| `._____|   </span><br><span class="line"></span><br><span class="line">____    __    ____  ___      .______          _______.</span><br><span class="line">\   \  /  \  /   / /   \     |   _  \        /       |</span><br><span class="line"> \   \/    \/   / /  ^  \    |  |_)  |      |   (----`</span><br><span class="line">  \            / /  /_\  \   |      /        \   \    </span><br><span class="line">   \    /\    / /  _____  \  |  |\  \----.----)   |   </span><br><span class="line">    \__/  \__/ /__/     \__\ | _| `._____|_______/    </span><br></pre></td></tr></table></figure>

<p>这样启动的时候</p>
<p><img src="https://upload-images.jianshu.io/upload_images/2691760-a111193c601abf7c.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1000/format/webp" alt="img"></p>
<p> 但是仅仅是这样看起来并不好看，还不如原来的图标好看呢。实际上Spring Boot为这个彩蛋提供了不少美化功能。</p>
<p> Spring Boot提供了一个枚举类</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">AnsiColor</span><br></pre></td></tr></table></figure>

<p>，这个类可以控制</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">banner.txt</span><br></pre></td></tr></table></figure>

<p>中的字符颜色，而且非常容易使用。</p>
<p> 比如我可以将字符设置成颜色：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">BRIGHT_YELLOW</span><br></pre></td></tr></table></figure>



<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">$&#123;AnsiColor.BRIGHT_YELLOW&#125;</span><br><span class="line">     _______.___________.    ___      .______         </span><br><span class="line">    /       |           |   /   \     |   _  \        </span><br><span class="line">   |   (----`---|  |----`  /  ^  \    |  |_)  |       </span><br><span class="line">    \   \       |  |      /  /_\  \   |      /        </span><br><span class="line">.----)   |      |  |     /  _____  \  |  |\  \----.   </span><br><span class="line">|_______/       |__|    /__/     \__\ | _| `._____|   </span><br><span class="line"></span><br><span class="line">____    __    ____  ___      .______          _______.</span><br><span class="line">\   \  /  \  /   / /   \     |   _  \        /       |</span><br><span class="line"> \   \/    \/   / /  ^  \    |  |_)  |      |   (----`</span><br><span class="line">  \            / /  /_\  \   |      /        \   \    </span><br><span class="line">   \    /\    / /  _____  \  |  |\  \----.----)   |   </span><br><span class="line">    \__/  \__/ /__/     \__\ | _| `._____|_______/    </span><br></pre></td></tr></table></figure>

<p>再重新启动项目，启动界面就会变成这个样子：</p>
<p><img src="https://upload-images.jianshu.io/upload_images/2691760-82e7e7222731f38e.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1000/format/webp" alt="img"></p>
<p>类似 <code>$&#123;AnsiColor.BRIGHT_YELLOW&#125;</code> 这种表达式，其实可以放置多个，启动界面上的颜色，总是会根据<code>AnsiColor</code> 的设置改变界面的颜色，这样启动的界面就会显示多种不同的颜色了。</p>
<p>除了这样美化的功能之外，启动界面很重要的功能就是要告诉我们这个项目的一些重要信息。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">`$&#123;application.version&#125;` 这个是`MANIFEST.MF`文件中的版本号</span><br><span class="line">`$&#123;application.formatted-version&#125;` 这个是上面的的版本号前面加v后上括号</span><br><span class="line">` $&#123;spring-boot.version&#125;` 这个是springboot的版本号</span><br><span class="line">`$&#123;spring-boot.formatted-version&#125;`同上</span><br></pre></td></tr></table></figure>

<p>把以上信息通过<code>$&#123;&#125;</code> 放入<code>banner.txt</code>中，就会打印出项目对应的信息。<br> 这里放一个完整的demo:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">$&#123;AnsiColor.BRIGHT_YELLOW&#125;</span><br><span class="line">     _______.___________.    ___      .______         ____    __    ____  ___      .______          _______.</span><br><span class="line">    /       |           |   /   \     |   _  \        \   \  /  \  /   / /   \     |   _  \        /       |</span><br><span class="line">   |   (----`---|  |----`  /  ^  \    |  |_)  |        \   \/    \/   / /  ^  \    |  |_)  |      |   (----`</span><br><span class="line">    \   \       |  |      /  /_\  \   |      /          \            / /  /_\  \   |      /        \   \</span><br><span class="line">.----)   |      |  |     /  _____  \  |  |\  \----.      \    /\    / /  _____  \  |  |\  \----.----)   |</span><br><span class="line">|_______/       |__|    /__/     \__\ | _| `._____|       \__/  \__/ /__/     \__\ | _| `._____|_______/</span><br><span class="line"></span><br><span class="line">$&#123;AnsiColor.BRIGHT_BLUE&#125;</span><br><span class="line">::: Project (version:$&#123;application.version&#125;) :::             ＼(^O^)／    Spring-Boot $&#123;spring-boot.version&#125;</span><br></pre></td></tr></table></figure>

<p>启动就会是这一个样子:</p>
<p><img src="https://upload-images.jianshu.io/upload_images/2691760-32c451ed29cdf37b.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1000/format/webp" alt="img"></p>
<p>如果颜色没有变，那么还需要设置：<code>spring.output.ansi.enabled=ALWAYS</code></p>
<hr>
<p>在2018年的最后一天，借用Spring Boot的<code>Banner</code>向各位程序猿同仁们问候一声：<code>Happy New Year</code>。</p>
<p><img src="https://upload-images.jianshu.io/upload_images/2691760-ccd00aa591ba3d4c.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/872/format/webp" alt="img"></p>
<hr>
<p>接下来我们就来介绍一下这个轻松愉快的自定义<code>banner</code>功能。实现的方式非常简单，我们只需要在Spring Boot工程的<code>/src/main/resources</code> 目录下创建一个<code>banner.txt</code> 文件，然后将<code>ASCII字符</code>画复制进去，就能替换默认的<code>banner</code>了。<br> 比如上图中的输出，就采用了下面的<code>banner.txt</code> 内容：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">$&#123;AnsiColor.BRIGHT_GREEN&#125;</span><br><span class="line">##     ##    ###    ########  ########  ##    ##    ##    ## ######## ##      ##    ##    ## ########    ###    ########</span><br><span class="line">##     ##   ## ##   ##     ## ##     ##  ##  ##     ###   ## ##       ##  ##  ##     ##  ##  ##         ## ##   ##     ##</span><br><span class="line">##     ##  ##   ##  ##     ## ##     ##   ####      ####  ## ##       ##  ##  ##      ####   ##        ##   ##  ##     ##</span><br><span class="line">######### ##     ## ########  ########     ##       ## ## ## ######   ##  ##  ##       ##    ######   ##     ## ########</span><br><span class="line">##     ## ######### ##        ##           ##       ##  #### ##       ##  ##  ##       ##    ##       ######### ##   ##</span><br><span class="line">##     ## ##     ## ##        ##           ##       ##   ### ##       ##  ##  ##       ##    ##       ##     ## ##    ##</span><br><span class="line">##     ## ##     ## ##        ##           ##       ##    ## ########  ###  ###        ##    ######## ##     ## ##     ##</span><br><span class="line">$&#123;AnsiColor.BRIGHT_RED&#125;</span><br><span class="line">Application Version: $&#123;application.version&#125;$&#123;application.formatted-version&#125;</span><br><span class="line">Spring Boot Version: $&#123;spring-boot.version&#125;$&#123;spring-boot.formatted-version&#125;</span><br></pre></td></tr></table></figure>

<p>从上面的内容中可以看到，还使用了一些属性设置：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">`$&#123;AnsiColor.BRIGHT_RED&#125;` ：设置控制台中输出内容的颜色</span><br><span class="line">`$&#123;application.version&#125;` ：用来获取`MANIFEST.MF` 文件中的版本号</span><br><span class="line">`$&#123;application.formatted-version&#125;` ：格式化后的`$&#123;application.version&#125;` 版本信息</span><br><span class="line">`$&#123;spring-boot.version&#125;` ：Spring Boot的版本号</span><br><span class="line">`$&#123;spring-boot.formatted-version&#125;` ：格式化后的`$&#123;spring-boot.version&#125;` 版本信息</span><br></pre></td></tr></table></figure>

<h4 id="生成工具"><a href="#生成工具" class="headerlink" title="生成工具"></a>生成工具</h4><p>如果让我们手工的来编辑这些字符画，显然是一件非常困难的差事。所以，我们可以借助下面这些工具，轻松地根据文字或图片来生成用于<code>Banner</code>输出的字符画。</p>
<blockquote>
<p><a target="_blank" rel="noopener" href="https://link.jianshu.com/?t=http://patorjk.com/software/taag">http://patorjk.com/software/taag</a><br> <a target="_blank" rel="noopener" href="https://link.jianshu.com/?t=http://www.network-science.de/ascii/">http://www.network-science.de/ascii/</a><br> <a target="_blank" rel="noopener" href="https://link.jianshu.com/?t=http://www.degraeve.com/img2txt.php">http://www.degraeve.com/img2txt.php</a></p>
</blockquote>
<p>作者：蝉鸣的雨</p>
<p>链接：<a target="_blank" rel="noopener" href="https://www.jianshu.com/p/bfbcabc4af1d">https://www.jianshu.com/p/bfbcabc4af1d</a></p>
<p>来源：简书</p>
<p>简书著作权归作者所有，任何形式的转载都请联系作者获得授权并注明出处。</p>
<p>本文地址： <a href="https://github.com/maxzhao-it/blog/post/18026/">https://github.com/maxzhao-it/blog/post/18026/</a> </p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://github.com/maxzhao-it/blog/post/51475/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/blog/uploads/images/avatar.jpg">
      <meta itemprop="name" content="赵联胜">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="maxzhao">
      <meta itemprop="description" content="小码农赵联胜的博客,从遇到Java到爱上Java，工作之余学习Java生态圈中的各种技术。">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | maxzhao">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/blog/post/51475/" class="post-title-link" itemprop="url">部署：华为云MPP(DWS)</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2022-07-04 14:50:22" itemprop="dateModified" datetime="2022-07-04T14:50:22+08:00">2022-07-04</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/blog/categories/DB/" itemprop="url" rel="index"><span itemprop="name">DB</span></a>
        </span>
          , 
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/blog/categories/DB/MPP/" itemprop="url" rel="index"><span itemprop="name">MPP</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>下面介绍的开发环境为 <code>postgresql 10.4</code> ;</p>
<p>初始操作参考官方文档.</p>
<h2 id="遇到的问题"><a href="#遇到的问题" class="headerlink" title="遇到的问题"></a>遇到的问题</h2><h3 id="1-数据库编码"><a href="#1-数据库编码" class="headerlink" title="1.数据库编码"></a>1.数据库编码</h3><p>默认的编码不是<code> UTF-8</code> 如果有需要</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">create</span><br><span class="line">database encoding <span class="string">&#x27;UTF8&#x27;</span> template =  owner to <span class="built_in">users</span>;</span><br></pre></td></tr></table></figure>

<h3 id="2-分布列"><a href="#2-分布列" class="headerlink" title="2.分布列"></a>2.分布列</h3><p>MPP 在表结构中, 有一个分布列的概念, 默认为主键, 否为为当前表的第一个字段.</p>
<p>如果没有主键的表, 可以指定分布列.</p>
<p>数据存储方式为 行存储.</p>
<p>备份的表结构中会有特殊 SQL参数, 不一定能还原到开发环境.</p>
<p>解决方法:</p>
<ol>
<li>单独备份表结构与数据</li>
<li>对结构进行修改, 还原表结构</li>
<li>还原数据</li>
</ol>
<h3 id="3-数据存储长度"><a href="#3-数据存储长度" class="headerlink" title="3.数据存储长度"></a>3.数据存储长度</h3><p>在我们开发环境中, <code>varchar(4)</code> 是可以存储 <strong><em>4</em>个汉字</strong>的, 但是在MPP中, 根据官方文档介绍, 只能存<strong><em>1</em>个</strong>汉字.</p>
<p>也就是说, 在开发库还原到线上之前, 需要对数据的长度进行一次处理.</p>
<p>可以根据下面的系统表查询出所需要修改的字段, 进行统一修改:</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">select table_name, column_name, data_type, character_maximum_length</span><br><span class="line">from infomation_schema.columns</span><br><span class="line"><span class="built_in">where</span> table_schema = <span class="string">&#x27;schema_name&#x27;</span></span><br><span class="line">  and data_type <span class="keyword">in</span> (<span class="string">&#x27;character&#x27;</span>, <span class="string">&#x27;character varying&#x27;</span>);</span><br></pre></td></tr></table></figure>

<h3 id="4-数据类型"><a href="#4-数据类型" class="headerlink" title="4.数据类型"></a>4.数据类型</h3><p>判断条件中的  <code>flag=true</code> 是错误的.</p>
<p>本文地址： <a href="https://github.com/maxzhao-it/blog/post/51475/">https://github.com/maxzhao-it/blog/post/51475/</a> </p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://github.com/maxzhao-it/blog/post/30217/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/blog/uploads/images/avatar.jpg">
      <meta itemprop="name" content="赵联胜">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="maxzhao">
      <meta itemprop="description" content="小码农赵联胜的博客,从遇到Java到爱上Java，工作之余学习Java生态圈中的各种技术。">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | maxzhao">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/blog/post/30217/" class="post-title-link" itemprop="url">SpringBoot Jpa实体继承通用属性</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2022-07-04 14:50:22" itemprop="dateModified" datetime="2022-07-04T14:50:22+08:00">2022-07-04</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/blog/categories/SpringBoot/" itemprop="url" rel="index"><span itemprop="name">SpringBoot</span></a>
        </span>
          , 
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/blog/categories/SpringBoot/JPA/" itemprop="url" rel="index"><span itemprop="name">JPA</span></a>
        </span>
          , 
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/blog/categories/SpringBoot/JPA/Entity/" itemprop="url" rel="index"><span itemprop="name">Entity</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h2 id="一、前言"><a href="#一、前言" class="headerlink" title="一、前言"></a>一、前言</h2><p>　　由于项目中的表结构有很多复用的字段，比如创建时间、删除状态、主键等等，也是为个数据设计规范，我们把项目中的 实体（entity）默认都是继承一个父类（包含这些公共的属性）。</p>
<p>　　所以我们这里要简单的实现这个父类。</p>
<p>　　在项目中一般没有物理删除，为了实现逻辑删除，一般会自己实现RepositoryFactoryBean 和 Repository。但是由于多个团队开发，表的结构没有统一，会出现有的表没有基础父类对应的字段，这样就会导致自定义的 jpa repository 操作这些表就会出错。<br>　　<code>@MappedSuperclass</code> 注解是重点！</p>
<h2 id="二、通用父类"><a href="#二、通用父类" class="headerlink" title="二、通用父类"></a>二、通用父类</h2><h3 id="通用主键和逻辑删除状态"><a href="#通用主键和逻辑删除状态" class="headerlink" title="通用主键和逻辑删除状态"></a>通用主键和逻辑删除状态</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * BaseEntity</span></span><br><span class="line"><span class="comment"> * 实体继承映射类基础,保存实体的通用属性</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> maxzhao</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2019-08-15 09:39</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@Accessors(chain = true)</span></span><br><span class="line"><span class="meta">@MappedSuperclass</span><span class="comment">//实体继承映射</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">BaseEntity</span> <span class="keyword">implements</span> <span class="title class_">Serializable</span> &#123;</span><br><span class="line">    <span class="meta">@Id</span></span><br><span class="line">    <span class="meta">@Column(name = &quot;ID&quot;)</span></span><br><span class="line">    <span class="meta">@ApiModelProperty(value = &quot;主键&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> Long id;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Basic</span></span><br><span class="line">    <span class="meta">@Column(name = &quot;DEL_STATUS&quot;)</span></span><br><span class="line">    <span class="meta">@ApiModelProperty(value = &quot;状态 1启用 0 停用&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> Integer delStatus;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>　　只要是实体继承当前类，就可以实现通用的主键和逻辑删除状态了。</p>
<p>　　当然了，我们还可以继续继承，进行实体规范。</p>
<h3 id="通用创建、修改信息"><a href="#通用创建、修改信息" class="headerlink" title="通用创建、修改信息"></a>通用创建、修改信息</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * BaseEntityId</span></span><br><span class="line"><span class="comment"> * 实体集成映射类,保存实体的通用属性</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> maxzhao</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2019-08-15 09:39</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@Accessors(chain = true)</span></span><br><span class="line"><span class="meta">@MappedSuperclass</span><span class="comment">//实体集成映射</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">BaseEntityId</span> <span class="keyword">extends</span> <span class="title class_">BaseEntity</span> &#123;</span><br><span class="line">    <span class="meta">@Basic</span></span><br><span class="line">    <span class="meta">@Column(name = &quot;CREATE_ID&quot;)</span></span><br><span class="line">    <span class="meta">@ApiModelProperty(value = &quot;创建人主键&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> Long createId;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Basic</span></span><br><span class="line">    <span class="meta">@Column(name = &quot;CREATE_IP&quot;)</span></span><br><span class="line">    <span class="meta">@ApiModelProperty(value = &quot;创建IP&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String createIp;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="meta">@Basic</span></span><br><span class="line">    <span class="meta">@Column(name = &quot;CREATE_DATE&quot;)</span></span><br><span class="line">    <span class="meta">@ApiModelProperty(value = &quot;创建时间&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> Timestamp createDate;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Basic</span></span><br><span class="line">    <span class="meta">@Column(name = &quot;UPDATE_DATE&quot;)</span></span><br><span class="line">    <span class="meta">@ApiModelProperty(value = &quot;修改时间&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> Timestamp updateDate;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Basic</span></span><br><span class="line">    <span class="meta">@Column(name = &quot;UPDATE_ID&quot;)</span></span><br><span class="line">    <span class="meta">@ApiModelProperty(value = &quot;修改人主键&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> Long updateId;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Basic</span></span><br><span class="line">    <span class="meta">@Column(name = &quot;UPDATE_IP&quot;)</span></span><br><span class="line">    <span class="meta">@ApiModelProperty(value = &quot;修改IP&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String updateIp;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>　　自此，通用实体属性规范父类就完成了，我们还可以定义主键策略和验证，这里就不列举了。</p>
<blockquote>
<p>本文地址： <a target="_blank" rel="noopener" href="https://www.jianshu.com/p/54762d51a40c">SpringBoot Jpa实体继承通用属性</a></p>
<p>推荐<br><a target="_blank" rel="noopener" href="https://www.jianshu.com/p/c1f87b0dd597">IDEA好用的插件</a><br><a target="_blank" rel="noopener" href="https://www.jianshu.com/p/c60d3b36142e">JAVA自定义注解</a></p>
</blockquote>
<p>本文地址： <a href="https://github.com/maxzhao-it/blog/post/30217/">https://github.com/maxzhao-it/blog/post/30217/</a> </p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://github.com/maxzhao-it/blog/post/22565/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/blog/uploads/images/avatar.jpg">
      <meta itemprop="name" content="赵联胜">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="maxzhao">
      <meta itemprop="description" content="小码农赵联胜的博客,从遇到Java到爱上Java，工作之余学习Java生态圈中的各种技术。">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | maxzhao">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/blog/post/22565/" class="post-title-link" itemprop="url">SpringBoot Jpa的SimpleJpaRepository</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2022-07-04 14:50:22" itemprop="dateModified" datetime="2022-07-04T14:50:22+08:00">2022-07-04</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/blog/categories/SpringBoot/" itemprop="url" rel="index"><span itemprop="name">SpringBoot</span></a>
        </span>
          , 
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/blog/categories/SpringBoot/JPA/" itemprop="url" rel="index"><span itemprop="name">JPA</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h3 id="SimpleJpaRepository"><a href="#SimpleJpaRepository" class="headerlink" title="SimpleJpaRepository"></a><code>SimpleJpaRepository</code></h3><p>　　先看结构<img src="/blog/uploads/images/SimpleJpaRepository_Diagram.png" alt="SimpleJpaRepository_Diagram"></p>
<ul>
<li><code>SimpleJpaRepository</code>实现了<code>JpaRepositoryImplementation</code>接口，它是<code>CrudRepository</code>的默认实现；</li>
<li><code>SimpleJpaRepository</code>的构造方法都包含<code>EntityManager</code>，从这里可以看出来，<code>SimpleJpaRepository</code>是通过<code>EntityManager</code>实现具体功能的。</li>
<li><code>SimpleJpaRepository</code>代码太长就不贴出来了，比较值得注意的地方是：类上注解了<code>@Transactional(readOnly = true)</code>，<code>delete*、save*、flush </code>等都添加了<code>@Transactional</code>注解。</li>
<li>对于查询功能很多都借助了applySpecificationToCriteria方法，将spring data的Specification转换为javax.persistence的CriteriaQuery</li>
<li>正常 <code>JPA</code> 继承<code>JpsRepository</code>接口，此接口继承的<code>PagingAndSortingRepository</code>有分页和排序。自定义<code>repository</code>时，就需要对<code>JpsRepository</code>与<code>CrudRepository</code>有所选择。</li>
</ul>
<h3 id="JpaRepositoryFactory"><a href="#JpaRepositoryFactory" class="headerlink" title="JpaRepositoryFactory"></a><code>JpaRepositoryFactory</code></h3><p>简单介绍了一下<code>SimpleJpaRepository</code>就不得不说<code>JpaRepositoryFactory</code>，这才是基础。</p>
<p>先看关系：</p>
<p><img src="/blog/uploads/images/JpaRepositoryFactoryBean_Diagram.png" alt="JpaRepositoryFactoryBean_Diagram"></p>
<ul>
<li><code>JpaRepositoryFactory</code>的<code>getTargetRepository</code>会根据<code>RepositoryInformation</code>创建<code>JpaRepositoryImplementation</code>，这里默认创建的是<code>SimpleJpaRepository</code>实例</li>
<li><code>RepositoryFactorySupport</code>的<code>getRepository </code>方法在调用子类的 <code>getTargetRepository </code>创建<code>SimpleJpaRepository </code>实例之后，会对其进行<code>proxy</code>，设置其接口为用户定义的<code>dao</code>接口、<code>Repository、TransactionalProxy</code>，并添加了<code>SurroundingTransactionDetectorMethodInterceptor、DefaultMethodInvokingMethodInterceptor、QueryExecutorMethodInterceptor、ImplementationMethodExecutionInterceptor</code>等<code>MethodInterceptor</code>，最后生成最终的实现类</li>
</ul>
<p>本文地址： <a href="https://github.com/maxzhao-it/blog/post/22565/">https://github.com/maxzhao-it/blog/post/22565/</a> </p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://github.com/maxzhao-it/blog/post/40131/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/blog/uploads/images/avatar.jpg">
      <meta itemprop="name" content="赵联胜">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="maxzhao">
      <meta itemprop="description" content="小码农赵联胜的博客,从遇到Java到爱上Java，工作之余学习Java生态圈中的各种技术。">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | maxzhao">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/blog/post/40131/" class="post-title-link" itemprop="url">SpringBoot+JPA多数据源（注解方式）</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2022-07-04 14:50:22" itemprop="dateModified" datetime="2022-07-04T14:50:22+08:00">2022-07-04</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/blog/categories/SpringBoot/" itemprop="url" rel="index"><span itemprop="name">SpringBoot</span></a>
        </span>
          , 
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/blog/categories/SpringBoot/%E8%87%AA%E5%AE%9A%E4%B9%89%E6%B3%A8%E8%A7%A3/" itemprop="url" rel="index"><span itemprop="name">自定义注解</span></a>
        </span>
          , 
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/blog/categories/SpringBoot/%E8%87%AA%E5%AE%9A%E4%B9%89%E6%B3%A8%E8%A7%A3/JPA/" itemprop="url" rel="index"><span itemprop="name">JPA</span></a>
        </span>
          , 
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/blog/categories/SpringBoot/%E8%87%AA%E5%AE%9A%E4%B9%89%E6%B3%A8%E8%A7%A3/JPA/%E5%A4%9A%E6%95%B0%E6%8D%AE%E6%BA%90/" itemprop="url" rel="index"><span itemprop="name">多数据源</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h3 id="First"><a href="#First" class="headerlink" title="First"></a>First</h3><ul>
<li>项目中经常会遇到使用多个数据源的情况。</li>
<li>这里是基于 JPA 来配置多个数据源。</li>
<li>使用了 注解 + AOP 的方式实现。</li>
<li>如果多个数据源的表结构大不相同，不推荐使用，会产生冗余空表。</li>
<li>上面问题也可以通过分包扫描实现</li>
<li>上上面问题也可以通过 <code>EntityManager</code>(<a target="_blank" rel="noopener" href="https://docs.jboss.org/hibernate/jpa/2.2/api/javax/persistence/EntityManager.html">doc</a>) 实现（操作类似于<code>JpaRepository</code>，并且没有实体映射数据库的操作）。</li>
<li>上上上面那问题，在分包扫描方式中，对于不同数据库的相同表用注解实现跨数据库访问很方便。</li>
<li>基于 MySql 8.x</li>
<li>alibaba Druid pool</li>
</ul>
<h4 id="优点"><a href="#优点" class="headerlink" title="优点"></a>优点</h4><ul>
<li>注解+AOP 简化切换工作</li>
<li>配置多数据源简单</li>
</ul>
<h4 id="缺点"><a href="#缺点" class="headerlink" title="缺点"></a>缺点</h4><ul>
<li>不能简单的跟据参数动态切换数据源，也就是说，启动打那一刻，该方法执行连接的数据源就确定了。</li>
<li>如果其它数据源的表在主数据源中没有，则会自动在主数据源中添加。需要另外添加解决方案（扫描包的方式配置数据源）。这是JPA在初始化 Table Bean 的时候，必须要映射到对应数据库中的 Table。</li>
</ul>
<h3 id="构建"><a href="#构建" class="headerlink" title="构建"></a>构建</h3><h4 id="添加依赖"><a href="#添加依赖" class="headerlink" title="添加依赖"></a>添加依赖</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-data-jpa<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>mysql<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mysql-connector-java<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">scope</span>&gt;</span>runtime<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>druid-spring-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.1.16<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--使用啦Lombok插件，需要自己添加 其它需要自己添加了--&gt;</span></span><br></pre></td></tr></table></figure>

<h4 id="配置文件"><a href="#配置文件" class="headerlink" title="配置文件"></a>配置文件</h4><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">datasource:</span></span><br><span class="line">    <span class="attr">driverClassName:</span> <span class="string">com.mysql.cj.jdbc.Driver</span></span><br><span class="line">    <span class="attr">url:</span> <span class="string">jdbc:mysql://127.0.0.1:3306/maxzhao_ittest?charset=utf8mb4&amp;useSSL=false</span></span><br><span class="line">    <span class="attr">username:</span> <span class="string">maxzhao</span></span><br><span class="line">    <span class="attr">password:</span> <span class="string">maxzhao</span></span><br><span class="line">  <span class="attr">main:</span></span><br><span class="line">    <span class="attr">allow-bean-definition-overriding:</span> <span class="literal">true</span></span><br><span class="line"></span><br><span class="line">  <span class="attr">jpa:</span></span><br><span class="line">    <span class="attr">database:</span> <span class="string">MYSQL</span></span><br><span class="line">    <span class="attr">database-plinatform:</span> <span class="string">org.hibernate.dialect.MySQL5InnoDBDialect</span></span><br><span class="line">    <span class="attr">show-sql:</span> <span class="literal">true</span></span><br><span class="line">    <span class="attr">generate-ddl:</span> <span class="literal">true</span></span><br><span class="line">    <span class="attr">open-in-view:</span> <span class="literal">false</span></span><br><span class="line"></span><br><span class="line">    <span class="attr">hibernate:</span></span><br><span class="line">      <span class="attr">ddl-auto:</span> <span class="string">update</span></span><br><span class="line">    <span class="comment">#       naming-strategy: org.hibernate.cfg.ImprovedNamingStrategy</span></span><br><span class="line">    <span class="attr">properties:</span></span><br><span class="line">      <span class="comment">#不加此配置，获取不到当前currentsession</span></span><br><span class="line">      <span class="attr">hibernate:</span></span><br><span class="line">        <span class="attr">current_session_context_class:</span> <span class="string">org.springframework.orm.hibernate5.SpringSessionContext</span></span><br><span class="line">        <span class="attr">dialect:</span> <span class="string">org.hibernate.dialect.MySQL5Dialect</span></span><br><span class="line"><span class="comment"># 多数据源配置</span></span><br><span class="line"><span class="attr">gt:</span></span><br><span class="line">  <span class="attr">maxzhao:</span></span><br><span class="line">    <span class="attr">boot:</span></span><br><span class="line">    <span class="comment">#主动开启多数据源</span></span><br><span class="line">      <span class="attr">multiDatasourceOpen:</span> <span class="literal">true</span></span><br><span class="line">      <span class="string">datasource[0]:</span></span><br><span class="line">        <span class="attr">dbName:</span> <span class="string">second</span></span><br><span class="line">        <span class="attr">driverClassName:</span> <span class="string">com.mysql.cj.jdbc.Driver</span></span><br><span class="line">        <span class="attr">url:</span> <span class="string">jdbc:mysql://127.0.0.1:3306/pos?charset=utf8mb4&amp;useSSL=false</span></span><br><span class="line">        <span class="attr">username:</span> <span class="string">maxzhao</span></span><br><span class="line">        <span class="attr">password:</span> <span class="string">maxzhao</span></span><br><span class="line">      <span class="string">datasource[1]:</span></span><br><span class="line">        <span class="attr">dbName:</span> <span class="string">third</span></span><br><span class="line">        <span class="attr">driverClassName:</span> <span class="string">com.mysql.cj.jdbc.Driver</span></span><br><span class="line">        <span class="attr">url:</span> <span class="string">jdbc:mysql://127.0.0.1:3306/biz?charset=utf8mb4&amp;useSSL=false</span></span><br><span class="line">        <span class="attr">username:</span> <span class="string">maxzhao</span></span><br><span class="line">        <span class="attr">password:</span> <span class="string">maxzhao</span></span><br></pre></td></tr></table></figure>



<h4 id="添加注解类"><a href="#添加注解类" class="headerlink" title="添加注解类"></a>添加注解类</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> gt.maxzhao.boot.common.annotation;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.lang.annotation.*;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * &lt;p&gt;多数据源标识&lt;/p&gt;</span></span><br><span class="line"><span class="comment"> * &lt;p&gt;使用方式：必须用在方法上&lt;/p&gt;</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> maxzhao</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2019-06-26 16:13</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Inherited</span></span><br><span class="line"><span class="meta">@Retention(RetentionPolicy.RUNTIME)</span></span><br><span class="line"><span class="meta">@Target(&#123;ElementType.METHOD&#125;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="meta">@interface</span> MultiDataSource &#123;</span><br><span class="line">    String <span class="title function_">name</span><span class="params">()</span> <span class="keyword">default</span> <span class="string">&quot;main&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="数据源配置映射-yml配置类"><a href="#数据源配置映射-yml配置类" class="headerlink" title="数据源配置映射 yml配置类"></a>数据源配置映射 <code>yml</code>配置类</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * &lt;p&gt;多数据源配置&lt;/p&gt;</span></span><br><span class="line"><span class="comment"> * &lt;p&gt;数据库数据源配置&lt;/p&gt;</span></span><br><span class="line"><span class="comment"> * &lt;p&gt;说明:这个类中包含了许多默认配置,建议不要修改本类,直接在&quot;application.yml&quot;中配置即可&lt;/p&gt;</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> maxzhao</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2019-06-26 16:13</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@ConfigurationProperties(prefix = &quot;spring.datasource&quot;)</span></span><br><span class="line"><span class="meta">@Setter</span></span><br><span class="line"><span class="meta">@Getter</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DruidProperties</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">DruidProperties</span><span class="params">()</span> &#123;</span><br><span class="line">        log.info(<span class="string">&quot;default 数据源加载&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 数据源名称</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="type">String</span> <span class="variable">dbName</span> <span class="operator">=</span> <span class="string">&quot;main&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String url;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String username;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String password;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 默认为 MYSQL 8.x 配置</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="type">String</span> <span class="variable">driverClassName</span> <span class="operator">=</span> <span class="string">&quot;com.mysql.cj.jdbc.Driver&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="type">Integer</span> <span class="variable">initialSize</span> <span class="operator">=</span> <span class="number">10</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="type">Integer</span> <span class="variable">minIdle</span> <span class="operator">=</span> <span class="number">3</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="type">Integer</span> <span class="variable">maxActive</span> <span class="operator">=</span> <span class="number">60</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="type">Integer</span> <span class="variable">maxWait</span> <span class="operator">=</span> <span class="number">60000</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="type">Boolean</span> <span class="variable">removeAbandoned</span> <span class="operator">=</span> <span class="literal">true</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="type">Integer</span> <span class="variable">removeAbandonedTimeout</span> <span class="operator">=</span> <span class="number">180</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="type">Integer</span> <span class="variable">timeBetweenEvictionRunsMillis</span> <span class="operator">=</span> <span class="number">60000</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="type">Integer</span> <span class="variable">minEvictableIdleTimeMillis</span> <span class="operator">=</span> <span class="number">300000</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="type">String</span> <span class="variable">validationQuery</span> <span class="operator">=</span> <span class="string">&quot;SELECT &#x27;x&#x27;&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="type">Boolean</span> <span class="variable">testWhileIdle</span> <span class="operator">=</span> <span class="literal">true</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="type">Boolean</span> <span class="variable">testOnBorrow</span> <span class="operator">=</span> <span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="type">Boolean</span> <span class="variable">testOnReturn</span> <span class="operator">=</span> <span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="type">Boolean</span> <span class="variable">poolPreparedStatements</span> <span class="operator">=</span> <span class="literal">true</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="type">Integer</span> <span class="variable">maxPoolPreparedStatementPerConnectionSize</span> <span class="operator">=</span> <span class="number">50</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="type">String</span> <span class="variable">filters</span> <span class="operator">=</span> <span class="string">&quot;stat&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> DruidDataSource <span class="title function_">config</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">DruidDataSource</span> <span class="variable">dataSource</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">DruidDataSource</span>();</span><br><span class="line">        <span class="keyword">return</span> config(dataSource);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> DruidDataSource <span class="title function_">config</span><span class="params">(DruidDataSource dataSource)</span> &#123;</span><br><span class="line">        dataSource.setDbType(JdbcConstants.MYSQL);</span><br><span class="line">        dataSource.setUrl(url);</span><br><span class="line">        dataSource.setUsername(username);</span><br><span class="line">        dataSource.setPassword(password);</span><br><span class="line">        dataSource.setDriverClassName(driverClassName);</span><br><span class="line">        dataSource.setInitialSize(initialSize);     <span class="comment">// 定义初始连接数</span></span><br><span class="line">        dataSource.setMinIdle(minIdle);             <span class="comment">// 最小空闲</span></span><br><span class="line">        dataSource.setMaxActive(maxActive);         <span class="comment">// 定义最大连接数</span></span><br><span class="line">        dataSource.setMaxWait(maxWait);             <span class="comment">// 获取连接等待超时的时间</span></span><br><span class="line">        dataSource.setRemoveAbandoned(removeAbandoned); <span class="comment">// 超过时间限制是否回收</span></span><br><span class="line">        dataSource.setRemoveAbandonedTimeout(removeAbandonedTimeout); <span class="comment">// 超过时间限制多长</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// 配置间隔多久才进行一次检测，检测需要关闭的空闲连接，单位是毫秒</span></span><br><span class="line">        dataSource.setTimeBetweenEvictionRunsMillis(timeBetweenEvictionRunsMillis);</span><br><span class="line">        <span class="comment">// 配置一个连接在池中最小生存的时间，单位是毫秒</span></span><br><span class="line">        dataSource.setMinEvictableIdleTimeMillis(minEvictableIdleTimeMillis);</span><br><span class="line">        <span class="comment">// 用来检测连接是否有效的sql，要求是一个查询语句</span></span><br><span class="line">        dataSource.setValidationQuery(validationQuery);</span><br><span class="line">        <span class="comment">// 申请连接的时候检测</span></span><br><span class="line">        dataSource.setTestWhileIdle(testWhileIdle);</span><br><span class="line">        <span class="comment">// 申请连接时执行validationQuery检测连接是否有效，配置为true会降低性能</span></span><br><span class="line">        dataSource.setTestOnBorrow(testOnBorrow);</span><br><span class="line">        <span class="comment">// 归还连接时执行validationQuery检测连接是否有效，配置为true会降低性能</span></span><br><span class="line">        dataSource.setTestOnReturn(testOnReturn);</span><br><span class="line">        <span class="comment">// 打开PSCache，并且指定每个连接上PSCache的大小</span></span><br><span class="line">        dataSource.setPoolPreparedStatements(poolPreparedStatements);</span><br><span class="line">        dataSource.setMaxPoolPreparedStatementPerConnectionSize(maxPoolPreparedStatementPerConnectionSize);</span><br><span class="line">        <span class="comment">// 属性类型是字符串，通过别名的方式配置扩展插件，常用的插件有：</span></span><br><span class="line">        <span class="comment">// 监控统计用的filter:stat</span></span><br><span class="line">        <span class="comment">// 日志用的filter:log4j</span></span><br><span class="line">        <span class="comment">// 防御SQL注入的filter:wall</span></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            dataSource.setFilters(filters);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (SQLException e) &#123;</span><br><span class="line">            log.error(<span class="string">&quot;扩展插件失败.&#123;&#125;&quot;</span>, e.getMessage());</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> dataSource;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h4 id="多数据源配置映射-yml配置类"><a href="#多数据源配置映射-yml配置类" class="headerlink" title="多数据源配置映射 yml配置类"></a>多数据源配置映射 <code>yml</code>配置类</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * &lt;p&gt;多数据源配置&lt;/p&gt;</span></span><br><span class="line"><span class="comment"> * &lt;p&gt;多个数据源&lt;/p&gt;</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> maxzhao</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2019-06-26 16:22</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@ConfigurationProperties(prefix = &quot;gt.maxzhao.boot&quot;)</span></span><br><span class="line"><span class="meta">@Getter</span></span><br><span class="line"><span class="meta">@Setter</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MultiDataSource</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">MultiDataSource</span><span class="params">()</span> &#123;</span><br><span class="line">        log.info(<span class="string">&quot;加载多数据源配置信息  --&gt;  &#123;&#125;&quot;</span>, <span class="string">&quot;gt.maxzhao.boot.datasource&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 多个数据源</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> List&lt;DruidProperties&gt; datasource;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h4 id="多数据源配置类"><a href="#多数据源配置类" class="headerlink" title="多数据源配置类"></a>多数据源配置类</h4><p>这里需要配置动态开启多数据源，如果不主动开启，配置了注解也不会生效。</p>
<p>这里也做了一个不必要的处理，如果多数据源中有处理失败或名称填写错误，默认使用主数据源。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * &lt;p&gt;多数据源配置&lt;/p&gt;</span></span><br><span class="line"><span class="comment"> * &lt;p&gt;多数据源配置&lt;/p&gt;</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> maxzhao</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2019-06-26 16:07</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MultiSourceConfig</span> &#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> DruidProperties druidProperties;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> MultiDataSource multiDataSource;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 单数据源连接池配置</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="meta">@ConditionalOnProperty(name = &quot;gt.maxzhao.boot.multiDatasourceOpen&quot;, havingValue = &quot;false&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> DruidDataSource <span class="title function_">singleDatasource</span><span class="params">()</span> &#123;</span><br><span class="line">        log.error(<span class="string">&quot;singleDatasource&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> druidProperties.config(<span class="keyword">new</span> <span class="title class_">DruidDataSource</span>());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 多数据源连接池配置</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="meta">@ConditionalOnProperty(name = &quot;gt.maxzhao.boot.multiDatasourceOpen&quot;, havingValue = &quot;true&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> DynamicDataSource <span class="title function_">mutiDataSource</span><span class="params">()</span> &#123;</span><br><span class="line">        log.error(<span class="string">&quot;mutiDataSource&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//存储数据源别名与数据源的映射</span></span><br><span class="line">        HashMap&lt;Object, Object&gt; dbNameMap = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">        <span class="comment">// 核心数据源</span></span><br><span class="line">        <span class="type">DruidDataSource</span> <span class="variable">mainDataSource</span> <span class="operator">=</span> druidProperties.config();</span><br><span class="line">        <span class="comment">// 这里添加 主要数据库，其它数据库挂了，默认使用主数据库</span></span><br><span class="line">        dbNameMap.put(<span class="string">&quot;main&quot;</span>, mainDataSource);</span><br><span class="line">        <span class="comment">// 其它数据源</span></span><br><span class="line">        <span class="comment">// 当前多数据源是否存在</span></span><br><span class="line">        <span class="keyword">if</span> (multiDataSource.getDatasource() != <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="comment">//过滤掉没有添加 dbName 的数据源，先加载娟全局配置，再次加载当前配置</span></span><br><span class="line">            List&lt;DruidDataSource&gt; multiDataSourceList = multiDataSource.getDatasource().stream()</span><br><span class="line">                    .filter(dp -&gt; !<span class="string">&quot;&quot;</span>.equals(Optional.ofNullable(dp.getDbName()).orElse(<span class="string">&quot;&quot;</span>)))</span><br><span class="line">                    .map(dp -&gt; &#123;</span><br><span class="line">                        <span class="type">DruidDataSource</span> <span class="variable">druidDataSource</span> <span class="operator">=</span> dp.config(druidProperties.config());</span><br><span class="line">                        dbNameMap.put(dp.getDbName(), druidDataSource);</span><br><span class="line">                        <span class="keyword">return</span> druidDataSource;</span><br><span class="line">                    &#125;)</span><br><span class="line">                    .collect(Collectors.toList());</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 测试所有的数据源</span></span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                mainDataSource.init();</span><br><span class="line">                <span class="keyword">for</span> (DruidDataSource druidDataSource : multiDataSourceList) &#123;</span><br><span class="line">                    druidDataSource.init();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125; <span class="keyword">catch</span> (SQLException sql) &#123;</span><br><span class="line">                log.error(<span class="string">&quot;=======================    多数据源配置错误   ==========================&quot;</span>);</span><br><span class="line">                sql.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="type">DynamicDataSource</span> <span class="variable">dynamicDataSource</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">DynamicDataSource</span>();</span><br><span class="line">        dynamicDataSource.setTargetDataSources(dbNameMap);</span><br><span class="line">        dynamicDataSource.setDefaultTargetDataSource(mainDataSource);</span><br><span class="line">        <span class="keyword">return</span> dynamicDataSource;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="DataSource-的-router"><a href="#DataSource-的-router" class="headerlink" title="DataSource 的 router"></a>DataSource 的 router</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * &lt;p&gt;多数据源配置&lt;/p&gt;</span></span><br><span class="line"><span class="comment"> * &lt;p&gt;动态数据源&lt;/p&gt;</span></span><br><span class="line"><span class="comment"> * &lt;p&gt;多 datasource 的上下文&lt;/p&gt;</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> xiongneng</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@since</span> 2017年3月5日 上午9:11:49</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DynamicDataSource</span> <span class="keyword">extends</span> <span class="title class_">AbstractRoutingDataSource</span> &#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * &lt;p&gt;多 datasource 的上下文&lt;/p&gt;</span></span><br><span class="line"><span class="comment">     * &lt;p&gt;每个线程独立的数据库连接名称&lt;/p&gt;</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> ThreadLocal&lt;String&gt; contextHolder = <span class="keyword">new</span> <span class="title class_">ThreadLocal</span>&lt;String&gt;();</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> dataSourceDbName 数据库别名</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@Description</span>: 设置数据源别名</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">setDataSourceDbName</span><span class="params">(String dataSourceDbName)</span> &#123;</span><br><span class="line">        contextHolder.set(dataSourceDbName);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@Description</span>: 获取数据源别名</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> String <span class="title function_">getDataSourceDbName</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> contextHolder.get();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@Description</span>: 清除数据源别名</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">clearDataSourceDbName</span><span class="params">()</span> &#123;</span><br><span class="line">        contextHolder.remove();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 重写获取连接名称的方法</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 连接名称</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> Object <span class="title function_">determineCurrentLookupKey</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> getDataSourceDbName();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="AOP配置"><a href="#AOP配置" class="headerlink" title="AOP配置"></a>AOP配置</h4><p>切点是自定义注解的包路径</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * &lt;p&gt;多数据源切换的 aop&lt;/p&gt;</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> maxzhao</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2019-06-26 16:22</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Aspect</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@ConditionalOnProperty(prefix = &quot;gt.maxzhao.boot&quot;, name = &quot;multiDatasourceOpen&quot;, havingValue = &quot;true&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MultiDataSourceAop</span> <span class="keyword">implements</span> <span class="title class_">Ordered</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">Logger</span> <span class="variable">log</span> <span class="operator">=</span> LoggerFactory.getLogger(<span class="built_in">this</span>.getClass());</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">MultiDataSourceAop</span><span class="params">()</span> &#123;</span><br><span class="line">        log.info(<span class="string">&quot;多数据源初始化 AOP &quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Pointcut(value = &quot;@annotation(gt.maxzhao.boot.common.annotation.MultiDataSource)&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">cut</span><span class="params">()</span> &#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Around(&quot;cut()&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> Object <span class="title function_">around</span><span class="params">(ProceedingJoinPoint point)</span> <span class="keyword">throws</span> Throwable &#123;</span><br><span class="line"></span><br><span class="line">        <span class="type">Signature</span> <span class="variable">signature</span> <span class="operator">=</span> point.getSignature();</span><br><span class="line">        MethodSignature methodSignature ;</span><br><span class="line">        <span class="keyword">if</span> (!(signature <span class="keyword">instanceof</span> MethodSignature)) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">IllegalArgumentException</span>(<span class="string">&quot;该注解只能用于方法&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        methodSignature = (MethodSignature) signature;</span><br><span class="line">        <span class="comment">//获取当点方法的注解</span></span><br><span class="line">        <span class="type">Object</span> <span class="variable">target</span> <span class="operator">=</span> point.getTarget();</span><br><span class="line">        <span class="type">Method</span> <span class="variable">currentMethod</span> <span class="operator">=</span> target.getClass().getMethod(methodSignature.getName(), methodSignature.getParameterTypes());</span><br><span class="line"></span><br><span class="line">        <span class="type">MultiDataSource</span> <span class="variable">datasource</span> <span class="operator">=</span> currentMethod.getAnnotation(MultiDataSource.class);</span><br><span class="line">        <span class="keyword">if</span> (datasource != <span class="literal">null</span>) &#123;</span><br><span class="line">            DynamicDataSource.setDataSourceDbName(datasource.name());</span><br><span class="line">            log.debug(<span class="string">&quot;设置数据源为：&quot;</span> + datasource.name());</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            DynamicDataSource.setDataSourceDbName(<span class="string">&quot;main&quot;</span>);</span><br><span class="line">            log.debug(<span class="string">&quot;设置数据源为：默认  --&gt;  main&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> point.proceed();</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            log.debug(<span class="string">&quot;清空数据源信息！&quot;</span>);</span><br><span class="line">            DynamicDataSource.clearDataSourceDbName();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * aop的顺序要早于spring的事务</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">getOrder</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p>到这里构建结束</p>
<h3 id="测试"><a href="#测试" class="headerlink" title="测试"></a>测试</h3><h4 id="model"><a href="#model" class="headerlink" title="model"></a>model</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Accessors(chain = true)</span></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@Entity</span></span><br><span class="line"><span class="meta">@Table(name = &quot;temp&quot;, schema = &quot;&quot;, catalog = &quot;&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Temp</span> <span class="keyword">implements</span> <span class="title class_">Serializable</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">long</span> <span class="variable">serialVersionUID</span> <span class="operator">=</span> -<span class="number">1L</span>;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Id</span></span><br><span class="line">    <span class="meta">@Column(name = &quot;ID&quot;,unique = true)</span></span><br><span class="line">    <span class="meta">@ApiModelProperty(value = &quot;主键&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> Long id;</span><br><span class="line">    <span class="meta">@Basic</span></span><br><span class="line">    <span class="meta">@Column(name = &quot;NAME&quot;)</span></span><br><span class="line">    <span class="meta">@ApiModelProperty(value = &quot;地区名称&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="service"><a href="#service" class="headerlink" title="service"></a>service</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="meta">@Transactional</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TempServiceDemo</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> TempRepository tempRepository;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> List&lt;Temp&gt; <span class="title function_">findAll</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> tempRepository.findAll();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@MultiDataSource(name = &quot;second&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> List&lt;Temp&gt; <span class="title function_">findAllSecond</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> tempRepository.findAll();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@MultiDataSource(name = &quot;third&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> List&lt;Temp&gt; <span class="title function_">findAllThird</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> tempRepository.findAll();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="dao"><a href="#dao" class="headerlink" title="dao"></a>dao</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Repository(&quot;tempRepository&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">TempRepository</span> <span class="keyword">extends</span> <span class="title class_">JpaRepository</span>&lt;Temp, Long&gt; &#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="Test"><a href="#Test" class="headerlink" title="Test"></a>Test</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RunWith(SpringRunner.class )</span></span><br><span class="line"><span class="comment">// 这里的 BasicApplication 是当前SpringBoot的启动类</span></span><br><span class="line"><span class="meta">@SpringBootTest(classes = BasicApplication.class)</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MultiDataSourceTest</span> &#123;</span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> TempServiceDemo tempServiceDemo;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> MultiDataSource multiDataSource;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testMultiDataSource</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;\r\n=================\r\n&quot;</span>);</span><br><span class="line">        System.out.println(tempServiceDemo.findAllSecond());</span><br><span class="line">        System.out.println(<span class="string">&quot;\r\n=================\r\n&quot;</span>);</span><br><span class="line">        System.out.println( tempServiceDemo.findAllThird());</span><br><span class="line">        System.out.println(<span class="string">&quot;\r\n=================\r\n&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="EntityManager-doc-方式"><a href="#EntityManager-doc-方式" class="headerlink" title="EntityManager(doc) 方式"></a><code>EntityManager</code>(<a target="_blank" rel="noopener" href="https://docs.jboss.org/hibernate/jpa/2.2/api/javax/persistence/EntityManager.html">doc</a>) 方式</h3><h4 id="引入："><a href="#引入：" class="headerlink" title="引入："></a>引入：</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Autowired</span></span><br><span class="line"><span class="keyword">private</span> EntityManager entityManager</span><br></pre></td></tr></table></figure>

<h4 id="使用："><a href="#使用：" class="headerlink" title="使用："></a>使用：</h4><p>后续更新。</p>
<blockquote>
<p>本文地址： <a target="_blank" rel="noopener" href="https://www.jianshu.com/p/fdd9a7546aee">SpringBoot+JPA多数据源（注解方式）</a></p>
<p><a target="_blank" rel="noopener" href="https://gitee.com/zhaoliansheng/gtboot-multidatasource">gitee</a></p>
<p>推荐<br><a target="_blank" rel="noopener" href="https://www.jianshu.com/p/c1f87b0dd597">IDEA好用的插件</a><br><a target="_blank" rel="noopener" href="https://www.jianshu.com/p/c60d3b36142e">JAVA自定义注解</a></p>
</blockquote>
<p>本文地址： <a href="https://github.com/maxzhao-it/blog/post/40131/">https://github.com/maxzhao-it/blog/post/40131/</a> </p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://github.com/maxzhao-it/blog/post/45583/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/blog/uploads/images/avatar.jpg">
      <meta itemprop="name" content="赵联胜">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="maxzhao">
      <meta itemprop="description" content="小码农赵联胜的博客,从遇到Java到爱上Java，工作之余学习Java生态圈中的各种技术。">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | maxzhao">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/blog/post/45583/" class="post-title-link" itemprop="url">SpringBoot整合Redis及Redis简介</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2022-07-04 14:50:22" itemprop="dateModified" datetime="2022-07-04T14:50:22+08:00">2022-07-04</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/blog/categories/SpringBoot/" itemprop="url" rel="index"><span itemprop="name">SpringBoot</span></a>
        </span>
          , 
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/blog/categories/SpringBoot/Redis/" itemprop="url" rel="index"><span itemprop="name">Redis</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h1><p>由于版本原因，SpringBoot2.0整合Redis和低版本的SpringBoot不太一样，此方案基于<code>Srping Boot 2.x</code>。</p>
<p><a target="_blank" rel="noopener" href="https://www.jianshu.com/p/d586b476c4cd">Linux下Redis安装</a></p>
<h1 id="整合"><a href="#整合" class="headerlink" title="整合"></a>整合</h1><h2 id="maven-依赖"><a href="#maven-依赖" class="headerlink" title="maven 依赖"></a>maven 依赖</h2><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-data-redis<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 下面的不用加，用于分布式共享session的配置 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.session<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-session-data-redis<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>分布式共享<code>session</code>参考：<a target="_blank" rel="noopener" href="https://www.cnblogs.com/qlong8807/p/5557271.html">参考</a></p>
<h2 id="配置文件application-properties"><a href="#配置文件application-properties" class="headerlink" title="配置文件application.properties"></a>配置文件<code>application.properties</code></h2><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Redis 数据库索引</span></span><br><span class="line"><span class="attr">spring.redis.host</span>=<span class="string">127.0.0.1</span></span><br><span class="line"><span class="attr">spring.redis.port</span>=<span class="string">6379</span></span><br><span class="line"><span class="attr">spring.redis.password</span>=<span class="string">maxzhao</span></span><br><span class="line"><span class="comment"># 连接池最大连接数</span></span><br><span class="line"><span class="attr">spring.redis.jedis.pool.max-active</span>=<span class="string">1000</span></span><br><span class="line"><span class="comment"># 连接池最大阻塞等待时间，负值没有限制</span></span><br><span class="line"><span class="attr">spring.redis.jedis.pool.max-wait</span>=<span class="string">-1</span></span><br><span class="line"><span class="comment"># 连接池中最大空闲连接</span></span><br><span class="line"><span class="attr">spring.redis.jedis.pool.max-idle</span>=<span class="string">10</span></span><br><span class="line"><span class="comment"># 连接池中的最小空闲连接</span></span><br><span class="line"><span class="attr">spring.redis.jedis.pool.min-idle</span>=<span class="string">2</span></span><br><span class="line"><span class="comment"># 超时时间 毫秒</span></span><br><span class="line"><span class="attr">spring.redis.timeout</span>=<span class="string">1000</span></span><br></pre></td></tr></table></figure>

<p>对应的配置类：<code>org.springframework.boot.autoconfigure.data.redis.RedisProperties</code></p>
<h3 id="Jedis-与-Lettuce-两种连接方式"><a href="#Jedis-与-Lettuce-两种连接方式" class="headerlink" title="Jedis 与 Lettuce 两种连接方式"></a>Jedis 与 Lettuce 两种连接方式</h3><ul>
<li>defautl : 默认，0配置 ，也就是走的是 lettuce 单通道方式。   端口：8081</li>
<li>jedis ： 使用Jedis 连接池。                                              端口：8082</li>
<li>lettue: lettuce 连接池方式。                                            端口：8083</li>
</ul>
<ol>
<li>使用jedis：当多线程使用同一个连接时，是线程不安全的。所以要使用连接池，为每个jedis实例分配一个连接。</li>
<li>使用Lettuce：当多线程使用同一连接实例时，是线程安全的。</li>
</ol>
<h2 id="注入"><a href="#注入" class="headerlink" title="注入"></a>注入</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Autowired</span></span><br><span class="line"><span class="keyword">private</span> RedisTemplate redisTemplate;</span><br><span class="line"><span class="meta">@Autowired</span></span><br><span class="line"><span class="keyword">private</span> StringRedisTemplate stringRedisTemplate;</span><br><span class="line"><span class="comment">// StringRedisTemplate是继承RedisTemplate的，</span></span><br><span class="line"><span class="comment">// RedisTemplate在StringRedisTemplate中泛型定义为String</span></span><br></pre></td></tr></table></figure>

<h3 id="StringRedisTemplate-源码"><a href="#StringRedisTemplate-源码" class="headerlink" title="StringRedisTemplate 源码"></a><code>StringRedisTemplate</code> 源码</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">StringRedisTemplate</span> <span class="keyword">extends</span> <span class="title class_">RedisTemplate</span>&lt;String, String&gt; &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">StringRedisTemplate</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.setKeySerializer(RedisSerializer.string());</span><br><span class="line">        <span class="built_in">this</span>.setValueSerializer(RedisSerializer.string());</span><br><span class="line">        <span class="built_in">this</span>.setHashKeySerializer(RedisSerializer.string());</span><br><span class="line">        <span class="built_in">this</span>.setHashValueSerializer(RedisSerializer.string());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">StringRedisTemplate</span><span class="params">(RedisConnectionFactory connectionFactory)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>();</span><br><span class="line">        <span class="built_in">this</span>.setConnectionFactory(connectionFactory);</span><br><span class="line">        <span class="built_in">this</span>.afterPropertiesSet();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">protected</span> RedisConnection <span class="title function_">preProcessConnection</span><span class="params">(RedisConnection connection, <span class="type">boolean</span> existingConnection)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">DefaultStringRedisConnection</span>(connection);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="StringRedisTemplate-测试"><a href="#StringRedisTemplate-测试" class="headerlink" title="StringRedisTemplate 测试"></a><code>StringRedisTemplate</code> 测试</h3><p>这里用的是Springboot Test</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RunWith(SpringRunner.class)</span></span><br><span class="line"><span class="meta">@SpringBootTest(classes = IttestApplication.class)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">RedisTest</span> &#123;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> RedisTemplate redisTemplate;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> StringRedisTemplate stringRedisTemplate;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testRedisTemplate</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">prefix</span> <span class="operator">=</span> <span class="string">&quot;maxzhao:redisTemplate:&quot;</span>;</span><br><span class="line">        <span class="type">HashOperations</span> <span class="variable">hashOperations</span> <span class="operator">=</span> redisTemplate.opsForHash();</span><br><span class="line">        <span class="type">ValueOperations</span> <span class="variable">valueOps</span> <span class="operator">=</span> redisTemplate.opsForValue();</span><br><span class="line">        <span class="type">ListOperations</span> <span class="variable">listOps</span> <span class="operator">=</span> redisTemplate.opsForList();</span><br><span class="line">        <span class="type">SetOperations</span> <span class="variable">setOps</span> <span class="operator">=</span> redisTemplate.opsForSet();</span><br><span class="line">        <span class="type">ZSetOperations</span> <span class="variable">zSetOps</span> <span class="operator">=</span> redisTemplate.opsForZSet();</span><br><span class="line">        <span class="type">GeoOperations</span> <span class="variable">geoOperations</span> <span class="operator">=</span> redisTemplate.opsForGeo();</span><br><span class="line">        <span class="type">ClusterOperations</span> <span class="variable">clusterOperations</span> <span class="operator">=</span> redisTemplate.opsForCluster();</span><br><span class="line">        <span class="type">Map</span> <span class="variable">map</span> <span class="operator">=</span> Arrays.stream(<span class="keyword">new</span> <span class="title class_">String</span>[]&#123;<span class="string">&quot;a&quot;</span>, <span class="string">&quot;B&quot;</span>&#125;).collect(Collectors.toMap(Function.identity(), Function.identity()));</span><br><span class="line">        hashOperations.putAll(prefix + <span class="string">&quot;hash&quot;</span>, map);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testStringRedisTemplate</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">prefix</span> <span class="operator">=</span> <span class="string">&quot;maxzhao:stringRedisTemplate:&quot;</span>;</span><br><span class="line">        <span class="type">HashOperations</span> <span class="variable">hashOperations</span> <span class="operator">=</span> stringRedisTemplate.opsForHash();</span><br><span class="line">        hashOperations.putAll(prefix + <span class="string">&quot;hash&quot;</span>, Arrays.stream(<span class="keyword">new</span> <span class="title class_">String</span>[]&#123;<span class="string">&quot;a&quot;</span>, <span class="string">&quot;b&quot;</span>&#125;).collect(Collectors.toMap(Function.identity(), Function.identity())));</span><br><span class="line">        hashOperations.putAll(prefix + <span class="string">&quot;hash&quot;</span>, Arrays.stream(<span class="keyword">new</span> <span class="title class_">String</span>[]&#123;<span class="string">&quot;c&quot;</span>, <span class="string">&quot;d&quot;</span>&#125;).collect(Collectors.toMap(Function.identity(), Function.identity())));</span><br><span class="line">        hashOperations.putAll(prefix + <span class="string">&quot;hash&quot;</span>, Arrays.stream(<span class="keyword">new</span> <span class="title class_">String</span>[]&#123;<span class="string">&quot;e&quot;</span>, <span class="string">&quot;f&quot;</span>&#125;).collect(Collectors.toMap(Function.identity(), Function.identity())));</span><br><span class="line">        hashOperations.put(prefix + <span class="string">&quot;hash&quot;</span>, <span class="string">&quot;max&quot;</span>, <span class="string">&quot;maxvalue&quot;</span>);<span class="comment">// a b c d e f max</span></span><br><span class="line">        hashOperations.get(prefix + <span class="string">&quot;hash&quot;</span>, <span class="string">&quot;max&quot;</span>);<span class="comment">// maxvalue</span></span><br><span class="line">        hashOperations.delete(prefix + <span class="string">&quot;hash&quot;</span>, <span class="string">&quot;f&quot;</span>);<span class="comment">// return 1  database:a b c d e max</span></span><br><span class="line">        hashOperations.delete(prefix + <span class="string">&quot;hash&quot;</span>, <span class="string">&quot;c&quot;</span>, <span class="string">&quot;d&quot;</span>);<span class="comment">// return 2  database:a b e max</span></span><br><span class="line">        hashOperations.hasKey(prefix + <span class="string">&quot;hash&quot;</span>, <span class="string">&quot;max&quot;</span>);<span class="comment">//return true</span></span><br><span class="line">        hashOperations.values(prefix + <span class="string">&quot;hash&quot;</span>);<span class="comment">// return map object</span></span><br><span class="line">        <span class="type">ValueOperations</span> <span class="variable">valueOperations</span> <span class="operator">=</span> stringRedisTemplate.opsForValue();</span><br><span class="line">        valueOperations.set(prefix + <span class="string">&quot;value&quot;</span>, <span class="string">&quot;value&quot;</span>);</span><br><span class="line">        valueOperations.set(prefix + <span class="string">&quot;value&quot;</span>, <span class="string">&quot;valueTest&quot;</span>);<span class="comment">//value 被覆盖</span></span><br><span class="line">        valueOperations.get(prefix + <span class="string">&quot;value&quot;</span>);<span class="comment">// return valueTest</span></span><br><span class="line"></span><br><span class="line">        <span class="type">ListOperations</span> <span class="variable">listOps</span> <span class="operator">=</span> stringRedisTemplate.opsForList();</span><br><span class="line"><span class="comment">//        listOps.remove(prefix + &quot;list&quot;, listOps.size(prefix + &quot;list&quot;), 1);</span></span><br><span class="line">        listOps.leftPush(prefix + <span class="string">&quot;list&quot;</span>, <span class="string">&quot;A&quot;</span>);</span><br><span class="line">        listOps.leftPush(prefix + <span class="string">&quot;list&quot;</span>, <span class="string">&quot;B&quot;</span>);</span><br><span class="line">        listOps.rightPush(prefix + <span class="string">&quot;list&quot;</span>, <span class="string">&quot;C&quot;</span>, <span class="string">&quot;D&quot;</span>);<span class="comment">//只有 1：B  2：A</span></span><br><span class="line">        listOps.leftPush(prefix + <span class="string">&quot;list&quot;</span>, <span class="string">&quot;C&quot;</span>);</span><br><span class="line">        listOps.leftPush(prefix + <span class="string">&quot;list&quot;</span>, <span class="string">&quot;D&quot;</span>);<span class="comment">//return 3  1:D 2:C 3:A</span></span><br><span class="line">        listOps.range(prefix + <span class="string">&quot;list&quot;</span>, <span class="number">0</span>, listOps.size(prefix + <span class="string">&quot;list&quot;</span>));<span class="comment">//return 3  0:D 1:C 2:A   list下标从0开始</span></span><br><span class="line">        listOps.leftPop(prefix + <span class="string">&quot;list&quot;</span>);<span class="comment">//只有   1：A 返回的为B</span></span><br><span class="line">        listOps.leftPush(prefix + <span class="string">&quot;list2&quot;</span>, <span class="string">&quot;A&quot;</span>);</span><br><span class="line">        listOps.leftPush(prefix + <span class="string">&quot;list2&quot;</span>, <span class="string">&quot;B&quot;</span>);<span class="comment">//只有 1：B  2：A</span></span><br><span class="line">        listOps.rightPush(prefix + <span class="string">&quot;list2&quot;</span>, <span class="string">&quot;C&quot;</span>);<span class="comment">//只有 1：B  2：A 3 C</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// set 是无序的，所有pop等获取value的操作，得到结果可能不同</span></span><br><span class="line">        <span class="type">SetOperations</span> <span class="variable">setOps</span> <span class="operator">=</span> stringRedisTemplate.opsForSet();</span><br><span class="line">        setOps.add(prefix + <span class="string">&quot;set&quot;</span>, <span class="string">&quot;A&quot;</span>);<span class="comment">//return 1</span></span><br><span class="line">        setOps.add(prefix + <span class="string">&quot;set&quot;</span>, <span class="string">&quot;A&quot;</span>);<span class="comment">//return 0</span></span><br><span class="line">        setOps.add(prefix + <span class="string">&quot;set&quot;</span>, <span class="string">&quot;B&quot;</span>);<span class="comment">//return 1</span></span><br><span class="line">        setOps.difference(prefix + <span class="string">&quot;set&quot;</span>, <span class="string">&quot;A&quot;</span>);<span class="comment">//return HashSet  A,B</span></span><br><span class="line">        setOps.isMember(prefix + <span class="string">&quot;set&quot;</span>, <span class="string">&quot;A&quot;</span>);<span class="comment">//return true</span></span><br><span class="line">        setOps.isMember(prefix + <span class="string">&quot;set&quot;</span>, <span class="string">&quot;C&quot;</span>);<span class="comment">//return false</span></span><br><span class="line">        setOps.members(prefix + <span class="string">&quot;set&quot;</span>);<span class="comment">//return HashSet  A,B</span></span><br><span class="line">        setOps.pop(prefix + <span class="string">&quot;set&quot;</span>);<span class="comment">// 出序列并删除 1个</span></span><br><span class="line">        setOps.add(prefix + <span class="string">&quot;set&quot;</span>, <span class="string">&quot;A&quot;</span>,<span class="string">&quot;B&quot;</span>, <span class="string">&quot;C&quot;</span>, <span class="string">&quot;D&quot;</span>, <span class="string">&quot;E&quot;</span>);<span class="comment">//return 5</span></span><br><span class="line">        setOps.pop(prefix + <span class="string">&quot;set&quot;</span>, <span class="number">2</span>);<span class="comment">// 出序列并删除 2个</span></span><br><span class="line">        setOps.add(prefix + <span class="string">&quot;set&quot;</span>, <span class="string">&quot;A&quot;</span>,<span class="string">&quot;B&quot;</span>, <span class="string">&quot;C&quot;</span>, <span class="string">&quot;D&quot;</span>, <span class="string">&quot;E&quot;</span>);</span><br><span class="line">        setOps.move(prefix + <span class="string">&quot;set&quot;</span>, <span class="string">&quot;D&quot;</span>, <span class="string">&quot;A&quot;</span>);<span class="comment">//return  true  database=BCE</span></span><br><span class="line">        <span class="comment">// 把当前key=set的c值，move到 key=set1</span></span><br><span class="line">        setOps.move(prefix + <span class="string">&quot;set&quot;</span>, <span class="string">&quot;C&quot;</span>, prefix + <span class="string">&quot;set1&quot;</span>);<span class="comment">//return  true</span></span><br><span class="line">        setOps.remove(prefix + <span class="string">&quot;set&quot;</span>, <span class="string">&quot;C&quot;</span>, <span class="string">&quot;D&quot;</span>);<span class="comment">//删除</span></span><br><span class="line">        <span class="comment">// 有序的set</span></span><br><span class="line">        <span class="type">ZSetOperations</span> <span class="variable">zSetOps</span> <span class="operator">=</span> stringRedisTemplate.opsForZSet();</span><br><span class="line"></span><br><span class="line">        <span class="type">GeoOperations</span> <span class="variable">geoOperations</span> <span class="operator">=</span> stringRedisTemplate.opsForGeo();</span><br><span class="line">        <span class="comment">// 只有jedis 和 lettuce 支持Redis Cluster。</span></span><br><span class="line">        <span class="type">ClusterOperations</span> <span class="variable">clusterOperations</span> <span class="operator">=</span> stringRedisTemplate.opsForCluster();</span><br><span class="line">        System.out.println(<span class="string">&quot;====================&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h4 id="Redis-Cluster"><a href="#Redis-Cluster" class="headerlink" title="Redis Cluster"></a>Redis Cluster</h4><h5 id="Enabling-Redis-Cluster"><a href="#Enabling-Redis-Cluster" class="headerlink" title="Enabling Redis Cluster"></a>Enabling Redis Cluster</h5><p>集群的支持是基于非集群通讯构建的。RedisClusterConnection 是RedisConnection 的一个扩展，用来处理和Redis Cluster的通讯，转换错误信息到Spring DAO异常层。RedisClusterConnection 是通过RedisConnectionFactory 创建的，该工程的创建要依据于RedisClusterConfiguration配置。</p>

<p>Example 1. Sample RedisConnectionFactory Configuration for Redis Cluster</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@ConfigurationProperties(prefix = &quot;spring.redis.cluster&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ClusterConfigurationProperties</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">     * spring.redis.cluster.nodes[0] = 127.0.0.1:7379</span></span><br><span class="line"><span class="comment">     * spring.redis.cluster.nodes[1] = 127.0.0.1:7380</span></span><br><span class="line"><span class="comment">     * ...</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    List&lt;String&gt; nodes;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Get initial collection of known cluster nodes in format &#123;<span class="doctag">@code</span> host:port&#125;.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> List&lt;String&gt; <span class="title function_">getNodes</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> nodes;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setNodes</span><span class="params">(List&lt;String&gt; nodes)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.nodes = nodes;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AppConfig</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Type safe representation of application.properties</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Autowired</span> ClusterConfigurationProperties clusterProperties;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="meta">@Bean</span> RedisConnectionFactory <span class="title function_">connectionFactory</span><span class="params">()</span> &#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">JedisConnectionFactory</span>(</span><br><span class="line">            <span class="keyword">new</span> <span class="title class_">RedisClusterConfiguration</span>(clusterProperties.getNodes()));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>通过配置文件配置：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"># 这个初始化的配置为驱动库指定了一组初始化集群节点。集群可以在线修改配置，但修改结果只会保存在本驱动的内存中，不会写入到配置文件中。</span><br><span class="line">spring.redis.cluster.nodes: Comma delimited list of host:port pairs.</span><br><span class="line">spring.redis.cluster.max-redirects: Number of allowed cluster redirections.</span><br></pre></td></tr></table></figure>





<blockquote>
<p>参考：<a target="_blank" rel="noopener" href="https://www.cnblogs.com/spihz/p/8548800.html">官方文档中文版（个人站）</a></p>
<p>参考：<a target="_blank" rel="noopener" href="https://docs.spring.io/spring-data/redis/docs/2.0.3.RELEASE/reference/html/#_working_with_redistemplate_and_clusteroperations">官方文档中文版（官网）</a></p>
<p>参考：<a target="_blank" rel="noopener" href="https://docs.spring.io/spring-data/redis/docs/2.1.2.RELEASE/api/">官方文档中文版（官网doc）</a></p>
<p>参考：<a target="_blank" rel="noopener" href="https://www.jianshu.com/p/8bb40afa2e8c">SpringBoot的配置文件</a></p>
</blockquote>
<h3 id="RedisTemplate源码"><a href="#RedisTemplate源码" class="headerlink" title="RedisTemplate源码"></a><code>RedisTemplate</code>源码</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">RedisTemplate</span>&lt;K, V&gt; <span class="keyword">extends</span> <span class="title class_">RedisAccessor</span> <span class="keyword">implements</span> <span class="title class_">RedisOperations</span>&lt;K, V&gt;, BeanClassLoaderAware &#123;</span><br><span class="line">    <span class="comment">// 是否支持事物，必须通过设置setEnableTransactionSupport(true)显式地为使用中的每个RedisTemplate启用事务支持这将强制将正在使用的重断开绑定到当前线程触发MULTI。如果事务完成时没有错误，则调用EXEC，否则丢弃。一旦在MULTI中，RedisConnection将对写操作进行排队，所有只读操作(例如键)都将通过管道传输到一个新的(非线程绑定的)RedisConnection。</span></span><br><span class="line">    <span class="keyword">private</span> <span class="type">boolean</span> <span class="variable">enableTransactionSupport</span> <span class="operator">=</span> <span class="literal">false</span>;</span><br><span class="line">    <span class="comment">// 有一个this.createRedisConnectionProxy代理</span></span><br><span class="line">    <span class="keyword">private</span> <span class="type">boolean</span> <span class="variable">exposeConnection</span> <span class="operator">=</span> <span class="literal">false</span>;</span><br><span class="line">    <span class="comment">// afterPropertiesSet()方法用到，此方法允许bean实例在设置了所有bean属性后执行总体配置的验证和最终初始化。</span></span><br><span class="line">    <span class="keyword">private</span> <span class="type">boolean</span> <span class="variable">initialized</span> <span class="operator">=</span> <span class="literal">false</span>;</span><br><span class="line">    <span class="comment">// 默认序列化</span></span><br><span class="line">    <span class="keyword">private</span> <span class="type">boolean</span> <span class="variable">enableDefaultSerializer</span> <span class="operator">=</span> <span class="literal">true</span>;</span><br><span class="line">    <span class="comment">// 默认使用JdkSerializationRedisSerializer序列化</span></span><br><span class="line">    <span class="meta">@Nullable</span></span><br><span class="line">    <span class="keyword">private</span> RedisSerializer&lt;?&gt; defaultSerializer;</span><br><span class="line">    <span class="meta">@Nullable</span></span><br><span class="line">    <span class="keyword">private</span> ClassLoader classLoader;</span><br><span class="line">    <span class="comment">// 默认使用 this.defaultSerializer 序列化</span></span><br><span class="line">    <span class="meta">@Nullable</span></span><br><span class="line">    <span class="keyword">private</span> <span class="type">RedisSerializer</span> <span class="variable">keySerializer</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">    <span class="comment">// 默认使用 this.defaultSerializer 序列化</span></span><br><span class="line">    <span class="meta">@Nullable</span></span><br><span class="line">    <span class="keyword">private</span> <span class="type">RedisSerializer</span> <span class="variable">valueSerializer</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">    <span class="comment">// 默认使用 this.defaultSerializer 序列化</span></span><br><span class="line">    <span class="meta">@Nullable</span></span><br><span class="line">    <span class="keyword">private</span> <span class="type">RedisSerializer</span> <span class="variable">hashKeySerializer</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">    <span class="comment">// 默认使用 this.defaultSerializer 序列化</span></span><br><span class="line">    <span class="meta">@Nullable</span></span><br><span class="line">    <span class="keyword">private</span> <span class="type">RedisSerializer</span> <span class="variable">hashValueSerializer</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">    <span class="comment">// 默认使用 new StringRedisSerializer(StandardCharsets.UTF_8)</span></span><br><span class="line">    <span class="keyword">private</span> RedisSerializer&lt;String&gt; stringSerializer = RedisSerializer.string();</span><br><span class="line">    <span class="comment">// 用于执行Redis脚本的ScriptExecutor</span></span><br><span class="line">    <span class="meta">@Nullable</span></span><br><span class="line">    <span class="keyword">private</span> ScriptExecutor&lt;K&gt; scriptExecutor;</span><br><span class="line">    <span class="meta">@Nullable</span></span><br><span class="line">    <span class="keyword">private</span> ValueOperations&lt;K, V&gt; valueOps;</span><br><span class="line">    <span class="meta">@Nullable</span></span><br><span class="line">    <span class="keyword">private</span> ListOperations&lt;K, V&gt; listOps;</span><br><span class="line">    <span class="meta">@Nullable</span></span><br><span class="line">    <span class="keyword">private</span> SetOperations&lt;K, V&gt; setOps;</span><br><span class="line">    <span class="meta">@Nullable</span></span><br><span class="line">    <span class="keyword">private</span> ZSetOperations&lt;K, V&gt; zSetOps;</span><br><span class="line">    <span class="meta">@Nullable</span></span><br><span class="line">    <span class="keyword">private</span> GeoOperations&lt;K, V&gt; geoOps;</span><br><span class="line">    <span class="meta">@Nullable</span></span><br><span class="line">    <span class="keyword">private</span> HyperLogLogOperations&lt;K, V&gt; hllOps;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">RedisTemplate</span><span class="params">()</span> &#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">afterPropertiesSet</span><span class="params">()</span> ;</span><br><span class="line">	<span class="comment">// 在连接中执行给定的操作对象</span></span><br><span class="line">    <span class="meta">@Nullable</span></span><br><span class="line">    <span class="keyword">public</span> &lt;T&gt; T <span class="title function_">execute</span><span class="params">(RedisCallback&lt;T&gt; action)</span> ;</span><br><span class="line">	<span class="comment">// 在连接中执行给定的操作对象，该对象可以公开，也可以不公开。</span></span><br><span class="line">    <span class="meta">@Nullable</span></span><br><span class="line">    <span class="keyword">public</span> &lt;T&gt; T <span class="title function_">execute</span><span class="params">(RedisCallback&lt;T&gt; action, <span class="type">boolean</span> exposeConnection)</span> ;</span><br><span class="line">	<span class="comment">// 在可公开或不可公开的连接中执行给定的操作对象。此外，可以对连接进行流水线操作。注意，管道的结果被丢弃(使其适合只写的场景)。有道翻译</span></span><br><span class="line">    <span class="meta">@Nullable</span></span><br><span class="line">    <span class="keyword">public</span> &lt;T&gt; T <span class="title function_">execute</span><span class="params">(RedisCallback&lt;T&gt; action, <span class="type">boolean</span> exposeConnection, <span class="type">boolean</span> pipeline)</span>;</span><br><span class="line">	<span class="comment">// 执行一个Redis会话。允许在同一个会话中执行多个操作，通过RedisOperations.multi()和RedisOperations.watch(Collection)操作启用“事务”功能。</span></span><br><span class="line">    <span class="keyword">public</span> &lt;T&gt; T <span class="title function_">execute</span><span class="params">(SessionCallback&lt;T&gt; session)</span> ;</span><br><span class="line">	<span class="comment">//在管道连接上执行给定的Redis会话。允许流水线处理事务。注意，回调函数不能返回非空值，因为它被管道覆盖。</span></span><br><span class="line">    <span class="keyword">public</span> List&lt;Object&gt; <span class="title function_">executePipelined</span><span class="params">(SessionCallback&lt;?&gt; session)</span> ;</span><br><span class="line">	<span class="comment">// 自定义序列化</span></span><br><span class="line">    <span class="keyword">public</span> List&lt;Object&gt; <span class="title function_">executePipelined</span><span class="params">(SessionCallback&lt;?&gt; session, <span class="meta">@Nullable</span> RedisSerializer&lt;?&gt; resultSerializer)</span> ;</span><br><span class="line">	<span class="comment">// 在管道连接上执行给定的操作对象，返回结果。注意，回调函数不能返回非空值，因为它被管道覆盖。此方法将使用默认的序列化器反序列化结果</span></span><br><span class="line">    <span class="keyword">public</span> List&lt;Object&gt; <span class="title function_">executePipelined</span><span class="params">(RedisCallback&lt;?&gt; action)</span> ;</span><br><span class="line">	<span class="comment">// 自定义序列化</span></span><br><span class="line">    <span class="keyword">public</span> List&lt;Object&gt; <span class="title function_">executePipelined</span><span class="params">(RedisCallback&lt;?&gt; action, <span class="meta">@Nullable</span> RedisSerializer&lt;?&gt; resultSerializer)</span> ;</span><br><span class="line">    <span class="keyword">public</span> &lt;T&gt; T <span class="title function_">execute</span><span class="params">(RedisScript&lt;T&gt; script, List&lt;K&gt; keys, Object... args)</span> ;</span><br><span class="line">    <span class="keyword">public</span> &lt;T&gt; T <span class="title function_">execute</span><span class="params">(RedisScript&lt;T&gt; script, RedisSerializer&lt;?&gt; argsSerializer, RedisSerializer&lt;T&gt; resultSerializer, List&lt;K&gt; keys, Object... args)</span> ;</span><br><span class="line">    <span class="keyword">public</span> &lt;T <span class="keyword">extends</span> <span class="title class_">Closeable</span>&gt; T <span class="title function_">executeWithStickyConnection</span><span class="params">(RedisCallback&lt;T&gt; callback)</span> ;</span><br><span class="line">    <span class="keyword">private</span> Object <span class="title function_">executeSession</span><span class="params">(SessionCallback&lt;?&gt; session)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> session.execute(<span class="built_in">this</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">protected</span> RedisConnection <span class="title function_">createRedisConnectionProxy</span><span class="params">(RedisConnection pm)</span> ;</span><br><span class="line">    <span class="keyword">protected</span> RedisConnection <span class="title function_">preProcessConnection</span><span class="params">(RedisConnection connection, <span class="type">boolean</span> existingConnection)</span> ;</span><br><span class="line">    <span class="meta">@Nullable</span></span><br><span class="line">    <span class="keyword">protected</span> &lt;T&gt; T <span class="title function_">postProcessResult</span><span class="params">(<span class="meta">@Nullable</span> T result, RedisConnection conn, <span class="type">boolean</span> existingConnection)</span> ;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">isExposeConnection</span><span class="params">()</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setExposeConnection</span><span class="params">(<span class="type">boolean</span> exposeConnection)</span> ;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">isEnableDefaultSerializer</span><span class="params">()</span> ;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setEnableDefaultSerializer</span><span class="params">(<span class="type">boolean</span> enableDefaultSerializer)</span> ;</span><br><span class="line">    <span class="meta">@Nullable</span></span><br><span class="line">    <span class="keyword">public</span> RedisSerializer&lt;?&gt; getDefaultSerializer() ;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setDefaultSerializer</span><span class="params">(RedisSerializer&lt;?&gt; serializer)</span> ;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setKeySerializer</span><span class="params">(RedisSerializer&lt;?&gt; serializer)</span> ;</span><br><span class="line">    <span class="keyword">public</span> RedisSerializer&lt;?&gt; getKeySerializer() ;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setValueSerializer</span><span class="params">(RedisSerializer&lt;?&gt; serializer)</span> ;</span><br><span class="line">    <span class="keyword">public</span> RedisSerializer&lt;?&gt; getValueSerializer() ;</span><br><span class="line">    <span class="keyword">public</span> RedisSerializer&lt;?&gt; getHashKeySerializer() ;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setHashKeySerializer</span><span class="params">(RedisSerializer&lt;?&gt; hashKeySerializer)</span> ;</span><br><span class="line">    <span class="keyword">public</span> RedisSerializer&lt;?&gt; getHashValueSerializer() ;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setHashValueSerializer</span><span class="params">(RedisSerializer&lt;?&gt; hashValueSerializer)</span> ;</span><br><span class="line">    <span class="keyword">public</span> RedisSerializer&lt;String&gt; <span class="title function_">getStringSerializer</span><span class="params">()</span> ;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setStringSerializer</span><span class="params">(RedisSerializer&lt;String&gt; stringSerializer)</span> ;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setScriptExecutor</span><span class="params">(ScriptExecutor&lt;K&gt; scriptExecutor)</span> ;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">byte</span>[] rawKey(Object key) ;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">byte</span>[] rawString(String key) ;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">byte</span>[] rawValue(Object value) ;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">byte</span>[][] rawKeys(Collection&lt;K&gt; keys) ;</span><br><span class="line">    <span class="keyword">private</span> K <span class="title function_">deserializeKey</span><span class="params">(<span class="type">byte</span>[] value)</span> ;</span><br><span class="line">    <span class="meta">@Nullable</span></span><br><span class="line">    <span class="keyword">private</span> List&lt;Object&gt; <span class="title function_">deserializeMixedResults</span><span class="params">(<span class="meta">@Nullable</span> List&lt;Object&gt; rawValues, <span class="meta">@Nullable</span> RedisSerializer valueSerializer, <span class="meta">@Nullable</span> RedisSerializer hashKeySerializer, <span class="meta">@Nullable</span> RedisSerializer hashValueSerializer)</span> ;</span><br><span class="line">    <span class="keyword">private</span> Set&lt;?&gt; deserializeSet(Set rawSet, <span class="meta">@Nullable</span> RedisSerializer valueSerializer) ;</span><br><span class="line">    <span class="keyword">private</span> Set&lt;TypedTuple&lt;V&gt;&gt; <span class="title function_">convertTupleValues</span><span class="params">(Set&lt;Tuple&gt; rawValues, <span class="meta">@Nullable</span> RedisSerializer valueSerializer)</span> ;</span><br><span class="line">    <span class="keyword">public</span> List&lt;Object&gt; <span class="title function_">exec</span><span class="params">()</span> ;</span><br><span class="line">    <span class="keyword">public</span> List&lt;Object&gt; <span class="title function_">exec</span><span class="params">(RedisSerializer&lt;?&gt; valueSerializer)</span> ;</span><br><span class="line">    <span class="keyword">protected</span> List&lt;Object&gt; <span class="title function_">execRaw</span><span class="params">()</span> ;</span><br><span class="line">    <span class="keyword">public</span> Boolean <span class="title function_">delete</span><span class="params">(K key)</span> ;</span><br><span class="line">    <span class="keyword">public</span> Long <span class="title function_">delete</span><span class="params">(Collection&lt;K&gt; keys)</span> ;</span><br><span class="line">    <span class="keyword">public</span> Boolean <span class="title function_">unlink</span><span class="params">(K key)</span> ;</span><br><span class="line">    <span class="keyword">public</span> Long <span class="title function_">unlink</span><span class="params">(Collection&lt;K&gt; keys)</span> ;</span><br><span class="line">    <span class="keyword">public</span> Boolean <span class="title function_">hasKey</span><span class="params">(K key)</span> ;</span><br><span class="line">    <span class="keyword">public</span> Long <span class="title function_">countExistingKeys</span><span class="params">(Collection&lt;K&gt; keys)</span> ;</span><br><span class="line">    <span class="keyword">public</span> Boolean <span class="title function_">expire</span><span class="params">(K key, <span class="type">long</span> timeout, TimeUnit unit)</span> ;</span><br><span class="line">    <span class="keyword">public</span> Boolean <span class="title function_">expireAt</span><span class="params">(K key, Date date)</span> ;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">convertAndSend</span><span class="params">(String channel, Object message)</span>;</span><br><span class="line">    <span class="keyword">public</span> Long <span class="title function_">getExpire</span><span class="params">(K key)</span> ;</span><br><span class="line">    <span class="keyword">public</span> Long <span class="title function_">getExpire</span><span class="params">(K key, TimeUnit timeUnit)</span> ;</span><br><span class="line">    <span class="keyword">public</span> Set&lt;K&gt; <span class="title function_">keys</span><span class="params">(K pattern)</span> ;</span><br><span class="line">    <span class="keyword">public</span> Boolean <span class="title function_">persist</span><span class="params">(K key)</span> ;</span><br><span class="line">    <span class="keyword">public</span> Boolean <span class="title function_">move</span><span class="params">(K key, <span class="type">int</span> dbIndex)</span> ;</span><br><span class="line">    <span class="keyword">public</span> K <span class="title function_">randomKey</span><span class="params">()</span> ;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">rename</span><span class="params">(K oldKey, K newKey)</span> ;</span><br><span class="line">    <span class="keyword">public</span> Boolean <span class="title function_">renameIfAbsent</span><span class="params">(K oldKey, K newKey)</span> ;</span><br><span class="line">    <span class="keyword">public</span> DataType <span class="title function_">type</span><span class="params">(K key)</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">byte</span>[] dump(K key) ;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">restore</span><span class="params">(K key, <span class="type">byte</span>[] value, <span class="type">long</span> timeToLive, TimeUnit unit, <span class="type">boolean</span> replace)</span> ;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">multi</span><span class="params">()</span> ;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">discard</span><span class="params">()</span> ;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">watch</span><span class="params">(K key)</span> ;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">watch</span><span class="params">(Collection&lt;K&gt; keys)</span> ;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">unwatch</span><span class="params">()</span> ;</span><br><span class="line">    <span class="keyword">public</span> List&lt;V&gt; <span class="title function_">sort</span><span class="params">(SortQuery&lt;K&gt; query)</span> ;</span><br><span class="line">    <span class="keyword">public</span> &lt;T&gt; List&lt;T&gt; <span class="title function_">sort</span><span class="params">(SortQuery&lt;K&gt; query, <span class="meta">@Nullable</span> RedisSerializer&lt;T&gt; resultSerializer)</span> ;</span><br><span class="line">    <span class="keyword">public</span> &lt;T&gt; List&lt;T&gt; <span class="title function_">sort</span><span class="params">(SortQuery&lt;K&gt; query, BulkMapper&lt;T, V&gt; bulkMapper)</span> ;</span><br><span class="line">    <span class="keyword">public</span> &lt;T, S&gt; List&lt;T&gt; <span class="title function_">sort</span><span class="params">(SortQuery&lt;K&gt; query, BulkMapper&lt;T, S&gt; bulkMapper, <span class="meta">@Nullable</span> RedisSerializer&lt;S&gt; resultSerializer)</span> ;</span><br><span class="line">    <span class="keyword">public</span> Long <span class="title function_">sort</span><span class="params">(SortQuery&lt;K&gt; query, K storeKey)</span> ;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">killClient</span><span class="params">(String host, <span class="type">int</span> port)</span>;</span><br><span class="line">    <span class="keyword">public</span> List&lt;RedisClientInfo&gt; <span class="title function_">getClientList</span><span class="params">()</span> ;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">slaveOf</span><span class="params">(String host, <span class="type">int</span> port)</span> ;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">slaveOfNoOne</span><span class="params">()</span> ;</span><br></pre></td></tr></table></figure>

<h3 id="完成的cache-redis-application-yml配置"><a href="#完成的cache-redis-application-yml配置" class="headerlink" title="完成的cache + redis application.yml配置"></a>完成的cache + redis application.yml配置</h3><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">cache:</span></span><br><span class="line">    <span class="attr">type:</span> <span class="string">REDIS</span></span><br><span class="line">    <span class="attr">redis:</span></span><br><span class="line">      <span class="attr">cache-null-values:</span> <span class="literal">false</span></span><br><span class="line">      <span class="attr">time-to-live:</span> <span class="string">600000ms</span></span><br><span class="line">      <span class="attr">use-key-prefix:</span> <span class="literal">true</span></span><br><span class="line">    <span class="attr">cache-names:</span> <span class="string">userCache,allUsersCache</span></span><br><span class="line">  <span class="attr">redis:</span></span><br><span class="line">    <span class="attr">host:</span> <span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span></span><br><span class="line">    <span class="attr">port:</span> <span class="number">6379</span></span><br><span class="line">    <span class="attr">database:</span> <span class="number">0</span></span><br><span class="line">    <span class="attr">lettuce:</span></span><br><span class="line">      <span class="attr">shutdown-timeout:</span> <span class="string">200ms</span></span><br><span class="line">      <span class="attr">pool:</span></span><br><span class="line">        <span class="attr">max-active:</span> <span class="number">7</span></span><br><span class="line">        <span class="attr">max-idle:</span> <span class="number">7</span></span><br><span class="line">        <span class="attr">min-idle:</span> <span class="number">2</span></span><br><span class="line">        <span class="attr">max-wait:</span> <span class="string">-1ms</span></span><br></pre></td></tr></table></figure>



<blockquote>
<p>本文地址：<a target="_blank" rel="noopener" href="https://www.jianshu.com/p/4a0ce460388c">SpringBoot整合Redis及Redis简介</a></p>
<p>推荐</p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/Idowww/article/details/80971166">Spring cache+ redis与redis 的比较</a></p>
</blockquote>
<p>本文地址： <a href="https://github.com/maxzhao-it/blog/post/45583/">https://github.com/maxzhao-it/blog/post/45583/</a> </p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://github.com/maxzhao-it/blog/post/40132/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/blog/uploads/images/avatar.jpg">
      <meta itemprop="name" content="赵联胜">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="maxzhao">
      <meta itemprop="description" content="小码农赵联胜的博客,从遇到Java到爱上Java，工作之余学习Java生态圈中的各种技术。">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | maxzhao">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/blog/post/40132/" class="post-title-link" itemprop="url">SpringBoot实现RESTful与RestTemplate</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2022-07-04 14:50:22" itemprop="dateModified" datetime="2022-07-04T14:50:22+08:00">2022-07-04</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/blog/categories/SpringBoot/" itemprop="url" rel="index"><span itemprop="name">SpringBoot</span></a>
        </span>
          , 
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/blog/categories/SpringBoot/RESTful/" itemprop="url" rel="index"><span itemprop="name">RESTful</span></a>
        </span>
          , 
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/blog/categories/SpringBoot/RESTful/%E7%BC%96%E5%86%99%E6%8E%A5%E5%8F%A3%E6%B5%8B%E8%AF%95%E7%B1%BB/" itemprop="url" rel="index"><span itemprop="name">编写接口测试类</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="RESTful"><a href="#RESTful" class="headerlink" title="RESTful"></a>RESTful</h1><h2 id="介绍"><a href="#介绍" class="headerlink" title="介绍"></a>介绍</h2><p>REST：表现层状态转化（Representational State Transfer）</p>
<p>RESTful是一种软件设计风格，就是目前最流行的一种互联网软件架构。它结构清晰、符合标准、易于理解、扩展方便。</p>
<p>Spring 对 RESTful 风格的接口有着天然的支持。</p>
<h3 id="什么是REST"><a href="#什么是REST" class="headerlink" title="什么是REST"></a>什么是REST</h3><p> REST（RepresentationalState Transfer）是Roy Fielding 提出的一个描述互联系统架构风格的名词。REST定义了一组体系架构原则，您可以根据这些原则设计以系统资源为中心的Web 服务，包括使用不同语言编写的客户端如何通过 HTTP处理和传输资源状态。</p>
<p>  为什么称为 REST？Web本质上由各种各样的资源组成，资源由URI 唯一标识。浏览器（或者任何其它类似于浏览器的应用程序）将展示出该资源的一种表现方式，或者一种表现状态。如果用户在该页面中定向到指向其它资源的链接，则将访问该资源，并表现出它的状态。这意味着客户端应用程序随着每个资源表现状态的不同而发生状态转移，也即所谓REST。</p>
<p>附：<a target="_blank" rel="noopener" href="https://www.ibm.com/developerworks/cn/webservices/ws-restful/">REST</a><a target="_blank" rel="noopener" href="https://www.ibm.com/developerworks/cn/webservices/ws-restful/">定义</a>、<a target="_blank" rel="noopener" href="http://www.ibm.com/developerworks/cn/webservices/0907_rest_soap/index.html">REST</a><a target="_blank" rel="noopener" href="http://www.ibm.com/developerworks/cn/webservices/0907_rest_soap/index.html">与</a><a target="_blank" rel="noopener" href="http://www.ibm.com/developerworks/cn/webservices/0907_rest_soap/index.html">SOAP</a><a target="_blank" rel="noopener" href="http://www.ibm.com/developerworks/cn/webservices/0907_rest_soap/index.html">的比较</a></p>
<h3 id="REST成熟度的四个层次"><a href="#REST成熟度的四个层次" class="headerlink" title="REST成熟度的四个层次"></a>REST成熟度的四个层次</h3><p>  第一个层次（Level0）的Web 服务只是使用 HTTP 作为传输方式，实际上只是远程方法调用（RPC）的一种具体形  式。SOAP和 XML-RPC都属于此类。</p>
<p>  第二个层次（Level1）的Web 服务引入了资源的概念。每个资源有对应的标识符和表达。</p>
<p>  第三个层次（Level2）的Web 服务使用不同的 HTTP 方法来进行不同的操作，并且使用HTTP 状态码来表示不同的结果。如 HTTPGET 方法来获取资源，HTTPDELETE 方法来删除资源。</p>
<p>  第四个层次（Level3）的Web 服务使用 HATEOAS。在资源的表达中包含了链接信息。客户端可以根据链接来发现可以执行的动作。</p>
<p>  其中第三个层次建立了创建、读取、更新和删除（create,read, update, and delete，CRUD）操作与 HTTP方法之间的一对一映射。根据此映射：</p>
<p>（1）若要在服务器上创建资源，应该使用POST 方法。</p>
<p>（2）若要检索某个资源，应该使用GET 方法。</p>
<p>（3）若要更改资源状态或对其进行更新，应该使用PUT 方法。</p>
<p>（4）若要删除某个资源，应该使用DELETE 方法。</p>
<h3 id="HTTP请求的方法"><a href="#HTTP请求的方法" class="headerlink" title="HTTP请求的方法"></a>HTTP请求的方法</h3><p>（1）GET：通过请求URI得到资源<br>（2）POST：用于添加新的内容<br>（3）PUT：用于修改某个内容，若不存在则添加<br>（4）DELETE：删除某个内容<br>（5）OPTIONS ：询问可以执行哪些方法<br>（6）HEAD ：类似于GET, 但是不返回body信息，用于检查对象是否存在，以及得到对象的元数据<br>（7）CONNECT ：用于代理进行传输，如使用SSL<br>（8）TRACE：用于远程诊断服务器</p>
<h3 id="HTTP请求的状态码"><a href="#HTTP请求的状态码" class="headerlink" title="HTTP请求的状态码"></a>HTTP请求的状态码</h3><p>（1）成功Successful2xx：此类状态码标识客户端的请求被成功接收、理解并接受。常见如200（OK）、204（NoContent）。<br>（2）重定向Redirection3xx：这个类别的状态码标识用户代理要做出进一步的动作来完成请求。常见如301（MovedPermanently）、302（MovedTemprarily）。<br>（3）客户端错误Client Error 4xx：4xx类别的状态码是当客户端象是出错的时使用的。常见如400（BadRequest）、401（Unauthorized）、403（Forbidden）、404（NotFound)。<br>（4）服务器错误Server Error 5xx：响应状态码以5开头表示服务器知道自己出错或者没有能力执行请求。常见如500（InternalServer Error）、502（BadGateway）、504（GatewayTimeout）。</p>
<p>附：<a target="_blank" rel="noopener" href="http://blog.chinaunix.net/uid-9188830-id-2007021.html">HTTP1.1的标准简介</a></p>
<h2 id="接口中的注解"><a href="#接口中的注解" class="headerlink" title="接口中的注解"></a>接口中的注解</h2><ol>
<li>@Controller：修饰class，用来创建处理http请求的对象</li>
<li>@RestController：Spring4之后加入的注解，原来在@Controller中返回实体需要@ResponseBody来配合，如果直接用@RestController替代@Controller就不需要再配置@ResponseBody，默认返回实体格式。</li>
<li>@RequestMapping：配置 url 映射</li>
<li>@PostMapping: 这个是@RequestMapping+POST方法的简写</li>
<li>@RequestHeader: 请求Header参数</li>
<li>@PathVariable: URL路径参数，比如&#x2F;{id}中的id参数</li>
<li>@RequestParam: URL请求参数</li>
<li>@RequestBody: 请求Body参数</li>
</ol>
<p>RESTful架构有一些典型的设计误区，就是URI包含动词。因为”资源”表示一种实体，所以应该是名词，URI不应该有动词，动词应该放在HTTP协议中。 上面设计的API的URI中都是名词。<a target="_blank" rel="noopener" href="https://www.xncoding.com/2017/07/05/spring/sb-restful.html">（此句引用）</a></p>
<h2 id="RESTful-测试类"><a href="#RESTful-测试类" class="headerlink" title="RESTful 测试类"></a>RESTful 测试类</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="meta">@AutoConfigureMockMvc</span></span><br><span class="line"><span class="meta">@RunWith(SpringRunner.class)</span></span><br><span class="line"><span class="meta">@SpringBootTest(classes = Application.class, webEnvironment = SpringBootTest.WebEnvironment.RANDOM_PORT)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ApplicationTests</span> &#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> MockMvc mvc;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testUserController</span><span class="params">()</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="comment">// 测试UserController</span></span><br><span class="line">        RequestBuilder request;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 1、get查一下user列表，应该为空</span></span><br><span class="line">        request = get(<span class="string">&quot;/users/&quot;</span>);</span><br><span class="line">        <span class="type">MvcResult</span> <span class="variable">result</span> <span class="operator">=</span> mvc.perform(request)</span><br><span class="line">                .andExpect(status().isOk())</span><br><span class="line">                .andReturn();</span><br><span class="line">        <span class="type">String</span> <span class="variable">content</span> <span class="operator">=</span> result.getResponse().getContentAsString();</span><br><span class="line">        BaseResponse&lt;List&lt;User&gt;&gt; response = JacksonUtil.json2Bean(content, <span class="keyword">new</span> <span class="title class_">TypeReference</span>&lt;BaseResponse&lt;List&lt;User&gt;&gt;&gt;() &#123;&#125;);</span><br><span class="line">        assertThat(response.isSuccess(), is(<span class="literal">true</span>));</span><br><span class="line">        assertThat(response.getMsg(), is(<span class="string">&quot;查询列表成功&quot;</span>));</span><br><span class="line">        assertThat(((List) response.getData()).size(), is(<span class="number">0</span>));</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 2、post提交一个user</span></span><br><span class="line">        request = post(<span class="string">&quot;/users/&quot;</span>)</span><br><span class="line">                .param(<span class="string">&quot;id&quot;</span>, <span class="string">&quot;1&quot;</span>)</span><br><span class="line">                .param(<span class="string">&quot;name&quot;</span>, <span class="string">&quot;测试大师&quot;</span>)</span><br><span class="line">                .param(<span class="string">&quot;age&quot;</span>, <span class="string">&quot;20&quot;</span>);</span><br><span class="line">        result = mvc.perform(request)</span><br><span class="line">                .andExpect(status().isOk())</span><br><span class="line">                .andReturn();</span><br><span class="line">        content = result.getResponse().getContentAsString();</span><br><span class="line">        BaseResponse&lt;String&gt; response1 = JacksonUtil.json2Bean(content, <span class="keyword">new</span> <span class="title class_">TypeReference</span>&lt;BaseResponse&lt;String&gt;&gt;() &#123;&#125;);</span><br><span class="line">        assertThat(response1.isSuccess(), is(<span class="literal">true</span>));</span><br><span class="line">        assertThat(response1.getMsg(), is(<span class="string">&quot;新增成功&quot;</span>));</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 3、get获取user列表，应该有刚才插入的数据</span></span><br><span class="line">        request = get(<span class="string">&quot;/users/&quot;</span>);</span><br><span class="line">        result = mvc.perform(request)</span><br><span class="line">                .andExpect(status().isOk())</span><br><span class="line">                .andReturn();</span><br><span class="line">        content = result.getResponse().getContentAsString();</span><br><span class="line">        BaseResponse&lt;List&lt;User&gt;&gt; response2 = JacksonUtil.json2Bean(content, <span class="keyword">new</span> <span class="title class_">TypeReference</span>&lt;BaseResponse&lt;List&lt;User&gt;&gt;&gt;() &#123;&#125;);</span><br><span class="line">        assertThat(response2.isSuccess(), is(<span class="literal">true</span>));</span><br><span class="line">        assertThat(response2.getMsg(), is(<span class="string">&quot;查询列表成功&quot;</span>));</span><br><span class="line">        assertThat((response2.getData()).size(), is(<span class="number">1</span>));</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 4、put修改id为1的user</span></span><br><span class="line">        request = put(<span class="string">&quot;/users/1&quot;</span>)</span><br><span class="line">                .param(<span class="string">&quot;name&quot;</span>, <span class="string">&quot;测试终极大师&quot;</span>)</span><br><span class="line">                .param(<span class="string">&quot;age&quot;</span>, <span class="string">&quot;30&quot;</span>);</span><br><span class="line">        result = mvc.perform(request)</span><br><span class="line">                .andExpect(status().isOk())</span><br><span class="line">                .andReturn();</span><br><span class="line">        content = result.getResponse().getContentAsString();</span><br><span class="line">        BaseResponse&lt;String&gt; response3 = JacksonUtil.json2Bean(content, <span class="keyword">new</span> <span class="title class_">TypeReference</span>&lt;BaseResponse&lt;String&gt;&gt;() &#123;&#125;);</span><br><span class="line">        assertThat(response3.isSuccess(), is(<span class="literal">true</span>));</span><br><span class="line">        assertThat(response3.getMsg(), is(<span class="string">&quot;更新成功&quot;</span>));</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 5、get一个id为1的user</span></span><br><span class="line">        request = get(<span class="string">&quot;/users/1&quot;</span>);</span><br><span class="line">        result = mvc.perform(request)</span><br><span class="line">                .andExpect(status().isOk())</span><br><span class="line">                .andReturn();</span><br><span class="line">        content = result.getResponse().getContentAsString();</span><br><span class="line">        BaseResponse&lt;User&gt; response4 = JacksonUtil.json2Bean(content, <span class="keyword">new</span> <span class="title class_">TypeReference</span>&lt;BaseResponse&lt;User&gt;&gt;() &#123;&#125;);</span><br><span class="line">        assertThat(response4.isSuccess(), is(<span class="literal">true</span>));</span><br><span class="line">        assertThat(response4.getMsg(), is(<span class="string">&quot;查询成功&quot;</span>));</span><br><span class="line">        <span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> response4.getData();</span><br><span class="line">        assertThat(user.getId(), is(<span class="number">1L</span>));</span><br><span class="line">        assertThat(user.getName(), is(<span class="string">&quot;测试终极大师&quot;</span>));</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 6、del删除id为1的user</span></span><br><span class="line">        request = delete(<span class="string">&quot;/users/1&quot;</span>);</span><br><span class="line">        result = mvc.perform(request)</span><br><span class="line">                .andExpect(status().isOk())</span><br><span class="line">                .andReturn();</span><br><span class="line">        content = result.getResponse().getContentAsString();</span><br><span class="line">        BaseResponse&lt;String&gt; response5 = JacksonUtil.json2Bean(content, <span class="keyword">new</span> <span class="title class_">TypeReference</span>&lt;BaseResponse&lt;String&gt;&gt;() &#123;&#125;);</span><br><span class="line">        assertThat(response5.isSuccess(), is(<span class="literal">true</span>));</span><br><span class="line">        assertThat(response5.getMsg(), is(<span class="string">&quot;删除成功&quot;</span>));</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 7、get查一下user列表，应该为空</span></span><br><span class="line">        request = get(<span class="string">&quot;/users/&quot;</span>);</span><br><span class="line">        result = mvc.perform(request)</span><br><span class="line">                .andExpect(status().isOk())</span><br><span class="line">                .andReturn();</span><br><span class="line">        content = result.getResponse().getContentAsString();</span><br><span class="line">        BaseResponse&lt;List&lt;User&gt;&gt; response6 = JacksonUtil.json2Bean(content, <span class="keyword">new</span> <span class="title class_">TypeReference</span>&lt;BaseResponse&lt;List&lt;User&gt;&gt;&gt;() &#123;&#125;);</span><br><span class="line">        assertThat(response6.isSuccess(), is(<span class="literal">true</span>));</span><br><span class="line">        assertThat(response6.getMsg(), is(<span class="string">&quot;查询列表成功&quot;</span>));</span><br><span class="line">        assertThat((response6.getData()).size(), is(<span class="number">0</span>));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h1 id="RestTemplate"><a href="#RestTemplate" class="headerlink" title="RestTemplate"></a>RestTemplate</h1><h2 id="介绍-1"><a href="#介绍-1" class="headerlink" title="介绍"></a>介绍</h2><p>用于同步客户端HTTP访问的Spring scentral类。它简化了与httpserver的通信，并实施了RESTful原则。它处理HTTP连接，让应用程序代码提供url(带有可能的模板变量)并提取结果。（简化了发起HTTP请求以及处理响应的过程，并且支持REST。）</p>
<p>RestTemplate默认依赖JDK提供http连接的能力（HttpURLConnection），如果有需要的话也可以通过setRequestFactory方法替换为例如 Apache HttpComponents、Netty或OkHttp等其它HTTP library。</p>
<h3 id="实现逻辑"><a href="#实现逻辑" class="headerlink" title="实现逻辑"></a>实现逻辑</h3><p>参考<a target="_blank" rel="noopener" href="https://www.xncoding.com/2017/07/06/spring/sb-restclient.html">https://www.xncoding.com/2017/07/06/spring/sb-restclient.html</a></p>
<p><a target="_blank" rel="noopener" href="https://docs.spring.io/spring/docs/current/javadoc-api/org/springframework/web/client/RestTemplate.html">API地址</a> </p>
<h2 id="不同的-HTTP-请求实现方式"><a href="#不同的-HTTP-请求实现方式" class="headerlink" title="不同的 HTTP 请求实现方式"></a>不同的 HTTP 请求实现方式</h2><p>RestTemplate 默认依赖 JDK 提供 http 连接的能力（HttpURLConnection），如果有需要的话也可以通过 setRequestFactory 方法替换为例如 Apache HttpComponents、Netty 或 OkHttp 等其它HTTP library。</p>
<h3 id="需要引入依赖"><a href="#需要引入依赖" class="headerlink" title="需要引入依赖"></a>需要引入依赖</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.httpcomponents<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>httpclient<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--&lt;version&gt;4.5.3&lt;/version&gt;--&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>



<h3 id="URLConnection-方式的请求"><a href="#URLConnection-方式的请求" class="headerlink" title="URLConnection 方式的请求"></a>URLConnection 方式的请求</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">String result= <span class="string">&quot;&quot;</span>;</span><br><span class="line">        BufferedReaderin = <span class="literal">null</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            String urlNameString= url +<span class="string">&quot;?&quot;</span> + param;</span><br><span class="line">            URL realUrl= <span class="keyword">new</span> <span class="title class_">URL</span>(urlNameString);</span><br><span class="line">            <span class="comment">// 打开和URL之间的连接</span></span><br><span class="line">            URLConnectionconnection = realUrl.openConnection();</span><br><span class="line">            <span class="comment">// 设置通用的请求属性</span></span><br><span class="line">            connection.setRequestProperty(<span class="string">&quot;accept&quot;</span>,<span class="string">&quot;*/*&quot;</span>);</span><br><span class="line">            connection.setRequestProperty(<span class="string">&quot;connection&quot;</span>,<span class="string">&quot;Keep-Alive&quot;</span>);</span><br><span class="line">            connection.setRequestProperty(<span class="string">&quot;user-agent&quot;</span>,</span><br><span class="line">                    <span class="string">&quot;Mozilla/4.0(compatible; MSIE 6.0; Windows NT 5.1;SV1)&quot;</span>);</span><br><span class="line">            <span class="comment">// 建立实际的连接</span></span><br><span class="line">            connection.connect();</span><br><span class="line">            <span class="comment">// 获取所有响应头字段</span></span><br><span class="line">            Map&lt;String,List&lt;String&gt;&gt; map = connection.getHeaderFields();</span><br><span class="line">            <span class="comment">// 遍历所有的响应头字段</span></span><br><span class="line">            <span class="keyword">for</span>(String key : map.keySet()) &#123;</span><br><span class="line">                System.out.println(key+ <span class="string">&quot;---&gt;&quot;</span> + map.get(key));</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">// 定义 BufferedReader输入流来读取URL的响应</span></span><br><span class="line">            in =<span class="keyword">new</span> <span class="title class_">BufferedReader</span>(newInputStreamReader(</span><br><span class="line">                    connection.getInputStream()));</span><br><span class="line">            String line;</span><br><span class="line">            <span class="keyword">while</span> ((line = in.readLine())!= <span class="literal">null</span>) &#123;</span><br><span class="line">                result += line;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            …</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 使用finally块来关闭输入流</span></span><br><span class="line">        <span class="keyword">finally</span>&#123;</span><br><span class="line">         <span class="comment">// 关闭流</span></span><br><span class="line">        &#125;</span><br></pre></td></tr></table></figure>

<h3 id="RestTemplate-方式的请求"><a href="#RestTemplate-方式的请求" class="headerlink" title="RestTemplate 方式的请求"></a>RestTemplate 方式的请求</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ResponseEntity&lt;SsoUrlPrm&gt;result = restTemplate.getForEntity(requestPathUrl,SsoUrlPrm.class);  </span><br></pre></td></tr></table></figure>

<p>参考1<a target="_blank" rel="noopener" href="https://www.cnblogs.com/zhaoyan001/p/8442602.html">https://www.cnblogs.com/zhaoyan001/p/8442602.html</a></p>
<p>参考2<a target="_blank" rel="noopener" href="https://blog.csdn.net/weixin_39986856/article/details/83018655">https://blog.csdn.net/weixin_39986856/article/details/83018655</a></p>
<h2 id="使用-RestTemplate"><a href="#使用-RestTemplate" class="headerlink" title="使用 RestTemplate"></a>使用 RestTemplate</h2><h3 id="直接使用方式很简单："><a href="#直接使用方式很简单：" class="headerlink" title="直接使用方式很简单："></a>直接使用方式很简单：</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">RestTemplateTest</span> &#123;	<span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">    <span class="type">RestTemplate</span> <span class="variable">restT</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">RestTemplate</span>();</span><br><span class="line">    <span class="comment">//通过Jackson JSON processing library直接将返回值绑定到对象</span></span><br><span class="line">    <span class="type">Quote</span> <span class="variable">quote</span> <span class="operator">=</span> restT.getForObject(<span class="string">&quot;http://gturnquist-quoters.cfapps.io/api/random&quot;</span>, Quote.class);</span><br><span class="line">    <span class="type">String</span> <span class="variable">quoteString</span> <span class="operator">=</span> restT.getForObject(<span class="string">&quot;http://gturnquist-quoters.cfapps.io/api/random&quot;</span>, String.class);</span><br><span class="line">    System.out.println(quoteString);</span><br><span class="line">&#125;&#125;</span><br></pre></td></tr></table></figure>

<h3 id="发送GET请求"><a href="#发送GET请求" class="headerlink" title="发送GET请求"></a>发送GET请求</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 1-getForObject()</span></span><br><span class="line"><span class="type">User</span> <span class="variable">user1</span> <span class="operator">=</span> <span class="built_in">this</span>.restTemplate.getForObject(uri, User.class);</span><br><span class="line"><span class="comment">// 2-getForEntity()</span></span><br><span class="line">ResponseEntity&lt;User&gt; responseEntity1 = <span class="built_in">this</span>.restTemplate.getForEntity(uri, User.class);<span class="type">HttpStatus</span> <span class="variable">statusCode</span> <span class="operator">=</span> responseEntity1.getStatusCode();<span class="type">HttpHeaders</span> <span class="variable">header</span> <span class="operator">=</span> responseEntity1.getHeaders();<span class="type">User</span> <span class="variable">user2</span> <span class="operator">=</span> responseEntity1.getBody();  </span><br><span class="line"><span class="comment">// 3-exchange()</span></span><br><span class="line"><span class="type">RequestEntity</span> <span class="variable">requestEntity</span> <span class="operator">=</span> RequestEntity.get(<span class="keyword">new</span> <span class="title class_">URI</span>(uri)).build();ResponseEntity&lt;User&gt; responseEntity2 = <span class="built_in">this</span>.restTemplate.exchange(requestEntity, User.class);<span class="type">User</span> <span class="variable">user3</span> <span class="operator">=</span> responseEntity2.getBody();</span><br></pre></td></tr></table></figure>

<h3 id="发送POST请求"><a href="#发送POST请求" class="headerlink" title="发送POST请求"></a>发送POST请求</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 1-postForObject()</span></span><br><span class="line"><span class="type">User</span> <span class="variable">user1</span> <span class="operator">=</span> <span class="built_in">this</span>.restTemplate.postForObject(uri, user, User.class);</span><br><span class="line"><span class="comment">// 2-postForEntity()</span></span><br><span class="line">ResponseEntity&lt;User&gt; responseEntity1 = <span class="built_in">this</span>.restTemplate.postForEntity(uri, user, User.class);</span><br><span class="line"><span class="comment">// 3-exchange()</span></span><br><span class="line">RequestEntity&lt;User&gt; requestEntity = RequestEntity</span><br><span class="line">.post(<span class="keyword">new</span> <span class="title class_">URI</span>(uri))</span><br><span class="line">    .body(user);</span><br><span class="line">ResponseEntity&lt;User&gt; responseEntity2 = <span class="built_in">this</span>.restTemplate.exchange(requestEntity, User.class);</span><br></pre></td></tr></table></figure>

<h3 id="设置HTTP-Header"><a href="#设置HTTP-Header" class="headerlink" title="设置HTTP Header"></a>设置HTTP Header</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 1-Content-TypeRequest</span></span><br><span class="line">Entity&lt;User&gt; requestEntity = RequestEntity        </span><br><span class="line">.post(<span class="keyword">new</span> <span class="title class_">URI</span>(uri))        </span><br><span class="line">    .contentType(MediaType.APPLICATION_JSON)        </span><br><span class="line">    .body(user);</span><br><span class="line"><span class="comment">// 2-AcceptRequest</span></span><br><span class="line">Entity&lt;User&gt; requestEntity = RequestEntity</span><br><span class="line">.post(<span class="keyword">new</span> <span class="title class_">URI</span>(uri))</span><br><span class="line">    .accept(MediaType.APPLICATION_JSON)</span><br><span class="line">    .body(user);</span><br><span class="line"><span class="comment">// 3-OtherRequest</span></span><br><span class="line">Entity&lt;User&gt; requestEntity = RequestEntity</span><br><span class="line">.post(<span class="keyword">new</span> <span class="title class_">URI</span>(uri))        </span><br><span class="line">    .header(<span class="string">&quot;Authorization&quot;</span>, <span class="string">&quot;Basic &quot;</span> + base64Credentials)        </span><br><span class="line">    .body(user);</span><br></pre></td></tr></table></figure>

<h3 id="捕获异常"><a href="#捕获异常" class="headerlink" title="捕获异常"></a>捕获异常</h3><p>捕获<code>HttpServerErrorException</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">try</span> &#123;    </span><br><span class="line">    responseEntity = restTemplate.exchange(requestEntity, String.class);&#125; <span class="keyword">catch</span> (HttpServerErrorException e) &#123;</span><br><span class="line">    <span class="comment">// log error</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="自定义异常处理器"><a href="#自定义异常处理器" class="headerlink" title="自定义异常处理器"></a>自定义异常处理器</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CustomErrorHandler</span> <span class="keyword">extends</span> <span class="title class_">DefaultResponseErrorHandler</span> &#123;    </span><br><span class="line">    <span class="meta">@Override</span>    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">handleError</span><span class="params">(ClientHttpResponse response)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">    <span class="comment">// todo    </span></span><br><span class="line">&#125;&#125;</span><br></pre></td></tr></table></figure>

<h4 id="然后设置下异常处理器："><a href="#然后设置下异常处理器：" class="headerlink" title="然后设置下异常处理器："></a>然后设置下异常处理器：</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configurationpublic</span> <span class="keyword">class</span> <span class="title class_">RestClientConfig</span> &#123;</span><br><span class="line">    <span class="meta">@Bean</span>    </span><br><span class="line">    <span class="keyword">public</span> RestTemplate <span class="title function_">restTemplate</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">RestTemplate</span> <span class="variable">restTemplate</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">RestTemplate</span>();</span><br><span class="line">        restTemplate.setErrorHandler(<span class="keyword">new</span> <span class="title class_">CustomErrorHandler</span>());</span><br><span class="line">        <span class="keyword">return</span> restTemplate;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="配置类"><a href="#配置类" class="headerlink" title="配置类"></a>配置类</h3><p>创建<code>HttpClientConfig</code>类，设置连接池大小、超时时间、重试机制等。配置如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * - Supports both HTTP and HTTPS</span></span><br><span class="line"><span class="comment"> * - Uses a connection pool to re-use connections and save overhead of creating connections.</span></span><br><span class="line"><span class="comment"> * - Has a custom connection keep-alive strategy (to apply a default keep-alive if one isn&#x27;t specified)</span></span><br><span class="line"><span class="comment"> * - Starts an idle connection monitor to continuously clean up stale connections.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@EnableScheduling</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">HttpClientConfig</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">Logger</span> <span class="variable">LOGGER</span> <span class="operator">=</span> LoggerFactory.getLogger(HttpClientConfig.class);</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> HttpClientProperties p;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> PoolingHttpClientConnectionManager <span class="title function_">poolingConnectionManager</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">SSLContextBuilder</span> <span class="variable">builder</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SSLContextBuilder</span>();</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            builder.loadTrustMaterial(<span class="literal">null</span>, <span class="keyword">new</span> <span class="title class_">TrustStrategy</span>() &#123;</span><br><span class="line">                <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">isTrusted</span><span class="params">(X509Certificate[] arg0, String arg1)</span> &#123;</span><br><span class="line">                    <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (NoSuchAlgorithmException | KeyStoreException e) &#123;</span><br><span class="line">            LOGGER.error(<span class="string">&quot;Pooling Connection Manager Initialisation failure because of &quot;</span> + e.getMessage(), e);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="type">SSLConnectionSocketFactory</span> <span class="variable">sslsf</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            sslsf = <span class="keyword">new</span> <span class="title class_">SSLConnectionSocketFactory</span>(builder.build());</span><br><span class="line">        &#125; <span class="keyword">catch</span> (KeyManagementException | NoSuchAlgorithmException e) &#123;</span><br><span class="line">            LOGGER.error(<span class="string">&quot;Pooling Connection Manager Initialisation failure because of &quot;</span> + e.getMessage(), e);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        Registry&lt;ConnectionSocketFactory&gt; socketFactoryRegistry = RegistryBuilder</span><br><span class="line">                .&lt;ConnectionSocketFactory&gt;create()</span><br><span class="line">                .register(<span class="string">&quot;https&quot;</span>, sslsf)</span><br><span class="line">                .register(<span class="string">&quot;http&quot;</span>, <span class="keyword">new</span> <span class="title class_">PlainConnectionSocketFactory</span>())</span><br><span class="line">                .build();</span><br><span class="line"></span><br><span class="line">        <span class="type">PoolingHttpClientConnectionManager</span> <span class="variable">poolingConnectionManager</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">PoolingHttpClientConnectionManager</span>(socketFactoryRegistry);</span><br><span class="line">        poolingConnectionManager.setMaxTotal(p.getMaxTotalConnections());  <span class="comment">//最大连接数</span></span><br><span class="line">        poolingConnectionManager.setDefaultMaxPerRoute(p.getDefaultMaxPerRoute());  <span class="comment">//同路由并发数</span></span><br><span class="line">        <span class="keyword">return</span> poolingConnectionManager;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> ConnectionKeepAliveStrategy <span class="title function_">connectionKeepAliveStrategy</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">ConnectionKeepAliveStrategy</span>() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="keyword">public</span> <span class="type">long</span> <span class="title function_">getKeepAliveDuration</span><span class="params">(HttpResponse response, HttpContext httpContext)</span> &#123;</span><br><span class="line">                <span class="type">HeaderElementIterator</span> <span class="variable">it</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">BasicHeaderElementIterator</span></span><br><span class="line">                        (response.headerIterator(HTTP.CONN_KEEP_ALIVE));</span><br><span class="line">                <span class="keyword">while</span> (it.hasNext()) &#123;</span><br><span class="line">                    <span class="type">HeaderElement</span> <span class="variable">he</span> <span class="operator">=</span> it.nextElement();</span><br><span class="line">                    <span class="type">String</span> <span class="variable">param</span> <span class="operator">=</span> he.getName();</span><br><span class="line">                    <span class="type">String</span> <span class="variable">value</span> <span class="operator">=</span> he.getValue();</span><br><span class="line">                    <span class="keyword">if</span> (value != <span class="literal">null</span> &amp;&amp; param.equalsIgnoreCase(<span class="string">&quot;timeout&quot;</span>)) &#123;</span><br><span class="line">                        <span class="keyword">return</span> Long.parseLong(value) * <span class="number">1000</span>;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">return</span> p.getDefaultKeepAliveTimeMillis();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> CloseableHttpClient <span class="title function_">httpClient</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">RequestConfig</span> <span class="variable">requestConfig</span> <span class="operator">=</span> RequestConfig.custom()</span><br><span class="line">                .setConnectionRequestTimeout(p.getRequestTimeout())</span><br><span class="line">                .setConnectTimeout(p.getConnectTimeout())</span><br><span class="line">                .setSocketTimeout(p.getSocketTimeout()).build();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> HttpClients.custom()</span><br><span class="line">                .setDefaultRequestConfig(requestConfig)</span><br><span class="line">                .setConnectionManager(poolingConnectionManager())</span><br><span class="line">                .setKeepAliveStrategy(connectionKeepAliveStrategy())</span><br><span class="line">                .setRetryHandler(<span class="keyword">new</span> <span class="title class_">DefaultHttpRequestRetryHandler</span>(<span class="number">3</span>, <span class="literal">true</span>))  <span class="comment">// 重试次数</span></span><br><span class="line">                .build();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> Runnable <span class="title function_">idleConnectionMonitor</span><span class="params">(<span class="keyword">final</span> PoolingHttpClientConnectionManager connectionManager)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Runnable</span>() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="meta">@Scheduled(fixedDelay = 10000)</span></span><br><span class="line">            <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    <span class="keyword">if</span> (connectionManager != <span class="literal">null</span>) &#123;</span><br><span class="line">                        LOGGER.trace(<span class="string">&quot;run IdleConnectionMonitor - Closing expired and idle connections...&quot;</span>);</span><br><span class="line">                        connectionManager.closeExpiredConnections();</span><br><span class="line">                        connectionManager.closeIdleConnections(p.getCloseIdleConnectionWaitTimeSecs(), TimeUnit.SECONDS);</span><br><span class="line">                    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                        LOGGER.trace(<span class="string">&quot;run IdleConnectionMonitor - Http Client Connection manager is not initialised&quot;</span>);</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">                    LOGGER.error(<span class="string">&quot;run IdleConnectionMonitor - Exception occurred. msg=&#123;&#125;, e=&#123;&#125;&quot;</span>, e.getMessage(), e);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> TaskScheduler <span class="title function_">taskScheduler</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">ThreadPoolTaskScheduler</span> <span class="variable">scheduler</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ThreadPoolTaskScheduler</span>();</span><br><span class="line">        scheduler.setThreadNamePrefix(<span class="string">&quot;poolScheduler&quot;</span>);</span><br><span class="line">        scheduler.setPoolSize(<span class="number">50</span>);</span><br><span class="line">        <span class="keyword">return</span> scheduler;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>然后再配置RestTemplateConfig类，使用之前配置好的CloseableHttpClient类注入，同时配置一些默认的消息转换器：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * RestTemplate客户端连接池配置</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@EnableAspectJAutoProxy(proxyTargetClass = true)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">RestTemplateConfig</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> CloseableHttpClient httpClient;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> RestTemplate <span class="title function_">restTemplate</span><span class="params">(MappingJackson2HttpMessageConverter jackson2HttpMessageConverter)</span> &#123;</span><br><span class="line">        <span class="type">RestTemplate</span> <span class="variable">restTemplate</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">RestTemplate</span>(clientHttpRequestFactory());</span><br><span class="line"></span><br><span class="line">        List&lt;HttpMessageConverter&lt;?&gt;&gt; messageConverters = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        <span class="type">StringHttpMessageConverter</span> <span class="variable">stringHttpMessageConverter</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StringHttpMessageConverter</span>(Charset.forName(<span class="string">&quot;utf-8&quot;</span>));</span><br><span class="line">        messageConverters.add(stringHttpMessageConverter);</span><br><span class="line">        messageConverters.add(jackson2HttpMessageConverter);</span><br><span class="line">        restTemplate.setMessageConverters(messageConverters);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> restTemplate;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> HttpComponentsClientHttpRequestFactory <span class="title function_">clientHttpRequestFactory</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">HttpComponentsClientHttpRequestFactory</span> <span class="variable">rf</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">HttpComponentsClientHttpRequestFactory</span>();</span><br><span class="line">        rf.setHttpClient(httpClient);</span><br><span class="line">        <span class="keyword">return</span> rf;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="发送文件"><a href="#发送文件" class="headerlink" title="发送文件"></a>发送文件</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">MultiValueMap&lt;String, Object&gt; multiPartBody = <span class="keyword">new</span> <span class="title class_">LinkedMultiValueMap</span>&lt;&gt;();</span><br><span class="line">multiPartBody.add(<span class="string">&quot;file&quot;</span>, <span class="keyword">new</span> <span class="title class_">ClassPathResource</span>(<span class="string">&quot;/tmp/user.txt&quot;</span>));</span><br><span class="line">RequestEntity&lt;MultiValueMap&lt;String, Object&gt;&gt; requestEntity = RequestEntity        </span><br><span class="line">.post(uri)        </span><br><span class="line">    .contentType(MediaType.MULTIPART_FORM_DATA)        </span><br><span class="line">    .body(multiPartBody);</span><br></pre></td></tr></table></figure>

<h3 id="下载文件"><a href="#下载文件" class="headerlink" title="下载文件"></a>下载文件</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 小文件</span></span><br><span class="line"><span class="type">RequestEntity</span> <span class="variable">requestEntity</span> <span class="operator">=</span> RequestEntity.get(uri).build();ResponseEntity&lt;<span class="type">byte</span>[]&gt; responseEntity = restTemplate.exchange(requestEntity, <span class="type">byte</span>[].class);<span class="type">byte</span>[] downloadContent = responseEntity.getBody();  </span><br><span class="line"><span class="comment">// 大文件  </span></span><br><span class="line">ResponseExtractor&lt;ResponseEntity&lt;File&gt;&gt; responseExtractor = <span class="keyword">new</span> <span class="title class_">ResponseExtractor</span>&lt;ResponseEntity&lt;File&gt;&gt;() &#123;    </span><br><span class="line">    <span class="meta">@Override</span>    </span><br><span class="line">    <span class="keyword">public</span> ResponseEntity&lt;File&gt; <span class="title function_">extractData</span><span class="params">(ClientHttpResponse response)</span> <span class="keyword">throws</span> IOException &#123;        </span><br><span class="line">        <span class="type">File</span> <span class="variable">rcvFile</span> <span class="operator">=</span> File.createTempFile(<span class="string">&quot;rcvFile&quot;</span>, <span class="string">&quot;zip&quot;</span>);</span><br><span class="line">        FileCopyUtils.copy(response.getBody(), <span class="keyword">new</span> <span class="title class_">FileOutputStream</span>(rcvFile));        </span><br><span class="line">        <span class="keyword">return</span> ResponseEntity.status(response.getStatusCode()).headers(response.getHeaders()).body(rcvFile);    </span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="type">File</span> <span class="variable">getFile</span> <span class="operator">=</span> <span class="built_in">this</span>.restTemplate.execute(targetUri, HttpMethod.GET, <span class="literal">null</span>, responseExtractor);</span><br></pre></td></tr></table></figure>

<h3 id="Service注入"><a href="#Service注入" class="headerlink" title="Service注入"></a>Service注入</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Servicepublic</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">DeviceService</span> &#123;</span><br><span class="line">    <span class="meta">@Resource</span>    </span><br><span class="line">    <span class="keyword">private</span> RestTemplate restTemplate;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="实际使用例子"><a href="#实际使用例子" class="headerlink" title="实际使用例子"></a>实际使用例子</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 开始推送消息logger.info(&quot;解绑成功后推送消息给对应的POS机&quot;);</span></span><br><span class="line"><span class="type">LoginParam</span> <span class="variable">loginParam</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">LoginParam</span>();</span><br><span class="line">loginParam.setUsername(managerInfo.getUsername());</span><br><span class="line">loginParam.setPassword(managerInfo.getPassword());<span class="type">HttpBaseResponse</span> <span class="variable">r</span> <span class="operator">=</span> restTemplate.postForObject(        </span><br><span class="line">    p.getPosapiUrlPrefix() + <span class="string">&quot;/notifyLogin&quot;</span>, loginParam, HttpBaseResponse.class);</span><br><span class="line"><span class="keyword">if</span> (r.isSuccess()) &#123;    </span><br><span class="line">    logger.info(<span class="string">&quot;推送消息登录认证成功&quot;</span>);</span><br><span class="line">    <span class="type">String</span> <span class="variable">token</span> <span class="operator">=</span> (String) r.getData();</span><br><span class="line">    <span class="type">UnbindParam</span> <span class="variable">unbindParam</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">UnbindParam</span>();  </span><br><span class="line">    unbindParam.setImei(pos.getImei());   </span><br><span class="line">    unbindParam.setLocation(location);</span><br><span class="line">    <span class="comment">// 设置HTTP Header信息   </span></span><br><span class="line">    URI uri;    </span><br><span class="line">    <span class="keyword">try</span> &#123;       </span><br><span class="line">        uri = <span class="keyword">new</span> <span class="title class_">URI</span>(p.getPosapiUrlPrefix() + <span class="string">&quot;/notify/unbind&quot;</span>);  </span><br><span class="line">    &#125; <span class="keyword">catch</span> (URISyntaxException e) &#123;   </span><br><span class="line">        logger.error(<span class="string">&quot;URI构建失败&quot;</span>, e);    </span><br><span class="line">        <span class="keyword">return</span> <span class="number">1</span>;    </span><br><span class="line">    &#125;  </span><br><span class="line">    RequestEntity&lt;UnbindParam&gt; requestEntity = RequestEntity            .post(uri)  </span><br><span class="line">        .contentType(MediaType.APPLICATION_JSON)     </span><br><span class="line">        .accept(MediaType.APPLICATION_JSON)     </span><br><span class="line">        .header(<span class="string">&quot;Authorization&quot;</span>, token)     </span><br><span class="line">        .body(unbindParam);</span><br><span class="line">    ResponseEntity&lt;HttpBaseResponse&gt; responseEntity = restTemplate.exchange(requestEntity, HttpBaseResponse.class);</span><br><span class="line">    <span class="type">HttpBaseResponse</span> <span class="variable">r2</span> <span class="operator">=</span> responseEntity.getBody();</span><br><span class="line">    <span class="keyword">if</span> (r2.isSuccess()) &#123;      </span><br><span class="line">        logger.info(<span class="string">&quot;推送消息解绑网点成功&quot;</span>);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;     </span><br><span class="line">        logger.error(<span class="string">&quot;推送消息解绑网点失败，errmsg = &quot;</span> + r2.getMsg());  </span><br><span class="line">    &#125;</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    logger.error(<span class="string">&quot;推送消息登录认证失败&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>





<blockquote>
<p>本文地址： <a target="_blank" rel="noopener" href="https://www.jianshu.com/p/51f4cc4138e8">SpringBoot实现RESTful与RestTemplate</a></p>
<p>推荐</p>
<p><a target="_blank" rel="noopener" href="https://www.jianshu.com/p/c60d3b36142e">JAVA自定义注解</a></p>
</blockquote>
<p>本文地址： <a href="https://github.com/maxzhao-it/blog/post/40132/">https://github.com/maxzhao-it/blog/post/40132/</a> </p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://github.com/maxzhao-it/blog/post/52100/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/blog/uploads/images/avatar.jpg">
      <meta itemprop="name" content="赵联胜">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="maxzhao">
      <meta itemprop="description" content="小码农赵联胜的博客,从遇到Java到爱上Java，工作之余学习Java生态圈中的各种技术。">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | maxzhao">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/blog/post/52100/" class="post-title-link" itemprop="url">JAVA中常用的依赖</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2022-07-28 17:37:16" itemprop="dateModified" datetime="2022-07-28T17:37:16+08:00">2022-07-28</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/blog/categories/Java/" itemprop="url" rel="index"><span itemprop="name">Java</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>日常遇到就收集啦,时间长了版本可能就旧了.</p>
<p>仅仅是收集</p>
<h4 id="commons-codec是Apache开源组织提供的用于摘要运算、编码解码的包。常见的编码解码工具Base64、MD5、Hex、SHA1、DES等。"><a href="#commons-codec是Apache开源组织提供的用于摘要运算、编码解码的包。常见的编码解码工具Base64、MD5、Hex、SHA1、DES等。" class="headerlink" title="commons-codec是Apache开源组织提供的用于摘要运算、编码解码的包。常见的编码解码工具Base64、MD5、Hex、SHA1、DES等。"></a>commons-codec是Apache开源组织提供的用于摘要运算、编码解码的包。常见的编码解码工具Base64、MD5、Hex、SHA1、DES等。</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--   commons-codec是Apache开源组织提供的用于摘要运算、编码解码的包。常见的编码解码工具Base64、MD5、Hex、SHA1、DES等。     --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>commons-codec<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>commons-codec<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.11<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h4 id="测试"><a href="#测试" class="headerlink" title="测试"></a>测试</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>junit<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>junit<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>4.12<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--   junit 中没有引入打测试框架     --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.hamcrest<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>hamcrest-all<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.3<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h4 id="代码性能测试"><a href="#代码性能测试" class="headerlink" title="代码性能测试"></a>代码性能测试</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- JMH  与插件配套使用--&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 想准确的知道某个方法需要执行多长时间，以及执行时间和输入之间的相关性；--&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 对比接口不同实现在给定条件下的吞吐量，找到最优实现--&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 查看多少百分比的请求在多长时间内完成--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.openjdk.jmh<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jmh-core<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;jmh.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.openjdk.jmh<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jmh-generator-annprocess<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;jmh.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">scope</span>&gt;</span>provided<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h4 id="JWT-shiro验证"><a href="#JWT-shiro验证" class="headerlink" title="JWT+shiro验证"></a>JWT+shiro验证</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.auth0<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>java-jwt<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.4.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- shiro 权限控制 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.shiro<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>shiro-spring<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.4.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">exclusions</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">exclusion</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>slf4j-api<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.slf4j<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">exclusion</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">exclusions</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- shiro ehcache (shiro缓存)--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.shiro<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>shiro-ehcache<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.4.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">exclusions</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">exclusion</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>slf4j-api<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.slf4j<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">exclusion</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">exclusions</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h4 id="加载-XML-或-properties-配置依赖"><a href="#加载-XML-或-properties-配置依赖" class="headerlink" title="加载 XML 或 properties 配置依赖"></a>加载 XML 或 properties 配置依赖</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- @ConfigurationProperties annotation processing (metadata for IDEs) --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-configuration-processor<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">optional</span>&gt;</span>true<span class="tag">&lt;/<span class="name">optional</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h4 id="SpringBoot-外化配置和自动配置"><a href="#SpringBoot-外化配置和自动配置" class="headerlink" title="SpringBoot 外化配置和自动配置"></a>SpringBoot 外化配置和自动配置</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-autoconfigure<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h4 id="JSON"><a href="#JSON" class="headerlink" title="JSON"></a>JSON</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- Json libs--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>net.sf.json-lib<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>json-lib<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.4<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">classifier</span>&gt;</span>jdk15<span class="tag">&lt;/<span class="name">classifier</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.google.code.gson<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>gson<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.8.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>fastjson<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.2.46<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.fasterxml.jackson.core<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jackson-databind<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.9.4<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.fasterxml.jackson.core<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jackson-annotations<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.9.4<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h4 id="连接池-看爱好"><a href="#连接池-看爱好" class="headerlink" title="连接池(看爱好)"></a>连接池(看爱好)</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>druid<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;druid.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h4 id="SpringBoot-plugins"><a href="#SpringBoot-plugins" class="headerlink" title="SpringBoot - plugins"></a>SpringBoot - plugins</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">build</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">plugins</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.maven.plugins<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>maven-compiler-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.6.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">                <span class="comment">&lt;!--&lt;proc&gt;none&lt;/proc&gt;--&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">source</span>&gt;</span>1.8<span class="tag">&lt;/<span class="name">source</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">target</span>&gt;</span>1.8<span class="tag">&lt;/<span class="name">target</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.maven.plugins<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>maven-surefire-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.20<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">skip</span>&gt;</span>true<span class="tag">&lt;/<span class="name">skip</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-maven-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">executions</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">executions</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">plugins</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">build</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h4 id="MAVEN-配置资源目录"><a href="#MAVEN-配置资源目录" class="headerlink" title="MAVEN 配置资源目录"></a>MAVEN 配置资源目录</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">build</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">resources</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">resource</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">directory</span>&gt;</span>src/main/resources<span class="tag">&lt;/<span class="name">directory</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">resource</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">resource</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">directory</span>&gt;</span>src/main/java<span class="tag">&lt;/<span class="name">directory</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">includes</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">include</span>&gt;</span>**/*.xml<span class="tag">&lt;/<span class="name">include</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">includes</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">resource</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">resources</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">build</span>&gt;</span></span><br></pre></td></tr></table></figure>



<p>本文地址： <a href="https://github.com/maxzhao-it/blog/post/52100/">https://github.com/maxzhao-it/blog/post/52100/</a> </p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/blog/page/36/"><i class="fa fa-angle-left" aria-label="Previous page"></i></a><a class="page-number" href="/blog/">1</a><span class="space">&hellip;</span><a class="page-number" href="/blog/page/36/">36</a><span class="page-number current">37</span><a class="page-number" href="/blog/page/38/">38</a><span class="space">&hellip;</span><a class="page-number" href="/blog/page/40/">40</a><a class="extend next" rel="next" href="/blog/page/38/"><i class="fa fa-angle-right" aria-label="Next page"></i></a>
  </nav>

</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">


<div class="copyright">
  &copy; 
  <span itemprop="copyrightYear">2023</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">赵联胜</span>
</div>

    </div>
  </footer>

  
  <script src="https://cdn.jsdelivr.net/npm/animejs@3.2.1/lib/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
<script src="/blog/js/comments.js"></script><script src="/blog/js/utils.js"></script><script src="/blog/js/motion.js"></script><script src="/blog/js/next-boot.js"></script>

  
<script src="https://cdn.jsdelivr.net/npm/hexo-generator-searchdb@1.4.0/dist/search.js" integrity="sha256-vXZMYLEqsROAXkEw93GGIvaB2ab+QW6w3+1ahD9nXXA=" crossorigin="anonymous"></script>
<script src="/blog/js/third-party/search/local-search.js"></script>




  <script src="/blog/js/third-party/pace.js"></script>

  





</body>
</html>
