<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222">


  <link rel="apple-touch-icon" sizes="180x180" href="/blog/uploads/images/gt.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/blog/uploads/images/gt-32.jpg">
  <link rel="icon" type="image/png" sizes="16x16" href="/blog/uploads/images/gt-16.jpg">
  <link rel="mask-icon" href="/blog/uploads/images/logo.png" color="#222">

<link rel="stylesheet" href="/blog/css/main.css">



<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.1.1/css/all.min.css" integrity="sha256-DfWjNxDkM94fVBWx1H5BMMp0Zq7luBlV8QRcSES7s+0=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/animate.css@3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/pace-js@1.2.4/themes/blue/pace-theme-minimal.css">
  <script src="https://cdn.jsdelivr.net/npm/pace-js@1.2.4/pace.min.js" integrity="sha256-gqd7YTjg/BtfqWSwsJOvndl0Bxc8gFImLEkXQT8+qj0=" crossorigin="anonymous"></script>

<script class="next-config" data-name="main" type="application/json">{"hostname":"github.com","root":"/blog/","images":"/blog/images","scheme":"Gemini","darkmode":false,"version":"8.11.1","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12},"copycode":false,"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"Searching...","empty":"We didn't find any results for the search: ${query}","hits_time":"${hits} results found in ${time} ms","hits":"${hits} results found"},"path":"/blog/search.xml","localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false}}</script><script src="/blog/js/config.js"></script>



<link rel="canonical" href="https://github.com/maxzhao-it/blog/post/4175/">



<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":false,"isPost":true,"lang":"en","comments":true,"permalink":"https://github.com/maxzhao-it/blog/post/4175/","path":"post/4175/","title":"Kafka安装配置"}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>Kafka安装配置 | maxzhao</title>
  





  <noscript>
    <link rel="stylesheet" href="/blog/css/noscript.css">
  </noscript>
<link rel="alternate" href="/blog/atom.xml" title="maxzhao" type="application/atom+xml">
</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/blog/" class="brand" rel="start">
      <i class="logo-line"></i>
      <p class="site-title">maxzhao</p>
      <i class="logo-line"></i>
    </a>
      <p class="site-subtitle" itemprop="description">不要害怕Exception和Error</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="/blog/" rel="section"><i class="fa fa-home fa-fw"></i>Home</a></li><li class="menu-item menu-item-about"><a href="/blog/about/" rel="section"><i class="fa fa-user fa-fw"></i>About</a></li><li class="menu-item menu-item-tags"><a href="/blog/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>Tags</a></li><li class="menu-item menu-item-categories"><a href="/blog/categories/" rel="section"><i class="fa fa-th fa-fw"></i>Categories</a></li><li class="menu-item menu-item-archives"><a href="/blog/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>Archives</a></li><li class="menu-item menu-item-schedule"><a href="/blog/schedule/" rel="section"><i class="fa fa-calendar fa-fw"></i>Schedule</a></li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>Search
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup"><div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off" maxlength="80"
           placeholder="Searching..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close" role="button">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div class="search-result-container no-result">
  <div class="search-result-icon">
    <i class="fa fa-spinner fa-pulse fa-5x"></i>
  </div>
</div>

    </div>
  </div>

</div>
        
  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>

  <aside class="sidebar">

    <div class="sidebar-inner sidebar-nav-active sidebar-toc-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
            <div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%B8%80%E3%80%81%E5%AE%89%E8%A3%85"><span class="nav-number">1.</span> <span class="nav-text">一、安装</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%BA%8C%E3%80%81%E9%BB%98%E8%AE%A4%E7%9A%84Zookeeper"><span class="nav-number">2.</span> <span class="nav-text">二、默认的Zookeeper</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%EF%BC%881%EF%BC%89%E5%90%AF%E5%8A%A8Zookeeper"><span class="nav-number">2.1.</span> <span class="nav-text">（1）启动Zookeeper</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%EF%BC%882%EF%BC%89%E5%85%B3%E9%97%ADZookeeper"><span class="nav-number">2.2.</span> <span class="nav-text">（2）关闭Zookeeper</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%B8%89%E3%80%81Kafka%E9%85%8D%E7%BD%AE"><span class="nav-number">3.</span> <span class="nav-text">三、Kafka配置</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%9B%9B%E3%80%81%E5%90%AF%E5%8A%A8%E5%8F%8A%E5%81%9C%E6%AD%A2Kafka"><span class="nav-number">4.</span> <span class="nav-text">四、启动及停止Kafka</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%EF%BC%881%EF%BC%89%E5%90%AF%E5%8A%A8kafka"><span class="nav-number">4.1.</span> <span class="nav-text">（1）启动kafka</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%EF%BC%882%EF%BC%89%E5%81%9C%E6%AD%A2kafka"><span class="nav-number">4.2.</span> <span class="nav-text">（2）停止kafka</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%BA%94%E3%80%81%E6%B5%8B%E8%AF%95"><span class="nav-number">5.</span> <span class="nav-text">五、测试</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1%E3%80%81%E5%88%9B%E5%BB%BAtopic"><span class="nav-number">5.1.</span> <span class="nav-text">1、创建topic</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2%E3%80%81%E6%9F%A5%E7%9C%8B%E4%B8%BB%E9%A2%98"><span class="nav-number">5.2.</span> <span class="nav-text">2、查看主题</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3%E3%80%81%E5%8F%91%E9%80%81%E6%B6%88%E6%81%AF"><span class="nav-number">5.3.</span> <span class="nav-text">3、发送消息</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4%E3%80%81%E6%8E%A5%E6%94%B6%E6%B6%88%E6%81%AF"><span class="nav-number">5.4.</span> <span class="nav-text">4、接收消息</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#5%E3%80%81%E6%9F%A5%E7%9C%8B%E7%89%B9%E5%AE%9A%E4%B8%BB%E9%A2%98%E7%9A%84%E8%AF%A6%E7%BB%86%E4%BF%A1%E6%81%AF"><span class="nav-number">5.5.</span> <span class="nav-text">5、查看特定主题的详细信息</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#6%E3%80%81%E5%88%A0%E9%99%A4%E4%B8%BB%E9%A2%98"><span class="nav-number">5.6.</span> <span class="nav-text">6、删除主题</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%85%AD%E3%80%81%E8%AE%BE%E7%BD%AE%E5%A4%9A%E4%B8%AAbroker%E9%9B%86%E7%BE%A4"><span class="nav-number">6.</span> <span class="nav-text">六、设置多个broker集群</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1%E3%80%81%E5%88%9B%E5%BB%BA%E5%A4%9A%E4%B8%AA%E8%8A%82%E7%82%B9%E7%9A%84%E9%85%8D%E7%BD%AE"><span class="nav-number">6.1.</span> <span class="nav-text">1、创建多个节点的配置</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2%E3%80%81%E5%90%AF%E5%8A%A8%E5%85%B6%E5%AE%83%E9%85%8D%E7%BD%AE%E7%9A%84%E6%9C%8D%E5%8A%A1"><span class="nav-number">6.2.</span> <span class="nav-text">2、启动其它配置的服务</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3%E3%80%81%E5%88%9B%E5%BB%BA%E6%96%B0%E7%9A%84-topic"><span class="nav-number">6.3.</span> <span class="nav-text">3、创建新的 topic</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4%E3%80%81%E6%9F%A5%E7%9C%8B%E4%B8%BB%E9%A2%98%E5%88%97%E8%A1%A8"><span class="nav-number">6.4.</span> <span class="nav-text">4、查看主题列表</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#5%E3%80%81%E6%94%B6%E5%8F%91%E6%B6%88%E6%81%AF%E6%B5%8B%E8%AF%95"><span class="nav-number">6.5.</span> <span class="nav-text">5、收发消息测试</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%8E%A5%E6%94%B6%E6%B6%88%E6%81%AF"><span class="nav-number">6.5.1.</span> <span class="nav-text">接收消息</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%8F%91%E9%80%81%E6%B6%88%E6%81%AF"><span class="nav-number">6.5.2.</span> <span class="nav-text">发送消息</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#6%E3%80%81%E6%B5%8B%E8%AF%95%E9%9B%86%E7%BE%A4-leader%E5%B4%A9%E6%BA%83"><span class="nav-number">6.6.</span> <span class="nav-text">6、测试集群 leader崩溃</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%81%9C%E6%AD%A2-leader1"><span class="nav-number">6.6.1.</span> <span class="nav-text">停止 leader1</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%9F%A5%E7%9C%8B%E4%B8%BB%E9%A2%98"><span class="nav-number">6.6.2.</span> <span class="nav-text">查看主题</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%8F%91%E9%80%81%E6%B6%88%E6%81%AF%E6%B5%8B%E8%AF%95"><span class="nav-number">6.6.3.</span> <span class="nav-text">发送消息测试</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%9F%A5%E8%AF%A2%E6%89%80%E6%9C%89%E6%B6%88%E6%81%AF"><span class="nav-number">6.6.4.</span> <span class="nav-text">查询所有消息</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%88%A0%E9%99%A4%E4%B8%BB%E9%A2%98"><span class="nav-number">6.6.5.</span> <span class="nav-text">删除主题</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%B8%83%E3%80%81%E5%AE%89%E5%85%A8"><span class="nav-number">7.</span> <span class="nav-text">七、安全</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Zookeeper%E9%85%8D%E7%BD%AE"><span class="nav-number">8.</span> <span class="nav-text">Zookeeper配置</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1-%E5%8D%95%E7%8B%AC%E4%BD%BF%E7%94%A8Zookeeper%E5%AE%89%E8%A3%85%E6%96%87%E4%BB%B6%E5%BB%BA%E7%AB%8B%E9%9B%86%E7%BE%A4"><span class="nav-number">8.1.</span> <span class="nav-text">1. 单独使用Zookeeper安装文件建立集群</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Kafka%E4%B8%8EZookeeper%E7%9A%84%E5%85%B3%E7%B3%BB"><span class="nav-number">9.</span> <span class="nav-text">Kafka与Zookeeper的关系</span></a></li></ol></div>
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author site-overview-item animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="赵联胜"
      src="/blog/uploads/images/avatar.jpg">
  <p class="site-author-name" itemprop="name">赵联胜</p>
  <div class="site-description" itemprop="description">小码农赵联胜的博客,从遇到Java到爱上Java，工作之余学习Java生态圈中的各种技术。</div>
</div>
<div class="site-state-wrap site-overview-item animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/blog/archives/">
          <span class="site-state-item-count">409</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
          <a href="/blog/categories/">
        <span class="site-state-item-count">182</span>
        <span class="site-state-item-name">categories</span></a>
      </div>
      <div class="site-state-item site-state-tags">
          <a href="/blog/tags/">
        <span class="site-state-item-count">230</span>
        <span class="site-state-item-name">tags</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author site-overview-item animated">
      <span class="links-of-author-item">
        <a href="https://gitee.com/zhaoliansheng" title="GitHub → https:&#x2F;&#x2F;gitee.com&#x2F;zhaoliansheng" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i></a>
      </span>
      <span class="links-of-author-item">
        <a href="/blog/1441439636@qq.com" title="E-Mail → 1441439636@qq.com"><i class="fa fa-envelope fa-fw"></i></a>
      </span>
  </div>


  <div class="links-of-blogroll site-overview-item animated">
    <div class="links-of-blogroll-title"><i class="fa fa-globe fa-fw"></i>
      友情链接
    </div>
    <ul class="links-of-blogroll-list">
        <li class="links-of-blogroll-item">
          <a href="https://www.jianshu.com/u/e8c426a6007e" title="https:&#x2F;&#x2F;www.jianshu.com&#x2F;u&#x2F;e8c426a6007e" rel="noopener" target="_blank">我的简书</a>
        </li>
    </ul>
  </div>

        </div>
      </div>
    </div>
  </aside>
  <div class="sidebar-dimmer"></div>


    </header>

    
  <div class="back-to-top" role="button" aria-label="Back to top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


    <div class="main-inner post posts-expand">


  


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="en">
    <link itemprop="mainEntityOfPage" href="https://github.com/maxzhao-it/blog/post/4175/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/blog/uploads/images/avatar.jpg">
      <meta itemprop="name" content="赵联胜">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="maxzhao">
      <meta itemprop="description" content="小码农赵联胜的博客,从遇到Java到爱上Java，工作之余学习Java生态圈中的各种技术。">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="Kafka安装配置 | maxzhao">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          Kafka安装配置
        </h1>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2022-09-16 17:31:12" itemprop="dateModified" datetime="2022-09-16T17:31:12+08:00">2022-09-16</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/blog/categories/DevelopTools/" itemprop="url" rel="index"><span itemprop="name">DevelopTools</span></a>
        </span>
          , 
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/blog/categories/DevelopTools/kafka/" itemprop="url" rel="index"><span itemprop="name">kafka</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
        <p><a target="_blank" rel="noopener" href="https://www.cnblogs.com/qingyunzong/p/9004509.html">kafka介绍1</a></p>
<p><a target="_blank" rel="noopener" href="https://kafka.apachecn.org/quickstart.html">kafka.apachecn介绍</a></p>
<h2 id="一、安装"><a href="#一、安装" class="headerlink" title="一、安装"></a>一、安装</h2><p><code>kafka</code> 可以通过<a target="_blank" rel="noopener" href="https://kafka.apache.org/downloads">官网下载</a></p>
<p><code>kafka</code> 根据Scala版本不同，又分为多个版本，我不需要使用<code>Scala</code>，所以就下载官方推荐版本<code>kafka_2.13-2.7.0.tgz</code>。</p>
<p> 解压到<code>opt</code>目录下</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">wget https://downloads.apache.org/kafka/3.2.1/kafka_2.13-3.2.1.tgz</span><br><span class="line">tar -xzf kafka_2.13-3.2.1.tgz -C ~/</span><br><span class="line"><span class="built_in">cd</span> ~/</span><br><span class="line"><span class="comment"># 为了使用方便，可以创建软链接`kafka`</span></span><br><span class="line"><span class="built_in">ln</span> -s kafka_2.13-3.2.1 kafka</span><br><span class="line"><span class="comment">#mv kafka_2.13-2.7.0 kafka</span></span><br><span class="line"><span class="built_in">cd</span> kafka</span><br></pre></td></tr></table></figure>

<p><code>kafka</code>的安装需要依赖<code>Zookeeper</code>。</p>
<h2 id="二、默认的Zookeeper"><a href="#二、默认的Zookeeper" class="headerlink" title="二、默认的Zookeeper"></a>二、默认的<code>Zookeeper</code></h2><p><code>kafka</code>自带的<code>Zookeeper</code>程序使用<code>bin/zookeeper-server-start.sh</code>，以及<code>bin/zookeeper-server-stop.sh</code>来启动和停止<code>Zookeeper</code>。</p>
<p><code>Zookeeper</code>的配制文件是<code>config/zookeeper.properties</code>，可以修改其中的参数</p>
<h3 id="（1）启动Zookeeper"><a href="#（1）启动Zookeeper" class="headerlink" title="（1）启动Zookeeper"></a>（1）启动<code>Zookeeper</code></h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 修改默认端口</span></span><br><span class="line">sed -i <span class="string">&#x27;s?clientPort=2181?clientPort=42181?&#x27;</span> ~/kafka/config/zookeeper.properties</span><br><span class="line"><span class="built_in">cat</span> ~/kafka/config/zookeeper.properties</span><br><span class="line">~/kafka/bin/zookeeper-server-start.sh -daemon ~/kafka/config/zookeeper.properties</span><br><span class="line"><span class="built_in">tail</span> -f ~/kafka/logs/zookeeper.out</span><br></pre></td></tr></table></figure>

<ul>
<li><code>-daemon</code>参数，可以在后台启动<code>Zookeeper</code>，输出的信息在保存在执行目录的<code>logs/zookeeper.out</code>文件中。</li>
</ul>
<blockquote>
<p>问题：对于小内存的服务器，启动时有可能会出现如下错误。</p>
<p><code>os::commit_memory(0x00000000e0000000, 536870912, 0) failed; error=&#39;Not enough space&#39; (errno=12)</code></p>
<p>可以通过修改<code>bin/zookeeper-server-start.sh</code>中的参数，来减少内存的使用，将<code>-Xmx512M -Xms512M</code>改小。</p>
</blockquote>
<h3 id="（2）关闭Zookeeper"><a href="#（2）关闭Zookeeper" class="headerlink" title="（2）关闭Zookeeper"></a>（2）关闭<code>Zookeeper</code></h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">~/kafka/bin/zookeeper-server-stop.sh -daemon ~/kafka/config/zookeeper.properties</span><br></pre></td></tr></table></figure>

<h2 id="三、Kafka配置"><a href="#三、Kafka配置" class="headerlink" title="三、Kafka配置"></a>三、Kafka配置</h2><p><code>kafka</code>的配置文件在<code>config/server.properties</code>文件中，主要修改参数如下，更具体的参数说明以后再整理下。</p>
<ol>
<li><code>broker.id</code>是<code>kafka broker</code>的编号，集群里每个<code>broker</code>的<code>id</code>需不同。默认从0开始。</li>
<li><code>listeners</code>是监听地址，需要提供外网服务的话，要设置本地的<code>IP</code>地址</li>
<li><code>log.dirs</code>是日志目录，需要设置</li>
<li>设置<code>Zookeeper</code>集群地址，我是在同一个服务器上搭建了<code>kafka</code>和<code>Zookeeper</code>，所以填的本地地址</li>
<li><code>num.partitions</code> 为新建<code>Topic</code>的默认<code>Partition</code>数量，<code>partition</code>数量提升，一定程度上可以提升并发性，数值应该小于等于<code>broker</code>的数量</li>
<li>因为要创建<code>kafka</code>集群，所以<code>kafka</code>的所有文件都复制两份，配置文件做相应的修改，尤其是<code>brokerid</code>、<code>IP</code>地址和<code>log.dirs</code>。分别创建软链接<code>kafka1</code>和<code>kafka2</code>。</li>
</ol>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 集群里每个`broker`的`id`需不同。默认从0开始。</span></span><br><span class="line">broker.id=0</span><br><span class="line"><span class="comment">############################# Socket Server Settings #############################</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># The address the socket server listens on. It will get the value returned from </span></span><br><span class="line"><span class="comment"># java.net.InetAddress.getCanonicalHostName() if not configured.</span></span><br><span class="line"><span class="comment">#   FORMAT:</span></span><br><span class="line"><span class="comment">#     listeners = listener_name://host_name:port</span></span><br><span class="line"><span class="comment">#   EXAMPLE:</span></span><br><span class="line"><span class="comment">#     listeners = PLAINTEXT://your.host.name:9092</span></span><br><span class="line"><span class="comment"># 监听的地址和端口，当前监听本机所有</span></span><br><span class="line">listeners=EXTERNAL://0.0.0.0:49092</span><br><span class="line"><span class="comment"># 主机地址</span></span><br><span class="line">advertised.listeners=PLAINTEXT://192.168.14.123:49092</span><br><span class="line"><span class="comment"># Maps listener names to security protocols, the default is for them to be the same. See the config documentation for more details</span></span><br><span class="line"><span class="comment">#listener.security.protocol.map=PLAINTEXT:PLAINTEXT,SSL:SSL,SASL_PLAINTEXT:SASL_PLAINTEXT,SASL_SSL:SASL_SSL</span></span><br><span class="line"><span class="comment">############################# Log Basics #############################</span></span><br><span class="line"><span class="comment"># A comma separated list of directories under which to store log files</span></span><br><span class="line">log.dirs=/tmp/kafka-logs</span><br><span class="line"><span class="comment"># 分区</span></span><br><span class="line">num.partitions=1 </span><br><span class="line"><span class="comment">############################# Zookeeper #############################</span></span><br><span class="line">zookeeper.connect=localhost:42181</span><br></pre></td></tr></table></figure>



<h2 id="四、启动及停止Kafka"><a href="#四、启动及停止Kafka" class="headerlink" title="四、启动及停止Kafka"></a>四、启动及停止Kafka</h2><h3 id="（1）启动kafka"><a href="#（1）启动kafka" class="headerlink" title="（1）启动kafka"></a>（1）启动<code>kafka</code></h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">~/kafka/bin/kafka-server-start.sh -daemon ~/kafka/config/server.properties</span><br><span class="line"><span class="built_in">tail</span> -f ~/kafka/logs/kafkaServer.out</span><br></pre></td></tr></table></figure>

<p> <code>-daemon</code> 参数会将任务转入后台运行，输出日志信息将写入日志文件，查看 <code>logs/kafkaServer.out</code>，如果结尾输同started说明启动成功。</p>
<p>也可以用<code>ps -ef|grep kafka</code>命令，看有没有<code>kafka</code>的进程</p>
<blockquote>
<p><code>kafka</code>默认的 <code>xmx xms</code>都是 <code>1G</code>，  对于小内存的服务器，启动时有可能会出现如下错误。</p>
<p><code>os::commit_memory(0x00000000e0000000, 536870912, 0) failed; error=&#39;Not enough space&#39; (errno=12)</code></p>
<p>可以通过修改<code>bin/kafka-server-start.sh</code>中的参数，来减少内存的使用，将配置改为<code>-Xmx256M -Xms64M</code>。</p>
</blockquote>
<h3 id="（2）停止kafka"><a href="#（2）停止kafka" class="headerlink" title="（2）停止kafka"></a>（2）停止<code>kafka</code></h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">~/kafka/bin/kafka-server-stop.sh -daemon ~/kafka/config/server.properties</span><br></pre></td></tr></table></figure>

<h2 id="五、测试"><a href="#五、测试" class="headerlink" title="五、测试"></a>五、测试</h2><p>前提：<code>kafka</code>和<code>Zookeeper</code>已启动完成</p>
<h3 id="1、创建topic"><a href="#1、创建topic" class="headerlink" title="1、创建topic"></a>1、创建topic</h3><p>创建一个名为 <code>test</code> 的<code>Topic</code>，只有一个备份（<code>replication-facto</code>）和一个分区（<code>partitions</code>）。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">~/kafka/bin/kafka-topics.sh --create --bootstrap-server 192.168.14.123:49092 --replication-factor 1 --partitions 1 --topic <span class="built_in">test</span></span><br></pre></td></tr></table></figure>

<p>成功提示 <code>Created topic test.</code></p>
<h3 id="2、查看主题"><a href="#2、查看主题" class="headerlink" title="2、查看主题"></a>2、查看主题</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">~/kafka/bin/kafka-topics.sh --list --bootstrap-server 192.168.14.123:49092</span><br></pre></td></tr></table></figure>

<p>成功提示</p>
<p><code>test</code></p>
<h3 id="3、发送消息"><a href="#3、发送消息" class="headerlink" title="3、发送消息"></a>3、发送消息</h3><p><code>Kafka</code>提供了一个命令行的工具，可以从输入文件或者命令行中读取消息并发送给<code>Kafka</code>集群。每一行是一条消息。<br>运行<code>producer</code>（生产者）,然后在控制台输入几条消息到服务器。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">~/kafka/bin/kafka-console-producer.sh --broker-list 192.168.14.123:49092 --topic <span class="built_in">test</span></span><br><span class="line">First message;</span><br><span class="line">Second mssage;</span><br></pre></td></tr></table></figure>

<h3 id="4、接收消息"><a href="#4、接收消息" class="headerlink" title="4、接收消息"></a>4、接收消息</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">~/kafka/bin/kafka-console-consumer.sh --bootstrap-server 192.168.14.123:49092 --topic <span class="built_in">test</span> --from-beginning</span><br></pre></td></tr></table></figure>

<p>展示上面输入的两个消息，表示成功;</p>
<ul>
<li><code>--from-beginning</code> 是从开始的消息展示</li>
</ul>
<h3 id="5、查看特定主题的详细信息"><a href="#5、查看特定主题的详细信息" class="headerlink" title="5、查看特定主题的详细信息"></a>5、查看特定主题的详细信息</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">~/kafka/bin/kafka-topics.sh --bootstrap-server 192.168.14.123:49092 --describe  --topic <span class="built_in">test</span></span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Topic: <span class="built_in">test</span>	PartitionCount: 1	ReplicationFactor: 1	Configs: </span><br><span class="line">	Topic: <span class="built_in">test</span>	Partition: 0	Leader: 0	Replicas: 0	Isr: 0</span><br></pre></td></tr></table></figure>



<ul>
<li>“leader”是负责给定分区所有读写操作的节点。每个节点都是随机选择的部分分区的领导者。</li>
<li>“replicas”是复制分区日志的节点列表，不管这些节点是leader还是仅仅活着。</li>
<li>“isr”是一组“同步”replicas，是replicas列表的子集，它活着并被指到leader。</li>
</ul>
<h3 id="6、删除主题"><a href="#6、删除主题" class="headerlink" title="6、删除主题"></a>6、删除主题</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">~/kafka/bin/kafka-topics.sh --bootstrap-server 192.168.14.123:49092 --delete  --topic <span class="built_in">test</span></span><br><span class="line">~/kafka/bin/kafka-topics.sh --list --bootstrap-server 192.168.14.123:49092</span><br></pre></td></tr></table></figure>

<h2 id="六、设置多个broker集群"><a href="#六、设置多个broker集群" class="headerlink" title="六、设置多个broker集群"></a>六、设置多个<code>broker</code>集群</h2><p>一个 <code>broker</code>只是集群中的一个节点，<code>id</code>是这个节点的名称。</p>
<h3 id="1、创建多个节点的配置"><a href="#1、创建多个节点的配置" class="headerlink" title="1、创建多个节点的配置"></a>1、创建多个节点的配置</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cp</span> ~/kafka/config/server.properties ~/kafka/config/server-1.properties </span><br><span class="line"><span class="built_in">cp</span> ~/kafka/config/server.properties ~/kafka/config/server-2.properties</span><br></pre></td></tr></table></figure>

<p>修改每个配置的 <code>id</code>，<code>id</code> 从0开始。</p>
<p>简单的配置如下</p>
<p><code>server-1.properties</code></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 修改节点名称</span></span><br><span class="line">broker.id=1 </span><br><span class="line"><span class="comment"># 监听的地址和端口，当前监听本机所有</span></span><br><span class="line">listeners=PLAINTEXT://0.0.0.0:49093</span><br><span class="line"><span class="comment"># 主机地址</span></span><br><span class="line">advertised.listeners=PLAINTEXT://192.168.14.123:49093</span><br><span class="line"><span class="comment"># 修改日志目录，防止覆盖日志</span></span><br><span class="line">log.dir=/tmp/kafka-logs-1</span><br><span class="line"><span class="comment"># 配置 Zookeeper</span></span><br><span class="line">zookeeper.connect=192.168.14.123:4181</span><br></pre></td></tr></table></figure>

<p><code>server-2.properties</code></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 修改节点名称</span></span><br><span class="line">broker.id=2 </span><br><span class="line"><span class="comment"># 监听的地址和端口，当前监听本机所有</span></span><br><span class="line">listeners=PLAINTEXT://0.0.0.0:49094</span><br><span class="line"><span class="comment"># 主机地址</span></span><br><span class="line">advertised.listeners=PLAINTEXT://192.168.14.123:49094</span><br><span class="line"><span class="comment"># 修改日志目录，防止覆盖日志</span></span><br><span class="line">log.dir=/tmp/kafka-logs-2</span><br><span class="line"><span class="comment"># 配置 Zookeeper</span></span><br><span class="line">zookeeper.connect=192.168.14.123:4181</span><br></pre></td></tr></table></figure>

<h3 id="2、启动其它配置的服务"><a href="#2、启动其它配置的服务" class="headerlink" title="2、启动其它配置的服务"></a>2、启动其它配置的服务</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">~/kafka/bin/kafka-server-start.sh -daemon ~/kafka/config/server-1.properties</span><br><span class="line">~/kafka/bin/kafka-server-start.sh -daemon ~/kafka/config/server-2.properties</span><br></pre></td></tr></table></figure>

<h3 id="3、创建新的-topic"><a href="#3、创建新的-topic" class="headerlink" title="3、创建新的 topic"></a>3、创建新的 topic</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">~/kafka/bin/kafka-topics.sh --create --bootstrap-server 192.168.14.123:49092 --replication-factor 3 --partitions 1 --topic my-replicated-3-topic </span><br><span class="line">~/kafka/bin/kafka-topics.sh --list --bootstrap-server 192.168.14.123:49092</span><br></pre></td></tr></table></figure>

<p>成功提示：&#96;Created topic my-replicated-3-topic.</p>
<p>这时候已经完成了一个集群的配置。</p>
<blockquote>
<p>启动失败解决</p>
<p>如果报 <code>replication</code> 不够的错误，则是因为 <code>server1</code>、<code>server2</code>可能启动失败了。</p>
<p>可以把 <code>-daemon</code>参数删掉，然后执行命令查看错误 <code>bin/kafka-server-start.sh config/server-1.properties</code>;</p>
<p>可以直接查看日志 <code>logs/server.out</code>;</p>
</blockquote>
<h3 id="4、查看主题列表"><a href="#4、查看主题列表" class="headerlink" title="4、查看主题列表"></a>4、查看主题列表</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">~/kafka/bin/kafka-topics.sh --bootstrap-server 192.168.14.123:49092 --describe  --topic my-replicated-3-topic </span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Topic: my-replicated-3-topic	PartitionCount: 1	ReplicationFactor: 3	Configs: </span><br><span class="line">	Topic: my-replicated-3-topic	Partition: 0	Leader: 1	Replicas: 1,0,2	Isr: 1,0,2</span><br></pre></td></tr></table></figure>

<p><code>leader： 1</code>表示当前 <code>leader</code>在节点1上。</p>
<h3 id="5、收发消息测试"><a href="#5、收发消息测试" class="headerlink" title="5、收发消息测试"></a>5、收发消息测试</h3><h4 id="接收消息"><a href="#接收消息" class="headerlink" title="接收消息"></a>接收消息</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">~/kafka/bin/kafka-console-consumer.sh --bootstrap-server 192.168.14.123:49092 --topic my-replicated-3-topic</span><br></pre></td></tr></table></figure>

<h4 id="发送消息"><a href="#发送消息" class="headerlink" title="发送消息"></a>发送消息</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">~/kafka/bin/kafka-console-producer.sh --broker-list 192.168.14.123:49092 --topic my-replicated-3-topic</span><br></pre></td></tr></table></figure>

<h3 id="6、测试集群-leader崩溃"><a href="#6、测试集群-leader崩溃" class="headerlink" title="6、测试集群 leader崩溃"></a>6、测试集群 <code>leader</code>崩溃</h3><h4 id="停止-leader1"><a href="#停止-leader1" class="headerlink" title="停止 leader1"></a>停止 <code>leader1</code></h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 查询进程</span></span><br><span class="line">ps -ef|grep server-1.properties</span><br><span class="line"><span class="comment"># 查询 kafka java 进程更方便</span></span><br><span class="line">jps -<span class="built_in">mv</span> |grep server-1.properties</span><br><span class="line"><span class="comment"># 杀掉进程</span></span><br><span class="line"><span class="built_in">kill</span> -9 xxx</span><br></pre></td></tr></table></figure>

<h4 id="查看主题"><a href="#查看主题" class="headerlink" title="查看主题"></a>查看主题</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">~/kafka/bin/kafka-topics.sh --describe --broker-list 192.168.14.123:49092 --topic my-replicated-3-topic</span><br></pre></td></tr></table></figure>

<p>此时的 <code>leader</code>已经变为了 0，所以 <code>broker 0</code> 成为了 <code>leader</code>, <code>broker1</code>已经不在备份集合里了。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Topic: my-replicated-3-topic	PartitionCount: 1	ReplicationFactor: 3	Configs: </span><br><span class="line">	Topic: my-replicated-3-topic	Partition: 0	Leader: 0	Replicas: 1,0,2	Isr: 0,2</span><br></pre></td></tr></table></figure>

<h4 id="发送消息测试"><a href="#发送消息测试" class="headerlink" title="发送消息测试"></a>发送消息测试</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">~/kafka/bin/kafka-console-producer.sh --broker-list 192.168.14.123:49094 --topic my-replicated-3-topic</span><br></pre></td></tr></table></figure>

<h4 id="查询所有消息"><a href="#查询所有消息" class="headerlink" title="查询所有消息"></a>查询所有消息</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">~/kafka/bin/kafka-console-consumer.sh --bootstrap-server 192.168.14.123:49092 --topic my-replicated-3-topic --from-beginning</span><br></pre></td></tr></table></figure>

<p>这个时候会发现所有的消息都没有丢</p>
<h4 id="删除主题"><a href="#删除主题" class="headerlink" title="删除主题"></a>删除主题</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">~/kafka/bin/kafka-topics.sh --bootstrap-server 192.168.14.123:49092 --delete  --topic my-replicated-3-topic</span><br><span class="line">~/kafka/bin/kafka-topics.sh --list --bootstrap-server 192.168.14.123:49092</span><br></pre></td></tr></table></figure>

<h2 id="七、安全"><a href="#七、安全" class="headerlink" title="七、安全"></a>七、安全</h2><p><a target="_blank" rel="noopener" href="https://kafka.apachecn.org/documentation.html#security_ssl">官方说明</a></p>
<h2 id="Zookeeper配置"><a href="#Zookeeper配置" class="headerlink" title="Zookeeper配置"></a>Zookeeper配置</h2><p>当前下载的kafka程序里自带Zookeeper，可以直接使用其自带的Zookeeper建立集群，也可以单独使用Zookeeper安装文件建立集群。</p>
<h3 id="1-单独使用Zookeeper安装文件建立集群"><a href="#1-单独使用Zookeeper安装文件建立集群" class="headerlink" title="1. 单独使用Zookeeper安装文件建立集群"></a>1. 单独使用Zookeeper安装文件建立集群</h3><p>Zookeeper的安装及配置可以参考另一篇博客，里面有详细介绍</p>
<p><a target="_blank" rel="noopener" href="https://www.cnblogs.com/zhaoshizi/p/12105143.html">ZooKeeper的安装和配置过程</a></p>
<p><a target="_blank" rel="noopener" href="https://www.cnblogs.com/zhaoshizi/p/12105143.html">https://www.cnblogs.com/zhaoshizi/p/12105143.html</a></p>
<h2 id="Kafka与Zookeeper的关系"><a href="#Kafka与Zookeeper的关系" class="headerlink" title="Kafka与Zookeeper的关系"></a>Kafka与Zookeeper的关系</h2><p>一个典型的Kafka集群中包含若干Produce，若干broker（一般broker数量越多，集群吞吐率越高），若干Consumer Group，以及一个Zookeeper集群。Kafka通过Zookeeper管理集群配置，选举leader，以及在Consumer Group发生变化时进行rebalance。Producer使用push模式将消息发布到broker，Consumer使用pull模式从broker订阅并消费消息。<br><img src="https://img-blog.csdnimg.cn/img_convert/38eea86ae43f4e40666d65f33fe590c0.png" alt="img"><br>1)Producer端直接连接broker.list列表,从列表中返回TopicMetadataResponse,该Metadata包含Topic下每个partition leader建立socket连接并发送消息.</p>
<p>2)Broker端使用zookeeper用来注册broker信息,以及监控partition leader存活性.</p>
<p>3)Consumer端使用zookeeper用来注册consumer信息,其中包括consumer消费的partition列表等,同时也用来发现broker列表,并和partition leader建立socket连接,并获取消息。</p>
<p><strong>Zookeeper作用：管理broker、consumer</strong></p>
<p>创建Broker后，向zookeeper注册新的broker信息，实现在服务器正常运行下的水平拓展。具体的，通过注册watcher，获取partition的信息。</p>
<p>Topic的注册，zookeeper会维护topic与broker的关系，通&#x2F;brokers&#x2F;topics&#x2F;topic.name节点来记录。</p>
<p>Producer向zookeeper中注册watcher,了解topic的partition的消息，以动态了解运行情况，实现负载均衡。Zookeepr不管理producer，只是能够提供当前broker的相关信息。</p>
<p>Consumer可以使用group形式消费kafka中的数据。所有的group将以轮询的方式消费broker中的数据，具体的按照启动的顺序。Zookeeper会给每个consumer group一个ID,即同一份数据可以被不同的用户ID多次消费。因此这就是单播与多播的实现。以单个消费者还是以组别的方式去消费数据，由用户自己去定义。Zookeeper管理consumer的offset跟踪当前消费的offset。</p>
<p>kafka使用ZooKeeper用于管理、协调代理。每个Kafka代理通过Zookeeper协调其他Kafka代理。<br>当Kafka系统中新增了代理或某个代理失效时，Zookeeper服务将通知生产者和消费者。生产者与消费者据此开始与其他代理协调工作。</p>
<p><strong>Zookeeper在Kakfa中扮演的角色：Kafka将元数据信息保存在Zookeeper中，但是发送给Topic本身的数据是不会发到Zk上的</strong></p>
<p>· kafka使用zookeeper来实现动态的集群扩展，不需要更改客户端（producer和consumer）的配置。broker会在zookeeper注册并保持相关的元数据（topic，partition信息等）更新。<br>· 而客户端会在zookeeper上注册相关的watcher。一旦zookeeper发生变化，客户端能及时感知并作出相应调整。这样就保证了添加或去除 broker时，各broker间仍能自动实现负载均衡。这里的客户端指的是Kafka的消息生产端(Producer)和消息消费端(Consumer)<br>· Broker端使用zookeeper来注册broker信息,以及监测partitionleader存活性.<br>· Consumer端使用zookeeper用来注册consumer信息,其中包括consumer消费的partition列表等,同时也用来发现broker列表,并和partitionleader建立socket连接,并获取消息.<br>· Zookeer和Producer没有建立关系，只和Brokers、Consumers建立关系以实现负载均衡，即同一个ConsumerGroup中的Consumers可以实现负载均衡（因为Producer是瞬态的，可以发送后关闭，无需直接等待）</p>
<p>本文地址： <a href="https://github.com/maxzhao-it/blog/post/4175/">https://github.com/maxzhao-it/blog/post/4175/</a> </p>

    </div>

    
    
    

    <footer class="post-footer">
          <div class="post-tags">
              <a href="/blog/tags/MQ/" rel="tag"># MQ</a>
              <a href="/blog/tags/kafka/" rel="tag"># kafka</a>
              <a href="/blog/tags/%E4%B8%AD%E9%97%B4%E4%BB%B6/" rel="tag"># 中间件</a>
          </div>

        

          <div class="post-nav">
            <div class="post-nav-item">
                <a href="/blog/post/34489/" rel="prev" title="KafkaConnect导入导出数据">
                  <i class="fa fa-chevron-left"></i> KafkaConnect导入导出数据
                </a>
            </div>
            <div class="post-nav-item">
                <a href="/blog/post/50825/" rel="next" title="SpringBoot+kafka初始配置与使用">
                  SpringBoot+kafka初始配置与使用 <i class="fa fa-chevron-right"></i>
                </a>
            </div>
          </div>
    </footer>
  </article>
</div>






</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">


<div class="copyright">
  &copy; 
  <span itemprop="copyrightYear">2023</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">赵联胜</span>
</div>

    </div>
  </footer>

  
  <script src="https://cdn.jsdelivr.net/npm/animejs@3.2.1/lib/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
<script src="/blog/js/comments.js"></script><script src="/blog/js/utils.js"></script><script src="/blog/js/motion.js"></script><script src="/blog/js/next-boot.js"></script>

  
<script src="https://cdn.jsdelivr.net/npm/hexo-generator-searchdb@1.4.0/dist/search.js" integrity="sha256-vXZMYLEqsROAXkEw93GGIvaB2ab+QW6w3+1ahD9nXXA=" crossorigin="anonymous"></script>
<script src="/blog/js/third-party/search/local-search.js"></script>




  <script src="/blog/js/third-party/pace.js"></script>

  





</body>
</html>
