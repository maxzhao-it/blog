<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>maxzhao</title>
  
  <subtitle>不要害怕Exception和Error</subtitle>
  <link href="/blog/atom.xml" rel="self"/>
  
  <link href="https://github.com/maxzhao-it/blog/"/>
  <updated>2024-07-17T13:09:32.110Z</updated>
  <id>https://github.com/maxzhao-it/blog/</id>
  
  <author>
    <name>赵联胜</name>
    
  </author>
  
  <generator uri="https://hexo.io/">Hexo</generator>
  
  <entry>
    <title>JAVA获取类的泛型信息</title>
    <link href="https://github.com/maxzhao-it/blog/post/56235478467467/"/>
    <id>https://github.com/maxzhao-it/blog/post/56235478467467/</id>
    <published>2025-07-16T16:00:00.000Z</published>
    <updated>2024-07-17T13:09:32.110Z</updated>
    
    <content type="html"><![CDATA[<h1 id="Java-使用-license"><a href="#Java-使用-license" class="headerlink" title="Java 使用 license"></a>Java 使用 license</h1><p>使用 truelicense</p><ol><li>应用程序可以创建以及验证绑定给用户、系统等实体的 license。</li><li>防止用户随意拷贝软件和 license。</li><li>licenses 可以是永久性的或者临时性的（在某个特定时期内有效）</li><li>licenses 的验证由 JAVA Security API 提供的数字签名机制来实现。</li><li>license 安装模块需要用特殊机制对其进行保护，以防被反编译轻易破解。</li></ol><h2 id="管理端生成密钥"><a href="#管理端生成密钥" class="headerlink" title="管理端生成密钥"></a>管理端生成密钥</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 1、生成密钥对</span></span><br><span class="line">keytool -genkey -<span class="built_in">alias</span> dsa_private_key -keyalg DSA -keysize 1024 -dname <span class="string">&quot;CN=maxzhao, OU=maxzhao, O=maxzhao_org, L=nanjing, ST=jiangsu, C=China&quot;</span> \</span><br><span class="line"> -validity 36500 -keystore dsa_private_key_store.jks -storepass maxzhao_pwd -keypass maxzhao_pwd</span><br><span class="line"><span class="comment"># 2、导出公钥</span></span><br><span class="line">keytool -<span class="built_in">export</span> -<span class="built_in">alias</span> dsa_private_key -file dsa_certfile.cer -keystore dsa_private_key_store.jks -storepass maxzhao_pwd</span><br><span class="line"><span class="comment"># 3、证书文件导入到公钥库</span></span><br><span class="line">keytool -import -<span class="built_in">alias</span> dsa_public_cert -file dsa_certfile.cer -keystore dsa_public_certs_store.jks -storepass maxzhao_pwd</span><br></pre></td></tr></table></figure><h2 id="服务段生成证书"><a href="#服务段生成证书" class="headerlink" title="服务段生成证书"></a>服务段生成证书</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.license;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> de.schlichtherle.license.*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.security.auth.x500.X500Principal;</span><br><span class="line"><span class="keyword">import</span> java.io.File;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.io.InputStream;</span><br><span class="line"><span class="keyword">import</span> java.text.DateFormat;</span><br><span class="line"><span class="keyword">import</span> java.text.ParseException;</span><br><span class="line"><span class="keyword">import</span> java.text.SimpleDateFormat;</span><br><span class="line"><span class="keyword">import</span> java.util.Properties;</span><br><span class="line"><span class="keyword">import</span> java.util.prefs.Preferences;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 生成证书</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CreateLicense</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">CreateLicense</span> <span class="variable">cLicense</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">CreateLicense</span>();</span><br><span class="line">        cLicense.setParam(<span class="string">&quot;/param.properties&quot;</span>);</span><br><span class="line">        <span class="comment">//生成证书</span></span><br><span class="line">        <span class="type">boolean</span> <span class="variable">b</span> <span class="operator">=</span> cLicense.create();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="type">String</span> <span class="variable">PRIVATE_ALIAS</span> <span class="operator">=</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="type">String</span> <span class="variable">KEY_PWD</span> <span class="operator">=</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="type">String</span> <span class="variable">STORE_PWD</span> <span class="operator">=</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="type">String</span> <span class="variable">SUB_JECT</span> <span class="operator">=</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="type">String</span> <span class="variable">LIC_PATH</span> <span class="operator">=</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="type">String</span> <span class="variable">PRI_PATH</span> <span class="operator">=</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="type">String</span> <span class="variable">ISSUED_TIME</span> <span class="operator">=</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="type">String</span> <span class="variable">NOT_BEFORE</span> <span class="operator">=</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="type">String</span> <span class="variable">NOT_AFTER</span> <span class="operator">=</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="type">String</span> <span class="variable">CONSUMER_TYPE</span> <span class="operator">=</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="type">int</span> <span class="variable">CONSUMER_AMOUNT</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="type">String</span> <span class="variable">INFO</span> <span class="operator">=</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line">    <span class="comment">// X500 Principal</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">static</span> <span class="type">X500Principal</span> <span class="variable">DEFAULT_HOLDER_AND_ISSUER</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">X500Principal</span>(<span class="string">&quot;CN=maxzhao, OU=maxzhao, O=maxzhao_org, L=nanjing, ST=jiangsu, C=China&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setParam</span><span class="params">(String propertiesPath)</span> &#123; <span class="comment">// 获取参数</span></span><br><span class="line">        <span class="type">Properties</span> <span class="variable">prop</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Properties</span>();</span><br><span class="line">        <span class="type">InputStream</span> <span class="variable">in</span> <span class="operator">=</span> getClass().getResourceAsStream(propertiesPath);</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            prop.load(in);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123; <span class="comment">// TODO Auto-generated catch block</span></span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        PRIVATE_ALIAS = prop.getProperty(<span class="string">&quot;privateAlias&quot;</span>);</span><br><span class="line">        KEY_PWD = prop.getProperty(<span class="string">&quot;keyPwd&quot;</span>);</span><br><span class="line">        STORE_PWD = prop.getProperty(<span class="string">&quot;storePwd&quot;</span>);</span><br><span class="line">        SUB_JECT = prop.getProperty(<span class="string">&quot;subJect&quot;</span>);</span><br><span class="line">        KEY_PWD = prop.getProperty(<span class="string">&quot;keyPwd&quot;</span>);</span><br><span class="line">        LIC_PATH = prop.getProperty(<span class="string">&quot;licPath&quot;</span>);</span><br><span class="line">        PRI_PATH = prop.getProperty(<span class="string">&quot;priPath&quot;</span>); <span class="comment">//license content</span></span><br><span class="line">        ISSUED_TIME = prop.getProperty(<span class="string">&quot;issuedTime&quot;</span>);</span><br><span class="line">        NOT_BEFORE = prop.getProperty(<span class="string">&quot;notBefore&quot;</span>);</span><br><span class="line">        NOT_AFTER = prop.getProperty(<span class="string">&quot;notAfter&quot;</span>);</span><br><span class="line">        CONSUMER_TYPE = prop.getProperty(<span class="string">&quot;consumerType&quot;</span>);</span><br><span class="line">        CONSUMER_AMOUNT = Integer.valueOf(prop.getProperty(<span class="string">&quot;consumerAmount&quot;</span>));</span><br><span class="line">        INFO = prop.getProperty(<span class="string">&quot;info&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 证书发布者端执行</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">create</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="type">LicenseManager</span> <span class="variable">licenseManager</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">LicenseManager</span>(initLicenseParams());</span><br><span class="line">            licenseManager.store((createLicenseContent()), <span class="keyword">new</span> <span class="title class_">File</span>(LIC_PATH));</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">            System.out.println(<span class="string">&quot;客户端证书生成失败!&quot;</span>);</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        System.out.println(<span class="string">&quot;服务器端生成证书成功!&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 返回生成证书时需要的参数</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> LicenseParam <span class="title function_">initLicenseParams</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">Preferences</span> <span class="variable">preference</span> <span class="operator">=</span> Preferences.userNodeForPackage(LicenseCreator.class);</span><br><span class="line">        <span class="comment">// 设置对证书内容加密的对称密码</span></span><br><span class="line">        <span class="type">CipherParam</span> <span class="variable">cipherParam</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">DefaultCipherParam</span>(STORE_PWD);</span><br><span class="line">        <span class="type">KeyStoreParam</span> <span class="variable">privateStoreParam</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">DefaultKeyStoreParam</span>(LicenseCreator.class, PRI_PATH, PRIVATE_ALIAS, STORE_PWD, KEY_PWD);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">DefaultLicenseParam</span>(SUB_JECT, preference, privateStoreParam, cipherParam);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 从外部表单拿到证书的内容</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">static</span> LicenseContent <span class="title function_">createLicenseContent</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">DateFormat</span> <span class="variable">format</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SimpleDateFormat</span>(<span class="string">&quot;yyyy-MM-dd&quot;</span>);</span><br><span class="line">        <span class="type">LicenseContent</span> <span class="variable">content</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">        content = <span class="keyword">new</span> <span class="title class_">LicenseContent</span>();</span><br><span class="line">        content.setSubject(SUB_JECT);</span><br><span class="line">        content.setHolder(DEFAULT_HOLDER_AND_ISSUER);</span><br><span class="line">        content.setIssuer(DEFAULT_HOLDER_AND_ISSUER);</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            content.setIssued(format.parse(ISSUED_TIME));</span><br><span class="line">            content.setNotBefore(format.parse(NOT_BEFORE));</span><br><span class="line">            content.setNotAfter(format.parse(NOT_AFTER));</span><br><span class="line">        &#125; <span class="keyword">catch</span> (ParseException e) &#123; <span class="comment">// TODO Auto-generated catch block</span></span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        content.setConsumerType(CONSUMER_TYPE);</span><br><span class="line">        content.setConsumerAmount(CONSUMER_AMOUNT);</span><br><span class="line">        content.setInfo(INFO); <span class="comment">// 扩展</span></span><br><span class="line">        content.setExtra(<span class="keyword">new</span> <span class="title class_">Object</span>());</span><br><span class="line">        <span class="keyword">return</span> content;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="客户端使用证书"><a href="#客户端使用证书" class="headerlink" title="客户端使用证书"></a>客户端使用证书</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.license;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> de.schlichtherle.license.*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.File;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.io.InputStream;</span><br><span class="line"><span class="keyword">import</span> java.util.Properties;</span><br><span class="line"><span class="keyword">import</span> java.util.prefs.Preferences;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 校验证书</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">VerifyLicense</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">VerifyLicense</span> <span class="variable">license</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">VerifyLicense</span>();</span><br><span class="line">        license.setParam(<span class="string">&quot;/public-param.properties&quot;</span>);</span><br><span class="line">        license.verify();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="type">String</span> <span class="variable">PUBLIC_ALIAS</span> <span class="operator">=</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="type">String</span> <span class="variable">STORE_PWD</span> <span class="operator">=</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="type">String</span> <span class="variable">SUB_JECT</span> <span class="operator">=</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="type">String</span> <span class="variable">LIC_PATH</span> <span class="operator">=</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="type">String</span> <span class="variable">PUB_PATH</span> <span class="operator">=</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setParam</span><span class="params">(String propertiesPath)</span> &#123;</span><br><span class="line">        <span class="comment">// 获取参数</span></span><br><span class="line">        <span class="type">Properties</span> <span class="variable">prop</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Properties</span>();</span><br><span class="line">        <span class="type">InputStream</span> <span class="variable">in</span> <span class="operator">=</span> getClass().getResourceAsStream(propertiesPath);</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            prop.load(in);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">            <span class="comment">// TODO Auto-generated catch block</span></span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        PUBLIC_ALIAS = prop.getProperty(<span class="string">&quot;publicAlias&quot;</span>);</span><br><span class="line">        STORE_PWD = prop.getProperty(<span class="string">&quot;storePwd&quot;</span>);</span><br><span class="line">        SUB_JECT = prop.getProperty(<span class="string">&quot;subJect&quot;</span>);</span><br><span class="line">        LIC_PATH = prop.getProperty(<span class="string">&quot;licPath&quot;</span>);</span><br><span class="line">        PUB_PATH = prop.getProperty(<span class="string">&quot;pubPath&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 证书使用者端执行</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">verify</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">LicenseManager</span> <span class="variable">licenseManager</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">LicenseManager</span>(initLicenseParams());</span><br><span class="line">        <span class="comment">// 安装证书</span></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            licenseManager.install(<span class="keyword">new</span> <span class="title class_">File</span>(LIC_PATH));</span><br><span class="line">            System.out.println(<span class="string">&quot;客户端安装证书成功!&quot;</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">            System.out.println(<span class="string">&quot;客户端证书安装失败!&quot;</span>);</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 验证证书</span></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            licenseManager.verify();</span><br><span class="line">            System.out.println(<span class="string">&quot;客户端验证证书成功!&quot;</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">            System.out.println(<span class="string">&quot;客户端证书验证失效!&quot;</span>);</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 返回验证证书需要的参数</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> LicenseParam <span class="title function_">initLicenseParams</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">Preferences</span> <span class="variable">preference</span> <span class="operator">=</span> Preferences.userNodeForPackage(VerifyLicense.class);</span><br><span class="line">        <span class="type">CipherParam</span> <span class="variable">cipherParam</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">DefaultCipherParam</span>(STORE_PWD);</span><br><span class="line">        <span class="type">KeyStoreParam</span> <span class="variable">privateStoreParam</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">DefaultKeyStoreParam</span>(VerifyLicense.class, PUB_PATH, PUBLIC_ALIAS, STORE_PWD, <span class="literal">null</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">DefaultLicenseParam</span>(SUB_JECT, preference, privateStoreParam, cipherParam);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="maven-依赖"><a href="#maven-依赖" class="headerlink" title="maven 依赖"></a>maven 依赖</h2><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>de.schlichtherle.truelicense<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>truelicense-core<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.33<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.commons<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>commons-lang3<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.12.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.bouncycastle<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>bcprov-jdk15to18<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.77<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.bouncycastle<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>bcprov-jdk15on<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.68<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br></pre></td></tr></table></figure><h2 id="param-properties"><a href="#param-properties" class="headerlink" title="param.properties"></a>param.properties</h2><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># alias</span></span><br><span class="line"><span class="attr">privateAlias</span>=<span class="string">dsa_private_key</span></span><br><span class="line"><span class="attr">keyPwd</span>=<span class="string">maxzhao_pwd</span></span><br><span class="line"><span class="attr">storePwd</span>=<span class="string">maxzhao_pwd</span></span><br><span class="line"><span class="attr">subJect</span>=<span class="string">bigdata</span></span><br><span class="line"><span class="comment"># 绝对路径</span></span><br><span class="line"><span class="attr">licPath</span>=<span class="string">/temp/bigdata-out-18.lic</span></span><br><span class="line"><span class="attr">priPath</span>=<span class="string">/dsa_private_key_store.jks</span></span><br><span class="line"><span class="comment">##########license content###########</span></span><br><span class="line"><span class="attr">issuedTime</span>=<span class="string">2014-04-01</span></span><br><span class="line"><span class="attr">notBefore</span>=<span class="string">2014-04-01</span></span><br><span class="line"><span class="attr">notAfter</span>=<span class="string">2024-07-18</span></span><br><span class="line"><span class="attr">consumerType</span>=<span class="string">user</span></span><br><span class="line"><span class="attr">consumerAmount</span>=<span class="string">1</span></span><br><span class="line"><span class="comment"># other info</span></span><br><span class="line"><span class="attr">info</span>=<span class="string">this is a license</span></span><br></pre></td></tr></table></figure><h2 id="public-param-properties"><a href="#public-param-properties" class="headerlink" title="public-param.properties"></a>public-param.properties</h2><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># alias</span></span><br><span class="line"><span class="attr">publicAlias</span>=<span class="string">dsa_public_cert</span></span><br><span class="line"><span class="attr">storePwd</span>=<span class="string">maxzhao_pwd</span></span><br><span class="line"><span class="comment"># 主题</span></span><br><span class="line"><span class="attr">subJect</span>=<span class="string">bigdata</span></span><br><span class="line"><span class="comment"># 绝对路径</span></span><br><span class="line"><span class="attr">licPath</span>=<span class="string">/temp/bigdata-out-18.lic</span></span><br><span class="line"><span class="attr">pubPath</span>=<span class="string">/dsa_public_certs_store.jks</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><p>本文地址： <a href="https://github.com/maxzhao-it/blog/post/56235478467467/">https://github.com/maxzhao-it/blog/post/56235478467467/</a> </p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h1 id=&quot;Java-使用-license&quot;&gt;&lt;a href=&quot;#Java-使用-license&quot; class=&quot;headerlink&quot; title=&quot;Java 使用 license&quot;&gt;&lt;/a&gt;Java 使用 license&lt;/h1&gt;&lt;p&gt;使用 truelicense&lt;/p&gt;
      
    
    </summary>
    
    
      <category term="Java" scheme="https://github.com/maxzhao-it/blog/categories/Java/"/>
    
    
      <category term="Java" scheme="https://github.com/maxzhao-it/blog/tags/Java/"/>
    
      <category term="License" scheme="https://github.com/maxzhao-it/blog/tags/License/"/>
    
  </entry>
  
  <entry>
    <title>Git拉取tag的更新</title>
    <link href="https://github.com/maxzhao-it/blog/post/a1bc7e95/"/>
    <id>https://github.com/maxzhao-it/blog/post/a1bc7e95/</id>
    <published>2024-08-21T00:52:12.951Z</published>
    <updated>2024-08-29T11:36:12.791Z</updated>
    
    <content type="html"><![CDATA[<h1 id="Git拉取tag的更新"><a href="#Git拉取tag的更新" class="headerlink" title="Git拉取tag的更新"></a>Git拉取tag的更新</h1><p>要拉取全部包括tag需要使用</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">git -c credential.helper= -c core.quotepath=false -c log.showSignature=false fetch origin --recurse-submodules=no --progress --prune</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">或者</span></span><br><span class="line">git fetch origin</span><br></pre></td></tr></table></figure><p>正常情况下,只能拉倒当前的分支</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git pull origin main </span><br></pre></td></tr></table></figure><p>本文地址： <a href="https://github.com/maxzhao-it/blog/post/a1bc7e95/">https://github.com/maxzhao-it/blog/post/a1bc7e95/</a> </p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h1 id=&quot;Git拉取tag的更新&quot;&gt;&lt;a href=&quot;#Git拉取tag的更新&quot; class=&quot;headerlink&quot; title=&quot;Git拉取tag的更新&quot;&gt;&lt;/a&gt;Git拉取tag的更新&lt;/h1&gt;&lt;p&gt;要拉取全部包括tag需要使用&lt;/p&gt;
&lt;figure class=&quot;
      
    
    </summary>
    
    
    
  </entry>
  
  <entry>
    <title>log4j2读取Application.yml中的配置</title>
    <link href="https://github.com/maxzhao-it/blog/post/3c950ad/"/>
    <id>https://github.com/maxzhao-it/blog/post/3c950ad/</id>
    <published>2024-08-20T13:36:41.887Z</published>
    <updated>2024-08-29T11:36:12.789Z</updated>
    
    <content type="html"><![CDATA[<h1 id="log4j2读取Application-yml中的配置"><a href="#log4j2读取Application-yml中的配置" class="headerlink" title="log4j2读取Application.yml中的配置"></a>log4j2读取Application.yml中的配置</h1><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 默认日志输出路径</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> maxzhao</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">LoggerListener</span> <span class="keyword">implements</span> <span class="title class_">ApplicationListener</span>&lt;ApplicationEvent&gt;, Ordered &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onApplicationEvent</span><span class="params">(ApplicationEvent event)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (event <span class="keyword">instanceof</span> ApplicationEnvironmentPreparedEvent) &#123;</span><br><span class="line">            <span class="type">ConfigurableEnvironment</span> <span class="variable">environment</span> <span class="operator">=</span> ((ApplicationEnvironmentPreparedEvent) event).getEnvironment();</span><br><span class="line">            <span class="type">String</span> <span class="variable">property</span> <span class="operator">=</span> environment.getProperty(<span class="string">&quot;spring.application.name&quot;</span>);</span><br><span class="line">            System.setProperty(<span class="string">&quot;empower.log.path&quot;</span>, property);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">getOrder</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> LoggingApplicationListener.DEFAULT_ORDER - <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>启动类</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DataHubApplication</span> &#123;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">SpringApplication</span> <span class="variable">application</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SpringApplication</span>(DataHubApplication.class);</span><br><span class="line">        application.addListeners(<span class="keyword">new</span> <span class="title class_">LoggerListener</span>());</span><br><span class="line">        <span class="type">ConfigurableApplicationContext</span> <span class="variable">context</span> <span class="operator">=</span> application.run(args);</span><br><span class="line">        SpringBootUtils.setApplicationContent(context);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>本文地址： <a href="https://github.com/maxzhao-it/blog/post/3c950ad/">https://github.com/maxzhao-it/blog/post/3c950ad/</a> </p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h1 id=&quot;log4j2读取Application-yml中的配置&quot;&gt;&lt;a href=&quot;#log4j2读取Application-yml中的配置&quot; class=&quot;headerlink&quot; title=&quot;log4j2读取Application.yml中的配置&quot;&gt;&lt;/a&gt;log4j
      
    
    </summary>
    
    
    
  </entry>
  
  <entry>
    <title>永久删除git历史提交中的大文件</title>
    <link href="https://github.com/maxzhao-it/blog/post/d3a05225/"/>
    <id>https://github.com/maxzhao-it/blog/post/d3a05225/</id>
    <published>2024-08-13T05:46:34.143Z</published>
    <updated>2024-08-29T11:36:12.787Z</updated>
    
    <content type="html"><![CDATA[<h2 id="直接清除"><a href="#直接清除" class="headerlink" title="直接清除"></a>直接清除</h2><p>安装好python3之后执行</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">pip install git-filter-repo</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">删除所有大于 10M的文件</span></span><br><span class="line">git filter-repo --strip-blobs-bigger-than 10M --force</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">删除某个具体的文件</span></span><br><span class="line">git filter-repo --path path/to/file.ext --invert-paths</span><br></pre></td></tr></table></figure><p>找到  <code>.git\filter-repo\commit-map</code> 文件，备份一下</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">git config --unset remote.origin.mirror</span><br><span class="line">git push origin --force &#x27;refs/heads/*&#x27;</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">git push origin --force <span class="string">&#x27;refs/tags/*&#x27;</span></span></span><br><span class="line">git push origin --force &#x27;refs/replace/*&#x27;</span><br></pre></td></tr></table></figure><p>到 gitlab的 Repository cleanup 上传</p><blockquote><p><a href="https://docs.gitlab.com/17.1/ee/user/project/repository/reducing_the_repo_size_using_git.html">Gitlab 说明文档</a></p></blockquote><h2 id="找到大文件（git-lt-2-40）"><a href="#找到大文件（git-lt-2-40）" class="headerlink" title="找到大文件（git &lt; 2.40）"></a>找到大文件（git &lt; 2.40）</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">git commit -am &quot;commit all&quot;</span><br><span class="line">git gc</span><br><span class="line">git count-objects -v </span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">第三列是大小：SHA-1 <span class="built_in">type</span> size size-in-packfile offset-in-packfile</span></span><br><span class="line">git verify-pack -v .git/objects/pack/pack-xxxx.idx | sort -k 3 -n | tail -3 </span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">windows</span></span><br><span class="line">git verify-pack -v .git/objects/pack/pack-xxxx.idx  &gt;&gt; 1.txt</span><br></pre></td></tr></table></figure><p>根据sha-1 列出所有commit</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">git rev-list --objects --all |grep b8b2c97e4327aadb5d5b5926a2a8aaa8dc0c5b1f</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">windows</span></span><br><span class="line">git rev-list --objects --all |findstr “b8b2c97e4327aadb5d5b5926a2a8aaa8dc0c5b1f”</span><br></pre></td></tr></table></figure><p>移除</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">git log --pretty=oneline --branches -- docs/.vuepress/public/nacos/nacos-server-2.2.0.1.tar.gz</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">输出</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">91b26ddfe8a744d266498fc6d176b7b75f0113f2 docs：文档</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">ea773ea3347b48d132c0ddfa1ae30541c831ed1e docs：build 部署中间件内容迁移</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">删除所有commit</span></span><br><span class="line">git filter-branch --index-filter &#x27;git rm --cached --ignore-unmatch docs/.vuepress/public/nacos/nacos-server-2.2.0.1.tar.gz&#x27; -- ea773ea3347b48d132c0ddfa1ae30541c831ed1e..</span><br></pre></td></tr></table></figure><p>删除空间引用</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">rm -rf .git/refs/original</span><br><span class="line">rm -rf .git/logs/</span><br><span class="line">git gc</span><br></pre></td></tr></table></figure><h2 id="查看空间"><a href="#查看空间" class="headerlink" title="查看空间"></a>查看空间</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git count-objects -v</span><br></pre></td></tr></table></figure><p>本文地址： <a href="https://github.com/maxzhao-it/blog/post/d3a05225/">https://github.com/maxzhao-it/blog/post/d3a05225/</a> </p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2 id=&quot;直接清除&quot;&gt;&lt;a href=&quot;#直接清除&quot; class=&quot;headerlink&quot; title=&quot;直接清除&quot;&gt;&lt;/a&gt;直接清除&lt;/h2&gt;&lt;p&gt;安装好python3之后执行&lt;/p&gt;
&lt;figure class=&quot;highlight shell&quot;&gt;&lt;table&gt;&lt;tr&gt;
      
    
    </summary>
    
    
    
  </entry>
  
  <entry>
    <title>K8S部署Logstash</title>
    <link href="https://github.com/maxzhao-it/blog/post/9074123121/"/>
    <id>https://github.com/maxzhao-it/blog/post/9074123121/</id>
    <published>2024-08-03T16:00:00.000Z</published>
    <updated>2024-08-21T09:15:47.595Z</updated>
    
    <content type="html"><![CDATA[<h1 id="K8S部署Logstash"><a href="#K8S部署Logstash" class="headerlink" title="K8S部署Logstash"></a>K8S部署Logstash</h1><h3 id="挂载路径"><a href="#挂载路径" class="headerlink" title="挂载路径"></a>挂载路径</h3><p>容器内绝对路径</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/usr/share/logstash/pipeline/logstash.conf</span><br></pre></td></tr></table></figure><p>容器内路径  </p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">~/pipeline/logstash.conf</span><br></pre></td></tr></table></figure><h1 id="K8S部署Filebeat"><a href="#K8S部署Filebeat" class="headerlink" title="K8S部署Filebeat"></a>K8S部署Filebeat</h1><h3 id="挂载路径-1"><a href="#挂载路径-1" class="headerlink" title="挂载路径"></a>挂载路径</h3><p>容器内绝对路径</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/usr/share/filebeat/filebeat.yml</span><br></pre></td></tr></table></figure><p>容器内路径</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">~/filebeat.yml</span><br></pre></td></tr></table></figure><h3 id="挂载路径-HostPath"><a href="#挂载路径-HostPath" class="headerlink" title="挂载路径 HostPath"></a>挂载路径 HostPath</h3><ul><li>&#x2F;var&#x2F;lib&#x2F;docker&#x2F;containers</li><li>&#x2F;var&#x2F;log</li></ul><h3 id="env"><a href="#env" class="headerlink" title="env"></a>env</h3><ul><li>NODE_NAME   1</li></ul><h1 id="K8S部署Kibana"><a href="#K8S部署Kibana" class="headerlink" title="K8S部署Kibana"></a>K8S部署Kibana</h1><h3 id="挂载路径-2"><a href="#挂载路径-2" class="headerlink" title="挂载路径"></a>挂载路径</h3><p>容器内绝对路径</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/usr/share/kibana/config/kibana.yml</span><br></pre></td></tr></table></figure><p>容器内路径</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">~/kibana.yml</span><br></pre></td></tr></table></figure><p>本文地址： <a href="https://github.com/maxzhao-it/blog/post/9074123121/">https://github.com/maxzhao-it/blog/post/9074123121/</a> </p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h1 id=&quot;K8S部署Logstash&quot;&gt;&lt;a href=&quot;#K8S部署Logstash&quot; class=&quot;headerlink&quot; title=&quot;K8S部署Logstash&quot;&gt;&lt;/a&gt;K8S部署Logstash&lt;/h1&gt;&lt;h3 id=&quot;挂载路径&quot;&gt;&lt;a href=&quot;#挂载路径&quot;
      
    
    </summary>
    
    
      <category term="ELK" scheme="https://github.com/maxzhao-it/blog/categories/ELK/"/>
    
      <category term="Logstash" scheme="https://github.com/maxzhao-it/blog/categories/ELK/Logstash/"/>
    
    
      <category term="ELK" scheme="https://github.com/maxzhao-it/blog/tags/ELK/"/>
    
      <category term="Logstash" scheme="https://github.com/maxzhao-it/blog/tags/Logstash/"/>
    
  </entry>
  
  <entry>
    <title>文件内容检索</title>
    <link href="https://github.com/maxzhao-it/blog/post/aa3ad85532434/"/>
    <id>https://github.com/maxzhao-it/blog/post/aa3ad85532434/</id>
    <published>2024-07-18T02:49:47.962Z</published>
    <updated>2024-08-29T11:36:45.280Z</updated>
    
    <content type="html"><![CDATA[<h3 id="直接检索出所有包含字符串的文件"><a href="#直接检索出所有包含字符串的文件" class="headerlink" title="直接检索出所有包含字符串的文件"></a>直接检索出所有包含字符串的文件</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">find /path/to/search -type f -name &quot;application.yml&quot; -exec grep -l &quot;test&quot; &#123;&#125; +</span><br></pre></td></tr></table></figure><h3 id="查看所有包含字符串的文件内上下文"><a href="#查看所有包含字符串的文件内上下文" class="headerlink" title="查看所有包含字符串的文件内上下文"></a>查看所有包含字符串的文件内上下文</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">find /path/to/search -type f -name &quot;application.yml&quot; -exec grep &quot;empower&quot; &#123;&#125; +</span><br></pre></td></tr></table></figure><h3 id="替换所有文件中的字符串"><a href="#替换所有文件中的字符串" class="headerlink" title="替换所有文件中的字符串"></a>替换所有文件中的字符串</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">find /path/to/search -type f -name &quot;application.yml&quot; -exec sed -i &#x27;s/empower/empower-test/g&#x27; &#123;&#125; +</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">之查看不替换，可以不用 sed 的 -i 命令</span></span><br><span class="line">find /path/to/search -type f -name &quot;application.yml&quot; -exec sed  &#x27;s/empower/empower-test/g&#x27; &#123;&#125; +</span><br></pre></td></tr></table></figure><p>本文地址： <a href="https://github.com/maxzhao-it/blog/post/aa3ad85532434/">https://github.com/maxzhao-it/blog/post/aa3ad85532434/</a> </p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h3 id=&quot;直接检索出所有包含字符串的文件&quot;&gt;&lt;a href=&quot;#直接检索出所有包含字符串的文件&quot; class=&quot;headerlink&quot; title=&quot;直接检索出所有包含字符串的文件&quot;&gt;&lt;/a&gt;直接检索出所有包含字符串的文件&lt;/h3&gt;&lt;figure class=&quot;highli
      
    
    </summary>
    
    
      <category term="Linux" scheme="https://github.com/maxzhao-it/blog/categories/Linux/"/>
    
    
      <category term="Linux" scheme="https://github.com/maxzhao-it/blog/tags/Linux/"/>
    
  </entry>
  
  <entry>
    <title>WIndows配置用户同时远程连接</title>
    <link href="https://github.com/maxzhao-it/blog/post/f4328759/"/>
    <id>https://github.com/maxzhao-it/blog/post/f4328759/</id>
    <published>2024-06-21T03:19:15.306Z</published>
    <updated>2024-08-29T11:36:12.785Z</updated>
    
    <content type="html"><![CDATA[<p>打开 GPEDIT.msc<br>点击** 计算机配置——管理模板——window组件——远程桌面服务——远程桌面会话主机——连接**<br>允许用户通过使用远程桌面服务进行远程连接  打开<br>限制链接数量  打开 ，填写数量<br>将远程桌面服务用户限制到单独的远程桌面服务回话  禁用</p><p>本文地址： <a href="https://github.com/maxzhao-it/blog/post/f4328759/">https://github.com/maxzhao-it/blog/post/f4328759/</a> </p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;打开 GPEDIT.msc&lt;br&gt;点击** 计算机配置——管理模板——window组件——远程桌面服务——远程桌面会话主机——连接**&lt;br&gt;允许用户通过使用远程桌面服务进行远程连接  打开&lt;br&gt;限制链接数量  打开 ，填写数量&lt;br&gt;将远程桌面服务用户限制到单独的远程桌
      
    
    </summary>
    
    
    
  </entry>
  
  <entry>
    <title></title>
    <link href="https://github.com/maxzhao-it/blog/post/0/"/>
    <id>https://github.com/maxzhao-it/blog/post/0/</id>
    <published>2024-06-20T11:12:46.717Z</published>
    <updated>2024-08-29T11:36:12.790Z</updated>
    
    <content type="html"><![CDATA[<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">title: SpringBoot使用外部目录放jar包</span><br><span class="line">author: maxzhao</span><br><span class="line"></span><br><span class="line">tags:</span><br><span class="line">  - Java</span><br><span class="line">  - Maven</span><br><span class="line">  </span><br><span class="line">categories:</span><br><span class="line">  - SpringBoot</span><br><span class="line">  - Maven</span><br><span class="line">  </span><br><span class="line">abbrlink: 31330vxcv</span><br><span class="line">date: 2024-06-16 00:00:00</span><br></pre></td></tr></table></figure><h1 id="SpringBoot使用外部目录放jar包"><a href="#SpringBoot使用外部目录放jar包" class="headerlink" title="SpringBoot使用外部目录放jar包"></a>SpringBoot使用外部目录放jar包</h1><p>配置 pom.xml</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-maven-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">executions</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">execution</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">goals</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">goal</span>&gt;</span>repackage<span class="tag">&lt;/<span class="name">goal</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">goals</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">execution</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">executions</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">mainClass</span>&gt;</span>com.xxxxApplication<span class="tag">&lt;/<span class="name">mainClass</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">layout</span>&gt;</span>ZIP<span class="tag">&lt;/<span class="name">layout</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">includeSystemScope</span>&gt;</span>true<span class="tag">&lt;/<span class="name">includeSystemScope</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">fork</span>&gt;</span>true<span class="tag">&lt;/<span class="name">fork</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">includes</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">include</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>no<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>no<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">include</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">includes</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br></pre></td></tr></table></figure><p>这里配置所有的jar都不要。</p><p>也可以单独去除某些依赖</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">excludes</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">exclude</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.projectlombok<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>lombok<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">exclude</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">excludes</span>&gt;</span></span><br></pre></td></tr></table></figure><p>配合  <code>maven-dependency-plugin</code> 输出jar包</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.maven.plugins<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>maven-dependency-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">executions</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">execution</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">id</span>&gt;</span>copy-dependencies<span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">phase</span>&gt;</span>package<span class="tag">&lt;/<span class="name">phase</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">goals</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">goal</span>&gt;</span>copy-dependencies<span class="tag">&lt;/<span class="name">goal</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">goals</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">outputDirectory</span>&gt;</span>$&#123;project.build.directory&#125;/libs/<span class="tag">&lt;/<span class="name">outputDirectory</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">includeScope</span>&gt;</span>runtime<span class="tag">&lt;/<span class="name">includeScope</span>&gt;</span></span><br><span class="line">                <span class="comment">&lt;!-- 以下排除 test 范围的依赖 --&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">excludeScope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">excludeScope</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">overWriteReleases</span>&gt;</span>true<span class="tag">&lt;/<span class="name">overWriteReleases</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">overWriteSnapshots</span>&gt;</span>true<span class="tag">&lt;/<span class="name">overWriteSnapshots</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">overWriteIfNewer</span>&gt;</span>true<span class="tag">&lt;/<span class="name">overWriteIfNewer</span>&gt;</span></span><br><span class="line">                <span class="comment">&lt;!--包含的jar，多个用英文逗号分隔--&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">includeArtifactIds</span>&gt;</span>bcprov-jdk15on<span class="tag">&lt;/<span class="name">includeArtifactIds</span>&gt;</span></span><br><span class="line">                <span class="comment">&lt;!--不包含的jar，多个用英文逗号分隔--&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">excludeArtifactIds</span>&gt;</span>bcprov-jdk15on<span class="tag">&lt;/<span class="name">excludeArtifactIds</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">execution</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">executions</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br></pre></td></tr></table></figure><p>本文地址： <a href="https://github.com/maxzhao-it/blog/post/0/">https://github.com/maxzhao-it/blog/post/0/</a> </p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;figure class=&quot;highlight plaintext&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span c
      
    
    </summary>
    
    
    
  </entry>
  
  <entry>
    <title>CentOS安装FTP</title>
    <link href="https://github.com/maxzhao-it/blog/post/54531fghfgd/"/>
    <id>https://github.com/maxzhao-it/blog/post/54531fghfgd/</id>
    <published>2024-06-19T16:00:00.000Z</published>
    <updated>2024-06-20T11:08:59.919Z</updated>
    
    <content type="html"><![CDATA[<p>Redhat上部署vsftp权限控制<br>1背景<br>现场需要部署一个ftp系统，供数据交换使用。<br>以前惯用的方式是通过linux的用户来创建。<br>本次做了另外一个尝试，采用虚拟用户进行配置。<br>2配置过程<br>2.1vsftpd配置<br>执行命令： vi &#x2F;etc&#x2F;vsftpd&#x2F;vsftpd.conf 修改&#x2F;etc&#x2F;vsftpd&#x2F;vsftpd.conf，增加如下配置项:<br>pam_service_name&#x3D;vsftpd<br>userlist_enable&#x3D;YES<br>userlist_deny&#x3D;YES<br>#tcp_wrapper&#x3D;YES</p><p>anonymous_enable&#x3D;NO<br>use_localtime&#x3D;YES<br>ascii_upload_enable&#x3D;YES<br>ascii_download_enable&#x3D;YES</p><p>chroot_local_user&#x3D;YES<br>chroot_list_enable&#x3D;YES<br>local_enable&#x3D;YES<br>chroot_list_file&#x3D;&#x2F;etc&#x2F;vsftpd&#x2F;chroot_list</p><p>xferlog_enable&#x3D;YES<br>local_umask&#x3D;022</p><p>listen_port&#x3D;21<br>connect_from_port_20&#x3D;YES</p><p>idle_session_timeout&#x3D;1000<br>data_connection_timeout&#x3D;1000<br>accept_timeout&#x3D;5<br>connect_timeout&#x3D;1</p><p>guest_enable&#x3D;YES<br>guest_username&#x3D;ftpuser<br>user_config_dir&#x3D;&#x2F;etc&#x2F;vsftpd&#x2F;vuser_conf</p><p>pasv_min_port&#x3D;10060<br>pasv_max_port&#x3D;10090</p><p>write_enable&#x3D;YES<br>local_umask&#x3D;022<br>virtual_use_local_privs&#x3D;NO<br>download_enable&#x3D;YES<br>anon_world_readable_only&#x3D;NO<br>anon_mkdir_write_enable&#x3D;YES<br>anon_upload_enable&#x3D;YES<br>anon_other_write_enable&#x3D;YES</p><p>xferlog_enable&#x3D;YES<br>xferlog_std_format&#x3D;YES<br>xferlog_file&#x3D;&#x2F;var&#x2F;log&#x2F;vsftp&#x2F;xferlog.log<br>dual_log_enable&#x3D;YES<br>vsftpd_log_file&#x3D;&#x2F;var&#x2F;log&#x2F;vsftp&#x2F;vsftpd.log<br>max_per_ip&#x3D;200<br>max_clients&#x3D;500<br>2.2创建chroot_list文件<br>执行命令touch &#x2F;etc&#x2F;vsftpd&#x2F;chroot_list，在&#x2F;etc&#x2F;vsftpd目录下创建chroot_list文件，可将可访问所有目录的用户写在里面，一行一个。<br>2.3创建linux用户<br>通过命令useradd -g ftp -s &#x2F;sbin&#x2F;nologin ftpuser创建ftp使用的用户ftpuser。<br>2.4配置用户信息<br>2.4.1用户数据库<br>使用vi命令在&#x2F;etc&#x2F;vsftpd目录下创建用户文件passwd，单数行为用户名，双数行为密码。<br>执行命令db_load -T -t hash -f &#x2F;etc&#x2F;vsftpd&#x2F;passwd &#x2F;etc&#x2F;vsftpd&#x2F;passwd.db。<br>2.4.2创建用户文件<br>使用命令mkdir &#x2F;etc&#x2F;vsftpd&#x2F;vuser_conf在&#x2F;etc&#x2F;vsftpd下创建目录vuser_conf。<br>在vuser_conf目录下创建用户同名文件。<br>文件内容如下：<br>local_root&#x3D;&#x2F;ftpdata<br>write_enable&#x3D;YES<br>local_umask&#x3D;022<br>virtual_use_local_privs&#x3D;NO<br>#下载<br>download_enable&#x3D;YES<br>#只读<br>anon_world_readable_only&#x3D;NO<br>#创建目录<br>anon_mkdir_write_enable&#x3D;YES<br>#上传<br>anon_upload_enable&#x3D;YES<br>#删除<br>anon_other_write_enable&#x3D;YES<br>anon_umask&#x3D;022<br>2.5修改用户目录权限<br>ftpuser必须对&#x2F;ftpdata无写权限<br>在&#x2F;ftpdata目录下创建新的有读写权限目录<br>mkdir &#x2F;ftpdata&#x2F;data<br>chown ftpuser: &#x2F;ftpdata&#x2F;data<br>2.6配置校验<br>使用命令vi &#x2F;etc&#x2F;pam.d&#x2F;vsftpd修改&#x2F;etc&#x2F;pam.d&#x2F;vsftpd，清空内容，修改为：<br>auth sufficient &#x2F;lib64&#x2F;security&#x2F;pam_userdb.so db&#x3D;&#x2F;etc&#x2F;vsftpd&#x2F;passwd<br>account sufficient &#x2F;lib64&#x2F;security&#x2F;pam_userdb.so db&#x3D;&#x2F;etc&#x2F;vsftpd&#x2F;passwd<br>2.7配置目录权限<br>若已关闭selinux，则跳过此步骤。</p><p>在ftp目录下，执行如下命令，查看目录权限：<br>sestatus -b| grep ftp</p><p>执行如下命令授权：<br>setsebool -P ftp_home_dir on<br>setsebool -P allow_ftpd_full_access on<br>2.8打开端口<br>firewall-cmd –add-port&#x3D;21&#x2F;tcp –permanent<br>firewall-cmd –add-port&#x3D;10060-10090&#x2F;tcp –permanent<br>2.9重启vsftpd服务</p><p>本文地址： <a href="https://github.com/maxzhao-it/blog/post/54531fghfgd/">https://github.com/maxzhao-it/blog/post/54531fghfgd/</a> </p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;Redhat上部署vsftp权限控制&lt;br&gt;1背景&lt;br&gt;现场需要部署一个ftp系统，供数据交换使用。&lt;br&gt;以前惯用的方式是通过linux的用户来创建。&lt;br&gt;本次做了另外一个尝试，采用虚拟用户进行配置。&lt;br&gt;2配置过程&lt;br&gt;2.1vsftpd配置&lt;br&gt;执行命令： 
      
    
    </summary>
    
    
      <category term="Linux" scheme="https://github.com/maxzhao-it/blog/categories/Linux/"/>
    
      <category term="Centos" scheme="https://github.com/maxzhao-it/blog/categories/Linux/Centos/"/>
    
      <category term="FTP" scheme="https://github.com/maxzhao-it/blog/categories/Linux/Centos/FTP/"/>
    
    
      <category term="Centos" scheme="https://github.com/maxzhao-it/blog/tags/Centos/"/>
    
      <category term="FTP" scheme="https://github.com/maxzhao-it/blog/tags/FTP/"/>
    
  </entry>
  
  <entry>
    <title>SpringBoot使用Filter排除某个Bean</title>
    <link href="https://github.com/maxzhao-it/blog/post/31330vxcvgfgdfg/"/>
    <id>https://github.com/maxzhao-it/blog/post/31330vxcvgfgdfg/</id>
    <published>2024-06-15T16:00:00.000Z</published>
    <updated>2024-06-20T11:13:34.675Z</updated>
    
    <content type="html"><![CDATA[<h1 id="需要排除某个-Bean-时，"><a href="#需要排除某个-Bean-时，" class="headerlink" title="需要排除某个 Bean 时，"></a>需要排除某个 <code>Bean</code> 时，</h1><h3 id="通过类排除-ASSIGNABLE-TYPE"><a href="#通过类排除-ASSIGNABLE-TYPE" class="headerlink" title="通过类排除 ASSIGNABLE_TYPE"></a>通过类排除 ASSIGNABLE_TYPE</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">@ComponentScan(excludeFilters = &#123;@ComponentScan.Filter(type = FilterType.ASSIGNABLE_TYPE,</span><br><span class="line">        value = &#123;DEMO.class&#125;)&#125;, basePackages = &#123;&quot;com&quot;&#125;)</span><br><span class="line">        </span><br></pre></td></tr></table></figure><h3 id="通过类排除"><a href="#通过类排除" class="headerlink" title="通过类排除"></a>通过类排除</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">@ComponentScan(excludeFilters = &#123;@ComponentScan.Filter(type = FilterType.ASSIGNABLE_TYPE,</span><br><span class="line">        value = &#123;DEMO.class&#125;)&#125;, basePackages = &#123;&quot;com&quot;&#125;)</span><br><span class="line">        </span><br></pre></td></tr></table></figure><h3 id="基于注解排除-ANNOTATION"><a href="#基于注解排除-ANNOTATION" class="headerlink" title="基于注解排除 ANNOTATION"></a>基于注解排除 ANNOTATION</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">@ComponentScan(excludeFilters = &#123;@ComponentScan.Filter(type = FilterType.ANNOTATION,</span><br><span class="line">        classes  = MyAnnotation.class )&#125;, basePackages = &#123;&quot;com&quot;&#125;)</span><br><span class="line">        </span><br></pre></td></tr></table></figure><h3 id="通过正则排除-REGEX"><a href="#通过正则排除-REGEX" class="headerlink" title="通过正则排除 REGEX"></a>通过正则排除 REGEX</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">@ComponentScan(excludeFilters = &#123;@ComponentScan.Filter(type = FilterType.REGEX,</span><br><span class="line">        pattern = &quot;com\.maxzhao\..*\.controller\..*&quot; )&#125;, basePackages = &#123;&quot;com&quot;&#125;)</span><br><span class="line">        </span><br></pre></td></tr></table></figure><p>本文地址： <a href="https://github.com/maxzhao-it/blog/post/31330vxcvgfgdfg/">https://github.com/maxzhao-it/blog/post/31330vxcvgfgdfg/</a> </p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h1 id=&quot;需要排除某个-Bean-时，&quot;&gt;&lt;a href=&quot;#需要排除某个-Bean-时，&quot; class=&quot;headerlink&quot; title=&quot;需要排除某个 Bean 时，&quot;&gt;&lt;/a&gt;需要排除某个 &lt;code&gt;Bean&lt;/code&gt; 时，&lt;/h1&gt;&lt;h3 id=&quot;通过类排
      
    
    </summary>
    
    
      <category term="SpringBoot" scheme="https://github.com/maxzhao-it/blog/categories/SpringBoot/"/>
    
      <category term="Maven" scheme="https://github.com/maxzhao-it/blog/categories/SpringBoot/Maven/"/>
    
    
      <category term="Java" scheme="https://github.com/maxzhao-it/blog/tags/Java/"/>
    
      <category term="Maven" scheme="https://github.com/maxzhao-it/blog/tags/Maven/"/>
    
  </entry>
  
  <entry>
    <title>Linux下MySQL自动备份</title>
    <link href="https://github.com/maxzhao-it/blog/post/3ed7094534213/"/>
    <id>https://github.com/maxzhao-it/blog/post/3ed7094534213/</id>
    <published>2024-06-07T16:00:00.000Z</published>
    <updated>2024-07-17T13:10:18.560Z</updated>
    
    <content type="html"><![CDATA[<h2 id="删除-30天前的备份"><a href="#删除-30天前的备份" class="headerlink" title="删除 30天前的备份"></a>删除 30天前的备份</h2><p>编辑 <code>vim </code></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&#x27;#!/bin/bash&#x27;</span> &gt; /opt/mysql8/dump_limit.sh</span><br><span class="line"><span class="built_in">echo</span> <span class="string">&#x27;find /opt/mysql8/dump/ -type f ! -newermt &quot;30 days ago&quot; -delete&#x27;</span> &gt;&gt; /opt/mysql8/dump_limit.sh</span><br><span class="line"><span class="built_in">chmod</span> u+x /opt/mysql8/dump_limit.sh</span><br></pre></td></tr></table></figure><p>同样的</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">crontab -e</span><br></pre></td></tr></table></figure><p>输入</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">0 0,12 * * * /opt/mysql8/dump_limit.sh</span><br></pre></td></tr></table></figure><p>本文地址： <a href="https://github.com/maxzhao-it/blog/post/3ed7094534213/">https://github.com/maxzhao-it/blog/post/3ed7094534213/</a> </p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2 id=&quot;删除-30天前的备份&quot;&gt;&lt;a href=&quot;#删除-30天前的备份&quot; class=&quot;headerlink&quot; title=&quot;删除 30天前的备份&quot;&gt;&lt;/a&gt;删除 30天前的备份&lt;/h2&gt;&lt;p&gt;编辑 &lt;code&gt;vim &lt;/code&gt;&lt;/p&gt;
&lt;figure class
      
    
    </summary>
    
    
      <category term="DB" scheme="https://github.com/maxzhao-it/blog/categories/DB/"/>
    
    
      <category term="Linux" scheme="https://github.com/maxzhao-it/blog/tags/Linux/"/>
    
  </entry>
  
  <entry>
    <title>ELasticSearch使用RestAPI操作</title>
    <link href="https://github.com/maxzhao-it/blog/post/14230ad/"/>
    <id>https://github.com/maxzhao-it/blog/post/14230ad/</id>
    <published>2024-06-03T16:00:00.000Z</published>
    <updated>2024-06-20T11:09:58.123Z</updated>
    
    <content type="html"><![CDATA[<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">private String getIndexTemplate = &quot;http://%s:%d/_index_template/%sapi-log&quot;;</span><br><span class="line">private String createIndexTemplate = &quot;http://%s:%d/_index_template/%sapi-log&quot;;</span><br><span class="line">private String putData = &quot;http://%s:%d/%sapi-log-$&#123;date&#125;/_doc&quot;;</span><br></pre></td></tr></table></figure><p>本文地址： <a href="https://github.com/maxzhao-it/blog/post/14230ad/">https://github.com/maxzhao-it/blog/post/14230ad/</a> </p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;figure class=&quot;highlight plaintext&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span c
      
    
    </summary>
    
    
      <category term="ELK" scheme="https://github.com/maxzhao-it/blog/categories/ELK/"/>
    
      <category term="ElasticSearch" scheme="https://github.com/maxzhao-it/blog/categories/ELK/ElasticSearch/"/>
    
    
      <category term="ELK" scheme="https://github.com/maxzhao-it/blog/tags/ELK/"/>
    
      <category term="ElasticSearch" scheme="https://github.com/maxzhao-it/blog/tags/ElasticSearch/"/>
    
  </entry>
  
  <entry>
    <title>Maven将依赖打包到指定路径下</title>
    <link href="https://github.com/maxzhao-it/blog/post/450e8a25/"/>
    <id>https://github.com/maxzhao-it/blog/post/450e8a25/</id>
    <published>2024-06-02T16:00:00.000Z</published>
    <updated>2024-06-20T11:11:57.632Z</updated>
    
    <content type="html"><![CDATA[<h2 id="配置插件"><a href="#配置插件" class="headerlink" title="配置插件"></a>配置插件</h2><p><code>pom.xml</code> 中配置 <code>maven-dependency-plugin</code></p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">build</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">plugins</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.maven.plugins<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>maven-dependency-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">executions</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">execution</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">id</span>&gt;</span>copy-dependencies<span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">phase</span>&gt;</span>package<span class="tag">&lt;/<span class="name">phase</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">goals</span>&gt;</span></span><br><span class="line">                            <span class="tag">&lt;<span class="name">goal</span>&gt;</span>copy-dependencies<span class="tag">&lt;/<span class="name">goal</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;/<span class="name">goals</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">                           <span class="comment">&lt;!--指定地址--&gt;</span> <span class="tag">&lt;<span class="name">outputDirectory</span>&gt;</span>../../plugins/$&#123;project.name&#125;<span class="tag">&lt;/<span class="name">outputDirectory</span>&gt;</span></span><br><span class="line">                            <span class="tag">&lt;<span class="name">overWriteReleases</span>&gt;</span>true<span class="tag">&lt;/<span class="name">overWriteReleases</span>&gt;</span></span><br><span class="line">                            <span class="tag">&lt;<span class="name">overWriteSnapshots</span>&gt;</span>true<span class="tag">&lt;/<span class="name">overWriteSnapshots</span>&gt;</span></span><br><span class="line">                            <span class="tag">&lt;<span class="name">overWriteIfNewer</span>&gt;</span>true<span class="tag">&lt;/<span class="name">overWriteIfNewer</span>&gt;</span></span><br><span class="line">                            <span class="comment">&lt;!--指定驱动--&gt;</span></span><br><span class="line">                            <span class="tag">&lt;<span class="name">includeArtifactIds</span>&gt;</span>bcprov-jdk15on<span class="tag">&lt;/<span class="name">includeArtifactIds</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;/<span class="name">execution</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">executions</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">plugins</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">build</span>&gt;</span></span><br></pre></td></tr></table></figure><p>本文地址： <a href="https://github.com/maxzhao-it/blog/post/450e8a25/">https://github.com/maxzhao-it/blog/post/450e8a25/</a> </p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2 id=&quot;配置插件&quot;&gt;&lt;a href=&quot;#配置插件&quot; class=&quot;headerlink&quot; title=&quot;配置插件&quot;&gt;&lt;/a&gt;配置插件&lt;/h2&gt;&lt;p&gt;&lt;code&gt;pom.xml&lt;/code&gt; 中配置 &lt;code&gt;maven-dependency-plugin&lt;/code&gt;&lt;
      
    
    </summary>
    
    
      <category term="Linux" scheme="https://github.com/maxzhao-it/blog/categories/Linux/"/>
    
      <category term="Maven" scheme="https://github.com/maxzhao-it/blog/categories/Linux/Maven/"/>
    
    
      <category term="Maven" scheme="https://github.com/maxzhao-it/blog/tags/Maven/"/>
    
  </entry>
  
  <entry>
    <title>容器环境中的命令行工具Busybox</title>
    <link href="https://github.com/maxzhao-it/blog/post/ebede6de/"/>
    <id>https://github.com/maxzhao-it/blog/post/ebede6de/</id>
    <published>2024-05-26T16:00:00.000Z</published>
    <updated>2024-08-24T01:31:50.731Z</updated>
    
    <content type="html"><![CDATA[<h1 id="容器环境中的命令行工具Busybox"><a href="#容器环境中的命令行工具Busybox" class="headerlink" title="容器环境中的命令行工具Busybox"></a>容器环境中的命令行工具Busybox</h1><p>地址：<a href="https://hub.docker.com/_/busybox">https://hub.docker.com/_/busybox</a></p><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">docker pull busybox:<span class="number">1</span>.<span class="number">36</span>.<span class="number">1</span></span><br><span class="line">docker save -o image_busybox-<span class="number">1</span>.<span class="number">36</span>.<span class="number">1</span>.tar.gz  busybox:<span class="number">1</span>.<span class="number">36</span>.<span class="number">1</span></span><br></pre></td></tr></table></figure><p>需要配置 CMD </p><p><code>sleep</code></p><p><code>360000</code></p><p>然后进入 </p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">exec -it  xxx /bin/sh</span><br></pre></td></tr></table></figure><p>本文地址： <a href="https://github.com/maxzhao-it/blog/post/ebede6de/">https://github.com/maxzhao-it/blog/post/ebede6de/</a> </p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h1 id=&quot;容器环境中的命令行工具Busybox&quot;&gt;&lt;a href=&quot;#容器环境中的命令行工具Busybox&quot; class=&quot;headerlink&quot; title=&quot;容器环境中的命令行工具Busybox&quot;&gt;&lt;/a&gt;容器环境中的命令行工具Busybox&lt;/h1&gt;&lt;p&gt;地址：&lt;a 
      
    
    </summary>
    
    
      <category term="K8S" scheme="https://github.com/maxzhao-it/blog/categories/K8S/"/>
    
    
      <category term="Docker" scheme="https://github.com/maxzhao-it/blog/tags/Docker/"/>
    
      <category term="Linux" scheme="https://github.com/maxzhao-it/blog/tags/Linux/"/>
    
      <category term="CentOS" scheme="https://github.com/maxzhao-it/blog/tags/CentOS/"/>
    
      <category term="K8S" scheme="https://github.com/maxzhao-it/blog/tags/K8S/"/>
    
  </entry>
  
  <entry>
    <title>Java使用RestClient连接ElasticSearch</title>
    <link href="https://github.com/maxzhao-it/blog/post/34329dsafadsfasdfgh/"/>
    <id>https://github.com/maxzhao-it/blog/post/34329dsafadsfasdfgh/</id>
    <published>2024-05-23T16:00:00.000Z</published>
    <updated>2024-05-25T08:01:32.956Z</updated>
    
    <content type="html"><![CDATA[<h2 id="ElasticSearch"><a href="#ElasticSearch" class="headerlink" title="ElasticSearch"></a>ElasticSearch</h2><h3 id="快速了解"><a href="#快速了解" class="headerlink" title="快速了解"></a>快速了解</h3><h4 id="索引-Index"><a href="#索引-Index" class="headerlink" title="索引(Index)"></a>索引(Index)</h4><p>类似于关系型数据库的库，是相同文档的集合。</p><h4 id="文档-document"><a href="#文档-document" class="headerlink" title="文档(document)"></a>文档(document)</h4><p>文档相当于关系型数据的列，是可以建立索引的基本单元。</p><table><thead><tr><th>ElasticSearch</th><th>RDBMS</th></tr></thead><tbody><tr><td>索引（index）</td><td>数据库（database）</td></tr><tr><td>类型（type）</td><td>表（table）</td></tr><tr><td>文档（document）</td><td>行（row）</td></tr><tr><td>字段（field）</td><td>列（column）</td></tr><tr><td>映射（mapping）</td><td>表结构（schema）</td></tr><tr><td>全文索引</td><td>索引</td></tr><tr><td>查询DSL</td><td>SQL</td></tr><tr><td>GET</td><td>select</td></tr><tr><td>PUT&#x2F;POST</td><td>update</td></tr><tr><td>DELETE</td><td>delete</td></tr></tbody></table><h3 id="Maven-依赖"><a href="#Maven-依赖" class="headerlink" title="Maven 依赖"></a>Maven 依赖</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">project</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--......................--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">properties</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">elasticsearch-rest-client.version</span>&gt;</span>7.13.2<span class="tag">&lt;/<span class="name">elasticsearch-rest-client.version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">elasticsearch-rest-high-level-client.version</span>&gt;</span>7.13.2<span class="tag">&lt;/<span class="name">elasticsearch-rest-high-level-client.version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--        &lt;dependency&gt;--&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--            &lt;groupId&gt;org.elasticsearch.client&lt;/groupId&gt;--&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--            &lt;artifactId&gt;elasticsearch-rest-client&lt;/artifactId&gt;--&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--            &lt;version&gt;$&#123;elasticsearch-rest-client.version&#125;&lt;/version&gt;--&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--        &lt;/dependency&gt;--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.elasticsearch.client<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>elasticsearch-rest-high-level-client<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;elasticsearch-rest-high-level-client.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--......................--&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">build</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">plugins</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">                <span class="comment">&lt;!--shade 把下面的报打包在一个 jar 里--&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.maven.plugins<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>maven-shade-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.2.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">executions</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">execution</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">phase</span>&gt;</span>package<span class="tag">&lt;/<span class="name">phase</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">goals</span>&gt;</span></span><br><span class="line">                            <span class="tag">&lt;<span class="name">goal</span>&gt;</span>shade<span class="tag">&lt;/<span class="name">goal</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;/<span class="name">goals</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">                            <span class="tag">&lt;<span class="name">relocations</span>&gt;</span></span><br><span class="line">                                <span class="tag">&lt;<span class="name">relocation</span>&gt;</span></span><br><span class="line">                                    <span class="tag">&lt;<span class="name">pattern</span>&gt;</span>org.apache.http<span class="tag">&lt;/<span class="name">pattern</span>&gt;</span></span><br><span class="line">                                    <span class="tag">&lt;<span class="name">shadedPattern</span>&gt;</span>hidden.org.apache.http<span class="tag">&lt;/<span class="name">shadedPattern</span>&gt;</span></span><br><span class="line">                                <span class="tag">&lt;/<span class="name">relocation</span>&gt;</span></span><br><span class="line">                                <span class="tag">&lt;<span class="name">relocation</span>&gt;</span></span><br><span class="line">                                    <span class="tag">&lt;<span class="name">pattern</span>&gt;</span>org.apache.logging<span class="tag">&lt;/<span class="name">pattern</span>&gt;</span></span><br><span class="line">                                    <span class="tag">&lt;<span class="name">shadedPattern</span>&gt;</span>hidden.org.apache.logging<span class="tag">&lt;/<span class="name">shadedPattern</span>&gt;</span></span><br><span class="line">                                <span class="tag">&lt;/<span class="name">relocation</span>&gt;</span></span><br><span class="line">                                <span class="tag">&lt;<span class="name">relocation</span>&gt;</span></span><br><span class="line">                                    <span class="tag">&lt;<span class="name">pattern</span>&gt;</span>org.apache.commons.codec<span class="tag">&lt;/<span class="name">pattern</span>&gt;</span></span><br><span class="line">                                    <span class="tag">&lt;<span class="name">shadedPattern</span>&gt;</span>hidden.org.apache.commons.codec<span class="tag">&lt;/<span class="name">shadedPattern</span>&gt;</span></span><br><span class="line">                                <span class="tag">&lt;/<span class="name">relocation</span>&gt;</span></span><br><span class="line">                                <span class="tag">&lt;<span class="name">relocation</span>&gt;</span></span><br><span class="line">                                    <span class="tag">&lt;<span class="name">pattern</span>&gt;</span>org.apache.commons.logging<span class="tag">&lt;/<span class="name">pattern</span>&gt;</span></span><br><span class="line">                                    <span class="tag">&lt;<span class="name">shadedPattern</span>&gt;</span>hidden.org.apache.commons.logging<span class="tag">&lt;/<span class="name">shadedPattern</span>&gt;</span></span><br><span class="line">                                <span class="tag">&lt;/<span class="name">relocation</span>&gt;</span></span><br><span class="line">                            <span class="tag">&lt;/<span class="name">relocations</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;/<span class="name">execution</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">executions</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">plugins</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--......................--&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">build</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">repositories</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- add the elasticsearch repo --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">repository</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">id</span>&gt;</span>elasticsearch-releases<span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">url</span>&gt;</span>https://artifacts.elastic.co/maven<span class="tag">&lt;/<span class="name">url</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">releases</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">enabled</span>&gt;</span>true<span class="tag">&lt;/<span class="name">enabled</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">releases</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">snapshots</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">enabled</span>&gt;</span>false<span class="tag">&lt;/<span class="name">enabled</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">snapshots</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">repository</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">repositories</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">pluginRepositories</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">pluginRepository</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">id</span>&gt;</span>alimaven<span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">name</span>&gt;</span>aliyun maven<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">url</span>&gt;</span>http://maven.aliyun.com/nexus/content/groups/public/<span class="tag">&lt;/<span class="name">url</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">releases</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">enabled</span>&gt;</span>true<span class="tag">&lt;/<span class="name">enabled</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">releases</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">snapshots</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">enabled</span>&gt;</span>false<span class="tag">&lt;/<span class="name">enabled</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">snapshots</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">pluginRepository</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">pluginRepositories</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">project</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="第一步建立文档索引-IndexRequest"><a href="#第一步建立文档索引-IndexRequest" class="headerlink" title="第一步建立文档索引(IndexRequest)"></a>第一步建立文档索引(IndexRequest)</h3><p><a href="https://www.elastic.co/guide/en/elasticsearch/reference/7.13/index-modules.html">索引文档</a></p><h4 id="创建带分词的索引"><a href="#创建带分词的索引" class="headerlink" title="创建带分词的索引"></a>创建带分词的索引</h4><p><a href="https://www.elastic.co/guide/en/elasticsearch/client/java-rest/current/java-rest-high-create-index.html">ES 7.13.2</a></p><h5 id="kibana"><a href="#kibana" class="headerlink" title="kibana"></a>kibana</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">PUT posts2/</span><br><span class="line">&#123;</span><br><span class="line">参考 EsIndexConfig.json</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="Dev-Tools"><a href="#Dev-Tools" class="headerlink" title="Dev Tools"></a>Dev Tools</h4><p>参数:</p><ul><li>posts 全局索引名称</li><li>_doc 类型</li><li>id_1 文档主键,如果包含主键，则为 PUT请求</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">POST /posts/_doc/id_1?refresh=wait_for&amp;version=-4&amp;timeout=10s</span><br><span class="line">&#123;</span><br><span class="line">&quot;tag2&quot;:&quot;不&quot;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>注意：<code>opType=index</code>  结果为：<code>[http://127.0.0.1:9200/posts/_doc?timeout=1m] and method [POST]]]</code><br>注意：<code>opType=create</code>  结果为：<code>[http://127.0.0.1:9200/posts/_create?version=-4&amp;timeout=1m] and method [POST]]]</code><br>但是 <code>/posts/_create</code>后面必须要跟文档ID<code>/posts/_create/ID_xxx</code><br>正常 <code>&amp;op_type=create</code>参数是作为 url 参数出现的。</p></blockquote><h4 id="简单的逻辑"><a href="#简单的逻辑" class="headerlink" title="简单的逻辑"></a>简单的逻辑</h4><ul><li>CREATE - 不指定文档id create</li><li>CREATE - 指定文档id - 不指定版本号 - 判断文档是否存在 - 不存在-create</li><li>CREATE - 指定文档id - 不指定版本号 - 判断文档是否存在 - 存在-报错</li><li>CREATE - 指定文档id - 指定版本号 - 报错，指定版本号请用INDEX</li><li>INDEX - 不指定文档id - create</li><li>INDEX - 指定文档id - 不指定版本号 - 判断文档id是否存在 - 存在 - update</li><li>INDEX - 指定文档id - 不指定版本号 - 判断文档id是否存在 - 不存在 - create</li><li>INDEX - 指定文档id - 指定版本号 - 判断文档id是否存在 - 存在 - 校验外部指定</li><li>INDEX - 指定文档id - 指定版本号 - 判断文档id是否存在 - 不存在 - create</li><li>UPDATE - 整体更新</li><li>UPDATE - 部分更新</li></ul><h4 id="Java"><a href="#Java" class="headerlink" title="Java"></a>Java</h4><h5 id="常用属性"><a href="#常用属性" class="headerlink" title="常用属性"></a>常用属性</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">demo</span> &#123;</span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">demo</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">/*全局索引名称*/</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">indexName</span> <span class="operator">=</span> <span class="string">&quot;posts&quot;</span>;</span><br><span class="line">        <span class="type">IndexRequest</span> <span class="variable">indexRequest</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">IndexRequest</span>(indexName);</span><br><span class="line">        <span class="comment">/*载入资源*/</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">jsonString</span> <span class="operator">=</span> <span class="string">&quot;&#123;\&quot;user\&quot;:\&quot;maxzhao\&quot;,\&quot;addtime\&quot;:\&quot;2013-01-30\&quot;,\&quot;message\&quot;:\&quot;add data Elasticsearch\&quot;&#125;&quot;</span>;</span><br><span class="line">        indexRequest.source(jsonString, XContentType.JSON);</span><br><span class="line">        <span class="comment">/**/</span></span><br><span class="line"><span class="comment">        indexRequest.routing(&quot;routing&quot;);</span></span><br><span class="line"><span class="comment">        /*超时时间*/</span></span><br><span class="line">        indexRequest.timeout(TimeValue.timeValueSeconds(<span class="number">60</span>));</span><br><span class="line">        <span class="comment">/*超时时间*/</span></span><br><span class="line">        indexRequest.timeout(<span class="string">&quot;1m&quot;</span>);</span><br><span class="line">        <span class="comment">/*刷新策略*/</span></span><br><span class="line">        indexRequest.setRefreshPolicy(WriteRequest.RefreshPolicy.WAIT_UNTIL);</span><br><span class="line">        <span class="comment">/*刷新策略：wait_for、true、false*/</span></span><br><span class="line">        indexRequest.setRefreshPolicy(<span class="string">&quot;wait_for&quot;</span>);</span><br><span class="line">        <span class="comment">/*文档主键*/</span></span><br><span class="line">        indexRequest.id();</span><br><span class="line">        <span class="comment">/*版本号*/</span></span><br><span class="line">        indexRequest.version(<span class="number">2</span>);</span><br><span class="line">        <span class="comment">/*校验类型*/</span></span><br><span class="line">        indexRequest.versionType(VersionType.EXTERNAL);</span><br><span class="line">        <span class="comment">/*操作类型，这里使用 create 必须要设置文档ID*/</span></span><br><span class="line">        indexRequest.opType(DocWriteRequest.OpType.CREATE);</span><br><span class="line">        <span class="comment">/*操作类型：create or index (default)*/</span></span><br><span class="line">        indexRequest.opType(<span class="string">&quot;create&quot;</span>);</span><br><span class="line">        <span class="comment">/*索引文档之前执行的管道名称*/</span></span><br><span class="line">        indexRequest.setPipeline(<span class="string">&quot;pipeline&quot;</span>);</span><br><span class="line">        <span class="comment">/*即将废除：indexRequest.type(&quot;_doc&quot;);*/</span></span><br><span class="line">        <span class="comment">/*获取响应结果*/</span></span><br><span class="line">        <span class="type">IndexResponse</span> <span class="variable">indexResponse</span> <span class="operator">=</span> restHighLevelClient.index(indexRequest, RequestOptions.DEFAULT);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="资源载入的四种方式"><a href="#资源载入的四种方式" class="headerlink" title="资源载入的四种方式"></a>资源载入的四种方式</h5><p>建议使用方式一、方式二</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">demo</span> &#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 建立索引</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">IndexRequest</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">/*方式一：*/</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">indexName</span> <span class="operator">=</span> <span class="string">&quot;posts&quot;</span>;</span><br><span class="line">        <span class="type">IndexRequest</span> <span class="variable">indexRequest</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">IndexRequest</span>(indexName);</span><br><span class="line">        <span class="type">String</span> <span class="variable">jsonString</span> <span class="operator">=</span> <span class="string">&quot;&#123;&quot;</span> +</span><br><span class="line">                <span class="string">&quot;\&quot;user\&quot;:\&quot;maxzhao\&quot;,&quot;</span> +</span><br><span class="line">                <span class="string">&quot;\&quot;message\&quot;:\&quot;add data Elasticsearch\&quot;&quot;</span> +</span><br><span class="line">                <span class="string">&quot;&#125;&quot;</span>;</span><br><span class="line">        indexRequest.source(jsonString, XContentType.JSON);</span><br><span class="line">        <span class="comment">/*方式二：*/</span></span><br><span class="line">        Map&lt;String, Object&gt; jsonMap = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">        jsonMap.put(<span class="string">&quot;user&quot;</span>, <span class="string">&quot;maxzhao&quot;</span>);</span><br><span class="line">        jsonMap.put(<span class="string">&quot;addtime&quot;</span>, <span class="keyword">new</span> <span class="title class_">Date</span>());</span><br><span class="line">        jsonMap.put(<span class="string">&quot;message&quot;</span>, <span class="string">&quot;add data Elasticsearch&quot;</span>);</span><br><span class="line">        indexRequest = <span class="keyword">new</span> <span class="title class_">IndexRequest</span>(indexName)</span><br><span class="line">                .source(jsonMap);</span><br><span class="line">        <span class="comment">/*方式三：*/</span></span><br><span class="line">        <span class="type">XContentBuilder</span> <span class="variable">builder</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            builder = XContentFactory.jsonBuilder();</span><br><span class="line">            builder.startObject();</span><br><span class="line">            &#123;</span><br><span class="line">                builder.field(<span class="string">&quot;user&quot;</span>, <span class="string">&quot;maxzhao&quot;</span>);</span><br><span class="line">                builder.timeField(<span class="string">&quot;addtime&quot;</span>, <span class="keyword">new</span> <span class="title class_">Date</span>());</span><br><span class="line">                builder.field(<span class="string">&quot;message&quot;</span>, <span class="string">&quot;add data Elasticsearch&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            builder.endObject();</span><br><span class="line">            indexRequest = <span class="keyword">new</span> <span class="title class_">IndexRequest</span>(indexName)</span><br><span class="line">                    .source(builder);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">/*方式四：*/</span></span><br><span class="line">        indexRequest = <span class="keyword">new</span> <span class="title class_">IndexRequest</span>(indexName)</span><br><span class="line">                .source(<span class="string">&quot;user&quot;</span>, <span class="string">&quot;maxzhao&quot;</span>,</span><br><span class="line">                        <span class="string">&quot;addtime&quot;</span>, <span class="keyword">new</span> <span class="title class_">Date</span>(),</span><br><span class="line">                        <span class="string">&quot;message&quot;</span>, <span class="string">&quot;add data Elasticsearch&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="发起请求"><a href="#发起请求" class="headerlink" title="发起请求"></a>发起请求</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">demo</span> &#123;</span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">demo</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">/*同步*/</span></span><br><span class="line">        <span class="type">IndexResponse</span> <span class="variable">indexResponse</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            indexResponse = restHighLevelClient.index(indexRequest, RequestOptions.DEFAULT);</span><br><span class="line">            <span class="built_in">this</span>.HandleIndexResponse(indexResponse);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (ElasticsearchException e) &#123;</span><br><span class="line">            log.warn(e.toString());</span><br><span class="line">            <span class="comment">/*版本冲突所抛出的异常*/</span></span><br><span class="line">            <span class="comment">/*同样会发生,以防opType将创建和相同的索引文档id已经存在:*/</span></span><br><span class="line">            <span class="keyword">if</span> (e.status() == RestStatus.CONFLICT) &#123;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">            log.warn(e.toString());</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">/*异步*/</span></span><br><span class="line">        <span class="type">Cancellable</span> <span class="variable">cancellable</span> <span class="operator">=</span> restHighLevelClient.indexAsync(indexRequest, RequestOptions.DEFAULT, <span class="keyword">new</span> <span class="title class_">ActionListener</span>&lt;IndexResponse&gt;() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onResponse</span><span class="params">(IndexResponse indexResponse)</span> &#123;</span><br><span class="line">                HandleIndexResponse(indexResponse);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onFailure</span><span class="params">(Exception e)</span> &#123;</span><br><span class="line">                log.warn(e.toString());</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="修改-UpdateRequest"><a href="#修改-UpdateRequest" class="headerlink" title="修改(UpdateRequest)"></a>修改(UpdateRequest)</h4><h4 id="删除-DeleteRequest"><a href="#删除-DeleteRequest" class="headerlink" title="删除(DeleteRequest)"></a>删除(DeleteRequest)</h4><h4 id="合并请求-BulkRequest"><a href="#合并请求-BulkRequest" class="headerlink" title="合并请求(BulkRequest)"></a>合并请求(BulkRequest)</h4><h4 id="复制索引-ReindexRequest"><a href="#复制索引-ReindexRequest" class="headerlink" title="复制索引(ReindexRequest)"></a>复制索引(ReindexRequest)</h4><p>可用于将文档从一个或多个索引复制到目标索引。</p><h4 id="查询-GetRequest、GetSourceRequest"><a href="#查询-GetRequest、GetSourceRequest" class="headerlink" title="查询(GetRequest、GetSourceRequest)"></a>查询(GetRequest、GetSourceRequest)</h4><h4 id="合并多个查询-MultiGetRequest"><a href="#合并多个查询-MultiGetRequest" class="headerlink" title="合并多个查询(MultiGetRequest)"></a>合并多个查询(MultiGetRequest)</h4><h3 id="检索-SearchRequest"><a href="#检索-SearchRequest" class="headerlink" title="检索(SearchRequest)"></a>检索(SearchRequest)</h3><ol><li>结构化检索</li><li>全文检索</li></ol><h2 id="详细了解"><a href="#详细了解" class="headerlink" title="详细了解"></a>详细了解</h2><h3 id="索引近义词"><a href="#索引近义词" class="headerlink" title="索引近义词"></a>索引近义词</h3><h4 id="创建索引时"><a href="#创建索引时" class="headerlink" title="创建索引时"></a>创建索引时</h4><p>创建索引时，进行<a href="https://www.elastic.co/guide/en/elasticsearch/reference/7.13/indices-reload-analyzers.html">配置</a></p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;settings&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;analysis&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;analyzer&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;my_hanlp_analyzer&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">          <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;custom&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;char_filter&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">            <span class="string">&quot;html_strip&quot;</span></span><br><span class="line">          <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;filter&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">            <span class="string">&quot;my_synonym&quot;</span></span><br><span class="line">          <span class="punctuation">]</span></span><br><span class="line">        <span class="punctuation">&#125;</span></span><br><span class="line">      <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;filter&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;my_synonym&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">          <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;synonym_graph&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;synonyms_path&quot;</span><span class="punctuation">:</span> <span class="string">&quot;analysis/synonym/synonym.txt&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;updateable&quot;</span><span class="punctuation">:</span> <span class="keyword">true</span></span><br><span class="line">        <span class="punctuation">&#125;</span></span><br><span class="line">      <span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><h4 id="配置文件"><a href="#配置文件" class="headerlink" title="配置文件"></a>配置文件</h4><p>路径 <code>$&#123;ES_HOME&#125;/analysis/synonym/synonym.txt</code></p><p>近义词配置方式</p><ul><li>中文,汉语,汉字<ul><li>这种写法在分词的时候，有中文的地方，都会解析成中文,汉语,汉字，把中文,汉语,汉字存入索引中</li></ul></li><li>毛衣,毛裤 &#x3D;&gt; 线服<ul><li>这种写法在分词的时候，毛衣,毛裤都会解析成为线服，然后把线服存入索引中</li></ul></li></ul><h3 id="分词"><a href="#分词" class="headerlink" title="分词"></a>分词</h3><p>请查看 <code>HanLP</code> 文档。</p><h3 id="分词过滤器-x2F-不区分大小写"><a href="#分词过滤器-x2F-不区分大小写" class="headerlink" title="分词过滤器&#x2F;不区分大小写"></a>分词过滤器&#x2F;不区分大小写</h3><p>创建索引时，进行配置</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;settings&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;number_of_shards&quot;</span><span class="punctuation">:</span> <span class="number">1</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;number_of_replicas&quot;</span><span class="punctuation">:</span> <span class="number">1</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;analysis&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;analyzer&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;my_hanlp_analyzer&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">          <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;custom&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;tokenizer&quot;</span><span class="punctuation">:</span> <span class="string">&quot;my_hanlp&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;char_filter&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">            <span class="string">&quot;html_strip&quot;</span></span><br><span class="line">          <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;filter&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">            <span class="string">&quot;my_lowercase&quot;</span></span><br><span class="line">          <span class="punctuation">]</span></span><br><span class="line">        <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;default&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">          <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;hanlp&quot;</span></span><br><span class="line">        <span class="punctuation">&#125;</span></span><br><span class="line">      <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;tokenizer&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;my_hanlp&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">          <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;hanlp&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;enable_stop_dictionary&quot;</span><span class="punctuation">:</span> <span class="keyword">false</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;enable_custom_config&quot;</span><span class="punctuation">:</span> <span class="keyword">false</span></span><br><span class="line">        <span class="punctuation">&#125;</span></span><br><span class="line">      <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;filter&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;my_lowercase&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">          <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;lowercase&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;language&quot;</span><span class="punctuation">:</span> <span class="string">&quot;greek&quot;</span></span><br><span class="line">        <span class="punctuation">&#125;</span></span><br><span class="line">      <span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="附录"><a href="#附录" class="headerlink" title="附录"></a>附录</h2><p>本文地址： <a href="https://github.com/maxzhao-it/blog/post/34329dsafadsfasdfgh/">https://github.com/maxzhao-it/blog/post/34329dsafadsfasdfgh/</a> </p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2 id=&quot;ElasticSearch&quot;&gt;&lt;a href=&quot;#ElasticSearch&quot; class=&quot;headerlink&quot; title=&quot;ElasticSearch&quot;&gt;&lt;/a&gt;ElasticSearch&lt;/h2&gt;&lt;h3 id=&quot;快速了解&quot;&gt;&lt;a href=&quot;#快速了解&quot;
      
    
    </summary>
    
    
      <category term="ELK" scheme="https://github.com/maxzhao-it/blog/categories/ELK/"/>
    
      <category term="ElasticSearch" scheme="https://github.com/maxzhao-it/blog/categories/ELK/ElasticSearch/"/>
    
    
      <category term="ELK" scheme="https://github.com/maxzhao-it/blog/tags/ELK/"/>
    
      <category term="ElasticSearch" scheme="https://github.com/maxzhao-it/blog/tags/ElasticSearch/"/>
    
  </entry>
  
  <entry>
    <title>Linux配置NTP使用自定义服务</title>
    <link href="https://github.com/maxzhao-it/blog/post/805f48c5123231231/"/>
    <id>https://github.com/maxzhao-it/blog/post/805f48c5123231231/</id>
    <published>2024-05-15T16:00:00.000Z</published>
    <updated>2024-06-24T06:27:16.278Z</updated>
    
    <content type="html"><![CDATA[<p>&#x2F;etc&#x2F;ntp.conf</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">server ntp.example.com iburst </span><br></pre></td></tr></table></figure><p>systemctl start ntpd<br>systemctl enable ntpd<br>systemctl status ntpd</p><p>本文地址： <a href="https://github.com/maxzhao-it/blog/post/805f48c5123231231/">https://github.com/maxzhao-it/blog/post/805f48c5123231231/</a> </p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;&amp;#x2F;etc&amp;#x2F;ntp.conf&lt;/p&gt;
&lt;figure class=&quot;highlight plaintext&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;
      
    
    </summary>
    
    
      <category term="Linux" scheme="https://github.com/maxzhao-it/blog/categories/Linux/"/>
    
    
      <category term="Linux" scheme="https://github.com/maxzhao-it/blog/tags/Linux/"/>
    
      <category term="NTP" scheme="https://github.com/maxzhao-it/blog/tags/NTP/"/>
    
  </entry>
  
  <entry>
    <title>MySQL报错toomanyconnect</title>
    <link href="https://github.com/maxzhao-it/blog/post/70e8b96e/"/>
    <id>https://github.com/maxzhao-it/blog/post/70e8b96e/</id>
    <published>2024-05-10T07:31:12.140Z</published>
    <updated>2024-05-10T07:31:12.141Z</updated>
    
    <content type="html"><![CDATA[<p>MySQL报错toomanyconnect</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">show</span> variables <span class="keyword">like</span> <span class="string">&#x27;max_connections&#x27;</span>;</span><br><span class="line"><span class="keyword">show</span> processlist;</span><br><span class="line"><span class="keyword">set</span> <span class="keyword">GLOBAL</span> max_connections<span class="operator">=</span><span class="number">200</span>;</span><br></pre></td></tr></table></figure><p>本文地址： <a href="https://github.com/maxzhao-it/blog/post/70e8b96e/">https://github.com/maxzhao-it/blog/post/70e8b96e/</a> </p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;MySQL报错toomanyconnect&lt;/p&gt;
&lt;figure class=&quot;highlight sql&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;li
      
    
    </summary>
    
    
      <category term="DB" scheme="https://github.com/maxzhao-it/blog/categories/DB/"/>
    
      <category term="MySQL" scheme="https://github.com/maxzhao-it/blog/categories/DB/MySQL/"/>
    
    
      <category term="DB" scheme="https://github.com/maxzhao-it/blog/tags/DB/"/>
    
      <category term="MySQL" scheme="https://github.com/maxzhao-it/blog/tags/MySQL/"/>
    
  </entry>
  
  <entry>
    <title>NodeJS打包时实现改写文件</title>
    <link href="https://github.com/maxzhao-it/blog/post/21566213545/"/>
    <id>https://github.com/maxzhao-it/blog/post/21566213545/</id>
    <published>2024-05-03T16:00:00.000Z</published>
    <updated>2024-05-23T03:39:13.812Z</updated>
    
    <content type="html"><![CDATA[<h2 id="执行"><a href="#执行" class="headerlink" title="执行"></a>执行</h2><h3 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install archiver</span><br></pre></td></tr></table></figure><h3 id="脚本"><a href="#脚本" class="headerlink" title="脚本"></a>脚本</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> fs = <span class="built_in">require</span>(<span class="string">&#x27;fs&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> projectNames = [<span class="string">&#x27;main-app&#x27;</span>];</span><br><span class="line"><span class="comment">// console.log(&#x27;current path &#x27;, process.cwd())</span></span><br><span class="line"><span class="comment">// 读取打包后的JavaScript文件</span></span><br><span class="line"><span class="keyword">const</span> args = process.<span class="property">argv</span>.<span class="title function_">slice</span>(<span class="number">2</span>);</span><br><span class="line"><span class="keyword">if</span>(args.<span class="property">length</span>==<span class="number">0</span>)&#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">warn</span>(<span class="string">&#x27;请输入参数&#x27;</span>,projectNames)</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">let</span> projectName = args[<span class="number">0</span>];</span><br><span class="line"><span class="keyword">if</span>(!projectName.<span class="title function_">endsWith</span>(<span class="string">&#x27;-app&#x27;</span>))&#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;项目名称转换:&quot;</span>,projectName,<span class="string">&#x27; -&gt; &#x27;</span>,projectName+<span class="string">&#x27;-app&#x27;</span>)</span><br><span class="line">    projectName+=<span class="string">&#x27;-app&#x27;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(projectNames.<span class="title function_">indexOf</span>(projectName)==-<span class="number">1</span>)&#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">warn</span>(<span class="string">&#x27;参数错误&#x27;</span>,projectName)</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">warn</span>(<span class="string">&#x27;请输入正确参数&#x27;</span>,projectNames)</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> filePath = <span class="string">&#x27;../dist/&#x27;</span>+projectName+<span class="string">&#x27;/config.js&#x27;</span>; <span class="comment">// 替换为你实际的文件路径</span></span><br><span class="line"><span class="keyword">const</span> fileData = fs.<span class="title function_">readFileSync</span>(filePath, <span class="string">&#x27;utf8&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 在文件中查找需要替换的域名，并进行替换</span></span><br><span class="line"><span class="keyword">const</span> oldAddress = <span class="string">&#x27;\&#x27;(?:https?:\\/\\/)?((([0-9]&#123;0,3&#125;\\.)&#123;3&#125;[0-9]&#123;0,3&#125;:[0-9]&#123;1,&#125;)|([\\w.-]+(?:\\.[\\w.-]+)+))&#x27;</span>; <span class="comment">// 替换为需要修改的旧地址</span></span><br><span class="line"><span class="keyword">const</span> newAddress = <span class="string">&#x27;\&#x27;&#x27;</span>; <span class="comment">// 替换为新地址</span></span><br><span class="line"><span class="keyword">const</span> oldPassword = <span class="string">&#x27;password: \&#x27;(.*)\&#x27;&#x27;</span>; <span class="comment">// 替换为需要修改的旧地址</span></span><br><span class="line"><span class="keyword">const</span> newPassword = <span class="string">&#x27;password: \&#x27;\&#x27;&#x27;</span>; <span class="comment">// 替换为新地址</span></span><br><span class="line"><span class="keyword">const</span> modifiedData = fileData.<span class="title function_">replace</span>(<span class="keyword">new</span> <span class="title class_">RegExp</span>(oldAddress, <span class="string">&#x27;g&#x27;</span>), newAddress);</span><br><span class="line"><span class="keyword">const</span> modifiedData = modifiedData.<span class="title function_">replace</span>(<span class="keyword">new</span> <span class="title class_">RegExp</span>(oldPassword, <span class="string">&#x27;g&#x27;</span>), newPassword);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 将修改后的内容写回文件</span></span><br><span class="line">fs.<span class="title function_">writeFileSync</span>(filePath, modifiedData, <span class="string">&#x27;utf8&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;文件修改完成！&#x27;</span>);</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;文件打包开始！&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> archiver = <span class="built_in">require</span>(<span class="string">&#x27;../&#x27;</span>+projectName+<span class="string">&#x27;/node_modules/archiver&#x27;</span>);</span><br><span class="line"><span class="comment">// 创建一个输出流，用于将文件写入 zip 包中</span></span><br><span class="line"><span class="keyword">const</span> output = fs.<span class="title function_">createWriteStream</span>(__dirname + <span class="string">&#x27;/../dist/&#x27;</span>+projectName+<span class="string">&#x27;.zip&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> archive = <span class="title function_">archiver</span>(<span class="string">&#x27;zip&#x27;</span>, &#123;</span><br><span class="line">  <span class="attr">zlib</span>: &#123; <span class="attr">level</span>: <span class="number">9</span> &#125; <span class="comment">// 设置压缩级别（可选）</span></span><br><span class="line">&#125;);</span><br><span class="line"><span class="comment">// 将输出流与 archiver 绑定</span></span><br><span class="line">archive.<span class="title function_">pipe</span>(output);</span><br><span class="line"><span class="comment">// 向 zip 包中添加构建好的前端代码，路径根据实际情况进行调整</span></span><br><span class="line">archive.<span class="title function_">directory</span>(__dirname + <span class="string">&#x27;/../dist/&#x27;</span>+projectName, <span class="literal">false</span>);</span><br><span class="line"><span class="comment">// 完成 zip 打包</span></span><br><span class="line">archive.<span class="title function_">finalize</span>();</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;文件打包完成！&#x27;</span>, output.<span class="property">path</span>);</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="运行"><a href="#运行" class="headerlink" title="运行"></a>运行</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">node ../devops/modifyScript.js main-app</span><br></pre></td></tr></table></figure><p>本文地址： <a href="https://github.com/maxzhao-it/blog/post/21566213545/">https://github.com/maxzhao-it/blog/post/21566213545/</a> </p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2 id=&quot;执行&quot;&gt;&lt;a href=&quot;#执行&quot; class=&quot;headerlink&quot; title=&quot;执行&quot;&gt;&lt;/a&gt;执行&lt;/h2&gt;&lt;h3 id=&quot;安装&quot;&gt;&lt;a href=&quot;#安装&quot; class=&quot;headerlink&quot; title=&quot;安装&quot;&gt;&lt;/a&gt;安装&lt;/h3&gt;&lt;figur
      
    
    </summary>
    
    
      <category term="NodeJs" scheme="https://github.com/maxzhao-it/blog/categories/NodeJs/"/>
    
      <category term="npm" scheme="https://github.com/maxzhao-it/blog/categories/NodeJs/npm/"/>
    
    
      <category term="NodeJs" scheme="https://github.com/maxzhao-it/blog/tags/NodeJs/"/>
    
      <category term="npm" scheme="https://github.com/maxzhao-it/blog/tags/npm/"/>
    
  </entry>
  
  <entry>
    <title>Liquibase在国产化OpenGauss下的使用</title>
    <link href="https://github.com/maxzhao-it/blog/post/cf860b21123/"/>
    <id>https://github.com/maxzhao-it/blog/post/cf860b21123/</id>
    <published>2024-04-16T16:00:00.000Z</published>
    <updated>2024-06-20T11:10:58.679Z</updated>
    
    <content type="html"><![CDATA[<h1 id="Opengauss"><a href="#Opengauss" class="headerlink" title="Opengauss"></a>Opengauss</h1><h2 id="生成表结构"><a href="#生成表结构" class="headerlink" title="生成表结构"></a>生成表结构</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">liquibase --driver=org.opengauss.Driver --classpath=opengauss-jdbc-6.0.0-RC1-og.jar --changeLogFile=./opengauss-dbchangelog-schema.xml --url=&quot;jdbc:opengauss://32.1.0.100:15232/empower?charSet=utf8&amp;currentSchema=empower_config&quot; --username=empower --password=&quot;SkyEmp12#$&quot; generateChangeLog</span><br></pre></td></tr></table></figure><h2 id="生成表数据"><a href="#生成表数据" class="headerlink" title="生成表数据"></a>生成表数据</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">liquibase --driver=org.opengauss.Driver --classpath=opengauss-jdbc-6.0.0-RC1-og.jar --changeLogFile=./opengauss-dbchangelog-data.xml --url=&quot;jdbc:opengauss://32.1.0.100:15232/empower?charSet=utf8&amp;currentSchema=empower_config&quot; --username=empower --password=&quot;SkyEmp12#$&quot; --diffTypes=data generateChangeLog</span><br></pre></td></tr></table></figure><p>本文地址： <a href="https://github.com/maxzhao-it/blog/post/cf860b21123/">https://github.com/maxzhao-it/blog/post/cf860b21123/</a> </p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h1 id=&quot;Opengauss&quot;&gt;&lt;a href=&quot;#Opengauss&quot; class=&quot;headerlink&quot; title=&quot;Opengauss&quot;&gt;&lt;/a&gt;Opengauss&lt;/h1&gt;&lt;h2 id=&quot;生成表结构&quot;&gt;&lt;a href=&quot;#生成表结构&quot; class=&quot;header
      
    
    </summary>
    
    
      <category term="Java" scheme="https://github.com/maxzhao-it/blog/categories/Java/"/>
    
      <category term="DB" scheme="https://github.com/maxzhao-it/blog/categories/Java/DB/"/>
    
    
      <category term="Java" scheme="https://github.com/maxzhao-it/blog/tags/Java/"/>
    
      <category term="DataSource" scheme="https://github.com/maxzhao-it/blog/tags/DataSource/"/>
    
      <category term="Liquibase" scheme="https://github.com/maxzhao-it/blog/tags/Liquibase/"/>
    
      <category term="OpenGauss" scheme="https://github.com/maxzhao-it/blog/tags/OpenGauss/"/>
    
  </entry>
  
  <entry>
    <title>Nginx负载路径</title>
    <link href="https://github.com/maxzhao-it/blog/post/ec5ec98b123324/"/>
    <id>https://github.com/maxzhao-it/blog/post/ec5ec98b123324/</id>
    <published>2024-04-15T16:00:00.000Z</published>
    <updated>2024-05-10T07:31:12.145Z</updated>
    
    <content type="html"><![CDATA[<h3 id="1-编写Nginx的systemd服务文件"><a href="#1-编写Nginx的systemd服务文件" class="headerlink" title="1. 编写Nginx的systemd服务文件"></a>1. 编写Nginx的systemd服务文件</h3><p>首先，在<code>/etc/systemd/system/</code>目录下创建一个新的服务文件，比如<code>nginx.service</code>。你可以使用<code>vi</code>、<code>nano</code>或其他文本编辑器来创建和编辑这个文件。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo vi /etc/systemd/system/nginx.service</span><br></pre></td></tr></table></figure><p>然后，将以下内容复制到该文件中：</p><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">[Unit]</span></span><br><span class="line"><span class="attr">Description</span>=nginx - high performance web server</span><br><span class="line"><span class="attr">After</span>=network.target</span><br><span class="line"></span><br><span class="line"><span class="section">[Service]</span></span><br><span class="line"><span class="attr">Type</span>=forking</span><br><span class="line"><span class="attr">User</span>=root</span><br><span class="line"><span class="attr">Group</span>=root</span><br><span class="line"><span class="attr">ExecStart</span>=/opt/nginx/nginx/sbin/nginx -c /opt/nginx/nginx/conf/nginx.conf </span><br><span class="line"><span class="attr">ExecReload</span>=/opt/nginx/nginx/sbin/nginx -s reload</span><br><span class="line"><span class="attr">ExecStop</span>=/opt/nginx/nginx/sbin/nginx -s quit</span><br><span class="line"></span><br><span class="line"><span class="section">[Install]</span></span><br><span class="line"><span class="attr">WantedBy</span>=multi-user.target</span><br></pre></td></tr></table></figure><blockquote><p>注意：<code>User</code>和<code>Group</code>字段应根据你的Nginx配置进行更改。同时，<code>ExecStart</code>字段中的Nginx路径也可能需要根据你的实际安装位置进行调整。</p><p>这里安装的路径是 <code>./configure --prefix=/opt/nginx/nginx </code></p></blockquote><h3 id="2-重新加载systemd配置"><a href="#2-重新加载systemd配置" class="headerlink" title="2. 重新加载systemd配置"></a>2. 重新加载systemd配置</h3><p>保存并关闭文件后，你需要重新加载systemd的配置，以便它识别新的Nginx服务文件。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo systemctl daemon-reload</span><br></pre></td></tr></table></figure><h3 id="3-启用并启动Nginx服务"><a href="#3-启用并启动Nginx服务" class="headerlink" title="3. 启用并启动Nginx服务"></a>3. 启用并启动Nginx服务</h3><p>现在，你可以使用<code>systemctl</code>命令来启用Nginx服务，以便它在系统启动时自动运行。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo systemctl <span class="built_in">enable</span> nginx</span><br></pre></td></tr></table></figure><p>然后，你可以手动启动Nginx服务来检查它是否按预期工作。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo systemctl start nginx</span><br></pre></td></tr></table></figure><h3 id="4-检查Nginx服务状态"><a href="#4-检查Nginx服务状态" class="headerlink" title="4. 检查Nginx服务状态"></a>4. 检查Nginx服务状态</h3><p>你可以使用以下命令来检查Nginx服务的状态：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo systemctl status nginx</span><br></pre></td></tr></table></figure><p>如果Nginx正在运行并且没有错误，那么你应该会看到“active (running)”的状态信息。</p><p>现在，Nginx已经被配置为在系统启动时自动运行了。如果你需要停止或重启Nginx服务，可以使用以下命令：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo systemctl stop nginx</span><br><span class="line">sudo systemctl restart nginx</span><br></pre></td></tr></table></figure><p>本文地址： <a href="https://github.com/maxzhao-it/blog/post/ec5ec98b123324/">https://github.com/maxzhao-it/blog/post/ec5ec98b123324/</a> </p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h3 id=&quot;1-编写Nginx的systemd服务文件&quot;&gt;&lt;a href=&quot;#1-编写Nginx的systemd服务文件&quot; class=&quot;headerlink&quot; title=&quot;1. 编写Nginx的systemd服务文件&quot;&gt;&lt;/a&gt;1. 编写Nginx的systemd服务文件
      
    
    </summary>
    
    
      <category term="Nginx" scheme="https://github.com/maxzhao-it/blog/categories/Nginx/"/>
    
    
      <category term="Linux" scheme="https://github.com/maxzhao-it/blog/tags/Linux/"/>
    
      <category term="Nginx" scheme="https://github.com/maxzhao-it/blog/tags/Nginx/"/>
    
  </entry>
  
</feed>
